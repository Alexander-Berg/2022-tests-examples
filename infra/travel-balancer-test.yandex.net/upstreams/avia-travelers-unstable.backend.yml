auth:
  staff:
    owners:
      logins:
      - miralx
      groups: []
labels:
  order: '10000000'
---
regexp_section:
  matcher:
    match_and:
      - match_fsm:
          host: 'travelers\\.unstable\\.avia\\.yandex\\.net'
      - match_fsm:
          path: '/v1/(.*)'
  modules:
    - rewrite:
        actions:
          - regexp: '/v1/(.*)'
            rewrite: '/%1'
    - balancer2:
        unique_policy: {}
        connection_attempts: !f count_backends()
        attempts: 2
        attempts_rate_limiter:
          limit: 0.05
        active:
          delay: '2s'
          request: 'GET /ping HTTP/1.0\nUser-agent: l7-balancer-health_check\n\n'
        generated_proxy_backends:
          proxy_options:
            backend_timeout: 60s
            connect_timeout: 100ms
            keepalive_count: 1
            keepalive_timeout: 60s
            fail_on_5xx: false
          include_backends:
            type: BY_ID
            ids: [avia-travelers-unstable.backend]
        on_error:
          errordocument:
            status: 504
            content: "Service unavailable (Generated by L7-Balancer)"
