auth:
  staff:
    owners:
      logins: []
      groups: []
labels:
  order: '10000000'
config_mode: easy2
---
l7_upstream_macro:
  version: 0.0.1
  id: avia-shared-flights-testing-admin
  matcher:
    url_re: "/admin(/.*)?"
  by_dc_scheme:
    dc_balancer:
      weights_section_id: 'bygeo'
      method: LOCAL_THEN_BY_DC_WEIGHT
      attempt_all_dcs: true
    balancer:
      attempts: 3
      backend_timeout: 20s
      connect_timeout: 200ms
      retry_non_idempotent: false
      retry_http_responses:
        codes: [5xx]
        on_last_failed_retry: PROXY_RESPONSE_AS_IS
      max_reattempts_share: 0.2
      max_pessimized_endpoints_share: 0.2
      health_check:
        delay: '2s'
        request: 'GET /ping HTTP/1.0\nUser-agent: l7-balancer-health_check\n\n'
    dcs:
      - name: sas
        backend_ids:
        - avia-shared-flights-testing.admin_sas
      - name: vla
        backend_ids:
        - avia-shared-flights-testing.admin_vla
    on_error:
      static:
        status: 503
        content: 'Service unavailable (Generated by L7-Balancer)'
