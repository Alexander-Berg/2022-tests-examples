instance_macro {
  version: "0.0.2"
  maxconn: 5000
  f_workers {
    type: GET_WORKERS
    get_workers_params {
    }
  }
  sections {
    key: "admin"
    value {
      ips {
        value: "127.0.0.1"
      }
      ips {
        value: "::1"
      }
      ports {
        f_value {
          type: GET_PORT_VAR
          get_port_var_params {
            var: "port"
          }
        }
      }
      nested {
        http {
          nested {
            admin {
            }
          }
        }
      }
    }
  }
  sections {
    key: "http_section"
    value {
      ips {
        value: "*"
      }
      ports {
        value: 80
      }
      nested {
        extended_http_macro {
          maxlen: 65536
          maxreq: 65536
          yandex_cookie_policy: YCP_STABLE
          nested {
            modules {
              exp_getter_macro {
                service_name: "test_uaas"
              }
            }
            modules {
              headers {
                create {
                  key: "h1"
                  value: "v1"
                }
              }
            }
            modules {
              regexp {
                include_upstreams {
                  filter {
                    any: true
                  }
                  order {
                    label {
                      name: "order"
                    }
                  }
                }
                prepend_sections {
                  key: "awacs-balancer-health-check"
                  value {
                    matcher {
                      match_fsm {
                        uri: "/awacs-balancer-health-check"
                      }
                    }
                    nested {
                      errordocument {
                        status: 200
                      }
                    }
                  }
                }
                prepend_sections {
                  key: "slbping"
                  value {
                    matcher {
                      match_fsm {
                        url: "/ping"
                      }
                    }
                    nested {
                      slb_ping_macro {
                        errordoc: true
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  tcp_listen_queue: 128
  unistat {
  }
  cpu_limiter {
    active_check_subnet_file: "./controls/active_check_subnets_list"
    disable_file: "./controls/cpu_limiter_disabled"
  }
  sd {
  }
  state_directory: "/dev/shm/balancer-state"
  f_dynamic_balancing_log {
    type: GET_LOG_PATH
    get_log_path_params {
      name: "dynamic_balancing_log"
      f_port {
        type: GET_PORT_VAR
        get_port_var_params {
          var: "port"
        }
      }
      default_log_dir: "/place/db/www/logs/"
    }
  }
  pinger_required: true
  f_pinger_log {
    type: GET_LOG_PATH
    get_log_path_params {
      name: "pinger_log"
      f_port {
        type: GET_PORT_VAR
        get_port_var_params {
          var: "port"
        }
      }
      default_log_dir: "/place/db/www/logs/"
    }
  }
  config_check {
  }
}