{
    "test_dsp_income.test_tariffication_layout[contract]": {
        "output_log_tariffed": [
            {
                "Amount": 18.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 15.0,
                "BillableAmount": 300.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 1,
                "ContractID": 10,
                "ContractObject": {
                    "client_id": 1,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 10,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 1,
                "EventCostVATCorrected": null,
                "EventDate": 1609448400,
                "EventTime": 1609448400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": null,
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 300.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609448400,
                "YandexPrice": null,
                "_TestCaseUID": "normal_case",
                "_chunk_record_index": 1,
                "_offset": 2,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 1,
                "ContractID": 10,
                "ContractObject": {
                    "client_id": 1,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 10,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 1,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@3@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "normal_case",
                "_chunk_record_index": 1,
                "_offset": 3,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 2,
                "ContractID": 20,
                "ContractObject": {
                    "client_id": 2,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 20,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 2,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@6@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "event_show",
                "_chunk_record_index": 1,
                "_offset": 6,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "undo-block-show",
                "ClientID": 3,
                "ContractID": 30,
                "ContractObject": {
                    "client_id": 3,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 30,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 3,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@9@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "event_undo_block_show",
                "_chunk_record_index": 1,
                "_offset": 9,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 4,
                "ContractID": 40,
                "ContractObject": {
                    "client_id": 4,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 40,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 4,
                "EventCostVATCorrected": null,
                "EventDate": 1625000400,
                "EventTime": 1625000400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@12@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1625000400,
                "YandexPrice": null,
                "_TestCaseUID": "contract_general_last_day",
                "_chunk_record_index": 1,
                "_offset": 12,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 5,
                "ContractID": 50,
                "ContractObject": {
                    "client_id": 5,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "end_dt": "2021-06-30T00:00:00",
                    "firm": 1,
                    "id": 50,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 5,
                "EventCostVATCorrected": null,
                "EventDate": 1625000400,
                "EventTime": 1625000400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@15@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1625000400,
                "YandexPrice": null,
                "_TestCaseUID": "contract_partners_last_day",
                "_chunk_record_index": 1,
                "_offset": 15,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 6.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 6,
                "ContractID": 61,
                "ContractObject": {
                    "client_id": 6,
                    "currency": 840,
                    "dt": "2021-04-01T00:00:00",
                    "end_dt": "2021-06-30T00:00:00",
                    "firm": 1,
                    "id": 61,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 6,
                "EventCostVATCorrected": null,
                "EventDate": 1619816400,
                "EventTime": 1619816400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@18@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1619816400,
                "YandexPrice": null,
                "_TestCaseUID": "two_contracts",
                "_chunk_record_index": 1,
                "_offset": 18,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": null,
                "AmountCurrency": null,
                "AmountWithoutNDS": null,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 10,
                "ContractID": null,
                "ContractObject": null,
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 10,
                "EventCostVATCorrected": null,
                "EventDate": 1585602000,
                "EventTime": 1585602000,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@29@1",
                "OutputStatus": "dropped_untariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": null,
                "ProductMdhID": null,
                "RubsPerContractCurrency": null,
                "TaxPolicyID": null,
                "TaxPolicyMdhID": null,
                "TaxPolicyPercentID": null,
                "TaxPolicyPercentMdhID": null,
                "TypeID": null,
                "UnixTime": 1585602000,
                "YandexPrice": null,
                "_TestCaseUID": "without_contract_outdated_event",
                "_chunk_record_index": 1,
                "_offset": 29,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": null,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": null,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 12,
                "ContractID": 120,
                "ContractObject": {
                    "client_id": 12,
                    "currency": 840,
                    "dt": "2020-01-01T00:00:00",
                    "end_dt": "2021-12-31T00:00:00",
                    "firm": 1,
                    "id": 120,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 12,
                "EventCostVATCorrected": null,
                "EventDate": 1585602000,
                "EventTime": 1585602000,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@33@1",
                "OutputStatus": "dropped_untariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": null,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1585602000,
                "YandexPrice": null,
                "_TestCaseUID": "with_contract_outdated_event",
                "_chunk_record_index": 1,
                "_offset": 33,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 15.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 15.0,
                "BillableAmount": 300.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 14,
                "ContractID": 140,
                "ContractObject": {
                    "client_id": 14,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 140,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 14,
                "EventCostVATCorrected": null,
                "EventDate": 1609448400,
                "EventTime": 1609448400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": null,
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 300.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609448400,
                "YandexPrice": null,
                "_TestCaseUID": "normal_case_firm4",
                "_chunk_record_index": 1,
                "_offset": 38,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 14,
                "ContractID": 140,
                "ContractObject": {
                    "client_id": 14,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 140,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 14,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@39@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "normal_case_firm4",
                "_chunk_record_index": 1,
                "_offset": 39,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 15,
                "ContractID": 150,
                "ContractObject": {
                    "client_id": 15,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 150,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 15,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@42@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "event_show_firm4",
                "_chunk_record_index": 1,
                "_offset": 42,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "undo-block-show",
                "ClientID": 16,
                "ContractID": 160,
                "ContractObject": {
                    "client_id": 16,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 160,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 16,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@45@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "event_undo_block_show_firm4",
                "_chunk_record_index": 1,
                "_offset": 45,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 17,
                "ContractID": 170,
                "ContractObject": {
                    "client_id": 17,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 170,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 17,
                "EventCostVATCorrected": null,
                "EventDate": 1625000400,
                "EventTime": 1625000400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@48@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1625000400,
                "YandexPrice": null,
                "_TestCaseUID": "contract_general_last_day_firm4",
                "_chunk_record_index": 1,
                "_offset": 48,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 18,
                "ContractID": 180,
                "ContractObject": {
                    "client_id": 18,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "end_dt": "2021-06-30T00:00:00",
                    "firm": 4,
                    "id": 180,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 18,
                "EventCostVATCorrected": null,
                "EventDate": 1625000400,
                "EventTime": 1625000400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@51@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1625000400,
                "YandexPrice": null,
                "_TestCaseUID": "contract_partners_last_day_firm4",
                "_chunk_record_index": 1,
                "_offset": 51,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 19,
                "ContractID": 191,
                "ContractObject": {
                    "client_id": 19,
                    "currency": 840,
                    "dt": "2021-04-01T00:00:00",
                    "end_dt": "2021-06-30T00:00:00",
                    "firm": 4,
                    "id": 191,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 19,
                "EventCostVATCorrected": null,
                "EventDate": 1619816400,
                "EventTime": 1619816400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@54@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1619816400,
                "YandexPrice": null,
                "_TestCaseUID": "two_contracts_firm4",
                "_chunk_record_index": 1,
                "_offset": 54,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": null,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": null,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 25,
                "ContractID": 250,
                "ContractObject": {
                    "client_id": 25,
                    "currency": 840,
                    "dt": "2020-01-01T00:00:00",
                    "end_dt": "2021-12-31T00:00:00",
                    "firm": 4,
                    "id": 250,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 25,
                "EventCostVATCorrected": null,
                "EventDate": 1585602000,
                "EventTime": 1585602000,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@64@1",
                "OutputStatus": "dropped_untariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": null,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1585602000,
                "YandexPrice": null,
                "_TestCaseUID": "with_contract_outdated_event_firm4",
                "_chunk_record_index": 1,
                "_offset": 64,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 5.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 5.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 27,
                "ContractID": 270,
                "ContractObject": {
                    "client_id": 27,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "end_dt": "2021-12-31T00:00:00",
                    "firm": 4,
                    "id": 270,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "PARTNERS"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-01T00:00:00+03:00",
                "DSPID": 27,
                "EventCostVATCorrected": null,
                "EventDate": 1619816400,
                "EventTime": 1619816400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@67@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 20.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1619816400,
                "YandexPrice": null,
                "_TestCaseUID": "contracts_different_services_firm4",
                "_chunk_record_index": 1,
                "_offset": 67,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_log_tariffed_internal": [],
        "output_log_untariffed": [
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 7,
                "EventCostVATCorrected": null,
                "EventDate": 1625086800,
                "EventTime": 1625086800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@22@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1625086800,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 7,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "general_contract_not_active",
                "_chunk_record_index": 1,
                "_offset": 22,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 8,
                "EventCostVATCorrected": null,
                "EventDate": 1625086800,
                "EventTime": 1625086800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@25@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1625086800,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 8,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "partners_contract_not_active",
                "_chunk_record_index": 1,
                "_offset": 25,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 9,
                "EventCostVATCorrected": null,
                "EventDate": 1625000400,
                "EventTime": 1625000400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@28@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1625000400,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": null,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "no_client",
                "_chunk_record_index": 1,
                "_offset": 28,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 13,
                "EventCostVATCorrected": null,
                "EventDate": 1601413200,
                "EventTime": 1601413200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@36@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1601413200,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 13,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "without_contract_fresh_event",
                "_chunk_record_index": 1,
                "_offset": 36,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 20,
                "EventCostVATCorrected": null,
                "EventDate": 1625086800,
                "EventTime": 1625086800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@58@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1625086800,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 20,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "general_contract_not_active_firm4",
                "_chunk_record_index": 1,
                "_offset": 58,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 21,
                "EventCostVATCorrected": null,
                "EventDate": 1625086800,
                "EventTime": 1625086800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@61@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1625086800,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 21,
                    "ContractID": null,
                    "ContractObject": null,
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "partners_contract_not_active_firm4",
                "_chunk_record_index": 1,
                "_offset": 61,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_meta_tariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "prev_run_id": "2020-12-31T11:00:00",
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_tariffed_internal": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "prev_run_id": "2020-12-31T11:00:00",
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_untariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "prev_run_id": "2020-12-31T11:00:00",
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_metrics_tariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1625000400.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1585602000.0
            },
            {
                "name": "billable_amount",
                "type": "float",
                "value": 2200.0
            },
            {
                "name": "dropped_billable_amount",
                "type": "float",
                "value": 300.0
            }
        ],
        "output_metrics_tariffed_internal": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 0.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 0.0
            }
        ],
        "output_metrics_untariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1625086800.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1601413200.0
            }
        ]
    },
    "test_dsp_income.test_tariffication_layout[currency]": {
        "output_log_tariffed": [
            {
                "Amount": 12.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 2,
                "ContractID": 20,
                "ContractObject": {
                    "client_id": 2,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 20,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-02T00:00:00+03:00",
                "DSPID": 2,
                "EventCostVATCorrected": null,
                "EventDate": 1609534800,
                "EventTime": 1609534800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@74@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609534800,
                "YandexPrice": null,
                "_TestCaseUID": "currency_usd",
                "_chunk_record_index": 1,
                "_offset": 74,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 4.8,
                "AmountCurrency": "EUR",
                "AmountWithoutNDS": 4.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 3,
                "ContractID": 30,
                "ContractObject": {
                    "client_id": 3,
                    "currency": 978,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 30,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-02T00:00:00+03:00",
                "DSPID": 3,
                "EventCostVATCorrected": null,
                "EventDate": 1609534800,
                "EventTime": 1609534800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@78@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503366,
                "ProductMdhID": "0b4846f5-3844-4974-a6ef-3c153a81f161",
                "RubsPerContractCurrency": 25.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609534800,
                "YandexPrice": null,
                "_TestCaseUID": "currency_eur",
                "_chunk_record_index": 1,
                "_offset": 78,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 120.0,
                "AmountCurrency": "RUB",
                "AmountWithoutNDS": 100.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 4,
                "ContractID": 40,
                "ContractObject": {
                    "client_id": 4,
                    "currency": 810,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 40,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 4,
                "EventCostVATCorrected": null,
                "EventDate": 1609621200,
                "EventTime": 1609621200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@82@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503364,
                "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                "RubsPerContractCurrency": 1.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609621200,
                "YandexPrice": null,
                "_TestCaseUID": "currency_rur",
                "_chunk_record_index": 1,
                "_offset": 82,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 12.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 5,
                "ContractID": 50,
                "ContractObject": {
                    "client_id": 5,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 50,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-04T00:00:00+03:00",
                "DSPID": 5,
                "EventCostVATCorrected": null,
                "EventDate": 1609707600,
                "EventTime": 1609707600,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@85@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609707600,
                "YandexPrice": null,
                "_TestCaseUID": "duplicate_currency",
                "_chunk_record_index": 1,
                "_offset": 85,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 12.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 6,
                "ContractID": 60,
                "ContractObject": {
                    "client_id": 6,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 60,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-06T00:00:00+03:00",
                "DSPID": 6,
                "EventCostVATCorrected": null,
                "EventDate": 1609880400,
                "EventTime": 1609880400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@90@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609880400,
                "YandexPrice": null,
                "_TestCaseUID": "mutilple_currency",
                "_chunk_record_index": 1,
                "_offset": 90,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 12.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 7,
                "ContractID": 70,
                "ContractObject": {
                    "client_id": 7,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 70,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-08T00:00:00+03:00",
                "DSPID": 7,
                "EventCostVATCorrected": null,
                "EventDate": 1610139600,
                "EventTime": 1610139600,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@96@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1610139600,
                "YandexPrice": null,
                "_TestCaseUID": "last_active_currency",
                "_chunk_record_index": 1,
                "_offset": 96,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 10.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 10,
                "ContractID": 100,
                "ContractObject": {
                    "client_id": 10,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 100,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-02T00:00:00+03:00",
                "DSPID": 10,
                "EventCostVATCorrected": null,
                "EventDate": 1609534800,
                "EventTime": 1609534800,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@106@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609534800,
                "YandexPrice": null,
                "_TestCaseUID": "currency_usd",
                "_chunk_record_index": 1,
                "_offset": 106,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 10.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 13,
                "ContractID": 130,
                "ContractObject": {
                    "client_id": 13,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 130,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-04T00:00:00+03:00",
                "DSPID": 13,
                "EventCostVATCorrected": null,
                "EventDate": 1609707600,
                "EventTime": 1609707600,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@110@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609707600,
                "YandexPrice": null,
                "_TestCaseUID": "duplicate_currency",
                "_chunk_record_index": 1,
                "_offset": 110,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 10.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 14,
                "ContractID": 140,
                "ContractObject": {
                    "client_id": 14,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 140,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-06T00:00:00+03:00",
                "DSPID": 14,
                "EventCostVATCorrected": null,
                "EventDate": 1609880400,
                "EventTime": 1609880400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@115@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1609880400,
                "YandexPrice": null,
                "_TestCaseUID": "mutilple_currency",
                "_chunk_record_index": 1,
                "_offset": 115,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 10.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "show",
                "ClientID": 15,
                "ContractID": 150,
                "ContractObject": {
                    "client_id": 15,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 150,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-08T00:00:00+03:00",
                "DSPID": 15,
                "EventCostVATCorrected": null,
                "EventDate": 1610139600,
                "EventTime": 1610139600,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@121@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1610139600,
                "YandexPrice": null,
                "_TestCaseUID": "last_active_currency",
                "_chunk_record_index": 1,
                "_offset": 121,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_log_tariffed_internal": [],
        "output_log_untariffed": [
            {
                "BillableEventType": "show",
                "CostCur": null,
                "DSPID": 1,
                "EventCostVATCorrected": null,
                "EventDate": 1609448400,
                "EventTime": 1609448400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@71@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1609448400,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": "USD",
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 1,
                    "ContractID": 10,
                    "ContractObject": {
                        "client_id": 1,
                        "currency": 840,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 1,
                        "id": 10,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": 503365,
                    "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": 200,
                    "TaxPolicyMdhID": "MDH_ID_200",
                    "TaxPolicyPercentID": 100,
                    "TaxPolicyPercentMdhID": "MDH_ID_100"
                },
                "_TestCaseUID": "no_currency_rate",
                "_chunk_record_index": 1,
                "_offset": 71,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "show",
                "CostCur": null,
                "DSPID": 8,
                "EventCostVATCorrected": null,
                "EventDate": 1610226000,
                "EventTime": 1610226000,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@100@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1610226000,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 8,
                    "ContractID": 80,
                    "ContractObject": {
                        "client_id": 8,
                        "currency": 9999999,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 1,
                        "id": 80,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": 200,
                    "TaxPolicyMdhID": "MDH_ID_200",
                    "TaxPolicyPercentID": 100,
                    "TaxPolicyPercentMdhID": "MDH_ID_100"
                },
                "_TestCaseUID": "unknown_currency",
                "_chunk_record_index": 1,
                "_offset": 100,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "show",
                "CostCur": null,
                "DSPID": 9,
                "EventCostVATCorrected": null,
                "EventDate": 1609448400,
                "EventTime": 1609448400,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@103@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1609448400,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": "USD",
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 9,
                    "ContractID": 90,
                    "ContractObject": {
                        "client_id": 9,
                        "currency": 840,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 4,
                        "id": 90,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": 503365,
                    "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": 200,
                    "TaxPolicyMdhID": "MDH_ID_200",
                    "TaxPolicyPercentID": 100,
                    "TaxPolicyPercentMdhID": "MDH_ID_100"
                },
                "_TestCaseUID": "no_currency_rate",
                "_chunk_record_index": 1,
                "_offset": 103,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "show",
                "CostCur": null,
                "DSPID": 16,
                "EventCostVATCorrected": null,
                "EventDate": 1610226000,
                "EventTime": 1610226000,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@125@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1610226000,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": null,
                    "AmountWithoutNDS": null,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 16,
                    "ContractID": 160,
                    "ContractObject": {
                        "client_id": 16,
                        "currency": 9999999,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 4,
                        "id": 160,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": null,
                    "ProductMdhID": null,
                    "RubsPerContractCurrency": null,
                    "TaxPolicyID": 200,
                    "TaxPolicyMdhID": "MDH_ID_200",
                    "TaxPolicyPercentID": 100,
                    "TaxPolicyPercentMdhID": "MDH_ID_100"
                },
                "_TestCaseUID": "unknown_currency",
                "_chunk_record_index": 1,
                "_offset": 125,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_meta_tariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_tariffed_internal": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_untariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_metrics_tariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1610139600.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1609534800.0
            },
            {
                "name": "billable_amount",
                "type": "float",
                "value": 1000.0
            },
            {
                "name": "dropped_billable_amount",
                "type": "float",
                "value": 0.0
            }
        ],
        "output_metrics_tariffed_internal": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 0.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 0.0
            }
        ],
        "output_metrics_untariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1610226000.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1609448400.0
            }
        ]
    },
    "test_dsp_income.test_tariffication_layout[tax]": {
        "output_log_tariffed": [
            {
                "Amount": 120.0,
                "AmountCurrency": "RUB",
                "AmountWithoutNDS": 100.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 2,
                "ContractID": 20,
                "ContractObject": {
                    "client_id": 2,
                    "currency": 810,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 1,
                    "id": 20,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 2,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@131@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503364,
                "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                "RubsPerContractCurrency": 1.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "duplicate_firm",
                "_chunk_record_index": 1,
                "_offset": 131,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 120.0,
                "AmountCurrency": "RUB",
                "AmountWithoutNDS": 100.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 3,
                "ContractID": 30,
                "ContractObject": {
                    "client_id": 3,
                    "currency": 810,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 3,
                    "id": 30,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 3,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@134@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503364,
                "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                "RubsPerContractCurrency": 1.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "choose_tax_by_date",
                "_chunk_record_index": 1,
                "_offset": 134,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 120.0,
                "AmountCurrency": "RUB",
                "AmountWithoutNDS": 100.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 4,
                "ContractID": 40,
                "ContractObject": {
                    "client_id": 4,
                    "currency": 810,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 44,
                    "id": 40,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 4,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@137@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503364,
                "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                "RubsPerContractCurrency": 1.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "duplicate_percent",
                "_chunk_record_index": 1,
                "_offset": 137,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 120.0,
                "AmountCurrency": "RUB",
                "AmountWithoutNDS": 100.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 5,
                "ContractID": 50,
                "ContractObject": {
                    "client_id": 5,
                    "currency": 810,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 5,
                    "id": 50,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": null,
                "DSPID": 5,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@140@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503364,
                "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                "RubsPerContractCurrency": 1.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "choose_by_default_tax",
                "_chunk_record_index": 1,
                "_offset": 140,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "Amount": 10.0,
                "AmountCurrency": "USD",
                "AmountWithoutNDS": 10.0,
                "BillableAmount": 100.0,
                "BillableAmountCurrency": "RUB",
                "BillableEventType": "block-show",
                "ClientID": 7,
                "ContractID": 70,
                "ContractObject": {
                    "client_id": 7,
                    "currency": 840,
                    "dt": "2021-01-01T00:00:00",
                    "finish_dt": "2021-07-01T00:00:00",
                    "firm": 4,
                    "id": 70,
                    "person_id": 666,
                    "person_type": "ur",
                    "services": [
                        80
                    ],
                    "type": "GENERAL"
                },
                "CostCur": null,
                "CurrencyRateDate": "2021-01-02T00:00:00+03:00",
                "DSPID": 7,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@147@1",
                "OutputStatus": "tariffed",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "ProductID": 503365,
                "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                "RubsPerContractCurrency": 10.0,
                "TaxPolicyID": 200,
                "TaxPolicyMdhID": "MDH_ID_200",
                "TaxPolicyPercentID": 100,
                "TaxPolicyPercentMdhID": "MDH_ID_100",
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TestCaseUID": "duplicate_firm",
                "_chunk_record_index": 1,
                "_offset": 147,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_log_tariffed_internal": [],
        "output_log_untariffed": [
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 1,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@128@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": "RUB",
                    "AmountWithoutNDS": 100.0,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 1,
                    "ContractID": 10,
                    "ContractObject": {
                        "client_id": 1,
                        "currency": 810,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 123456789,
                        "id": 10,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": null,
                    "OutputStatus": "untariffed",
                    "ProductID": 503364,
                    "ProductMdhID": "675abbd6-bd4c-48cd-b0ec-75d8bc92c36d",
                    "RubsPerContractCurrency": 1.0,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "no_firm",
                "_chunk_record_index": 1,
                "_offset": 128,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            },
            {
                "BillableEventType": "block-show",
                "CostCur": null,
                "DSPID": 6,
                "EventCostVATCorrected": null,
                "EventDate": 1612213200,
                "EventTime": 1612213200,
                "FakePrice": null,
                "ImpID": null,
                "LBMessageUID": "c1@t1@0@143@1",
                "PageID": null,
                "PartnerCost": null,
                "PartnerPrice": null,
                "PartnerStatID": null,
                "PlaceID": null,
                "Price": 100.0,
                "TypeID": null,
                "UnixTime": 1612213200,
                "YandexPrice": null,
                "_TarifficationInfo": {
                    "Amount": null,
                    "AmountCurrency": "USD",
                    "AmountWithoutNDS": 10.0,
                    "BillableAmount": 100.0,
                    "BillableAmountCurrency": "RUB",
                    "ClientID": 6,
                    "ContractID": 60,
                    "ContractObject": {
                        "client_id": 6,
                        "currency": 840,
                        "dt": "2021-01-01T00:00:00",
                        "finish_dt": "2021-07-01T00:00:00",
                        "firm": 123456789,
                        "id": 60,
                        "person_id": 666,
                        "person_type": "ur",
                        "services": [
                            80
                        ],
                        "type": "GENERAL"
                    },
                    "CurrencyRateDate": "2021-01-02T00:00:00+03:00",
                    "OutputStatus": "untariffed",
                    "ProductID": 503365,
                    "ProductMdhID": "b6e2e55e-511c-487b-81d9-195837d1c298",
                    "RubsPerContractCurrency": 10.0,
                    "TaxPolicyID": null,
                    "TaxPolicyMdhID": null,
                    "TaxPolicyPercentID": null,
                    "TaxPolicyPercentMdhID": null
                },
                "_TestCaseUID": "no_firm",
                "_chunk_record_index": 1,
                "_offset": 143,
                "_partition": 0,
                "_topic": "t1",
                "_topic_cluster": "c1"
            }
        ],
        "output_meta_tariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_tariffed_internal": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_meta_untariffed": {
            "log_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_client_dsp_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_contract_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "ref_currency_interval": {
                "topics": [
                    {
                        "cluster": "c1",
                        "partitions": [
                            {
                                "first_offset": 0,
                                "next_offset": 151,
                                "partition": 0
                            }
                        ],
                        "topic": "t1"
                    }
                ]
            },
            "run_id": "2021-01-01T00:00:00"
        },
        "output_metrics_tariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1612213200.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1612213200.0
            },
            {
                "name": "billable_amount",
                "type": "float",
                "value": 500.0
            },
            {
                "name": "dropped_billable_amount",
                "type": "float",
                "value": 0.0
            }
        ],
        "output_metrics_tariffed_internal": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 0.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 0.0
            }
        ],
        "output_metrics_untariffed": [
            {
                "name": "last_event_time",
                "type": "timestamp",
                "value": 1612213200.0
            },
            {
                "name": "late_event_time",
                "type": "timestamp",
                "value": 1612213200.0
            }
        ]
    }
}
