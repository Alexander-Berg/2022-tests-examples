// <<< AUTOGENERATED BY YANDEX.SCRIPT FROM mock-backend/sbp-request-handler.ts >>>

package com.yandex.xplat.testopithecus.payment.sdk

import com.yandex.xplat.common.*
import com.yandex.xplat.eventus.common.*
import com.yandex.xplat.testopithecus.common.*
import com.yandex.xplat.payment.sdk.*

public open class SbpRequestHandler(private val trustModel: MockTrustModel): HttpRequestHandler {
    open override fun handleRequest(request: HttpRequest): HttpResponse {
        if (request.url.startsWith("/sbp_pay")) {
            val url = Uris.fromString(request.url)
            if (url == null) {
                return HttpResponseBuilder().setCode(500).build()
            }
            val purchaseToken = url!!.getQueryParameter("purchase_token")
            if (purchaseToken == null) {
                return HttpResponseBuilder().setCode(500).build()
            }
            val result = this.trustModel.confirmSbpPaid(purchaseToken)
            return HttpResponseBuilder().setCode(if (result) 200 else 500).build()
        }
        return HttpResponseBuilder().setCode(500).build()
    }

}

