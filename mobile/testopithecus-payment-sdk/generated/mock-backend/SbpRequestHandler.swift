// <<< AUTOGENERATED BY YANDEX.SCRIPT FROM mock-backend/sbp-request-handler.ts >>>

import Foundation

open class SbpRequestHandler: HttpRequestHandler {
  private let trustModel: MockTrustModel
  public init(_ trustModel: MockTrustModel) {
    self.trustModel = trustModel
  }

  @discardableResult
  open func handleRequest(_ request: HttpRequest) -> HttpResponse {
    if request.url.startsWith("/sbp_pay") {
      let url: Uri! = Uris.fromString(request.url)
      if url == nil {
        return HttpResponseBuilder().setCode(500).build()
      }
      let purchaseToken: String! = url!.getQueryParameter("purchase_token")
      if purchaseToken == nil {
        return HttpResponseBuilder().setCode(500).build()
      }
      let result = self.trustModel.confirmSbpPaid(purchaseToken)
      return HttpResponseBuilder().setCode(result ? 200 : 500).build()
    }
    return HttpResponseBuilder().setCode(500).build()
  }

}

