task assemblePerfTests() {
    def outputPerfDir = "${rootProject.buildDir}/perf"

    doLast {
        def copied = 0
        copy {
            from buildDir
            into outputPerfDir
            include "**/debug/perftests-debug.apk"
            eachFile { file ->
                file.path = "mock-app.apk"
                copied += 1
            }
            includeEmptyDirs = false
        }
        assert copied == 1 && file("$outputPerfDir/mock-app.apk").exists()

        copy {
            from buildDir
            into outputPerfDir
            include "**/androidTest/debug/perftests-debug-androidTest.apk"
            eachFile { file ->
                file.path = "tests.apk"
                copied += 1
            }
            includeEmptyDirs = false
        }
        assert copied == 2 && file("$outputPerfDir/tests.apk").exists()
    }

    dependsOn("assembleDebug", "assembleDebugAndroidTest")
}