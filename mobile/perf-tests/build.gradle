import com.android.build.gradle.tasks.PackageAndroidArtifact
import com.yandex.mobile.tools.signing.SignActionFactory
import com.yandex.mobile.tools.signing.task.SignTask
import com.yandex.mobile.tools.signing.task.SignTaskAndroidAGP3

android {
    defaultConfig {
        // min for ui-automator
        minSdkVersion 18

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    testBuildType "release"

    buildTypes {
        release {
            buildConfigField "String", "INSTRUMENTED_APP_PACKAGE", '"ru.yandex.yandexbus"'
        }
        debug {
            buildConfigField "String", "INSTRUMENTED_APP_PACKAGE", '"ru.yandex.yandexbus.inhouse"'
        }
    }
}

dependencies {

    testImplementation deps.junit

    androidTestImplementation deps.perfTestsRunner
    androidTestImplementation deps.androidx.test.runner
    androidTestImplementation deps.androidx.test.uiAutomator
}

// ~M TODO разобраться, что здесь за фигня
//if (isServerBuild) {
//    apply plugin: "yandex-signer-android"
//
//    afterEvaluate {
//        final PackageAndroidArtifact packageTask = tasks.findByName('packageReleaseAndroidTest')
//        if (packageTask != null) {
//            final SignTask signTask = new SignTaskAndroidAGP3(project, SignActionFactory.ANDROID)
//            signTask.defineVariables()
//
//            packageTask.apkNames.each { final String apkName ->
//                final File artifact = new File(packageTask.outputDirectory, apkName)
//                packageTask.doLast(signTask.createAction(artifact.absolutePath))
//            }
//        }
//    }
//}
