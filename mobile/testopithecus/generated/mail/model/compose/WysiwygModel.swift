// <<< AUTOGENERATED BY YANDEX.SCRIPT FROM mail/model/compose/wysiwyg-model.ts >>>

import Foundation

open class WysiwygModel: WYSIWIG {
  private var symbols: YSArray<String> = YSArray()
  private var styles: YSArray<YSSet<String>> = YSArray()
  @discardableResult
  open func clearFormatting(_ from: Int32, _ to: Int32) throws -> Void {
    for i in stride(from: from, to: to, by: 1) {
      self.styles[i] = YSSet<String>()
    }
  }

  @discardableResult
  open func setStrong(_ from: Int32, _ to: Int32) throws -> Void {
    for i in stride(from: from, to: to, by: 1) {
      self.styles[i].add("strong")
    }
  }

  @discardableResult
  open func setItalic(_ from: Int32, _ to: Int32) throws -> Void {
    for i in stride(from: from, to: to, by: 1) {
      self.styles[i].add("em")
    }
  }

  @discardableResult
  open func appendText(_ index: Int32, _ text: String) throws -> Void {
    let newBody: YSArray<String> = YSArray()
    let newStyles: YSArray<YSSet<String>> = YSArray()
    let startIndex: Int32 = 0
    if index < 1 {
      for i in stride(from: startIndex, to: text.length, by: 1) {
        let symbol = text.slice(i, i + 1)
        newBody.push(symbol)
        if self.styles.length > index {
          newStyles.push(self.styles[index])
        } else {
          newStyles.push(YSSet<String>())
        }
      }
      for i in stride(from: 0, to: self.symbols.length, by: 1) {
        newBody.push(self.symbols[i])
        newStyles.push(self.styles[i])
      }
    } else {
      for i in stride(from: 0, to: self.symbols.length, by: 1) {
        if i == index {
          for j in stride(from: startIndex, to: text.length, by: 1) {
            let symbol = text.slice(j, j + 1)
            newBody.push(symbol)
            newStyles.push(self.styles[i - 1])
          }
        }
        newBody.push(self.symbols[i])
        newStyles.push(self.styles[i])
      }
    }
    self.symbols = newBody
    self.styles = newStyles
  }

  @discardableResult
  open func getBody() -> String {
    var newBody = ""
    var prevStyles: YSSet<String> = YSSet<String>()
    var appendSymbol: String
    let startIndex: Int32 = 0
    for i in stride(from: startIndex, to: self.symbols.length, by: 1) {
      appendSymbol = ""
      for style in self.styles[i].values() {
        if !prevStyles.has(style) {
          appendSymbol += "<\(style)>"
        }
      }
      for style in prevStyles.values() {
        if !self.styles[i].has(style) {
          appendSymbol += "</\(style)>"
        }
      }
      appendSymbol += self.symbols[i]
      newBody += appendSymbol
      prevStyles = self.styles[i]
    }
    return newBody
  }

  open func clear() -> Void {
    self.symbols = YSArray()
    self.styles = YSArray()
  }

  @discardableResult
  open func getSymbols() -> YSArray<String> {
    return self.symbols
  }

  @discardableResult
  open func getStyles() -> YSArray<YSSet<String>> {
    return self.styles
  }

}

