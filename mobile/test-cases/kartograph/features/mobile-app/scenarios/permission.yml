components: permission
testing:
  - regress

aliases:
  - &TODO
    - do: Переустановить приложение
    - do: Пройти онбординг
    - do: Авторизоваться в приложении
    - assert: Открывается главный экран приложения

specs:
  Запрет на доступ к камере через системный поп-ап:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - assert: Появляется системный поп-ап на доступ к камере
    - do: Тап "Запретить"
    - assert: Поп-ап скрылся
    - do: (android) Выдать разрешение на доступ к микрофону
    - do: Выдать разрешение на доступ к геопозиции
    - assert: (ios) Появился поп-ап на допуск уведомлений
    - do: (ios) Выдать доступ на отправку уведомлений
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере
    - do: Тап на кнопку "Разрешить доступ к камере" в заглушке
    - assert: |
        (ios) Открываются настройки приложения на девайсе
        (android) Повторно появляется системный поп-ап на доступ к камере
    - do: (android) Активировать чек-бокс "Больше не спрашивать"
    - do: (android) Тап на "Отклонить"
    - assert: |
        Поп-ап скрылся
        Отображается заглушка о необходимости дать доступ к камере
    - do: (android) Тап на кнопку "Разрешить доступ к камере" в заглушке
    - assert: Открываются настройки приложения на девайсе

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Запрет на доступ к камере через настройки приложения на девайсе:
    - preconditions: |
        Выданы все разрешения
        Пользователь авторизован
    - do: Перейти в настройки девайса > Картограф и запретить доступ к камере
    - do: Вернуться в приложение
    - do: Перейти в таб Съемка
    - do: Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Запрет на доступ к микрофону через системный поп-ап:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - do: Выдать разрешение на доступ к камере
    - assert: Появляется системный поп-ап на доступ к микрофону
    - do: Тап "Отклонить"
    - assert: Поп-ап скрылся
    - do: Выдать разрешение на доступ к геопозиции
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере
    - do: Тап на кнопку "Разрешить доступ к камере" в заглушке
    - assert: Повторно появляется системный поп-ап на доступ к микрофону
    - do: Активировать чек-бокс "Больше не спрашивать"
    - do: Тап на "Отклонить"
    - assert: |
        Поп-ап скрылся
        Отображается заглушка о необходимости дать доступ к камере
    - do: Тап на кнопку "Разрешить доступ к камере" в заглушке
    - assert: Открываются настройки приложения на девайсе

    - platforms:
        - android
    - tags:
        - assessors


  Запрет на доступ к микрофону через настройки девайса:
    - info: |
        Выданы все разрешения
        Пользователь авторизован
    - do: Перейти в настройки девайса > Картограф и запретить доступ к микрофону
    - do: Вернуться в приложение
    - do: Перейти в таб Съемка
    - do: Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере

    - platforms:
      - android
    - tags:
      - assessors


  Запрет на доступ к геопозиции через системный поп-ап:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - do: Выдать разрешение на доступ к камере
    - do: (android) Выдать разрешение на доступ к микрофону
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Тап "Запретить"
    - assert: (ios) Появился поп-ап на допуск уведомлений
    - do: (ios) Выдать доступ на отправку уведомлений
    - assert: |
        Поп-ап скрылся
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к геопозиции
    - do: Тап на кнопку "Разрешить доступ к геопозиции" в заглушке
    - assert: |
        (ios) Открываются настройки приложения на девайсе
        (android) Повторно появляется системный поп-ап на доступ к камере
    - do: (android) Активировать чек-бокс "Больше не спрашивать"
    - do: (android) Тап на "Отклонить"
    - assert: |
        Поп-ап скрылся
        Отображается заглушка о необходимости дать доступ к геопозиции
    - do: (android) Тап на кнопку "Разрешить доступ к геопозиции" в заглушке
    - assert: Открываются настройки приложения на девайсе

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Запрет на доступ к геопозиции через настройки девайса:
    - info: |
        Выданы все разрешения
        Пользователь авторизован
    - do: Перейти в настройки девайса > Картограф и запретить доступ к геопозиции
    - do: Вернуться в приложение
    - do: Перейти в таб Съемка
    - do: Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отсутствие повторных запросов после перезапуска приложения:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - assert: Появляется системный поп-ап на доступ к камере
    - do: Выдать разрешение
    - assert: (android) Появляется системный поп-ап на доступ к микрофону
    - do: (android) Выдать разрешение
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Выдать разрешение
    - assert: |
        Открывается экран съемки маршрута
        Отображается онбординг экрана съемки
    - do: Перезапустить приложение
    - do: Тап на "Съемка маршрута"
    - assert: |
        Системные разрешения повторно не запрашиваются
        Открывается экран съемки маршрута
        На экране отображается картинка с камеры устройства

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Смена заглушек на экране съемки при отсутствии всех разрешений:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - assert: Появляется системный поп-ап на доступ к камере
    - do: Отклонить разрешение
    - assert: (android) Появляется системный поп-ап на доступ к микрофону
    - do: (android) Отклонить разрешение
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Отклонить разрешение
    - assert: (ios) Появился поп-ап на допуск уведомлений
    - do: (ios) Выдать доступ на отправку уведомлений
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере
    - do: Перейти в настройки девайса > Картограф и выдать разрешение на камеру
    - do: (android) Перезагрузить приложение
    - do: (android) Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к камере
    - do: (android) Перейти в настройки девайса > Картограф и выдать разрешение на микрофон
    - do: Перезагрузить приложение
    - do: Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки
        Отображается заглушка о необходимости дать доступ к геопозиции
    - do: Перейти в настройки девайса > Картограф и выдать разрешение на геопозицию
    - do: Перезагрузить приложение
    - do: Тап на "Съемка маршрута"
    - assert: |
        Открывается экран съемки маршрута
        Отображается онбординг экрана съемки

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Показ системных пермишенов в разделе Видео:
    - *TODO
    - do: Перейти в таб "Галерея"
    - do: Перейти в раздел "Видео"
    - assert: Отображается заглушка "Пока нет снятых видео"
    - do: Тап по кнопке "Снять маршрут"
    - assert: Появляется системный поп-ап на доступ к камере
    - do: Выдать разрешение
    - assert: (android) Появляется системный поп-ап на доступ к микрофону
    - do: (android) Выдать разрешение
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Выдать разрешение
    - assert: (ios) Появился поп-ап на допуск уведомлений
    - do: (ios) Выдать разрешение
    - assert: |
        Открывается экран съемки маршрута
        Отображается онбординг экрана съемки

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Показ системных пермишенов в разделе Маршруты:
    - info: Авторизоваться аккаунтом, на котором раньше не выгружались маршруты
    - *TODO
    - do: Перейти в таб "Галерея"
    - do: Перейти в раздел "Видео"
    - assert: Отображается заглушка "Пока нет снятых маршрутов"
    - do: Тап по кнопке "Снять маршрут"
    - assert: Появляется системный поп-ап на доступ к камере
    - do: Выдать разрешение
    - assert: (android) Появляется системный поп-ап на доступ к микрофону
    - do: (android) Выдать разрешение
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Выдать разрешение
    - assert: (ios) Появился поп-ап на допуск уведомлений
    - do: (ios) Выдать разрешение
    - assert: |
        Открывается экран съемки маршрута
        Отображается онбординг экрана съемки

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Разрешение на однократный доступ к геопозиции через системный поп-ап:
    - *TODO
    - do: Тап на "Съемка маршрута"
    - do: Выдать разрешение на доступ к камере
    - assert: Появляется системный поп-ап на доступ к геопозиции
    - do: Тап "Однократно"
    - assert: Появился поп-ап на допуск уведомлений
    - do: Выдать разрешение
    - assert: |
        Поп-ап скрылся
        Отображается онбординг экрана съемки
    - do: Перезапустить приложение
    - do: Тап на "Съемка маршрута"
    - assert: Появляется системный поп-ап на доступ к геопозиции

    - platforms:
        - ios
    - tags:
        - assessors


  Запрет на доступ к уведомлениям через системный поп-ап:
    - *TODO
    - do: Debug-панель > Environment > MapKit enviroment > testing
    - do: Перезапустить приложение
    - do: Тап на "Съемка маршрута"
    - do: Выдать разрешение на доступ к камере
    - do: Выдать разрешение на доступ к геопозиции
    - assert: Появляется системный поп-ап на допуск уведомлений
    - do: Запретить доступ на отправку уведомлений
    - assert: |
        Открывается онбординг экрана съемки
    - do: Тап на кнопку перехода к съемки в онбординге
    - assert: Открывается экран съемки
    - do: Начать съемку
    - do: Свернуть приложение
    - assert: Отсутствует пуш о прекращении съемки

    - platforms:
        - ios
    - tags:
        - assessors


  Запрет на доступ к уведомлениям через настройки девайса:
    - info: |
        Выданы все разрешения
        Пользователь авторизован
    - do: Debug-панель > Environment > MapKit enviroment > testing
    - do: Перезапустить приложение
    - do: Выйти из приложения
    - do: В настройках девайса выключить разрешениие на уведомления (Настройки -> Kartograph -> Уведомления -> Допуск уведомлений -> Выкл)
    - do: Запустить приложение
    - do: Тап на "Съемка маршрута"
    - assert: Открывается экран съемки маршрута
    - do: Начать съемку
    - do: Не выключая записи свернуть приложение в фон
    - assert: Уведомление об остановке съёмки не приходит

    - platforms:
        - ios
    - tags:
        - assessors