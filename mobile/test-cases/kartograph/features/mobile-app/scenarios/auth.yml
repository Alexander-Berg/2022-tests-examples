components: auth
testing:
  - regress
integration_run:
  - am_sdk

specs:
  Авторизация - открытие экрана Регистрации:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап по "Зарегистрироваться"
    - assert: Открывается экран "Регистрация" с полем ввода номера телефона
    - do: Выйти на предыдущий экран.
    - assert: Осуществляется переход на предыдущий экран.

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация - невалидный логин:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Ввести логин несуществующего пользователя
    - do: Тап "Войти"
    - assert: Появляется красная надпись "Такой логин не подойдет"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация - невалидный номер телефона:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Ввести телефон неверного формата
    - do: Тап "Войти"
    - assert: Появляется красная надпись "Такой логин не подойдет"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  (android) Авторизация - Удаление аккаунтов c устройства:
    - info: |
        Приложение установлено на девайс
        В приложение имеются данные нескольких пользователей
        Пользователь не авторизован в приложении
        Приложение запущено
    - do: Тап "Войти"
    - assert: |
        Открыта карусель АМ
        Отображаются ранее добавленные аккаунты
    - do: Лонг тап по аватарке аккаунта
    - assert: Отображается поп-ап с кнопками "Вы уверены, что хотите удалить аккаунт Аккаунт1 с этого устройства?" с кнопками "Удалить" и "Не удалять аккаунт"
    - do: Тап "Не удалять аккаунт"
    - assert: |
        Происходит возврат к карусели АМ
        Аккаунт не удален
    - do: Лонг тап по аватарке аккаунта
    - assert: Отображается поп-ап с кнопками “Вы уверены, что хотите удалить аккаунт Аккаунт1 с этого устройства?” с кнопками "Удалить" и "Не удалять аккаунт"
    - do: Тап "Удалить"
    - assert: Аккаунт удаляется

    - platforms:
        - android
    - tags:
        - assessors


  (ios) Авторизация - Удаление аккаунтов с устройства:
    - info: |
        Приложение установлено на девайс
        В приложение имеются данные нескольких пользователей
        Пользователь не авторизован в приложении
        Приложение запущено
    - do: Тап "Войти"
    - assert: |
        Открыта карусель АМ
        Отображаются ранее добавленные аккаунты
    - do: Лонг тап по аватарке аккаунта
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап "Не удалять аккаунт"
    - assert: |
        Происходит возврат к карусели АМ
        Аккаунт не удален
    - do: Лонг тап по аватарке аккаунта
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап "Забыть на этом устройстве"
    - assert: Аккаунт удаляется

    - platforms:
        - ios
    - tags:
        - assessors


  Авторизация через социальные сети. Google:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на значок Google
    - assert: |
        Открывается вебвью логина.
    - do: Ввести данные существующего Google
    - do: Подтвердить вход
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. Facebook:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Facebook
    - do: Ввести данные существующего Facebook - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. Вконтакте:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Вконтакте
    - do: Ввести данные существующего Вконтакте - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. Приложение Вконтакте:
    - info: |
        На девайсе установлено приложение ВКонтакте, с авторизованным пользователем
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Вконтакте
    - do: Ввести данные существующего Вконтакте - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. mail.ru:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип mail.ru
    - do: Ввести данные существующего mail.ru - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. Twitter:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Twitter
    - do: Ввести данные существующего Twitter - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация через социальные сети. Одноклассниики:
    - info: |
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Одноклассниики
    - do: Ввести данные существующего Одноклассниики - аккаунта
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Регистрация через Apple ID (успех):
    - info: |
        Для тестирования используется сборка из TestFlight
        Для тестирования необходим свежий/новый аккаунт Apple ID
        Приложение установлено на девайс
        Приложение запущено
        Пользователь не авторизован
        На устройстве нет аккаунтов Яндекса
    - do: Тап "Войти"
    - assert: Открывается экран Авторизации
    - do: Тап на логотип Apple
    - assert: Открывается экран "Вход с Apple"
    - do: Тап "Продолжить"
    - assert: Открывается экран создания учетной записи для Картографа с подтверждением Touch ID
    - do: |
        - Выбрать один из пунктов E-mail
        - Ввести Touch ID (на девайсах с кнопкой - приложить палец к кнопке)
    - assert: Осуществляется переход на страницу Яндекс ID, в котором указан имя аккаунта, ссылки на пользовательское соглашение, политику конфиденциальности.
    - do: Тап "Я новый пользователь"
    - assert: Происходит авторизация в приложении

    - platforms:
        - ios
    - tags:
        - assessors


  #Авторизация черех Apple ID (сохранение данных) - в первом TF глянем поведение
  Разлогин в приложении через веб-версию Паспорта:
    - info: |
        Пользователь авторизован
        Приложение выгружено из памяти
    - do: Выполнить авторизацию таким же аккаунтом на https://passport.yandex.ru
    - do: Тап на "Выйти на всех устройствах"
    - do: В появившемся диалоге тап "Подтвердить"
    - do: Открыть Картограф на телефоне
    - assert: |
        Пользователь ралогинен
        Открыт стартовый экран
        Присутствует кнопка авторизации "Войти"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Разлогин в приложении через Настройки:
    - info: |
        Пользователь авторизован
    - do: Перейти в таб "Настройки"
    - do: Тап на "Выйти из профиля"
    - assert: |
        Пользователь ралогинен
        Открыт стартовый экран
        Присутствует кнопка авторизации "Войти"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - smoke


  Авторизация в приложении через вебвью:
    - info: |
        Первый запуск приложения
        На устройстве отсутствуют аккаунты Яндекс (если есть, необходимо их удалить и переустановить сборку)
    - do: Запустить приложение
    - assert: Открывается форма авторизациии
    - do: Тап на Войти
    - assert: Открывается вебвью авторизации
    - do: Ввести логин и пароль
    - assert: |
        Открывается главный экран приложения
        Подтягивается имя аккаунта и аватарка
        Подсвечен таб "Создать" в нижнем таббаре

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация в приложении через карусель АМ:
    - info: |
        Первый запуск приложения
        На устройстве есть аккаунты Яндекс
    - do: Запустить приложение
    - assert: Открывается форма авторизациии
    - do: Тап на Войти
    - assert: Поднимается шторка со списком аккаунтов
    - do: Тап на любой аккаунт из списка
    - assert: |
        Открывается главный экран приложения
        Подтягивается имя аккаунта и аватарка
        Подсвечен таб "Создать" в нижнем таббаре

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - smoke


  Недоступность дебаг-панели внешним пользователям:
    - info: |
        (iOS) Проходится на TestFlight-сборке
        На устройстве нет учетных записей Яндекса, привязанных к staff
    - do: Открыть приложение в первый раз
    - assert: Отображается экран "Добро пожаловать в Народный Картограф"
    - do: Тап Войти
    - do: Использовать тестовый аккаунт для входа yndx.tula.testers@yandex.ru / thisislegitpassword
    - do: Тап Настройки
    - assert: Отображается экран Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: Debug Panel не отображается

    - platforms:
        - ios
    - testing:
        - smoke


  Отображение дебаг-панели для пользователя, который авторизован staff аккаунтом:
    - info: |
        (iOS) Проходится на TestFlight-сборке
        Пользователь авторизован аккаунтом, привязанным к staff
        Открыт главный экран приложения
    - do: Тап Настройки
    - assert: Отображается экран Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: Отображается Debug Panel

    - platforms:
        - ios
    - testing:
        - smoke


  Разлогин в приложении через Настройки экрана съемки:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Съемка"
    - do: Тап на "Снять маршрут"
    - assert: |
        Открывается экран съемки
        В нижнем навбаре присутствуют кнопки "Настройки" и "Галерея"
    - do: Тап на кнопку Настройки
    - do: Отскроллить экран вниз до кнопки "Выйти из профиля"
    - do: Тап на кнопку "Выйти из профиля"
    - assert: |
        Пользователь ралогинен
        Открыт стартовый экран
        Присутствует кнопка авторизации "Войти"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Открытие:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ
    - do: Тап на экран за пределами карусели АМ
    - assert: |
        Карусель АМ скрывается
        Открыт экран настроек
    - do: Повернуть девайс
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Отмена удаления аккаунта на устройстве:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ
    - do: Лонг тап по аватарке любого аккаунта в карусели АМ
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап "Не удалять аккаунт"
    - assert: |
        Происходит возврат к карусели АМ
        Аккаунт не удален

    - platforms:
        - ios
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Удаления аккаунта на устройстве:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
        В АМ добавлены два аккаунта или более
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: |
        Открывается карусель АМ
        Отображаются ранее добавленные аккаунты
    - do: Лонг тап по аватарке аккаунта, которым не залогинен в приложении
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап "Забыть на этом устройстве"
    - assert: |
        Аккаунт удаляется из карусели АМ
        Карусель АМ остается открытой

    - platforms:
        - ios
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Удаление текущего аккаунта на устройстве:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ
    - do: Лонг тап по аватарке аккаунта, которым залогинен в приложении
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап "Забыть на этом устройстве"
    - assert: |
        Аккаунт удаляется
        Открыт стартовый экран
        Присутствует кнопка авторизации "Войти"

    - platforms:
        - ios
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Переход к странице полного удаления аккаунта:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: |
        Открывается карусель АМ
        Отображаются ранее добавленные аккаунты
    - do: Лонг тап по аватарке аккаунта
    - assert: Отображается поп-ап с кнопками "Вы хотите удалить аккаунт?" с кнопками "Забыть на этом устройстве", "Удалить аккаунт насовсем" и "Не удалять аккаунт"
    - do: Тап на "Удалить аккаунт насовсем"
    - assert: Открывается вебвью с формой удаления аккаунта
    - do: Тап на стрелку Назад
    - assert: |
        Вебвью закрылось
        Карусель АМ продолжает отображаться
        Аккаунт не удалился из АМ

    - platforms:
        - ios
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Перелогин:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ
    - do: Авторизоваться аккаунтом, которым не залогинен в приложении
    - assert: |
        Открыт экран настроек
        Пользователь в плашке аккаунта сменился
    - do: Перейти в Галерея > Маршруты
    - assert: Подтянулись маршруты нового пользователя

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Аккаунт-менеджер в настройках. Перелогин на текущий аккаунт:
    - info: |
        Пользователь авторизован
        Выданы все разрешения
    - do: Перейти в таб "Настройки"
    - assert: |
        Сверху отображается плашка аккаунта
        На плашке присутствует аватарка и имя пользователя
        В подстрочнике отображается адрес почты
    - do: Тап на плашку аккаунта
    - assert: Открывается карусель АМ
    - do: Тап на аккаунт, которым залогинен в приложении
    - assert: |
        Открыт экран настроек
        Пользователь в плашке аккаунта не изменился
    - do: Перейти в Галерея > Маршруты
    - assert: Маршруты соответствуют текущему пользователю

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Авторизация. Оффлайн:
    - info: Пользователь не авторизован
    - do: Отключить интернет на устройстве
    - do: Тап на кнопку "Войти" стартовой страницы
    - do: Попытаться авторизоваться в приложении
    - assert: |
        Авторизация не происходит
        Отображается сообщение об отсутствие интернета

    - platforms:
        - ios
        - android
    - tags:
        - assessors