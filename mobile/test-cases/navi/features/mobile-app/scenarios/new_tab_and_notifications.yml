components: new_tab_and_notifications
testing:
  - regress

specs:
  Включение показа нового пункта в таббаре:
    - description: Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
    - do: |
        Запустить навигатор
    - assert: |
        - Навигатор запущен
        - В таббаре появился новый пункт (иконка машины)
        - Показана нотификация. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - do: Тап по новой кнопке в таббаре
    - assert: |
        - Открылось меню "Моя машина"
        - Меню содержит:
           - Заголовок "Моя машина"
           - Карусель с добавленными машинами в Отзывные кампании
           - Ленту с офферами
    - do: Открыть меню навигатора
    - assert: Открылось старое меню навигатора
    - do: |
        Выключить эксперименты Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON
        Перезапустить навигатор
    - assert: |
        - Навигатор запущен
        - Новая кнопка в табе отсутствует
    - do: |
        Открыть меню навигатора
    - assert: |
        - Показано новое меню навигатора

    - platforms:
      - ios
      - android
    - tags:
        - assessors
    - testing:
      - acceptance_navi
    - integration_run:
      - new_tab_and_notifications

  Логика показ нотификаций:
    - description: | 
        Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
        - Порядок показа нотификаций:
            1. Вы пока не добавили ни одной машины
            2. Экономия на ОСАГО до 20%
            3. Это уведомление показывается только на Android (или на iOS – в зависимости от устройства пользователя)
            4. Это уведомление показывается только в Москве (или только в Нижнем Новгороде) – если применимо (то есть, если пользователь действительно находится в указанном городе).
            5. Это уведомление показывается только в Москве или в Нижнем Новгороде – если применимо.
            6. Уведомление с низким приоритетом (показывается три раза)
        - Так же показываются нотификации если добавить авто в отзывные кампании следующих моделей ::
            - BMW
            - Volkswagen
            - Renault
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
        - Выключить использования продового конфига. Developer settings -> Misc -> Use prod tabbar notifications config -> переключить свитчер в положение Off и перезапустить приложение
        - У пользователя нет добавленных машин.
        - Нотифкации не просматривались ранее. Для этого можно скинуть просмотры нотификаций тапнув в Developer settings -> Misc -> Reset tabbat notification data и перезапустить навигатор
    - do: |
        Осмотреть главный экран навигатора после перезапуска
    - assert: |
        - В таббаре появился новый пункт (иконка машины)
        - Показана нотификация "У вас ни одной машины Давайте добавим одну?"
    - do: Тап в любое место на карте
    - assert: |
            - Нотификация закрылась
            - Зажглась синяя лампочка на кнопке с иконкой машины
    - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Показана нотификация "Экономия на ОСАГО до 20% Сравнение предложений разных кампаний"
    - do: Сменить ориентацию устройства (портрет в лендскейп)
    - assert: |
        - Нотификация скрылась
        - На кнопке с иконкой машины зажглась синяя точка
    - do: Сменить ориентацию устройства (лендскейп в портрет)
    - assert: |
        - Нотификация показалась
        - На кнопке с иконкой машины перестала гореть синяя лампочка
    - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Показана нотификация "Это уведомление показывается только на Android / iOS" (в зависимости от платформы)
    - do: Тап по нотификации
    - assert: |
        - Открылось меню "Моя машина"
    - do: Перезапустить навигатор
    - assert: |
        - Показана нотификация "Уведомление с низким приоритетом"
    - do: Перезапускать навигатор, пока не перестанут показываться нотификации. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Нотификация "Уведомление с низким приоритетом" показывается еще несколько раз, после чего нотификации перестают показываться

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - new_tab_and_notifications

  Нотификации с привязкой к дате окончания ОСАГО:
  - description: |
        Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
        Нотификации с привязкой - это нотификации, которые показываются при выполнении определенных условий. Всего таких нотификаций не много:
            1. Нотификация с привязкой к дате окончания ОСАГО добавленного авто
            2. Нотификация с привязкой к марке авто (BMW, Volkswagen, Renault)
            3. Нотификация с привязкой к местоположению (Москва или Нижний Новгород)
  - info: |
      - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
      - Выключить использования продового конфига. Developer settings -> Misc -> Use prod config notifications -> переключить свитчер в положение Off и перезапустить приложение
      - У пользователя нет добавленных машин.
      - Все нотифкации были просмотрены.
      - Пользователь находится на главном экране навигатора (карта)
  - do: |
      Тап на кнопку с изображением машины в таббаре
  - assert: |
      - Открылось меню "Моя машина"
  - do: Добавить авто в отзывные кампании. Для этого Тап по "Добавить машину" -> Ввести любой номер машины (например Т777ТТ77) и Тап добавить -> Тап по "Верно, это моя машина" -> Тап "Добавить дату окончания" -> Выбрать дату не позднее 30 дней от текущей даты и Тап "Сохранить"
  - assert: |
      - Машина успешно добавлена
  - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
  - assert: |
      - Навигатор запущен
      - Показана нотификация "ОСАГО закнчится менее чем через 30 дней (и номер добавленного авто) Т777ТТ77" (Номер подставляется авто с истекающим сроком осаго)

  - platforms:
      - ios
      - android
  - tags:
      - assessors
  - testing:
      - acceptance_navi
  - integration_run:
      - new_tab_and_notifications

  Нотификации с привязкой к марке авто:
    - description: |
        Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
        Нотификации с привязкой - это нотификации, которые показываются при выполнении определенных условий. Всего таких нотификаций не много:
            1. Нотификация с привязкой к дате окончания ОСАГО добавленного авто
            2. Нотификация с привязкой к марке авто (BMW, Volkswagen, Renault)
            3. Нотификация с привязкой к местоположению (Москва или Нижний Новгород)
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
        - Выключить использования продового конфига. Developer settings -> Misc -> Use prod config notifications -> переключить свитчер в положение Off и перезапустить приложение
        - У пользователя есть добавленная машина, кроме Марок(BMW, Volkswagen и Renault). Для этого Тап по "Добавить машину" -> Ввести любой номер машины (например Т777ТТ77) и Тап добавить -> Тап по "Верно, это моя машина" -> Тап "Добавить дату окончания" -> Выбрать дату и Тап "Сохранить"
        - Все нотифкации были просмотрены.
        - Пользователь находится на главном экране навигатора (карта)
    - do: |
        Тап на кнопку с изображением машины в таббаре
    - assert: |
        - Открылось меню "Моя машина"
    - do: Изменить марку добавленного авто на BMW, или Volkswagen, или Renault. Для этого Тап по добавленному авто -> Тап по иконке карандаша (редактировние) -> Тап по марке-модели машины -> выбрать одну из нужных марок (BMW, Volkswagen и Renault), модель любая, год любой и Тап "Сохранить" -> Вверху страницы Тап на "Сохранить"
    - assert: |
        - Марка-модель авто успешно сменилась
    - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Навигатор запущен
        - Показана нотификация "Акция для владельцев ... и указана выбранная марка-модель авто"
    - do: Изменить марку добавленного авто на BMW, или Volkswagen, или Renault, отличную от текущей модели. (Если было добавлено BMW, то выбрать или Volkswagen, или Renault)
    - assert: |
        - Марка-модель авто успешно сменилась
    - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Навигатор запущен
        - Нотификация "Акция для владельцев ... и указана выбранная марка-модель авто" отсутствует, т.к. была просмотрена ранее

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - new_tab_and_notifications

  Нотификации с привязкой к геолокации:
    - description: | 
        Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
        Нотификации с привязкой - это нотификации, которые показываются при выполнении определенных условий. Всего таких нотификаций не много:
            1. Нотификация с привязкой к дате окончания ОСАГО добавленного авто
            2. Нотификация с привязкой к марке авто (BMW, Volkswagen, Renault)
            3. Нотификация с привязкой к местоположению (Москва или Нижний Новгород)
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
        - Выключить использования продового конфига. Developer settings -> Misc -> Use prod config notifications -> переключить свитчер в положение Off и перезапустить приложение
        - Пользователь НЕ просматривал нотификации. Для этого можно скинуть просмотры нотификаций тапнув в Developer settings -> Misc -> Reset tabbat notification data и перезапустить навигатор
        - Пользователь находится на главном экране навигатора (карта)
        - Пользователь находится территориально в г.Москва
    - do: |
        Перезапускать навигатор пока не покажется нотификация с привязкой к городу
    - assert: |
        - Показана нотификация "Это уведомление показывается только в Москве"
    - do: Перезапустить навигатор
    - assert: |
        - Показана нотификация "Это уведомление показывается только в Москве или в Нижнем Новгороде"
    - do: Сделать подмену местоположения на Нижний Новгород
    - assert: |
        - Пользователь находится в Нижнем Новгороде
    - do: Очистить показ нотификаций. Для этого можно скинуть просмотры нотификаций тапнув в Developer settings -> Misc -> Reset tabbat notification data и перезапустить навигатор
    - assert: |
        - Нотификации сбросились
    - do: |
        Перезапускать навигатор пока не покажется нотификация с привязкой к городу
    - assert: |
        - Показана нотификация "Это уведомление показывается только в Нижнем Новгороде"
    - do: Перезапустить навигатор
    - assert: |
        - Показана нотификация "Это уведомление показывается только в Москве или в Нижнем Новгороде

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - new_tab_and_notifications

  Непоказ нотификаций во время Freedrive:
    - description: Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
                Нотификации не должна показываться во время свободного движения (freedrive), в режиме ведения по маршруту (поездка по построенному маршруту), а так же в тех случаях, когда новая кнопка в таббаре скрыта
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
        - Выключить использования продового конфига. Developer settings -> Misc -> Use prod config notifications -> переключить свитчер в положение Off и перезапустить приложение
        - Пользователь НЕ просматривал нотификации. Для этого можно скинуть просмотры нотификаций тапнув в Developer settings -> Misc -> Reset tabbat notification data и перезапустить навигатор
        - Пользователь находится на главном экране навигатора (карта)
    - do: |
        Запустить Freedrive. Для этого либо сделать подмену местоположения с движеним по маршруту, либо воспользовавшись дебажной сборкой - построить маршрут -> включить ведение по маршруту (В дебаг панели переключть - Route: с OFF на ON) и отменить построенный маршут, не прекращая симуляцию движения
    - assert: |
        - Пользователь передвигается по карте без построенного маршрута - freedrive
    - do: Перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Показана нотификация.
    - do: Ничего не трогая дождаться когда пропадут все кнопки (контралы) с экрана.
    - assert: |
        - Контралы (кнопки призумливания, алисы, таббар и др.) скрываются
        - Нотификация скрывается
    - do: Тап в любую часть экрана
    - assert: |
        - Контралы (Кнопки призумливания, алисы, таббар и др.) показались
        - Нотификация скрылась
        - На кнопке с иконкой машины зажглась синяя лампочка

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - new_tab_and_notifications

  Непоказ нотификаций во время Ведения по маршруту:
    - description: Новый пункт в таббаре - это новая кнопка в таббаре с изображением машины, и нотификациями, появляющимися над таббаром, когда кнопка активна.
        Нотификации не должна показываться во время свободного движения (freedrive), в режиме ведения по маршруту (поездка по построенному маршруту), а так же в тех случаях, когда новая кнопка в таббаре скрыта
    - info: |
        - Включены 2 экперимента, для этого авторизовавшись портальным акаунтом или на дебаг сборке перейти в: Developer settings -> Misc -> Show offers in tabbar -> ON и Misc -> Use pure platform layout -> ON и перезапустить приложение.
        - Выключить использования продового конфига. Developer settings -> Misc -> Use prod config notifications -> переключить свитчер в положение Off и перезапустить приложение
        - Пользователь НЕ просматривал нотификации. Для этого можно скинуть просмотры нотификаций тапнув в Developer settings -> Misc -> Reset tabbat notification data и перезапустить навигатор
        - Пользователь находится на главном экране навигатора (карта)
    - do: |
        Построить маршрут. Для этого лонгтап по карте -> Сюда -> Поехали
    - assert: |
        - Пользователь построил маршрут
        - Кнопка с иконкой машины заменилась кнопкой обзора маршрута
    - do: Перезапустить навигатор несколько раз. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Нотификация не показывается.
    - do: Отменить построенный маршрут (тамнуть на крестик) и перезапустить навигатор. Для Андроид устройств необходима остановка приложения через настройки, что бы появилась нотификация при запуске
    - assert: |
        - Нотификации показываются

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - new_tab_and_notifications