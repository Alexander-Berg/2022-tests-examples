components: suggest
testing:
  - regress

specs:
  Проверка саджеста точки назначения:
    - info: |
        - Условия отображения саджеста:
        - сохранены точки Дом/Работа/Избранное
        - есть история маршрутов.
        - Саджест не должен отображаться в режиме ведения, в момент построения маршрута, во время проставления ДС (поп апп/ диалог)
        - Не должны предлагать работу в выходной день
    - do: Выполнить условия отображения саджеста точки назначения
    - do: |
        - Запустить Навигатор на девайсе
        - Повернуть девайс в ледскейп
    - assert: Саджест точки назначения отображается
    - do: Повернуть девайс в портрет
    - assert: Саджест точки назначения отбражается
    - do: Посвайпать саджест точки назначения вправо-влево
    - assert: |
        - Если линия саджестов выходит за границы экрана, при свайпе она сдвигается
        - Если линия саджестов не выходит за границы экрана, ничего не происходит
    - do: |
        Повернуть девайс в лендскейп
        Заблокировать/ разблокировать девайс не меняя ориентации экрана
    - assert: Саджест отображается в лендскейпе

    - platforms:
      - motrex
      - autochip
      - geely
      - carsharing_t3
      - ios
      - nissan
      - t3am
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Логирование саджеста точки назначения:
    - description: |
        Необходимо убедиться, что после действий приходит **только одно** событие
        **Саджест** - это маршрут предлагаемый внизу карты навигатора, куда ранее могли ездить.
    - do: Запустить приложение
    - assert: При появлении саджестов в логах приходят события **suggestions.visible** по количеству появившихся
    - do: Тап на любой саджест
    - assert: |
        - Построился маршрут и видно экран обзора
        - В логах будет два события: **suggestions.invisible** и **suggestions.destination_tap**
    - do: |
        - Отменить построенный маршрут
        - Перейти на другие экраны (Меню/Поиск/Мои Места)
        - Вернуться на экран Карта
    - assert: В логах **не** приходят повторные события о саджестах **suggestions.visible**

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - metric


  Отображение саджеста точки назначения при free drive:
    - info: |
        Условия отображения саджеста:
        - добавлены точки дом/работа
        - есть история поиска.
        - Саджест не должен отображаться в режиме ведения, при построении маршрута и проставлении ДС (поп апп/ диалог)
        - Не должны предлагать работу в выходной день
        - Саджест не отображается, если расстояние по прямой до него превышает 300км
        - В режиме фридрайв саджест отображается в течение 5 мин
    - do: Выполнить условия отображения саджеста точки назначения
    - do: |
        Запустить Навигатор на девайсе
        Девайс в портретной ориентации
        Выполнить условия отображения саджеста точки назначения
    - do: Тап на саджест
    - assert: 
        Выбрать точку из саджеста с временем движения более 5 минут
        Построить маршрут в выбраную точку из саджеста
    - do: |
        Тап "Поехали"
        Запустить симуляцию движения
        Сбросить маршрут не сбрасывая симуляцию
        Дождаться перехода в режим Free Drive (элементы меню и тапбар пропадают с экрана)
    - assert: Саджесты отображаются во Free Drive
    - do: Подождать 5+ минут в режиме Free Drive
    - assert: Спустя 5 минут саджесты скрываются

    - platforms:
      - geely
      - carsharing_t3
      - ios
      - nissan
      - android
      - t3am
      - motrex
      - autochip
    - tags:
      - assessors
      - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit


  Проверка мобильных тестов саджеста точки назначения (don't keep activities):
    - info: |
        Условия отображения саджеста:
        - добавлены точки дом/работа
        - есть история поиска.
        - Саджест не должен отображается в режиме ведения, при построении маршрута и проставления дс (поп апп/ диалог)
        - Не должны предлагать работу в выходной день
        - Максимальное расстояние по прямой до точки не должно превышать 300 км по прямой
        - Саджест во фридрайве отображается в течение 5 мин
    - do: Включена функция Don’t keep activities/Вытеснять фоновые активности (Настройки устройства -> Параметры разработчика)
    - do: Выполнить условия отображения саджеста точки назначения
    - do: |
        - Запустить Навигатор на девайсе
        - Повернуть девайс в ледскейп
    - assert: Саджест точки назначения отображается
    - do: Повернуть девайс в портрет
    - assert: Саджест точки назначения отбражается
    - do: Посвайпать саджест точки назначения вправо-влево
    - assert: |
        - Если линия саджестов выходит за границы экрана, при свайпе она сдвигается
        - Если линия саджестов не выходит за границы экрана, ничего не происходит

    - platforms:
        - motrex
        - autochip
        - geely
        - carsharing_t3
        - nissan
        - t3am
        - android
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - mapkit


  Проверка мобильных саджестов точки назначения без времени доезда:
    - info: |
        Условия отображения саджеста:
        - добавлены точки дом/работа
        - есть история поиска.
        - Не должны предлагать работу в выходной день!
        - Саджест не отображается, если расстояние по прямой до него превышает 300км
    - do: |
        Запустить Навигатор на девайсе
        Девайс в портретной ориентации
        Перейти в Dev.Settings > Misc > Fast day & night switching > On
        Перейти в Dev.Settings - Misc - Disable summary in destination suggest - On
        Dev.Settings - Misc - Disable summary in destination suggest - On (эксперимент, который позволяет отключать время доезда в саджесте)
        Перезагрузить приложение
    - do: Выполнить условия отображения саджеста точки назначения
    - assert: Саджест отображается, указан адресс без времени доезда, текст не едет, UI не ломается
    - do: Посвайпать саджест точки назначения вправо-влево
    - assert: Саджесты свайпаются
    - do: Перевернуть девайс в альбомную ориентацию
    - assert: Саджест отображается, указан адресс без времени доезда, текст не едет, UI не ломается
    - do: Тап на саджест
    - assert: Строится маршрут, соответствующий саджесту

    - platforms:
        - ios
        - android
        - myspin
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - myspin


  Проверка сокращения саджестов точки назначения :
    - info: |
        Условия отображения саджеста:
        - добавлены точки дом/работа
        - есть история поиска.
        - Не должны предлагать работу в выходной день
        - Саджест не отображается, если расстояние по прямой до него превышает 300км.
        Название точек назначения выглядит следующем образом: https://jing.yandex-team.ru/files/midway/IMAGE%202021-04-27%2018%3A14%3A35.jpg
        Сокращаются слова, как пример:
        "улицы" - "ул"
        "Набережная" - "наб"
    - do: |
        Запустить приложение
        Девайс в портретной ориентации
        Перейти в Dev.Settings > Misc > Fast day & night switching > On
        Dev.Settings - Misc - Disable summary in destination suggest - эксперимент, который позволяет отключать время доезда в саджесте
        Перезагрузить приложение
    - do: |
        Выполнить условия отображения саджеста точки назначения
    - assert: Саджест отображается, указан адресс без времени доезда, текст не едет, UI не ломается
    - do: Посвайпать саджест точки назначения вправо-влево
    - assert: Саджесты свайпаются
    - do: Перевернуть девайс в альбомную ориентацию
    - assert: Саджест отображается, указан адресс без времени доезда, текст не едет, UI не ломается, сокращение слов работает корректно
    - do: Тап на саджест
    - assert: Строится маршрут, соответствующий саджесту

    - platforms:
        - ios
        - android
        - myspin
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - myspin


  Выключение маршрутного саджеста:
    - info: Dev settings - Map - Hider route suggest from the screen - on
    - do: Открыть приложение
    - assert: |
        - Открыт экран карта
        - Маршрутный саджест не отображается
    - do: Включить маршрутный саджест -  Dev settings - Map - Hider route suggest from the screen - off. Перезапустить приложение
    - assert: Маршрутный саджест отображается на экране карты

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Выключение маршрутного саджеста и проверка других саджестов:
    - info: |
        - Dev settings - Map - Hider route suggest from the screen - on
        - Подменить местоположение на любую яндекс заправку
    - do: Открыть приложение
    - assert: |
        - Открыт экран карта
        - Маршрутный саджест не отображается
        - Отображается саджест азс с кнопкой "заправиться"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Саджест работа:
    - info: |
        - Dev settings/Map/Use route suggest with fallback strategy - on
        - На девайсе дневное время
    - do: |
        - Добавить точку "дом" рядом со своим местоположением.
        - Добавить точку "работа" на растоянии > 1 км от дома
    - assert: На экране карты отображается саджест "Работа"
    - do: |
        - Изменить ориентацию экрана на лендскейп
        - Тап на саджест
    - assert: |
        - UI не искажается
        - Строится маршрут до работы

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Саджест дом:
    - info: |
        - Dev settings/Map/Use route suggest with fallback strategy - on
        - На девайсе ночное время
    - do: |
        - Добавить точку "работа" рядом со своим местоположением
        - Добавить точку "дом" на растоянии > 1 км от работы
    - assert: На экране карты отображается саджест "дом"
    - do: |
        - Изменить ориентацию экрана на лендскейп
        - Тап на саджест
    - assert: |
        - UI не искажается
        - Строится маршрут до дома

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отображение саджестов дом/работа:
    - info: |
        - Dev settings -> Map -> Use route suggest with Y.Maps logic - on
        - Пользователь авторизован
        - У пользователя есть сохраненные дом/работа и маршруты 
        - Перезапустить приложение 
    - do: Открыть главный экран приложения
    - assert: |
         - Открыт главный экран 
         - Внизу отображаются саджесты: Дом, Работа и не больше 4-х саджестов улиц
    - do: Перевернуть устройство в горизонтальную ориентацию
    - assert: |
         - UI саджестов не искажается
         - Внизу отображаются саджесты: Дом, Работа и не больше 4-х саджестов улиц

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity


  Логика показа саджестов дом/работа:
    - info: |
        - Dev settings -> Map -> Use route suggest with Y.Maps logic - on
        - Пользователь авторизован
        - У пользователя отсутствуют сохраненные дом/работа, но есть сохраненные маршруты
        - Перезапустить приложение 
    - do: Открыть главный экран приложения
    - assert: |
         - Открыт главный экран 
         - Внизу отображаются саджесты: Дом, Работа и не больше 4-х саджестов улиц
    - do: Добавить точку "Работа" находящуюся не более 250м от своего местоположения
    - assert: |
         - Точка добавлена
         - Открыт главный экран приложения
         - Внизу присутствуют только саджесты улиц
    - do: Добавить точку "Дом" находяющуюся в расстоянии более 300 км от текущего местоположения
    - assert: |
         - Точка добавлена
         - Открыт главный экран приложения
         - Внизу присутствуют только саджесты улиц

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity