components: permissions
testing:
  - regress

specs:
  Запрос на доступ к местоположению:
    - description: |
        Проверяется **только на девайсах Android 6.0 и старше**
        После отказа в предоставлении доступа к местоположению, либо отзыве этого пермишена после установки, Навигатор должен запрашивать доступ к местоположению только в перечисленных ниже условиях.
    - info: Приложение установлено, после установки при прохождении интроскринов отказано в доступе к местоположению, либо пермишен у Навигатора отозван в настройках девайса. (Настройки -> Приложения -> Навигатор)
    - do: |
        - После установки приложения, выполнить три запуска для полного прохождения интроскринов
        - **Отказывать в разрешении на доступ к местоположению** каждый раз когда появляется запрос
    - assert: На третий и каждый последующий запуск при открытии приложения запрашивается доступ к определению местоположения
    - do: Тап кнопку "Найди меня" в правом нижнем углу окна "Карта"
    - assert: Появляется запрос пермишена на местоположение
    - do: |
        - Дать Навигатору разрешение на определение местоположения
        - Отключить геолокацию в настройках девайса
    - assert: |
        При каждом запуске навигатор показывает поп-ап с текстом:
        "Включите определение местоположения по GPS. Иначе Навигатор не сможет вести вас по маршруту"
        и кнопками [Отмена] [Настройки]
    - do: Тап кнопки [Отмена] или [Настройки]
    - assert: |
        - При нажатии [Отмена] поп-ап закрывается
        - При нажатии [Настройки] происходит переход в настройки GPS девайса

    - platforms:
      - android
    - tags:
        - assessors
    - testing:
      - acceptance_navi


  Установка и выдача разрешений (Android ниже 6):
    - description: На Android версии ниже 6.0 разрешения запрашиваются не при запуске, а при установке. **Интроскрины могут иметь другой вид, это считаем нормой!**
    - info: Навигатор НЕ установлен.
    - do: Запустить установку Навигатора.
    - assert: |
        Перед установкой запрашивается набор разрешений. Содержание набора разрешений зависит от конкретного девайса.
        Обязательно присутствие следующих разрешений:
        * Доступ к местоположению пользователя;
        * Доступ к записи аудио;
        * Доступ к интернету.
    - do: Произвести и завершить установку Навигатора.
    - assert: Навигатор успешно установлен.
    - do: Запустить Навигатор.
    - assert: |
        Навигатор запускается. Во время запуска показывается лончскрин.
        ![image](https://jing.yandex-team.ru/files/mikhail-vin/photo_2021-05-18%2011.05.49.jpeg)
        После лончскрина показывается экран с лицензионным соглашением. 
        ![image](https://jing.yandex-team.ru/files/mikhail-vin/photo_2021-05-18%2011.05.46.jpeg)
    - do: Тап на ссылку лицензионного соглашения (синий текст).
    - assert: Осуществляется переход на страницу лицензионного соглашения.
    - do: Вернуться в Навигатор. (Это можно сделать нажатием на системную клавишу back)
    - assert: Навигатор открывается на экране лицензионного соглашения.
    - do: Тап на Дальше.
    - assert: Осуществляется переход на экран карты. Определяется местоположение пользователя.
    - do: |
        Произнести “Привет/Слушай, Алиса/Яндекс”.
    - assert: |
        Если разрешение к доступу к микрофону давалось прямо из Навигатора, сразу открывается Алиса - необходимо закрыть его тапом на карту, чтобы проверить реакцию на фразу-активатор.
        После того, как произнесена фраза-активатор, открывается плашка Алисы.
    - do: |
        Нажатием на свободное место на карте закрыть голосового помощника.
        Нажатием на системную кнопку “домой” свернуть Навигатор.
        Развернуть Навигатор через 10-15 секунд.
    - assert: Навигатор открывается на том же экране, на котором производилось его сворачивание.
    - do: Тап на стрелку “где я”.
    - assert: Карта центрируется на местоположении пользователя.
    - do: |
        При помощи лонгтапа (Тап и подержать) в любое место на карте вызвать меню
        Тап “Сюда”
    - assert: Производится построение маршрута в указанную точку
    - do: |
        Сбросить маршрут.
        Выгрузить Навигатор.
        Запустить Навигатор заново.
    - assert: |
        Производится переход на экран карты.
        Карта открыта в районе местоположения пользователя.

    - platforms:
      - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - testing:
      - acceptance_navi


  Установка и выдача разрешений (Android 6+):
    - description: В данном кейсе, проверяются разрешения, запрашиваемые Навигатором при первом запуске.
    - info: Навигатор установлен, но ещё ни разу не запускался.
    - do: Запустить Навигатор.
    - assert: |
        Навигатор запускается. Во время запуска показывается лончскрин.
        После лончскрина показывается экран с лицензионным соглашением.
    - do: Тап на ссылку лицензионного соглашения.
    - assert: Осуществляется переход на страницу лицензионного соглашения.
    - do: Вернуться в Навигатор. (Это можно сделать нажатием на системную клавишу back)
    - assert: Навигатор открывается на экране лицензионного соглашения.
    - do: Тап “Дальше”
    - assert: Осуществляется переход к следующему интроскрину с определением местоположения
    - do: Тап Дальше
    - assert: Возникает системное меню с разрешением к доступу к геопозиции.
    - do: Запретить доступ к геопозиции.
    - assert: Осуществляется переход к следующему интроскрину с доступом к микрофону.
    - do: Тап на Хорошо
    - assert: Возникает системное меню с разрешением к доступу к микрофону.
    - do: Запретить доступ к микрофону.
    - assert: |
        Для Android <=9 Осуществляется переход на экран карты.
        Для Android >= 10 осуществляется переход к следующему интроскрину Подсказки в пути
    - do: Шаг для Android >= 10. Разрешить доступ к данным физической активности.
    - assert: Осуществляется переход на экран карты. Местоположение пользователя не определяется.
    - do: Тап на иконку Алисы.
    - assert: |
        Открывается системное сообщение о необходимости дать доступ к микрофону.
        Обычно есть возможность дать доступ к микрофону на этом этапе.
    - do: Дать доступ к микрофону. 
    - assert: |
        Если разрешение к доступу к микрофону давалось прямо из Навигатора, сразу открывается Алиса - необходимо закрыть его тапом на карту, чтобы проверить реакцию на фразу-активатор.
        После того, как произнесена фраза-активатор, открывается плашка Алисы.
    - do: |
        Нажатием на свободное место на карте закрыть голосового помощника.
        Нажатием на системную кнопку “домой” свернуть Навигатор.
        Развернуть Навигатор через 10-15 секунд
    - assert: Навигатор открывается на том же экране, на котором производилось его сворачивание.
    - do: Тап на стрелку “где я”.
    - assert: |
        Открывается системное сообщение о необходимости дать доступ к геоданным.
        НЕ ДАВАТЬ ДОСТУП К ГЕОПОЗИЦИИ
        Обычно есть возможность дать доступ к геоданным на этом этапе.
    - do: |
        При помощи лонгтапа (Тап и подержать) в любое место на карте вызвать меню
        Тап “Сюда”
    - assert: Появляется панель “Поиск местоположения”
    - do: |
        Свернуть приложение.
        Перейти в настройки девайса и дать доступ к геопозиции.
        Вернуться в Навигатор.
    - assert: Построен маршрут до точки, указанной в предыдущем шаге.
    - do: |
        Сбросить маршрут.
        Выгрузить Навигатор.
        Запустить Навигатор заново.
    - assert: Показывается интроскрин “Музыка в навигаторе”
    - do: Закрыть интроскрин тапом по кнопке Хорошо
    - assert: |
        Производится переход на экран карты.
        Карта открыта в районе местоположения пользователя.

    - platforms:
      - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - testing:
      - acceptance_navi


  Установка и выдача разрешений (iOS ниже 14.5):
    - description: В данном кейсе, проверяются разрешения, запрашиваемые Навигатором при первом запуске.
    - info: Навигатор установлен, но ещё ни разу не запускался.
    - do: |
        Запустить Навигатор.
    - assert: |
        Навигатор запускается. Во время запуска показывается лончскрин.
        ![image](https://jing.yandex-team.ru/files/yavgmoth9/photo_2019-11-19%2015.54.28.jpeg)
    - do: |
        Открывается интроскрин и запрос на определение местоположения
        Тап "Без проблем"
    - assert: Возникает системное меню с разрешением к доступу к геопозиции.
    - do: Запретить доступ к геопозиции.
    - assert: Осуществляется переход к следующему интроскрину с доступом к микрофону.
    - do: |
        Возникает системное меню с разрешением к доступу к микрофону
        Тап "хорошо"
        Запретить доступ к микрофону
    - assert: Осуществляется переход к интроскрину с разрешением подсказок по маршруту.
    - do: |
        Тап “Договорились”
    - assert: Открывается системное меню с разрешением уведомлений.
    - do: |
        Тап на “Дальше” - Откроется системное меню.
        Разрешить отправку уведомлений
    - assert: |
        Осуществляется переход на экран карты.
        Также появляется уведомление о необходимости дать доступ к геопозиции.
    - do: |
        Открывается экран карт, отображается сообщение о необходимости предоставить доступ к геопозиции
        Тап "ОК"
    - assert: Сообщение закрывается, отображается карта
    - do: Тап на иконку Алисы.
    - assert: Открывается системное сообщение о необходимости дать доступ к микрофону.
    - do: Дать доступ к микрофону. Для этого необходимо перейти в настройки девайса затем вернуться в Навигатор.
    - assert: После того, как произнесена фраза-активатор, открывается плашка Алисы.
    - do: |
        Нажатием на свободное место на карте закрыть голосового помощника.
        Нажатием на системную кнопку “домой” свернуть Навигатор.
        Развернуть Навигатор через 10-15 секунд.
    - assert: Навигатор открывается на том же экране, на котором производилось его сворачивание.
    - do: |
        При помощи лонгтапа (Тап и подержать) в любое место на карте вызвать меню
        Тап “Сюда”
    - assert: Появляется панель “Поиск местоположения”
    - do: |
        Свернуть приложение.
        Перейти в настройки девайса и дать доступ к геопозиции.
        Вернуться в Навигатор.
    - assert: Построен маршрут до точки, указанной в предыдущем шаге.
    - do: |
        Тап на Поехали
    - assert: |
        Появляется пермишен на доступ к данным движения и фитнеса

    - platforms:
      - ios
    - tags:
        - assessors
        - not_suitable_for_farm
    - testing:
      - acceptance_navi


  Установка и выдача разрешений (iOS 14.5+):
    - description: В данном кейсе, проверяются разрешения при первом запуске.
    - info: Приложение установлено, но ещё ни разу не запускалось.
    - do: |
        Запустить приложение.
    - assert: |
        Приложение запускается. Во время запуска показывается лончскрин.
        ![image](https://jing.yandex-team.ru/files/yavgmoth9/photo_2019-11-19%2015.54.28.jpeg)
    - do: |
        - Открывается интроскрин и запрос на определение местоположения
        - Тап "Без проблем"
    - assert: Возникает системное меню с разрешением к доступу к геопозиции.
    - do: Запретить доступ к геопозиции.
    - assert: Осуществляется переход к следующему интроскрину с доступом к микрофону.
    - do: |
        - Возникает системное меню с разрешением к доступу к микрофону
        - Тап "хорошо"
        - Запретить доступ к микрофону
    - assert: Осуществляется переход к интроскрину с разрешением подсказок по маршруту.
    - do: |
        - Тап “Договорились”
    - assert: Открывается системное меню с разрешением уведомлений.
    - do: |
        - Тап на “Дальше” - Откроется системное меню.
        - Разрешить отправку уведомлений
    - assert: |
        - Осуществляется переход на экран карты
        - Запрашивается разрешение на отслеживание действий в приложениях и на веб-сайтах
    - do: Тап на “Разрешить”
    - assert: Отображается уведомление о необходимости дать доступ к геопозиции.
    - do: Тап "ОК"
    - assert: Сообщение закрывается, отображается карта
    - do: Тап на иконку Алисы.
    - assert: Открывается системное сообщение о необходимости дать доступ к микрофону.
    - do: Дать доступ к микрофону. Для этого необходимо перейти в настройки девайса затем вернуться в приложение.
    - assert: После того, как произнесена фраза-активатор, открывается плашка Алисы.
    - do: |
        - Нажатием на свободное место на карте закрыть голосового помощника.
        - Нажатием на системную кнопку “домой” свернуть приложение.
        - Развернуть приложение через 10-15 секунд.
    - assert: Приложение открывается на том же экране, на котором производилось его сворачивание.
    - do: |
        - При помощи лонгтапа (Тап и подержать) в любое место на карте вызвать меню
        - Тап “Сюда”
    - assert: Появляется панель “Поиск местоположения”
    - do: |
        - Свернуть приложение.
        - Перейти в настройки девайса и дать доступ к геопозиции.
        - Вернуться в приложение.
    - assert: Построен маршрут до точки, указанной в предыдущем шаге.
    - do: |
        - Тап на Поехали
    - assert: |
        - Появляется пермишен на доступ к данным движения и фитнеса

    - platforms:
        - ios
    - tags:
        - assessors
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Запрет разрешения на отслеживание действий в приложениях и на веб-сайтах (iOS 14.5+):
    - info: Приложение установлено, но ещё ни разу не запускалось.
    - do: |
        - Запустить приложение
        - Пройти все разрешения
    - assert: |
        - Осуществляется переход на экран карты
        - Запрашивается разрешение на отслеживание действий в приложениях и на веб-сайтах
    - do: Тап “Попросить приложение не отслеживать”
    - assert: Осуществляется переход на экран карты.
    - do: |
        - Свернуть приложение.
        - Перейти в настройки девайса
        - Найти там приложение и перейти к его настройкам
    - assert: Свитчер "Разрешить отслеживание" не активен

    - platforms:
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Запрос на доступ к местоположению (доступ только во время использовании приложения):
    - description: |
       Проверяется только на девайсах Android 6.0 и старше.
    - info: Навигатор не установлен.
    - do: |
       Запустить установку приложения
       Дать все разрешения ( для разрешение на определение местоположения выбрать "доступ только во время использовании приложения"
       Переграузить приложения 2-3 раза для подгрузки всех экспирементов
    - assert: Навигатор запускается, все разрешения выданы, запрос разрешение на определения местоположение не предлагается
    - do: |
       Передвинуть карту в любое место
       Тап на кнопку "Мое местоположение"
    - assert: Карта сдвигается к местоположению курсора, запрос на разрешение местоположение не предлагается

    - platforms:
      - android
    - tags:
        - assessors
    - testing:
      - acceptance_navi


  Запрос на доступ к местоположению после обновления:
    - description: |
        **Цель:** Проверить работоспособность приложения после обновления, а также сохранение установленных настроек.
        Кейс подразумевает прохождение на debug cборке
        **!!Если андроид ниже 6, то данный кейс пропускается!!**
    - info: |
        1) С устройств удален Навигатор.
        2) Для **android**: на устройства скачаны предыдущие запинованные сборки. Установка не производилась.
        Для **iOS**: на устройства установлены предыдущие запинованные сборки. Запуск не производился.
        3) На девайсах установлены разные локали из списка поддерживаемых
    - do: |
        (Шаг для Android)
        Запустить установку предыдущей версии приложения.
    - assert: При установке должны запрашиваться только необходимые разрешения
    - do: Запустить приложение.
    - assert: Показываются интро-скрины. Для Android ниже 6 показывается только интро с лицензионным соглашением и стартовое интро (добро пожаловать).
    - do: |
        (Для iOS и Android выше 5-го)
        Дать все разрешения ( для разрешение на определение местоположения выбрать "доступ только во время использовании приложения"
    - assert: После прохождения всех интро и выдачи разрешений открывается экран карты.
    - do: |
         Перезагрузить приложение на одном из устройств (желательно сделать это дважды).
         Перейти на экран карта
    - assert: |
         На перезагруженном устройстве показываются вторые интро-скрины.
         После их прохождения открывается экран карта
    - do: |
         Передвинуть карту в любое место
         Тап на кнопку "Мое местоположение"
    - assert: Карта сдвигается к местоположению курсора, запрос на разрешение местоположение не предлагается
    - do: |
         Установить тестируемую сборку поверх уже установленной. Не запускать приложение!
    - assert: |
         Приложение обновлено успешно.
         Иконка приложения отображается на рабочем столе, не пропала
    - do: |
        Открыть приложение
        По-возможности потапать на разные кнопки на открывающихся интро-скринах.
    - assert: |
        Нажатия на кнопки на интроскринах корректно обрабатываются
        Карта во всех случаях отображается
    - do: |
        Передвинуть карту в любое место
        Тап на кнопку "Мое местоположение"
    - assert: Карта сдвигается к местоположению курсора, запрос на разрешение местоположение не предлагается

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Локализация интроскрина доступ к местоположению (локаль ru):
    - description: |
        Проверяется **только на девайсах Android 6.0 и старше**
        В процессе проверке кейса необходимо сменить локаль: ru, en, tr
    - info: |
        - Приложение установлено и НЕ запускалось
        - Локаль ru_RU (подробнее о локалях и их смене можно прочитать на привественной wiki)
    - do: |
        - Запустить приложение
        На Android - пройти интроскрин с лицензионным соглашением
    - assert: |
        - Отображается интроскрин на запрос доступа к местоположению
        - Заголовок IOS/android -
        ru: Данные о местоположении
        - **Текст: android**
        ru: Нужны, чтобы вести вас по маршруту. Искать места рядом и показывать на карте, где вы находитесь
        **Текст: IOS**
        ru: Навигатору важно знать вашу геолокацию. Так он будет вовремя подсказывать, куда повернуть

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Локализация интроскрина доступ к местоположению (локаль en):
    - description: |
        Проверяется **только на девайсах Android 6.0 и старше**
        В процессе проверке кейса необходимо сменить локаль: ru, en, tr
    - info: |
        - Приложение установлено и НЕ запускалось
        - Локаль en (Напр, en_RU, en_TR) (подробнее о локалях и их смене можно прочитать на привественной wiki)
    - do: |
        - Запустить приложение
        На Android - пройти интроскрин с лицензионным соглашением
    - assert: |
        - Отображается интроскрин на запрос доступа к местоположению
        - Заголовок IOS/android -
        en: Location access
        - **Текст: android**
        en: Yandex.Navi will tell you about upcoming turns, search for places nearby, and show where you are on the map
        **Текст: IOS**
        en: Yandex.Navigator needs to know your location to tell you about upcoming turns and maneuvers

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Локализация интроскрина доступ к местоположению (локаль tr):
    - description: |
        Проверяется **только на девайсах Android 6.0 и старше**
        В процессе проверке кейса необходимо сменить локаль: ru, en, tr
    - info: |
        - Приложение установлено и НЕ запускалось
        - Локаль tr_TR (подробнее о локалях и их смене можно прочитать на привественной wiki)
    - do: |
        - Запустить приложение
        На Android - пройти интроскрин с лицензионным соглашением
    - assert: |
        - Отображается интроскрин на запрос доступа к местоположению
        - Заголовок IOS/android -
        tr: Konum verileri
        - **Текст: android**.
        tr: Bu, size rota çizmemiz için,
        ayrıca Navigasyon kapatıldığında
        widget'ta trafik durumunu,
        eve yolculuk süresini görmek için şart.
        **Текст: IOS**
        tr: Gerekli dönüş ve manevraları bildirebilmesi için Navigasyon'nun konumunuzu bilmesi gerekiyor

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Интро скрины при включенном родительском контроле:
    - info: |
        На девайсе настроен родительский контроль([Официальная документация от Apple](https://support.apple.com/ru-ru/HT201304))
        В родительском контроле запрещена возможность изменять настройки конфиденциальности для службы геолокации
        Приложение установлено, но не запускалось
    - do: |
        Запустить приложение
        Пройти все интроскрины и выдать доступы при запросе к микрофону/отправке уведомлений
    - assert: |
        Появились интро:
          - про подсказки в пути
          - про уведомления
        Интро и запрос к определению местоположения не появились
        Местоположение пользователя не определено
    - do: Перезапустить приложение несколько раз
    - assert: |
        При каждом перезапуске интро и запрос к определению местоположения не появились
        Местоположение пользователя не определено
    - do: |
        В родительском контроле разрешить изменять настройки конфиденциальности для службы геолокации
        Перезапустить приложение
    - assert: Показывается интро про доступ к местоположению
    - do: Тап "Дальше"
    - assert: Показан запрос к определению местоположения
    - do: Тап "Во время использования"
    - assert: |
        Открыт главный экран
        Местоположение пользователя определено

    - platforms:
        - ios
    - testing:
        - acceptance_navi


  Доступ к местоположению в фоновом режиме. Добавление виджета на n запуске :
    - info: |
        - Кейс проходить на Android 11
        - Третий и более запуск приложения
        - Добавлен поисковой виджет приложения Навигатор (лонг тап на иконку нави-> виджеты)
    - do: Открыть приложение
    - assert: Отображается интроскрин "Доступ к местоположению в фоновом режиме" с кнопками "Хорошо" и "Позже"

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Доступ к местоположению в фоновом режиме. Кнопка "Позже" :
    - info: |
        - Кейс проходить на Android 11
        - Приложение установлено, но не запускалось
        - Добавлен поисковой виджет приложения Навигатор (лонг тап на иконку нави-> виджеты)
    - do: |
        - Пройти все интроскрины при первом запуске приложения и разрешить доступы
        - Перезапустить приложение
    - assert: |
        - На втором запуске после интроскринов "АЗС" и "Музыка", отображается интроскрин "Доступ к местоположению в фоновом режиме"
        - У интроскрина присутствуют 2 кнопки: "Хорошо" и "Позже"
    - do: Тап "Позже"
    - assert: |
        - Интроскин закрывается
        - Открывается главный экран приложения
    - do: Перезапустить приложение несколько раз
    - assert: Интроскрин больше не появляется

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Доступ к местоположению в фоновом режиме. Кнопка "Хорошо" :
    - info: |
        - Кейс проходить на Android 11
        - Приложение установлено, но не запускалось
        - Добавлен поисковой виджет приложения Навигатор (лонг тап на иконку нави-> виджеты)
    - do: |
        - Пройти все интроскрины при первом запуске приложения и разрешить доступы
        - Перезапустить приложение
    - assert: |
        - На втором запуске появляется интроскрин "Доступ к местоположению в фоновом режиме"
        - У интроскрина присутствуют 2 кнопки: "Хорошо" и "Позже"
    - do: Тап "Хорошо"
    - assert: |
        - Произошел переход в настройки девайса
        - Отображаются 4 разрешения:
        1.Разрешить в любом режиме
        2.Разрешить только во время использования приложения
        3.Спрашивать каждый раз
        4.Запретить
    - do: |
        - Тап на любое разрешение
        - Тап на кнопку назад
    - assert: Открывается главный экран приложения
    - do: Перезапустить приложение несколько раз
    - assert: Интроскрин больше не появляется

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Отсутсутсвует "Доступ к местоположению в фоновом режиме" :
    - info: |
        - Кейс проходить на Android 11
        - Приложение установлено, но не запускалось
        - Поисковой виджет не добавлен
    - do: Пройти все интроскрины на 3 запусках
    - assert: Интроскрин "Доступ к местоположению в фоновом режиме" отсутствует

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi