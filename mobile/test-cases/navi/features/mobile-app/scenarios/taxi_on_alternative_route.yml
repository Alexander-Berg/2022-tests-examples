components: taxi_on_alternative_route
testing:
  - regress

specs:
  Кнопка такси на втором месте:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev Settings - Misc - Fast day&night switching - On
        - Перезапустить приложение
        - Открыт главный экран  на спане Москвы
    - do: Построить маршрут в пределах города
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на альтернативе показана "цена, Такси"
    - do: Тап по альтернативе с такси
    - assert: |
        - Выбранный маршрут на карте остался тем же
        - Кнопка "Поехали" меняется на "Заказать"
        - Под кнопкой появляется дисклеймер "Яндекс.GO приедет через n мин"
    - do: Сменить ориентацию
    - assert: |
        - Выбрана альтернатива с такси
        - Справа иконка такси
        - Заголовок кнопки "Время поездки, Цена, Такси"
        - Подзаголовок "Яндекс.GO приедет через n мин"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Кнопка такси на третьем месте:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev Settings - Misc - Fast day&night switching - On
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На третьем месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"
    - do: Тап по альтернативе с такси
    - assert: |
        - Выбранный маршрут на карте остался тем же
        - Кнопка "Поехали" меняется на "Заказать"
        - Под кнопкой появляется дисклеймер "Яндекс.GO приедет через n мин"
    - do: Сменить ориентацию
    - assert: |
        - Выбрана кнопка с такси
        - Справа иконка такси
        - Заголовок кнопки "Время поездки, Цена, Такси"
        - Подзаголовок "Яндекс.GO приедет через n мин"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Маршрут рядом с собой (кнопка на втором месте):
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev Settings - Misc - Fast day&night switching - On
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На 1 месте показана кнопка маршрута
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстояния на этой кнопке показана "цена, Такси"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Маршрут рядом с собой (кнопка на третьем месте):
    - info: |
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev Settings - Misc - Fast day&night switching - On
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На 1 месте показана кнопка маршрута
        - На втором месте (т.к. нет альтернативного маршрута) показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Заказ такси (Яндекс.GO установлен):
    - info: |
        - Установленно приложение Яндекс.Go (из плеймаркета или аппстор)
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"
    - do: Тап по альтернативе с такси
    - assert: |
        - Выбранный маршрут на карте остался тем же
        - Кнопка "Поехали" меняется на "Заказать"
        - Под кнопкой появляется дисклеймер "Яндекс.GO приедет через n мин"
    - do: Тап по "Заказать"
    - assert: |
        - Открывется приложение Яндекс.GO
        - В приложение Такси прокидывается маршрут построенный в Навигаторе:
            - Начальная и конечная точка совпадают с навигаторскими
            - Предлагается выбрать класс поездки (эконом, комфорт и т.д.)
            - Закаывать такси не надо! Только убедиться, что маршрут построен

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Заказ такси (Яндекс.GO НЕ установлен):
    - info: |
        - Приложение Яндекс.Go отсутствует
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"
    - do: Тап на альтернативу с такси
    - assert: |
        - Выбранный маршрут на карте остался тем же
        - Кнопка "Поехали" меняется на "Заказать"
        - Под кнопкой появляется дисклеймер "Яндекс.GO приедет через n мин"
    - do: Тап на "Заказать"
    - assert: |
        - Открывется App Store / Play Market на страние приложения Яндекс.GO

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Эксперимент на свитчер такси в альтернативе:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстояния на этой кнопке показана "цена, Такси"
    - do: |
        - Отменить маршрут
        - Зайти в Меню - Настройки - Навигация
    - assert: |
        - Отсутвтует свитчер "Предлагать маршрут на такси"
    - do: Включить эксперимент Dev Settings - Ad - Show taxi ad route setting - On и перезапустить приложение
    - do: Зайти в Меню - Настройки - Навигация
        - Наверху присутствует свитчер "Предлагать маршрут на такси" (по умолчанию в положении ВКЛ)

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Работа свитчера такси в альтернативе:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - On
        - Свитечер в положении ВКЛ (Меню - Настройки - Навигация - Предлагать маршрут на такси - ВКЛ)
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстояния на этой кнопке показана "цена, Такси"
    - do: |
        - Отменить маршрут
        - Зайти в Меню - Настройки - Навигация
        - Выключить свитчер "Предлагать маршрут на такси"
        - Закрыть меню
    - do: Построить маршрут в Москве
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - Среди альтернатив маршрута отсутствует альтернатива с иконкой такси
    - do: |
        - Отменить маршрут
        - Зайти в Меню - Настройки - Навигация
        - Включить свитчер "Предлагать маршрут на такси"
        - Закрыть меню
    - do: Построить маршрут в Москве
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Кнопка такси на втором месте (ГК включен, но в настройках выбрано значение для легковых):
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Включен грузовой каркас Меню - Настройки - Навигация - Маршруты для грузовиков - свитчер вкл
        - Меню - Настройки - в блоке Быстрые настройки - Маршруты - Для легковых.
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - На втором месте показывается альтернатива с иконкой такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"
    - do: Тап на кнопку такси
    - assert: |
        - Выбранный маршрут на карте остался тем же
        - Кнопка "Поехали" меняется на "Заказать"
        - Под кнопкой появляется дисклеймер "Яндекс.GO приедет через n мин"
    - do: Сменить ориентацию
    - assert: |
        - Выбрана альтернатива с такси
        - Справа иконка такси
        - Заголовок кнопки "Время поездки, Цена, Такси"
        - Подзаголовок "Яндекс.GO приедет через n мин"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Кнопка такси при взаимодействии с рекламой GeoAd в обзоре при слабом интернете:
    - info: |
        Для проверки включаем рекламу в обзоре, в данном кейсе будет использоваться Geoad
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перейти в настройку: Dev. Set. -> Ad -> Setup pages ids
        - Занулить все категории прописав в них 0 или null
        - В категорию "Баннер в обзоре (geo ad)" вписать следующий pageid: overview_banner_3/testing_overview_regular_site
        - Тап сохранить
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        А так же прокинуть интенты:
        - `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad,brand_route,via` - интент приоритета геоэда над БМ и Бураном.
        - `yandexnavi://add_exp?navi_ads_overview_ad_queue=geo_ad_location,geo_ad_route,direct,yas` - интент приоритета источника рекламы
        - `yandexnavi://add_exp?navi_ad_product_cooldown_overview_banner=60` - кулдаун в сек
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        - Приложение перезапущено после изменений в dev settings
        - Девайс подключен к снифферу через socks.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - В инструменте Throttling выбираем пресет 256 kbits/s
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        - Строится маршрут
        - Открыт экран обзора
        - Альтернатива с такси на третьем месте отсутствуе (пытается прогрузиться, но не прогружается)
        - После неудачной попытки прогрузиться кнопке такси в течение нескольких секунд над обзором показывается баннер GeoAd (условно, 2 секунды пока ждём саджеста + от 3 до 5 секунд на ожидание баннера)

    - platforms:
        - ios
        - android


  Кнопка такси при взаимодействии с рекламой GeoAd в обзоре:
    - info: |
        Для проверки включаем рекламу в обзоре, в данном кейсе будет использоваться Geoad
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перейти в настройку: Dev. Set. -> Ad -> Setup pages ids
        - Занулить все категории прописав в них 0 или null
        - В категорию "Баннер в обзоре (geo ad)" вписать следующий pageid: overview_banner_3/testing_overview_regular_site
        - Тап сохранить
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        А так же прокинуть интенты:
        - `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad,brand_route,via` - интент приоритета геоэда над БМ и Бураном.
        - `yandexnavi://add_exp?navi_ads_overview_ad_queue=geo_ad_location,geo_ad_route,direct,yas` - интент приоритета источника рекламы
        - `yandexnavi://add_exp?navi_ad_product_cooldown_overview_banner=60` - кулдаун в сек
        *Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`*
        - Приложение перезапущено после изменений в dev settings
        - Девайс подключен к инструменту для снятия логов.
        - Девайс подключен к снифферу через socks.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        - Строится маршрут
        - Открывается экран обзора.
        - На третьем месте показывается кнопка Такси.
        - После успешного появления такси, в пределах 2 секунд **Над обзором показывается баннер GeoAd**
        - В логах наблюдаем событие `geoadv.bb.pin.show (навигатор)`/ `mapkit.search.logger.billboard.show` (мапкит) - показ карточки
    - do: Тап на баннер GeoAd
    - assert: |
        - Открывается карточка с рекламным контентом, соответствующим этому баннеру

    - platforms:
        - ios
        - android
    - tags:
        - metric


  Отсутствие кнопки такси при включенном ГК, но в настройках выбрано значение для грузовых:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Включен грузовой каркас Меню - Настройки - Навигация - Маршруты для грузовиков - свитчер ВКЛ
        - Меню - Настройки - в блоке Быстрые настройки - Маршруты - Для грузовых (о полном включении ГК свидетельсвует грузовик - курсор)
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открывается экран обзора
        - Кнопка с иконкой такси отсутствует

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отсутствие кнопки такси при построении маршрута свыше 50 км:
    - info: |
        -  Dev Settings - Ad - Show taxi ad route at second position - Off
        -  Dev Settings - Ad - Show taxi ad route at third position - On
        -  Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открывается экран обзора
        - Кнопка с иконкой такси отсутствует

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Кнопка такси при взаимодействии с рекламой в обзоре. Буран:
    - info: |
        Для проверки достаточно использовать любую рекламу в обзоре, в данном кейсе будет использоваться Буран.
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перейти в настройку: Dev. Set. -> Ad -> Setup pages ids
        - Занулить все категории прописав в них 0 или null
        - В категорию "Буран (Via)" вписать следующий pageid: route_via_point_1/testing_azs_temp_neftmag
        - Тап сохранить
        - Пробросить интент приортета: `adb shell am start -a android.intent.action.VIEW -d "yandexnavi://add_exp?navi_overview_ads_priority_for_RU=via"` (для android)/`yandexnavi://add_exp?navi_overview_ads_priority_for_RU=via`
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        - Приложение перезапущен после изменений в dev settings
        - Девайс подключен к снифферу через socks/brooks.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран (карта)
        - Девайс подключен к инструменту для снятия логов.
    - do: Построить маршрут с помощью интента `adb shell am start -a android.intent.action.VIEW -d "yandexnavi://build_route_on_map?lat_from=55.734337\&lon_from=37.589145\&lat_to=55.376780\&lon_to=37.396182"` (android)/`yandexnavi://build_route_on_map?lat_from=55.734337&lon_from=37.589145&lat_to=55.376780&lon_to=37.396182` (IOS)
    - assert: |
        - Строится маршрут
        - Открывается экран обзора
        - На третьем месте показывается кнопка с иконкой такси
        - Вместо расстояния на этой кнопке показана "цена, Такси"
        - Показывается свитчер с названием рекламной организации (буран)
        - В логах приходит событие (навигатора) overview-ads.pin-shown и (мапкит) mapkit.search.logger.billboard.show
    - do: |
        - Переключить свитчер в положение включен
    - assert: |
        - Добавляется виа точка нового перестроенного маршрута. Брендированность рекламной виа-точки не теряется
        - В логах приходит событие (навигатора) overview-ads.pin-swapped и (мапкит) mapkit.search.logger.billboard.click
        - Кнопка с иконкой такси на третьем месте

    - platforms:
        - ios
        - android
    - tags:
        - metric


  Такси в обзоре после тапа по кнопке Поехали (во время движения по маршруту):
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открывается экран обзора
        - Альтернатива с иконкой такси присутствует на третьем месте
    - do: Тап на Поехали и запустить симуляцию движения по маршруту через дебаг-панель
    - assert: |
        - Начинается движение по маршруту
    - do: Перейти на экран обзора
    - assert: |
        - Открывается экран обзора.
        - Альтернатива с такси отсутствует

    - platforms:
        - ios
        - android


  Отсутствие такси в обзоре в случае если маршрут был построен при помощи интента на построение маршрута из Я.Про:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: |
        - Для Android пробросить интент `adb shell am start -a android.intent.action.VIEW -d "yandexnavi://build_route_on_map?lat_to=54.192837\&lon_to=37.614855\&client=7\&signature=fqPtf8pn8g1nrFZF6hdSb%2F6V7fMleefctBJ8pDE0kjmlSIOdzkD54YF5M%2Fsoh1syQrxiVdYTr5ynckQhc2xaZw%3D%3D"`
        - Для IOS пробросить интент `yandexnavi://build_route_on_map?lat_to=54.192837&lon_to=37.614855&client=7&signature=fqPtf8pn8g1nrFZF6hdSb%2F6V7fMleefctBJ8pDE0kjmlSIOdzkD54YF5M%2Fsoh1syQrxiVdYTr5ynckQhc2xaZw%3D%3D`
    - assert:
        Альтернатива с такси в обзоре не показывается в случае если маршрут был построен при помощи интента на построение маршрута из Я.Про.

    - platforms:
        - ios
        - android


  Кнопка такси в обзоре при добавлении промежуточной точки до тап по Поехали:
    - info: |
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev Settings - Misc - Fast day&night switching - On
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Открывается экран обзора
        - На третьем месте показывается альтернатива с такси
        - Вместо расстаяния на этой кнопке показана "цена, Такси"
    - do: Через Лонг-тап добавить промежуточную точку.
    - assert: |
        - Маршрут перестраивается с учетом промежуточной точки
        - На экране обзора наблюдаем альтернативу с Такси

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Кнопка такси при взаимодействии с рекламой GeoAd (РСЯ) в обзоре:
    - info: |
        Для проверки включаем рекламу в обзоре, в данном кейсе будет использоваться Geoad
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перейти в настройку: Dev. Set. -> Ad -> Setup pages ids
        - Занулить все категории прописав в них 0 или null
        - В категорию "Баннер в обзоре РСЯ" вписать следующий pageid: |
        iOS: R-IM-588231-3
        Android: R-IM-588230-3
        - Тап сохранить
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        А так же прокинуть интенты:
        - `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad,brand_route,via` - интент приоритета геоэда над БМ и Бураном.
        - `yandexnavi://add_exp?navi_ads_overview_ad_queue=yas` - интент приоритета источника рекламы
        - `yandexnavi://add_exp?navi_ad_product_cooldown_overview_banner=60` - кулдаун в сек
        *Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`*
        - Приложение перезапущен после изменений в dev settings
        - Девайс подключен к инструменту для снятия логов.
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        - Строится маршрут
        - Открывается экран обзора.
        - На третьем месте показывается кнопка Такси.
        - После успешного появления такси (в пределах 2 секунд) **Над обзором показывается баннер GeoAd**
        - В логах наблюдаем событие `route.direct-yan-visibility`
    - do: Тап на баннер GeoAd
    - assert: |
        - Открывается карточка с рекламным контентом, соответствующим этому баннеру

    - platforms:
        - ios
        - android
    - tags:
        - metric


  Кнопка такси при взаимодействии с Брендированным маршрутом в обзоре:
    - info: |
        Для проверки включаем рекламу в обзоре, в данном кейсе будет использоваться Geoad
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Dev.settings -> AD -> FDE вкл
        - Тап сохранить
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        А так же прокинуть интенты:
        - `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=brand_route` - интент приоритета БМ.
        - `yandexnavi://add_exp?navi_special_project_common_brand_route_cooldown_seconds=60` - кулдаун в сек
        - `yandexnavi://add_exp?navi_special_project_brand_route_rotation_configurations_for_RU=%5B%7B%22project_name%22%3A%20%22megafon_bm%22%2C%22configuration%22%3A%20%7B%20%22weight%22%3A%201.0%20%7D%7D%5D` - включение тестового БМ
        *Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`*
        - Приложение перезапущен после изменений в dev settings
        - Девайс подключен к инструменту для снятия логов.
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        - Строится маршрут
        - Открывается экран обзора.
        - На третьем месте показывается кнопка Такси.
        - После успешного появления такси (в пределах 2 секунд) **Над обзором показывается БМ**
        - В логах наблюдаем событие `route.brand-route-visibility`
    - do: Тап на баннер GeoAd
    - assert: |
        - Открывается , интроскрин/вебвью/etc соответствующим этому баннеру

    - platforms:
        - ios
        - android
    - tags:
        - metric


  Кнопка такси при взаимодействии с рекламой Буран в обзоре при слабом интернете:
    - info: |
        Для проверки включаем следующие настройки:
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off
        - Dev Settings - Ad - Show taxi ad route at third position - On
        - Dev Settings - Ad - Show taxi ad route setting - Off
        - Перейти в настройку: Dev. Set. -> Ad -> Setup pages ids
        - Занулить все категории прописав в них 0 или null
        - В категорию "Буран (Via)" вписать следующий pageid: route_via_point_1/testing_azs_temp_neftmag
        - Тап сохранить
        - Пробросить интент приортета: `adb shell am start -a android.intent.action.VIEW -d "yandexnavi://add_exp?navi_overview_ads_priority_for_RU=via"` (для android)/`yandexnavi://add_exp?navi_overview_ads_priority_for_RU=via`
        - DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
        - Приложение перезапущено после изменений в dev settings
        - Девайс подключен к снифферу через socks/Brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - В инструменте Throttling выбираем пресет 256 kbits/s
        - Открыт главный экран (карта)
        - Девайс подключен к инструменту для снятия логов.
    - do: Построить маршрут с помощью интента `adb shell am start -a android.intent.action.VIEW -d "yandexnavi://build_route_on_map?lat_from=55.734337\&lon_from=37.589145\&lat_to=55.376780\&lon_to=37.396182"` (android)/`yandexnavi://build_route_on_map?lat_from=55.734337&lon_from=37.589145&lat_to=55.376780&lon_to=37.396182` (IOS)
    - assert: |
        - Строится маршрут
        - Показана плашка альтернативных маршрутов
        - На третьем месте НЕ показывается кнопка с иконкой такси (пытается прогрузиться, но не прогружается)
        - После неудачной попытки прогрузиться кнопке такси (в пределах 2 секунд) в течение нескольких следующих секунд **видим буран** (условно, 2 секунды пока ждём саджеста + от 3 до 5 секунд на ожидание баннера)

    - platforms:
        - ios
        - android


  Логирование кнопки Такси в обзоре маршрута:
    - info: |
        Для проверки включаем следующие настройки:
        - Пользователь авторизован
        - Установлено приложение Яндекс.GO
        - Dev Settings - Ad - Show taxi ad route at second position - On
        - Dev Settings - Ad - Show taxi ad route at third position - Off
        - Dev Settings -> Misc -> Fast day & night switching - On
        - Девайс подключен к инструменту для снятия логов
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут дистанция которого будет меньше чем 50км
    - assert: |
        - Строится маршрут
        - Показана плашка альтернативных маршрутов
        - На втором месте показывается кнопка с иконкой такси (С логотипом приложения Яндекс.GO, временем в пути и ценой)
        - В логи приходит событие route.show-taxi-variant с параметрами:
          (route_distance) - длинна
          (route_time) - время
          (price + currency) - цена поездки
          (end_lat и end_lon) - координаты точки назначения
          (end_uri) - uri
    - do: Тап на плашку с вариантов заказа Такси
    - assert: |
        - В логи приходит событие route.switch-route-variants с параметрами
          (route_distance) - длинна
          (route_time) - время
          (price + currency) - цена поездки
          (end_lat и end_lon) - координатф точки назначения
          (end_uri) - uri 

    - platforms:
        - ios
        - android
    - tags:
        - metric


  UI кнопки Такси в обзоре маршрута:
    - info: |
        Для проверки включаем следующие настройки:
        - Пользователь авторизован
        - Установлено приложение Яндекс.GO
        - Dev Settings - Ad - Show taxi ad route at second position - On (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(3).add831d.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_second=enabled`
        - Dev Settings - Ad - Show taxi ad route at third position - Off (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(4).5bfe791.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_third=disabled`
        - Dev Settings -> Misc -> Fast day & night switching - On (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(6).d7cb38c.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled`
        - Перезапустить приложение
        - Девайс подключен к снифферу через socks/brook.
        - С помощью инструмента Map Local, подменяем ответ https://geointernal.mob.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Открыт главный экран
    - do: Построить маршрут
    - assert: |
        - Строится маршрут
        - Показана плашка альтернативных маршрутов
        - На втором месте показывается кнопка с иконкой такси (С логотипом приложения Яндекс.GO, временем в пути и ценой)
    - do: Сменить ориентацию девайса несколько раз. Дождаться смены на дневную|ночную тему
    - assert: |
        - UI кнопки Такси не едет
        - Текст внутри кнопки отцентрован и читабелен
        - Отсутствие артефактов противоположной темы(ночь|день)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  Поддержка суффиксов у параметров Такси. Яндекс.GO не установлено:
    - info: |
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(7).7c5d729.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_second=disabled`
        - Dev Settings - Ad - Show taxi ad route at third position - On (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(8).fa5321d.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_third=enabled`
        - Dev Settings - Ad - Show taxi ad route setting - Off (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(9).69845bb.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_navi_feature_setting_taxi=disabled`
        - Девайс подключен к снифферу через прокси.
        - С помощью инструмента Map Local, подменяем ответ https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Яндекс.GO не установлен
        - Не получен эксперимент на добавление суффиксов в параметры запроса(taxi_ref_suffix)
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        Строится маршрут
        Открывается экран обзора.
        На третьем месте показывается кнопка Такси.
    - do: |
        Тап на кнопку Такси
        Тап Заказать
    - assert: |
        Происходит переход в стор
        В сниффере отображается запрос https://3.redirect.appmetrica.yandex.com/
        У параметров запроса ref и utm_medium отсутвует суффикс(например, _999)
    - do: |
        Прокинуть интент:
        yandexnavi://add_exp?taxi_ref_suffix=999
        Построить маршрут
        Тап на кнопку Такси
        Тап Заказать
    - assert: |
        Происходит переход в стор
        В сниффере отображается запрос https://3.redirect.appmetrica.yandex.com/
        У параметров запроса ref - присутвует суффикс, а у utm_medium - нет(например, _999)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  Поддержка суффиксов у параметров Такси. Яндекс.GO  установлен:
    - info: |
        - Меню - Настройки - Developer Settings - Misc - Debug config enable - On
        - Dev Settings - Ad - Show taxi ad route at second position - Off (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(7).7c5d729.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_second=disabled`
        - Dev Settings - Ad - Show taxi ad route at third position - On (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(8).fa5321d.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_show_alternative_taxi_third=enabled`
        - Dev Settings - Ad - Show taxi ad route setting - Off (QR):
            [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(9).69845bb.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_navi_feature_setting_taxi=disabled`
        - Девайс подключен к снифферу через прокси.
        - С помощью инструмента Map Local, подменяем ответ https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/taxi/navi/orders/estimate на ((https://jing.yandex-team.ru/files/kiseln/taxi.json json)) c готовым измененным ответом.
        - Яндекс.GO установлен
        - Не получен эксперимент на добавление суффиксов в параметры запроса(taxi_ref_suffix)
        - Открыт главный экран (карта)
    - do: Построить маршрут в Москве, расстояние от начальной и конечной точки не более 50 км (расстояние по прямой, не по графу).
    - assert: |
        Строится маршрут
        Открывается экран обзора.
        На третьем месте показывается кнопка Такси.
    - do: |
        Тап на кнопку Такси
        Тап Заказать
    - assert: |
        Происходит переход в Яндекс.GO
        В сниффере отображается запрос https://app.adjust.com/sdk_click
        У запроса присутсвует параметр deeplink в котором лежит ссылка yandextaxi://route...
        В ссылке у yandextaxi://route... у  ref и utm_medium отсутвует суффикс(например, _999)
    - do: |
        Прокинуть интент:
        yandexnavi://add_exp?taxi_ref_suffix=999
        Построить маршрут
        Тап на кнопку Такси
        Тап Заказать
    - assert: |
        Происходит переход в Яндекс.GO
        В сниффере отображается запрос https://app.adjust.com/sdk_click
        У запроса присутсвует параметр deeplink в котором лежит ссылка yandextaxi://route...
        В ссылке yandextaxi://route... у ref - присутствует суффикс, а у utm_medium - нет(например, _999)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
