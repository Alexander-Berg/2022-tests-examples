components: ad_unlogin
testing:
  - regress

specs:
  Настройки "другое" при незалогине:
    - description: |
        Есть фича "отключение настройки против рекламы для незалогинов"
        Суть в чем, настройка "другое" будет недоступна для пользователей, что не авторизован и их настройки против рекламы будут выключенны.
    - info: |
        Перед проверками необходимо прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - do: |
        Войти незалогиненным пользователем в навигатор
        Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается экран авторизации
    - do: Авторизоваться в приложении
    - assert: Открывается раздел Другие настройки

    - platforms:
      - ios
      - android
    - testing:
      - acceptance_navi
    - tags:
        - assessors


  Настройки "другое" при незалогине и обновлении:
    - description: |
        Есть фича "отключение настройки против рекламы для незалогинов"
        Суть в чем, настройка "другое" будет недоступна для пользователей, что не авторизован и их настройки против рекламы будут выключенны.
        Данная фича включается экспериментом https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - info: |
        Установить чистый навигатор
        `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> Off`
    - do: |
        Войти незалогиненным пользователем в навигатор версии 4.90 или старше
        Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается раздел Другие настройки
    - do: |
        Выключить "Реклама при построении маршрута"
        Попробовать поймать отключенную рекламу!
        Для этого включить следующие настройки:
        - прокинуть интент yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad
        - DevSettings - Ad - FDE - On
        - DevSettings - Ad - Ad misc features - Ignore ads cooldown - on
        Перезапустить навигатор
        Построить маршрут
    - assert: Соответствующая реклама больше не появляется (над карточкой обзора отсутствует баннер)
    - do: |
        Включить эксперимент для отключения входа в пункт Другие настройки для незалогинов, для этого:
        включить эксперимент https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        После установки настройки перезапустить навигатор
        Обновить приложение до версии 4.95 и выше
        Попробовать поймать еще раз рекламу которую отключали на шаге 2
        Для этого необходимо:
        - Построить маршрут
    - assert: Реклама которую отключали на шаге 2 ловиться (над карточкой обзора появляется баннер)
    - do: Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается экран авторизации
    - do: Авторизоваться в приложении
    - assert: |
        Открывается раздел Другие настройки
        Отключенная реклама восстанавливается в соответствующее отключенное состояние
    - do: |
        Попробовать поймать отключенную рекламу на шаге 2
        Для этого необходимо:
        - Построить маршрут
    - assert: Отключенная реклама не появляется (над карточкой обзора не появляется баннер)

    - platforms:
      - ios
      - android
    - tags:
      - assessors


  Настройки "другое" при залогине и обновлении (Вкл рекламы):
    - description: |
        Есть фича "отключение настройки против рекламы для незалогинов"
        Суть в чем, настройка "другое" будет недоступна для пользователей, что не авторизован и их настройки против рекламы будут выключенны.
        Данная фича включается экспериментом https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - info: |
        Установить чистый навигатор
        Данная фича включается экспериментом https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled
        или локально включить настройку в Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On
        Для Android использовать команду: adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”
        После установки настройки перезапустить навигатор
    - do: |
        Войти в приложение аккаунтом с имеющимися отключенными настройками рекламы в пункте Другие настройки в навигатор версии 4.90 или старше
        (Например была отключена настройка Реклама при построении маршрута)
        Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается раздел Другие настройки
    - do: Включить отключенную рекламу (Например была отключена настройка Реклама при построении маршрута)
    - assert: Пункты перешли в состояние ВКЛ
    - do: |
        Попробовать поймать включенную рекламу
        Для этого включить следующие настройки:
        - прокинуть интент `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad`
        - DevSettings - Ad - FDE - On
        - DevSettings - Ad - Ad misc features - Ignore ads cooldown - on
        Перезапустить навигатор
        Построить маршрут
    - assert: Включенная реклама показывается (над карточкой обзора появляется баннер)
    - do: |
        Обновить приложение до версии 4.95 и выше
        Попробовать поймать включенную на шаге 2 рекламу
        Для этого необходимо:
        - Построить маршрут
    - assert: Реклама которую включали на шаге 2 ловиться (над карточкой обзора появляется баннер)
    - do: Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: |
        Открывается раздел Другие настройки
        Состояние настроек после обновления не изменилось

    - platforms:
      - ios
      - android
    - tags:
      - assessors


  Настройки "другое" при залогине и обновлении (Выкл рекламы):
    - description: |
        Есть фича "отключение настройки против рекламы для незалогинов"
        Суть в чем, настройка "другое" будет недоступна для пользователей, что не авторизован и их настройки против рекламы будут выключенны.
        Данная фича включается экспериментом https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - info: |
        Установить чистый навигатор
        Данная фича включается экспериментом https://st.yandex-team.ru/EXPERIMENTS-55204 с выборкой 282967
        или локально прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - do: |
        Войти аккаунтом с имеющимися включенными настройками рекламы в пункте Другие настройки в навигаторе версии например 4.90 или старше
        (Например была включена настройка Реклама при построении маршрута)
        Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается раздел Другие настройки
    - do: Отключить какую либо включенную рекламу (Например была включена настройка Реклама при построении маршрута)
    - assert: Пункты перешли в состояние ВЫКЛ
    - do: |
        Попробовать поймать отключенную рекламу
        Для этого включить следующие настройки:
        - прокинуть интент `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad`
        - DevSettings - Ad - FDE - On
        - DevSettings - Ad - Ad misc features - Ignore ads cooldown - on
        Перезапустить навигатор
        Построить маршрут
    - assert: Отключенная реклама не показывается (над карточкой обзора не появляется баннер)
    - do: |
        Обновить приложение например до версии 4.95 и выше
        Попробовать поймать отключенную на шаге 2 рекламу
        Для этого необходимо:
        - Построить маршрут
    - assert: Реклама которую выключали на шаге 2 не ловиться (над карточкой обзора не появляется баннер)
    - do: Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: |
        Открывается раздел Другие настройки
        Состояние настроек после обновления не изменилось

    - platforms:
      - ios
      - android
    - tags:
      - assessors


  Настройки "другое" при незалогине (логирование):
    - description: |
        Есть фича "отключение настройки против рекламы для незалогинов"
        Суть в чем, настройка "другое" будет недоступна для пользователей, что не авторизован и их настройки против рекламы будут выключенны.
        Данная фича включается интентом `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - info: |
        Установить чистый навигатор
        прокинуть интент `yandexnavi://add_exp?navi_feature_show_ads_for_unauthorized_person=enabled`
        или локально включить настройку в `Dev.Set -> Ad -> Ad misc features -> Disable ads setting for unauthorized person -> On`
        Для Android использовать команду: `adb shell am start -a android.intent.action.VIEW -d “НУЖНЫЙ ИНТЕНТ”`
        После установки настройки перезапустить навигатор
    - do: |
        Войти незалогиненным пользователем в навигатор
        Перейти в Меню - Настройки - Карта и интерфейс - Другие настройки
    - assert: Открывается экран авторизации
    - do: Сэмитировать неудачную авторизацию, например закрыв экран авторизации
    - assert: |
        В логи приходит событие `settings.misc_settings_login` с параметром `success: false`
        Происходит переход обратно к настройкам Карта и интерфейс
    - do: Тап на пункт Другие настройки
    - assert: Происходит переход на экран авторизации
    - do: Авторизоваться аккаунтом в приложении
    - assert: |
        В логи приходит событие settings.misc_settings_login с параметром success: true
        Происходит переход в раздел "Другие настройки"

    - platforms:
      - ios
      - android
    - testing:
      - acceptance_navi
    - tags:
      - assessors
      - metric