components: audio
testing:
  - regress

specs:
  Прооверка входящих звонков во время фонового ведения на iOS:
    - info: |
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение (пользователь не идет пешком)
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Отменить входящий вызов на тестовом девайсе
    - assert: |
        Навигатор продолжает ведение в фоне.
        Аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Ответить на звонок
    - assert: |
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Через некоторый промежуток времени, завершить звонок
    - assert: |
        Навигатор продолжает ведение в фоне.
        После завершения вызова аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS

    - integration_run:
        - annotation
        - audiosession
    - platforms:
        - ios
    - tags:
        - assessors
        - mobile_internet


  Прооверка входящих звонков во время фонового ведения на Android:
    - info: |
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение (пользователь не идет пешком)
        Аннотации произносятся/не произносятся(Особенность Android)

    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Отменить входящий вызов на тестовом девайсе
    - assert: |
        Навигатор продолжает ведение в фоне.
        Аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Ответить на звонок
    - assert: |
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Через некоторый промежуток времени, завершить звонок
    - assert: |
        Навигатор продолжает ведение в фоне.
        После завершения вызова аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS

    - integration_run:
        - annotation
        - audiosession
    - platforms:
        - android
    - tags:
        - assessors
        - mobile_internet


  Входящие звонки во время фонового ведения BT-гарнитруа на iOS:
    - info: |
        Подключить девайс к BT-гарнитуре
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение
    - do: |
        Позвонить на девайс.
    - assert: |
        До звонка аннотации озвучиваются через гарнитуру.
    - do: |
        Ответить на входящий
    - assert: |
        Разговор осуществляется через гарнитуру.
        Аннотации не произносятся.
    - do: |
        Завершить звонок
    - assert: |
        Аннотации начинают воспроизводится


    - integration_run:
        - annotation
        - audiosession
    - platforms:
        - ios
    - tags:
        - assessors
        - mobile_internet


  Входящие звонки во время фонового ведения BT-гарнитруа на Android:
    - info: |
        Подключить девайс к BT-гарнитуре
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение
        Аннотации во время и до звонка произносятся/не произносятся(Особенность Android)
    - do: |
        Позвонить на девайс.
    - assert: |
        До звонка аннотации озвучиваются через гарнитуру.
    - do: |
        Ответить на входящий
    - assert: |
        Разговор осуществляется через гарнитуру.
    - do: |
        Завершить звонок
    - assert: |
        Аннотации начинают воспроизводится


    - integration_run:
        - annotation
        - audiosession
    - platforms:
        - android
    - tags:
        - assessors
        - mobile_internet


  Android. Голосовое управление — Отсутствие артефактов звукозаписи:
    - description: Приложение запускалось 2 и более раз. Производилось взаимодействие с голосовым помощником.
    - do: Посмотреть, что навигатор НЕ пишет файл /sdcard0/stream.wav (/mnt/sdcard/stream.wav).
    - assert: Нет указанного файла.

    - integration_run:
        - speechkit
        - alice
    - platforms:
        - android
    - tags:
        - assessors


  Голосовое управление — работа с гарнитурой (iOS):
    - description: |
        Я.Навигатор на андройде пока не поддерживает запись звука с bluetooth гарнитуры. Воспроизведение звука идет через гарнитуру.
        Я.Навигатор выводит звук через bluetooth гарнитуру только если на устройстве запущена музыка. Для проверки на iOS, перед выполнением тестов, нужно запустить музыку (Например через приложение Я. Музыка).
        Встроенная музыка в навигатор при подключении BT гарнитуры должна иметь тоже поведение, что и с другой
        музыкой
    - info: |
        - Подключить БТ-гарнитуру к телефону.
        - Проверить правильность подключения и работы БТ-гарнитуры. (Включить музыку через приложение Я.Музыка. Позвонить на устройство с подключенной гарнитурой)
        -  **Для iOS**: Выставить в настройках "**Звуки и оповещения**" режим подключения **A2DP**
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Построить маршрут и запустить ведение по нему.
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Свернуть приложение
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Запустить музыку
    - assert: Музыка и аннотации звучат через гарнитуру.
    - do: |
        - Выставить в настройках **Звуки и оповещения** - **Bluetooth** режим подключения **По умолчанию**
        - Построить новый маршрут и запустить по нему ведение
        - Свернуть приложение
        - Запустить музыку (если была отключена ранее)
    - assert: Когда музыка запущена, все аннотации смешиваются с музыкой и звучат через гарнитуру.
    - do: |
        - Выключить музыку
        - Не прерывать ведение в фоне
    - assert: Когда музыка не запущена, все аннотации звучат через динамик устройства.

    - platforms:
        - ios
    - tags:
        - assessors
        - bt_headset
    - integration_run:
        - audiosession


  Проверка VR при входящих звонках в движении:
    - description: |
        Подключить устройство к ГУ.
        Запустить Навигатор через лончер.
    - do: Построить маршрут и начать ведение по маршруту.
    - assert: При ведении по маршруту воспроизводятся аннотации, не заикаются и произносятся целиком.
    - do: |
        Совершить входящий звонок на телефон, подключенный к ГУ.
    - assert: Возникает экран входящего звонка на ГУ. Отклонить звонок.
    - do: Активно общаться с алисой/болтать.
    - assert: Разговор с Алисой не прерывается, звучание Алисы четкое, понятное.
    - do: Закрыть Алису.
    - assert: Алиса скрылась с экрана.
    - do: |
        - Совершить входящий звонок на телефон, подключенный к ГУ.
        - Принять входящий звонок.
    - assert: Кнопки ГУ окна входящего звонка активны
    - do: Завершить звонок через минуту и более.
    - assert: Трубку возможно положить через ГУ.
    - do: Прислушаться к аннотациям.
    - assert: Аннотации воспроизводятся, не прерываются
    - do: |
        **Для локализации проблемы(при ее наличии) необходимы проверки на тестовых приложениях**

    - testing:
        - acceptance_navi
    - integration_run:
        - myspin
    - platforms:
        - renault
        - nissan
    - tags:
        - assessors


  Разорвать соединение при ответе Алисы:
    - info: |
        Быть подключенным к ГУ по bluetooth и кабелю
    - do: |
        - Вызвать Алису
        - Задать вопрос, например "какая завтра погода?"
        - Во время ответа Алисы - выдернуть кабель из ГУ
        - Подключиться кабелем и вызвать Алису
    - assert: Алиса вызывается, слышит и отвечает без дополнительных переподключений кабеля и/или bluetooth

    - testing:
        - acceptance_navi
    - integration_run:
        - myspin
    - platforms:
        - renault
        - nissan
    - tags:
        - assessors


  Mute под рулевыми кнопками Renault:
    - do: |
        - Построить маршрут и начать ведение по нему
        - Включить любой аудио-истоичник, например музыку
        - Сделать "MUTE" под рулевой кнопкой
    - assert: Отсутствует музыка. Аннотации произносятся и Алиса работает
    - do: Отключить "MUTE"
    - assert: Возобновлено воспроизведение звуков

    - platforms:
        - renault
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - myspin


  Проверка сохранения блютуз соединения после несколькиз часов:
    - do: |
        - Подключиться _debug сборкой к ГУ по кабелю и блютуз
        - Построить длинный маршрут, например из Мск в Владивосток
        - Начать симуляцию движения
        - Отключить звук радио и музыки (ехать без допольнительных звуков0
        - Спустя 3+ часа проверить работу аннотаций в маршруте
    - assert: Аннотации воспроизводятся корректно (если симуляция не умерла)
    - do: |
        - Построить новый маршрут (любой)
        - Начать ведение по нему
    - assert: |
        - Произносится аннотация о построенном маршруте
        - Аннотации произносятся, переподключения по блютузу не требуется

    - platforms:
        - renault
        - nissan
    - integration_run:
        - myspin


  Мьют радио и музыки при звонках:
    - info: Иметь с собой USB-флэшку с музыкой для проверки работы музыки
    - do: |
        - Запустить радио
        - Принять входящий звонок
    - assert: |
        - Звонок принимается
        - Радио мьютится
    - do: Завершить звонок
    - assert: |
        - Звонок завершается
        - Работа радио возобновляется
    - do: |
        - Выключить радио
        - Запустить музыку с USB-флэшки
        - Принять входящий звонок
    - assert: |
        - Звонок принимается
        - Музыка мьютится
    - do: Завершить звонок
    - assert: |
        - Звонок завершается
        - Возобновляется проигрывание музыки
    - do: |
        - Выключить музыку
        - Подключить по блютуз устройство
        - Запустить музыку
        - Принять входящий звонок
    - assert: |
        - Звонок принимается
        - Музыка мьютится
    - do: Завершить звонок
    - assert: |
        - Звонок завершается
        - Возобновляется проигрывание музыки

    - platforms:
        - motrex
        - autochip
    - testing:
        - acceptance_navi


  Рулевые кнопки. Входящие звонки при движении.:
    - do: |
        - Подключить телефон по БТ к ГУ
        - Зайти в навигатор
        -  Построить и подтвердить маршрут.
        -  Начать ведение по маршруту.
        - Совершить входящий звонок на телефон, подключенный к ГУ.
    - assert: |
        Построен маршрут, контекстное ведение отображается на экране.
        При ведении по маршруту воспроизводятся аннотации. Аннотации НЕ заикаются, произносятся целиком.
        Звонок отображается на ГУ в виде верхней строки статус -бара
    - do: Сбросить звонок при помощи рулевой кнопки
    - assert: |
        - Звонок сбрасывается
        - Навигатор не крешится, продолжается ведение по маршруту
    - do: |
        - Совершить звонок на подключенный телефон
        - Принять звонок при помощи рулевой кнопки.
        Произвести разговор в течении 1-2 минут (необходимо, чтобы на время разговора пришлось 2-3 аннотации (при этом аннотации могут быть как произнесены, так и не произнесены))
    - assert: |
        - Звонок принимается
        - Навигатор не крешится, продолжает работать.
    - do: При помощи рулевой кнопки закончить текущий звонок
    - assert: |
        - Звонок прекращается. Осуществляется переход к Навигатору
        - Навигатор не крешится, продолжает работать. Ведение по маршруту аннотируется.

    - platforms:
        - motrex
    - testing:
        - acceptance_navi


  Проверка аннотаций и звуков других приложений:
    - description: |
        Кейс описывает в первую очередь поведение на iOS, но может быть проверен также на Android.
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Открыть экран карты.
        - Отправить на девайс смс или любое сообщение, которое должно прийти с аудио нотификацией.
    - assert: |
        - ios звук нотификации есть (но может не быть и это ок)
        - android звук нотификации есть
    - do: |
        Перейти в одно из меню:
        - Поиск
        - Мои места
        - Меню
    - assert: |
        Звук нотификации есть (его может не быть, если звук происходит одновременно с произносимой аннотацией)
        `При включенном поиске от МЯК при нахождении на экране поиска  звуковой нотификации НЕ будет`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - integration_run:
        - annotation
        - audiosession


  Работа с BT-гарнитурой:
    - description: |
        При переходе из стороннего приложения в навигатор, отключается Bluetooth-гарнитура, когда задана настройка Настройки - Звуки и оповещения - Bluetooth - по умолчанию (Это для того, чтобы слушать аннотации не в гарнитуре, а в телефоне. Но если позвонят, то гарнитура заберет назад фокус.)
        Если указана иная настройка например, A2DP или Headset, то Bluetooth-гарнитура работает
    - info: |
        - Необходима bluetooth-гарнитура.
        - В настройках приложения все "Звуковые предупреждения" (дтп, камеры, работы...) активированы.
        - В IOS в Меню-Настройки-Звуковое сопровождение включена настройка "Все звуки Навигатора включены".
        - Подключена bluetooth-гарнитуру.
        - Задана настройка Настройки - Звуки и оповещения - Bluetooth - A2DP или Headset
    - do: |
        - Запустить проигрывание музыки на девайсе.
        - Построить маршрут через ДС (камеры, ДТП, дорожные работы) .
        - Запустить ведение по нему.
    - assert: |
        Проигрывается музыка.
        Происходит ведение по маршруту, озвучиваются аннотации.
    - do: |
        - Остановить проигрывание музыки.
        - Зайти в Меню - Настройки - Звуки и оповещения и уменьшить громкость аннотаций.
    - assert: Громкость аннотаций уменьшилась.
    - do: Вызвать Алису любым способом
    - assert: Громкость Алисы уменьшилась.
    - do: |
        Зайти в Меню - Настройки - Звуки и оповещения и увеличить громкость.
        Перевести свитчер в Меню-Настройки-Звуковое сопровождение в состояние “Выключить все звуки навигатора.”
    - assert: Аннотации и предупреждения не проигрываются.
    - do: Перевести свитчер в Меню-Настройки-Звуковое сопровождение в состояние “Включены оповещения о камерах, дорожных событиях и изменениях маршрута.”
    - assert: Проигрываются только оповещения о камерах, дорожных событиях и изменениях маршрута.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - bt_headset
    - testing:
        - acceptance_navi
    - integration_run:
        - annotation


  Работа с нативным голосовым помощником при прерывании аннотации:
    - info: |
        - В системных настройках девайса включен нативный голосовой помошник
        - В настройках приложения включена Алиса
        - Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api, и написать об этом в заведенной баге
    - do: |
        - Включить developer settings -> Misc -> New Audio focus Api
        - Перезапустить приложение
    - do: Построить маршрут и запустить введение
    - assert: Аннотации воспроизводятся
    - do: Вызвать нативный голосовой помощник (Siri или Google) по функциональной клавише в момент произнесения аннотации
    - assert: |
        - Аннотации прерываются
        - Активируется голосовой помошник
        - По завершении работы голосового помощника аннотации возобновляются
    - do: Вызвать алису голосом
    - assert: Алиса вызывается

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - integration_run:
        - annotation
        - audiosession
        - alice


  Проверка работы Навигатора при входящих звонках:
    - description: |
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Совершить звонок на тестовый девайс
    - assert: |
        - **Для Android:** Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        - **Для iOS:** Аннотации отсутствуют
    - do: |
        - Завершить вызов.
        - Вызвать Алису голосом
    - assert: |
        - Аннотации возобновляются
        - Алиса вызывается голосом

    - platforms:
        - ios
        - android
        - carsharing_t3
        - t3am
        - geely
        - vaz
        - motrex
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession
    - testing:
        - acceptance_navi


  Вызовы и Нави.Музыка:
    - description: |
        **Музыка раскатана только на регионы: РФ, Белоруссия, Казахстан**
        **Условия появления:** симка одной из стран (РФ, Белоруссия, Казахстан) / либо системный язык один из этих трех стран
        Местоположение пользователя __неважно__
        **Примечание:** Если симки нет, то в качестве "страны симки" будет использоваться язык приложения (или интерфейса системы).
        Запустить воспроизведение музыки в навигаторе.
        ---
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
    - do: Принять звонок на ГУ.
    - assert: Музыка должна поставиться на паузу на время звонка.
    - do: Сбросить звонок на ГУ.
    - assert: Воспроизведение музыки продолжилось.
    - do: Позвонить с ГУ.
    - assert: Музыка поставилась на паузу.
    - do: |
        - Поговорить 1-2 минуты.
        - Сбросить звонок на телефоне.
    - assert: После завершения звонка воспроизведение музыки продолжилось.

    - platforms:
        - renault
        - nissan


  Проверка отключения аннотаций во время звонка:
    - description: |
        **на iOS** убрали настройку (Меню -> Настройки -> Звуки и оповещения -> Аннотации во время звонка.), позволяющая переключать воспроизводимость аннотаций во время разговора.
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Перейти в Меню -> Настройки -> Звуки и оповещения
    - assert: В меню должен отсутствовать пункт Аннотации во время звонка
    - do: |
        **Построить маршрут и начать ведение** по маршруту.
        _Удобно установить маршрут с частыми поворотами либо со сходами с маршрута._
    - assert: Маршрут построен, ведение начато, **аннотации озвучиваются.**
    - do: Совершить **входящий звонок** на устройство и принять, **начать разговор.**
    - assert: |
        Во время поступления звонка **аннотаций НЕТ.**
        Во время разговора **аннотаций НЕТ.**
    - do: Завершить звонок.
    - assert: По завершению звонка **Аннотации воспроизводятся с прежней(до совершения звонка) громкостью.**

    - platforms:
        - ios
    - tags:
        - assessors
        - mobile_internet
    - testing:
        - acceptance_navi
    - integration_run:
        - annotation
        - audiosession


  Проверка настройки "Звуковое сопровождение":
    - description: |
        **Выполнять кейс следует, используя меню быстрых настроек, которое отображается непосредственно на ГУ. Панель быстрых настроек включается по эксперименту и в developer settings / Ya.Auto / Myspin fast settings in TabBar**
        Значение по-умолчанию для переключателя: “Все звуки Навигатора включены.”
        Значения настройки:
        Все = Все звуки Навигатора включены.
        Важные = Включены оповещения о камерах, дорожных событиях и изменениях маршрута.
        Выкл = Выключены все звуки Навигатора.
        Следует заметить, что на iOS и на Android эта настройка выбирается по разному -- на Android это выпадающее меню, а на iOS просто три переключателя.
    - info: |
        - Настройка “Голосовое сопровождение” установлена в значении “Все звуки Навигатора включены”
        - Настройка “Дорожные события” должна быть выставлена так, чтобы произносились аннотации о различных дорожных событиях. **Проверьте что настройки верно установлены как в "Отображение на карте" так и в "Звуковое предупреждение"**
    - do: |
        Построить маршрут в любую точку с наличием поворотов и ДС на нём.
        Тап на “Поехали”
    - assert: Все оповещения о поворотах, изменениях маршрута и предупреждения о ДС озвучиваются.
    - do: |
        Перейти в Настройки
        Изменить состояние настройки “Голосовое сопровождение” на “ Включены оповещения о камерах, дорожных событиях и изменениях маршрута.”
        Перейти на экран “Карта”
    - assert: Проигрываются только оповещения о камерах, дорожных событиях и изменениях маршрута.
    - do: |
        Перейти в Настройки
        Изменить состояние настройки “Голосовое сопровождение” на “Выключить все звуки навигатора.”
        Перейти на экран “Карта”
    - assert: Аннотации и предупреждения не произносятся.

    - platforms:
        - renault
        - nissan
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - myspin


  Звонки:
    - do: |
        - Построить маршрут и начать ведение по нему
        - Принять звонок во время ведения
    - assert: |
        - Принятие вызова не блокирует работу навигатора, отсутсвует креш, навигатор продолжает свою работу
        - Собеседники слышат друг друга по телефону
    - do: Дождаться момента, когда должна быть аннотация
    - assert: Аннотация не звучит, так как есть разговор по телефону
    - do: Завершить разговор на ГУ спустя 1,5-2 минуты
    - assert: |
        - Навигатор продолжает свою работу
        - Аннотации произносятся вовремя и без заиканий
    - do: Вызвать Алису
    - assert: Алиса слышит и отвечает, нет заиканий

    - platforms:
        - motrex
        - renault
        - nissan
        - autochip
        - first_run_hu
    - tags:
        - assessors
    - testing:
        - acceptance_navi
    - integration_run:
        - myspin


  Входящие звонки. Долгий разговор:
    - description: |
        Проверка работы приложения по возвращению из режима звонка по сценарию:
        - пользователь едет и ему позвонили
        ТК удобно проходить используя **debug** сборки.
    - info: Построить маршрут. Начать движение по маршруту. (запустить симуляцию движения через debug-панель)
    - do: |
        - Ответить на входящий звонок.
        - Произвести разговор в течении 10-15 минут.
        - Завершить разговор.
    - assert: Переход к Навигатору. Движение по маршруту продолжается.

    - platforms:
        - motrex
        - autochip
        - renault
        - geely
        - carsharing_t3
        - ios
        - nissan
        - t3am
        - android
    - tags:
        - mobile_internet


  Входящие звонки. Остановка движения во время разговора:
    - description: |
        Проверка работы приложения по возвращению из режима звонка по сценарию:
        - пользователь едет, ему позвонили, пользователь  припарковался на время разговора.
        ТК удобно проходить используя **debug** сборки.
    - info: Построить маршрут. Начать движение по маршруту. (запустить симуляцию через debug-панель)
    - do: Ответить на входящий звонок. Перейти в Навигатор, остановить движение в debug панели. Вернуться к экрану входящего звонка.
    - assert: |
        Движение остановлено.
        (Запомнить состояние навигатора, какой зум и как установлен курсор)
    - do: Завершить разговор.
    - assert: |
        Переход к Навигатору. Навигатор должен находится в том же состоянии, что и во время остановки движения из Шага 1, если проверка проводится в реальной поездке.
        Если проверка проводится через debug панель, то при остановке движения в панели сбрасывается маршрут, поэтому по окончания разговора произойдет переход в Навигатор без маршрута.
    - do: |
        Построить новый маршрут.
        Включить движение в debug панели.
    - assert: Возобновляется движение по построенному маршруту.

    - platforms:
        - motrex
        - autochip
        - renault
        - geely
        - carsharing_t3
        - ios
        - nissan
        - t3am
        - android
    - tags:
        - mobile_internet


  Голосовое управление — работа с гарнитурой:
    - description: |
        Я.Навигатор на андройде пока не поддерживает запись звука с bluetooth гарнитуры. Воспроизведение звука идет через гарнитуру.
        Я.Навигатор выводит звук через bluetooth гарнитуру только если на устройстве запущена музыка. Для проверки на iOS, перед выполнением тестов, нужно запустить музыку (Например через приложение Я. Музыка).
        Встроенная музыка в навигатор при подключении BT гарнитуры должна иметь тоже поведение, что и с другой
        музыкой
    - info: |
        - Подключить БТ-гарнитуру к телефону.
        - Проверить правильность подключения и работы БТ-гарнитуры. (Включить музыку через приложение Я.Музыка. Позвонить на устройство с подключенной гарнитурой)
        - **Для iOS**: Выставить в настройках "**Звуки и оповещения**" режим подключения **Headset**
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Построить маршрут и запустить ведение по нему.
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Свернуть приложение
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Запустить музыку
    - assert: Музыка и аннотации звучат через гарнитуру.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - bt_headset
    - integration_run:
        - audiosession


  Проверка аннотаций и звуков других приложений (приложение свернуто):
    - description: |
        Кейс описывает в первую очередь поведение на iOS, но может быть проверен также на Android.
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
    - do: |
        Свернуть приложение.
        Отправить на девайс смс или любое сообщение, которое должно прийти с аудио нотификацией.
    - assert: Звук нотификации есть (его может не быть, если звук происходит одновременно с произносимой аннотацией)

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - integration_run:
        - annotation
        - audiosession


  Проверка аннотаций и звуков других приложений (Алиса):
    - description: |
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
    - do: |
        - Запустить на девайсе воспроизведение музыки.
        - Вызвать Алису
    - assert: |
        - Алиса не слышит при воспроизведении музыки из стороннего приложения  (Спотифай, ЯМузыка, ютюб музыка). После вызова по кнопке Алисы сторонняя музыка не возобновляется
    - do: |
        - Вызвать Алису по кнопке
    - assert: |
        - Алиса вызывается и слышит команды


    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - integration_run:
        - annotation
        - audiosession


  Проверка аннотаций и звуков других приложений (Звонок):
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Запустить на девайсе воспроизведение музыки. (в стороннем приложении, например, Спотифай, ЯМузыка, ютюб музыка)
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Открыть приложение на экране карты
    - do: |
        - Позвонить и принять звонок
    - assert: |
        - Звук звонка слышен.
        - Звонок принимается
        - Воспроизведение аннотаций во время разговора происходит через динамик устройства на Android 4-7, на Android 8+ и iOS аннотации во время разговора не воспроизводятся.
    - do: |
        - Завершить разговор, спустя 1-2 мин
    - assert: |
        - Воспроизведение аннотаций возобновляется после завершения разговора.
        - Воспроизведение музыки из стороннего приложения возобновляется


    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession


  Проверка аннотаций и звуков других приложений при вызове Алисы(Звонок):
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Запустить на девайсе воспроизведение музыки. (в стороннем приложении, например, Спотифай, ЯМузыка, ютюб музыка)
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Открыть приложение на экране карты
    - do: |
        - Вызвать Алису голосом
    - assert: |
        - Вызов Алисы не доступен при воспроизведении музыки (iOS)
        - Алиса вызывается, воспринимает слова (Android)
    - do: |
        - Позвонить и принять звонок
    - assert: |
        - Звук звонка слышен
        - Звонок принимается
        - Воспроизведение аннотаций во время разговора происходит через динамик устройства на Android 4-7, на Android 8+ и iOS аннотации во время разговора не воспроизводятся.
    - do: |
        - Завершить разговор, спустя 1-2 мин
    - assert: |
        - Воспроизведение аннотаций возобновляется после завершения разговора.
        - Воспроизведение музыки из стороннего приложения не возобновляется

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession


  Проверка работы Навигатора при входящих звонках (навигатор в фоне):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо выключить developer settings -> Misc -> New Audio focus Api -> Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с включенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Свернуть навигатор во время ведения по маршруту
        - Совершить звонок на тестируемое устройство
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession


  Проверка работы Навигатора при входящих звонках (прерывание аннотации):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Совершить звонок на тестируемое устройство во время произнесения аннотации
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession


  Проверка работы Навигатора при входящих звонках (прерывание Алисы):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Вызвать Алису.
        - Позвонить на тестовый девайс во время разговора с Алисой.
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют
    - do: |
        - Завершить разговор
        - Вызвать Алису голосом
    - assert: По завершении разговора все аннотации возобновляются; Алису можно вызвать голосом.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mobile_internet
    - integration_run:
        - annotation
        - audiosession


  Работа аудио с reset media services:
    - description: проверка, что аннотации не умирают при ресете аудио в ios
    - info: Важно убедиться, что все настройки аудио стоит по умолчанию в приложении.
    - do: |
        - построить любой маршрут
        - запустить ведение по нему через дебаг панель
        - свернуть навигатор
    - assert: |
        - маршрут построился
        - началось ведение по нему
        - навигатор свернут и звучат аннотации
    - do: |
        - открыть системные ios настройки
        - перейти в Developer
        - тап "reset media services"
        - вернуться в навигатор и услышать, что аннотация работает
    - assert: |
        - развернув навигатор слышно все аннотации в приложении

    - platforms:
        - ios
    - integration_run:
        - annotation
        - audiosession
    - tags:
        - not_suitable_for_farm


  Фоновое ведение - аудио ведение с BT гарнитурой:
    - do: |
        - Developer settings -> Misc -> New Audio focus Api Off
        - Перезапустить приложение
        - Установлена _debug версия
    - do: |
        - Запустить навигатор
        - Построить маршрут с учетом максимального количества маневров и ДС
        - Свернуть навигатор
    - assert: |
        - Навигатор запущен
        - Маршрут построен
    - do: |
        - Подключить BT-гарнитуру к девайсу
        - Запустить воспроизведение музыки в навигаторе
    - assert: Музыка воспроизводит вместе с голосовыми аннотациями через гарнитуру
    - do: |
        - Получить звонок и принять его
        - Завершить звонок
    - assert: После завершения вызова воспроизведение музыки и голосовых аннотаций продолжается через BT-гарнитуру

    - platforms:
      - ios
      - android
    - integration_run:
      - audiosession
    - tags:
      - bt_headset
      - assessors


  Запуск приложения быстрой командой Siri (iOS):
    - info: |
        - В системных настройках девайса включена Siri
        - В приложении пройдены все интроскрины
        - В приложении сохранена точка Дом
    - do: Закрыть приложение
    - do: Произнести "Привет, Сири, поехали домой"
    - assert: |
        - Открывается приложение
        - Строится маршрут в сохраненный адрес "Дом"

    - testing:
        - acceptance_navi
    - platforms:
        - ios
    - tags:
        - assessors
        - not_suitable_for_farm


  Запуск приложения быстрой командой Siri из фона (iOS):
    - info: |
        - В системных настройках девайса включена Siri
        - В приложении пройдены все интроскрины
        - В приложении сохранена точка Дом
    - do: Свернуть приложение
    - do: Произнести "Привет, Сири, поехали домой"
    - assert: |
        - Открывается приложение
        - Строится маршрут в сохраненный адрес "Дом"

    - testing:
        - acceptance_navi
    - platforms:
        - ios
    - tags:
        - assessors
        - not_suitable_for_farm
