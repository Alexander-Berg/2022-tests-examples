components: zsb_appinstall
testing:
  - regress

specs-integration:
  aliases:
    - &Инфо
      - info: |
          - Dev. Set. -> Misc -> Debug config enable - On
          - Использовать интенты:
            [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

            `yandexnavi://reset_exp`
            [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download.7ed8e87.png){title=QR-код}

            `yandexnavi://set_ad_page_id?page_id=null`
            [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/testing_zsb_resolve_appinstall.png){title=QR-код}

            `yandexnavi://set_ad_page_id?page_type=zero_speed&page_id=navi_zero_speed_banner_10/testing_zsb_resolve_appinstall`
            [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-1.ce82061.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_zsb_statuses_logging=enabled&navi_feature_day_night_fast_switch=enabled&navi_ad_product_cooldown_zero_speed_banner=10&navi_ads_logging_zsb_closing_errors=enabled`
          - Перезапустить приложение
          - {{TEST_PH}}

specs:
  ZSB Appinstall (геомедийный источник). Браузер по умолчанию. Неудачный выбор:
    - *Инфо
    - info: На девайсе не установлен браузер по умолчанию!
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
        - Картинка не обрезается, рамок нет
    - do: |
        - Тап на баннер
        - Тап на кнопку Хорошо
    - assert: По нажатию на Хорошо отображается диалог выбора браузера
    - do: |
        - Не выбирать браузер
        - Тап на системную кнопку "назад"
    - assert: |
        - Баннер скрылся
        - Карта и интерфейс остаются тапабельными.

    - platforms:
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Возврат в навигатор:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Тап на баннер
        - Тап на кнопку Хорошо
    - assert: |
        - По тапу на ОК в поп-апе открывается браузер, выбранный по умолчанию
        - Происходит переход из браузера в магазин приложений
        - Открытие ссылки в браузере не дублируется (нет задублированных вкладок с этой ссылкой) в т.ч. при многократных тапах по ОК.
        - Android: Если браузер по умолчанию не установлен, то по нажатию на ОК отображается диалог выбора браузера
          При выборе браузера происходит открытие в нём трекинговой ссылки и редирект в магазин приложений
          Если закрыть диалог выбора браузера, не совершив выбор, баннер скрывается
          Карта и интерфейс остаются тапабельными
    - do: Переключиться из "магазина приложений" на приложение (Навигатор)
    - assert: При возврате в приложение баннер скрыт

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Android - системная кнопка "Back":
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
        - Картинка не обрезается, рамок нет
    - do: |
        - Тап на баннер
        - Тап на системную кнопку Back
    - assert: |
        - Тап back аналогичен тапу "Отмена"
        - Поп-ап скрывается
        - Баннер ZSB не скрывается

    - testing:
        - acceptance_navi
    - platforms:
        - android


  ZSB Appinstall (геомедийный источник). Поведение поп-апа при возобновлении движения.:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Тап на баннер
        - Не взаимодействовать с навигатором
        - Дождаться начала движения
    - assert: |
        - По тапу на баннер появляется поп-ап
        - После начала движения ZSB баннер не скрывается
        - После начала движения поп-ап не скрывается
    - do: Тап на кнопку "Не надо"
    - assert: Поп-ап и баннер скрываются

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Поведение поп-апа в фоне:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Тап на баннер
        - После появления поп-апа свернуть приложение в фон на 1-2 секунды и развернуть
    - assert: Поп-ап не исчезает

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Поведение поп-апа в оффлайне:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Тап на баннер
        - Включить авиарежим.
        - Тап по кнопке Хорошо
    - assert: |
        - Появляется поп-ап
        - После тапа по кнопке Хорошо:
        - При отсутствии сети происходит переход в браузер, но трекинговая ссылка не загружается в нем.
        - Текст ошибки об отсутствии сети может выводится не на всех ОС/браузерах.

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Логирование тапа Согласия в поп-апе:
    - *Инфо
    - info: Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Тап на баннер
        - Тап по кнопке Хорошо
    - assert: |
        - ZSB баннер скрывается
        - Начинается процесс перехода во внешний браузер (на Android может сперва появиться системный поп-ап с выбором браузера)
        - В логах наблюдаем событие `geoadv.bb.action.dialog.ok` или `dialog.ok`
        - А так же наблюдаем `geoadv.bb.action.openSite` и `mapkit.search.logger.billboard.action.open_site`

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  ZSB Appinstall (геомедийный источник). Логирование тапа Отмена в поп-апе:
    - *Инфо
    - info: Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: Тап на баннер.
    - assert: |
        - ZSB баннер не скрывается
        - Открывается поп-ап с кнопками Хорошо/Не надо
    - do: Тап по кнопке Не надо
    - assert: |
        - Поп-ап скрывается
        - ZSB баннер не скрывается
        - Маршрут и ведение по нему не сбрасывается
        - в логах наблюдаем событие `geoadv.bb.action.dialog.cancel`

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  ZSB Appinstall (геомедийный источник). Логирование закрытия:
    - *Инфо
    - info: Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: Тап на баннер.
    - assert: |
        - ZSB баннер не скрывается
        - Открывается поп-ап с кнопками Хорошо/Не надо
    - do: Тап на кнопку "Хорошо"
    - assert: |
        - ZSB баннер скрывается
        - В логи приходит событие `geoadv.bb.hide` с параметром `Reason: discard_uri_was_resolved`
        - Происходит переход во внешний браузер (на Android может сперва появиться системный поп-ап с выбором браузера)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  ZSB Appinstall (геомедийный источник). Скрытие поп-апа ZSB на IOS:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: Тап на баннер.
    - assert: |
        - ZSB баннер не скрывается
        - Открывается поп-ап с кнопками Хорошо/Не надо
    - do: Тап по поп-апу
    - assert: Поп-ап не скрывается
    - do: Тап мимо поп-апа (например, по карте)
    - assert: Поп-ап не скрывается
    - do: Тап по кнопке Не надо
    - assert: |
        - Поп-ап скрывается
        - ZSB баннер отображается
        - Маршрут и ведение не сбрасываются
    - do: |
        - Тап на баннер
        - Тап по Хорошо в поп-апе
    - assert: |
        - ZSB баннер скрывается
        - Открывается браузер, выбранный по умолчанию
    - do: После открытия ссылки переключиться из "магазина приложений" на приложение (Навигатор)
    - assert: |
        - При возврате в Навигатор после открытия ссылки - поп-ап скрыт
        - Баннер ZSB отсутствует
        - Маршрут и ведение не сбрасываются

    - platforms:
        - ios
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Скрытие поп-апа ZSB на Android:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: Тап на баннер
    - assert: |
        - ZSB не скрывается
        - Открывается поп-апа с кнопками Хорошо/Не надо
    - do: Тап по поп-апу
    - assert: |
        - Поп-ап скрывается
        - ZSB отображается
        - Маршрут и ведение не сбрасываются.
    - do: |
        - Тап на баннер.
        - Тап мимо поп-апа (например, по карте)
    - assert: |
        - Поп-ап скрывается
        - ZSB отображается
        - Маршрут и ведение не сбрасываются.
    - do: |
        - Тап по баннеру
        - Тап по кнопке Не надо
    - assert: |
        - Поп-ап скрывается.
        - ZSB не скрывается
        - Маршрут и ведение не сбрасываются.
    - do: |
        - Тап на баннер.
        - Тап по Хорошо в поп-апе
    - assert: |
        - Баннер ZSB скрывается
        - Открывается браузер, выбранный по умолчанию либо (для Android) диалог выбора браузера (в таком случае, необходимо выбрать браузер и продолжить переход)
    - do: После открытия ссылки переключиться из "магазина приложений" на приложение (Навигатор)
    - assert: |
        - При возврате в приложение после открытия ссылки - поп-ап скрыт
        - Баннер ZSB отсутствует
        - Маршрут и ведение не сбрасываются

    - platforms:
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Проверка UI поп-апа ZSB:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: Тап на баннер
    - assert: |
        - По тапу на баннер отображается поп-ап с заголовком, основным текстом, кнопками Хорошо/Не надо (названия кнопок может меняться, в зависимости от рекламной кампании)
        - Текст помещается в поп-ап, кнопки активны
        - Кнопка Хорошо справа, Не надо – слева
        - Открывается только один поп-ап, даже при многократном тапе на баннер
        - ZSB не скрывается
    - do: Несколько раз сменить ориентацию девайса.
    - assert: |
        - Поп-ап не схлопывается
        - UI баннера не искажается, элементы остаются на своих местах, после возврата ориентации
        - Поп-ап выравнивается относительно середины экрана
    - do: Дождаться смены темы
    - assert: |
        - Поп-ап подстраивается под текущую актуальную тему
        - Артефакты противоположной темы отсутствуют

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  ZSB Appinstall (геомедийный источник). Проверка UI:
    - *Инфо
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
        - Картинка не обрезается, рамок нет
    - do: Несколько раз сменить ориентацию девайса
    - assert: |
        - Баннер не схлопывается
        - Картинка и дисклеймер подстраиваются под ориентацию девайса
    - do: Дождаться автоматической смены темы
    - assert: Поле с текстом под баннером переключается на нужную тему
    - do: Попробовать раскрыть баннер свайпом
    - assert: Баннер не высвайпывается
    - do: |
        - Сменить ориентацию устройства
        - Попробовать раскрыть баннер свайпом
    - assert: |
        - Баннер не высвайпывается
        - UI баннера не ломается, подстраивается под ориентацию устройства, не перекрывывает ЕТА

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
