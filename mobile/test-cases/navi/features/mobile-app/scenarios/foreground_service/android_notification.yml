components: android_notification
testing:
  - regress
platforms:
  - android
tags:
  - assessors

specs:
  Английская локализация нотификаций фонового ведения в шторке:
    - info: |
        - В системных настройках телефона используется английский язык
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
        - Меню - Настройки - Карта и интерфейс - Язык приложения - Английский
    - do: |
        - Построить маршрут
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Приложение перешло в режим фонового ведения
    - do: Развернуть системную шторку свайпом вниз
    - assert: В нотификациях отображается текст на английском языке


  Турецкая локализация нотификаций фонового ведения в шторке:
    - info: |
        - В системных настройках телефона используется турецкий язык
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
        - Меню - Настройки - Карта и интерфейс - Язык приложения - Турецкий
        - В системных настройках телефона используется турецкий язык
    - do: |
        - Построить маршрут
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Приложение перешло в режим фонового ведения
    - do: Развернуть системную шторку свайпом вниз
    - assert: В нотификациях отображается текст на турецком языке


  Русская локализация нотификаций фонового ведения в шторке:
    - info: |
        - В системных настройках телефона используется русский язык
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
        - Меню - Настройки - Карта и интерфейс - Язык приложения - Русский
    - do: |
        - Построить маршрут
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Приложение перешло в режим фонового ведения
    - do: Развернуть системную шторку свайпом вниз
    - assert: В нотификациях отображается текст на русском языке


  Удаление нотификации фонового ведения при выгрузке приложения:
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут и запустить симуляцию ведения по нему
        - Свернуть приложение по кнопке “Домой”
        - Проверить нотификацию в шторке и поверх приложений
    - assert: |
        - При сворачивании отображается нотификация 
    - do: Удалить приложение из меню мультизадачности
    - assert: Нотификации от приложения пропадают

    - tags:
      - not_suitable_for_farm


  Удаление нотификации фонового ведения при удалении приложения:
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут и запустить симуляцию ведения по нему
        - Свернуть приложение по кнопке “Домой”
        - Проверить нотификацию поверх приложений и в шторке
    - assert: При сворачивании отображаются нотификации
    - do: Удалить приложение при активном фоновом ведении
    - assert: Нотификации и аннотации пропадают

    - tags:
        - not_suitable_for_farm


  Нотификации. Без уведомлений:
    - do: |
        - Меню - Настройки - Звуковое сопровождение - Все звуки включены
        - Меню - Настройки - Дорожные события - Включено отображение и звуковое предупреждение для ДС
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут c несколькими ДС и различными маневрами
        - Запустить симуляцию ведения
        - Свернуть приложение
    - assert: Появляется нотификация с ближайшим маневром и ДС
    - do: |
        - Развернуть уведомление свайпом вниз (может понадобиться доп свайп для полного раскрытия нотфикации)
        - Тап "Без уведомлений"
    - assert: Кнопка меняется на "С уведомлениями"
    - do: Свернуть шторку и продолжать двигаться по маршруту
    - assert: |
        - Всплывающие нотификации не отображаются
        - Отображаются уведомления в шторке
        - Маневры не озвучиваются
    - do: |
        - Развернуть шторку
        - Развернуть уведомление свайпом вниз
        - Тап "С уведомлениями"
    - assert: Кнопка меняется на "Без уведомлений"
    - do: Свернуть шторку и продолжать двигаться по маршруту
    - assert: |
        - Нотификации отображаются
        - Маневры озвучиваются

    - tags:
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Нотификации. Кнопка "Завершить маршрут":
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут c несколькими ДС и различными маневрами
        - Запустить симуляцию ведения
        - Свернуть приложение
    - assert: Появляется нотификация с ближайшим маневром и ДС
    - do: |
        - Развернуть уведомление свайпом вниз (может понадобиться доп свайп для полного раскрытия нотфикации)
        - Тап "Завершить маршрут"
    - assert: Нотификация скрывается из шторки
    - do: Открыть приложение
    - assert: Маршрут сброшен

    - tags:
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Нотификации на заблокированном экране:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
        - Меню - Настройки - Уведомления - Ситуация на маршруте - On
    - do: |
        - Построить маршрут c несколькими ДС и различными маневрами
        - Запустить симуляцию ведения через дебаг-панель
        - Свернуть приложение
        - Заблокировать смартфон
    - assert: |
        - На лок-скрине отображаются данные о ближайшем маневре и название улицы, по которой производится движение
        - Расстояние обновляется корректно
        - Маневры озвучиваются
        - Содержимое оповещения может быть другим: операционная система сама определяет, что показывать
    - do: Тап по нотификации из лок-скрина
    - assert: Открывается приложение

    - tags:
        - not_suitable_for_farm
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Фоновое ведение. Включение аннотаций в плашке нотификаций:
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
        - Настройки -> Звуковое сопровождение - Выключены все звуки
        - Настройки -> Дорожные события - Включено отображение и звуковое предупреждение для ДС
    - do: |
        - Построить маршрут с наличием поворотов и ДС на нём
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Оповещения о поворотах, изменениях маршрута и предупреждения о ДС не озвучиваются
    - do: |
        - Развернуть системную шторку
        - В шторке дождаться уведомления о камере или маневре, развернуть свайпом вниз уведомление
        - Тап «С уведомлениями»
    - assert: Кнопка сменила название на "Без уведомлений", иконка перечеркнута
    - do: Свернуть шторку, продолжать двигаться по маршруту
    - assert: Оповещения о поворотах, изменениях маршрута и предупреждения о ДС озвучиваются
    - do: Открыть приложение
    - assert: Настройки - Звуковое сопровождение - Все звуки Навигатора включены

    - tags:
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Фоновое ведение.Включение важных аннотаций в плашке нотификаций:
    - do: |
        - Настройки -> Звуковое сопровождение - Выключены все звуки Навигатора
        - Настройки -> Дорожные события - Включено отображение и звуковое предупреждение для ДС
    - do: |
        - Построить маршрут с наличием поворотов и ДС на нём
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Оповещения об изменениях маршрута и предупреждения о ДС не озвучиваются
    - do: |
        - Свайпом вниз раскрыть системную шторку уведомлений
        - Дождаться отображения камеры или поворота
        - Раскрыть нотификацию в максимальное состояние
        - Тап «С уведомлениями»
    - assert: |
        - Кнопка сменила название на "Без уведомлений", иконка перечеркнута
        - Озвучиваются оповещения об изменениях маршрута и предупреждения о ДС
    - do: Вернуться в приложение
    - assert: В настройках "Звуковое сопровождение” установлено в значении “Включены оповещения о камерах, дорожных событиях и изменениях маршрута”

    - tags:
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Фоновое ведение.Выключение важных аннотаций в плашке нотификаций:
    - do: |
        - Настройки -> Звуковое сопровождение - Включены оповещения о камерах, дорожных событиях и изменениях маршрута
        - Настройки -> Дорожные события - Включено отображение и звуковое предупреждение для ДС
    - do: |
        - Построить маршрут с наличием поворотов и ДС на нём
        - Запустить симуляцию движения
        - Свернуть приложение
    - assert: Озвучиваются только оповещения об изменениях маршрута и предупреждения о ДС
    - do: |
        - В шторке уведомлений дождаться отображения камеры или поворота
        - Раскрыть нотификацию в максимальное состояние
        - Тап «Без уведомлений»
    - assert: |
        - Все звуки приложения выключены
        - Всплывающие нотификации не появляются
        - Оповещения об изменениях маршрута и предупреждения о ДС не озвучиваются
        - Кнопка сменила название на "С уведомлениями", иконка не перечеркнута

    - tags:
        - not_suitable_for_farm
    - testing:
        - acceptance_navi


  Фоновое ведение. Уведомление в шторке. Маневр:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут с маневрами
        - Подтвердить маршрут
        - Запустить симуляцию ведения через дебаг-панель
        - Свернуть приложение
    - assert: Приложение в фоне
    - do: Раскрыть системную шторку свайпом вниз
    - assert: |
        В шторке отображается нотификация в свернутом состоянии
        В нотификации присутствуют:
          - изображение ближайшего маневра
          - расстояние до ближайшего маневра
          - название улицы, на которой будет произведен маневр
          - оставшееся расстояние движения по маршруту
          - среднее время до окончания маршрута
    - do: Свайпом вниз развернуть карточку
    - assert: |
        Нотификация раскрылась до конца
        В нотификации стали доступны:         
        - кнопка выключения звука (без уведомлений)
        - кнопка завершения маршрута

    - testing:
        - acceptance_navi


  Фоновое ведение. Уведомление в шторке. Камера контроля скорости:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут через камеру контроля скорости
        - Подтвердить маршрут
        - Запустить симуляцию ведения через дебаг-панель
        - Установить скорость 100 км/ч
        - Свернуть приложение
    - assert: Приложение в фоне
    - do: Раскрыть системную шторку свайпом вниз
    - assert: |
        В шторке отображается нотификация в свернутом состоянии
        В плашке присутствует:
        - изображение камеры, расстояние до нее
        - изображение камеры контроля скорости и расстояние до нее
        - среднее время до окончания маршрута
        При приближении к камере звучит голосовое предупреждение о приближении к камере контроля скорости и номинале разрешенной скорости
    - do: Свайпом вниз развернуть карточку
    - assert: |
        Нотификация раскрылась до конца
        В нотификации стали доступны:         
        - кнопка выключения звука (без уведомлений)
        - кнопка завершения маршрута
        При приближении к камере звучит голосовое предупреждение о приближении к камере контроля скорости и номинале разрешенной скорости
    - do: Продолжать двигаться по маршруту, обратить внимание на расстояние до камеры
    - assert: По мере приближения к камере расстояние динамически уменьшается

    - testing:
        - acceptance_navi


  Отсутствие нотификаций на заблокированном экране:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Выкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Выкл
    - do: |
        - Построить маршрут c несколькими ДС и различными маневрами
        - Запустить симуляцию ведения через дебаг-панель
        - Свернуть приложение
        - Заблокировать смартфон
    - assert: |
        Отсутствуют оповещения о предстоящих маневрах, камерах контроля скорости на выключенном экране
        Отсутствуют голосовые аннотации


  Отсутствие нотификаций на при выгрузке приложения из меню многозадачности:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Выкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Выкл
    - do: |
        - Построить маршрут c несколькими ДС и различными маневрами
        - Запустить симуляцию ведения через дебаг-панель
        - Свернуть приложение
    - assert: Приложение продолжает работать в фоне, отображаются нотификации, звучат аннотации
    - do: |
        Свайпом удалить приложение из меню мультизадачности
        Подождать ~30 секунд
    - assert: Нотификации по маршруту и аннотации отсутствуют


  Сохранение настроек уведомлений при обновлении приложения:
    - do: Установить предыдущую версию Навигатора
    - do: Запустить приложение несколько раз
    - do: |
        Проверить что приложению даны все разрешения: 
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Обновиться до текущей (тестируемой) версии Навигатора и запустить приложение
    - do: |
        Проверить что приложению даны все разрешения: 
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - assert: Все разрешения выданы
    - do: Вернуться в приложение
    - do: |
        Построить автомаршрут с маневрами и камерами
        Подтвердить маршрут
        Запустить симуляцию движения через debug-панель
        Свернуть приложение
    - assert: |
        Звучат аннотации по маршруту
        Отображаются heads-up нотификации
    - do: Развернуть системную шторку
    - assert: В шторке отображается нотификация по маршруту