components: foreground_guidance
testing:
  - regress

specs:
  Фоновое ведение. Не отключение GPS при cворачивании навигатора:
    - info: 
        Установлена не debug версия
        Приложение не запущено
        В настройках (шторке) устройства включено GPS
        В фоне не запущены приложения, которые используют GPS
        В статус-баре отсутствует иконка геолокации
    - do: Запустить приложение
    - assert: Присутствует значок геолокации в статус баре устройства (геолокация используется)
    - do: |
        - Построить маршрут
        - Тап Поехали
        - Свернуть приложение
    - assert: |
        - Службы локации не отключаются
        - iOS: Вверху экрана видна синяя плашка «Навигатор использует ваше местоположение\вашу геопозицию»
        - Android: Из Status Barа не исчезает значок GPS
    - do: |
        - Развернуть навигатор
        - Сбросить маршрут
    - assert: Присутствует значок геолокации в статус баре устройства (геолокация используется)
    - do: Свернуть приложение и подождать 2 минуты
    - assert: |
        Службы локации отключаются и больше не появляется
        - iOS: Вверху экрана не отображается синяя плашка «Навигатор использует ваше местоположение\вашу геопозицию»
        - Android: Из Status Barа исчезает значок GPS

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - not_suitable_for_farm
      - mapkit_ready
    - integration_run:
      - mapkit


  Фоновое ведение. Ведение по маршруту через дебаг панель:
    - do: |
       Меню - Настройки - Developer settings - Misc - Debug panel enabel - on
       Перезагрузить приложение
    - do: |
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут
        - Включить ведение через дебаг панель
        - Свернуть приложение
    - assert: Аннотации по маршруту озвучиваются
    - do: |
        - Развернуть приложение
        - Отключить ведение в дебаг панели
        - Построить маршрут
        - Свернуть приложение
    - assert: Аннотации по маршруту отсутствуют

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - not_suitable_for_farm
      - mapkit_ready
    - integration_run:
      - annotation
      - mapkit


  Фоновое ведение. Выход из приложения.ГУ:
    - description: |
        На ГУ должно быть включено фоновое ведение, но скрыта настройка в меню.
    - do: |
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут, имеющий несколько поворотов и ДС на нём
        - Тап Поехали
        - Запустить симуляцию ведения по маршруту через дебаг-панель
        - Свернуть приложение
        - (для ГУ) Перейти в любое меню в интерфейсе ГУ (для ГУ)
    - assert: Аннотации о маневрах и дорожных событиях озвучиваются
    - do: |
        Шаг для Android:
        - Развернуть приложение 
        - Тап по системной кнопке Back
    - assert: |
        - Приложение закрывается
        - Фоновое ведение не активируется 
        - Аннотации не озвучиваются. Оповещения о маневрах на маршруте не отображаются в шторке девайса

    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
    - platforms:
      - geely
      - vaz
      - nissan
      - t3am
      - motrex
      - autochip
      - first_run_hu
    - tags:
      - assessors
      - not_suitable_for_farm
      - mapkit_ready


  Фоновое ведение. Выход из приложения по кнопке back:
    - do: |
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        - Построить маршрут, имеющий несколько поворотов и ДС на нём
        - Тап Поехали
        - Запустить симуляцию ведения по маршруту через дебаг-панель
        - Свернуть приложение
    - assert: Аннотации о маневрах и дорожных событиях озвучиваются
    - do: |
        - Развернуть приложение 
        - Тап по системной кнопке Back
    - assert: |
        - Приложение закрывается
        - Фоновое ведение не активируется 
        - Аннотации не озвучиваются. Оповещения о маневрах на маршруте не отображаются в шторке девайса

    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
    - platforms:
      - android
    - tags:
      - assessors
      - not_suitable_for_farm
      - mapkit_ready


  Фоновое ведение по маршруту. Уход с маршрута.:
    - do: |
        Меню - Настройки - Голос - Выбрать любой из списка - Выбрать Голос диктора, отличного от стандартного (Оксаны)
        Меню - Настройки - Сохраненные данные - Стереть карты
    - do: |
        Построить маршрут имеющий несколько маневров.
        Тап Поехали
        Запустить симуляцию движения через дебаг-панель
    - assert: |
        - Производится симуляция движения по маршруту
        - Аннотации о маневрах и дорожных событиях произносятся
    - do: |
        - Не сбрасывая симуляцию ведения по маршруту построить маршрут в другую точку и подтвердить его (тап на "поехали")
        - Отключить сеть на девайсе (включить режим “в самолёте”)
        - Свернуть приложение
    - assert: |
        - В момент расхождения симулируемого маршрута и построенного маршрута звучат аннотация о сходе с маршрута
        - Новый маршрут не строится
    - do: Включить сеть на девайсе (отключить режим "в самолёте").
    - assert: Звучит аннотация “маршрут перестроен” и маршрут перестраивается

    - platforms:
       - android
       - ios
    - integration_run:
       - mapkit
    - tags:
       - not_suitable_for_farm
       - assessors
       - mapkit_ready


  Фоновое ведение во freedrive:
    - do: |
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
        Построить маршрут
        Тап Поехали
        Запустить ведение по маршруту с помощью дебаг-панели
    - assert: Курсор движется по маршруту
    - do: Не сбрасывая симуляцию движения сбросить маршрут
    - assert: Курсор продолжает двигаться
    - do: Свернуть приложение
    - assert: |
         - Приложение продолжает работать в фоне
         - Звучат аннотации по предполагаемому маршруту

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Фоновое ведение во freedrive. Показ нотификации:
    - do: |
        Построить маршрут
        Тап Поехали
        Запустить ведение по маршруту с помощью дебаг-панели
    - assert: Курсор движется по маршруту
    - do: |
        Не сбрасывая симуляцию движения сбросить маршрут
        Построить более короткий маршрут так, чтобы он проходил через существующий
        Подтвердить маршрут
    - assert: Курсор движется по маршруту
    - do: |
        Дождаться когда курсор доедет до финиша
        Дождаться отображение нотификации "Яндекс.Навигатор запущен"
        Свернуть приложение
    - assert: |
        Приложение продолжает работать в фоне
        Звучат аннотации о ДС по предполагаемому маршруту
    - do: Развернуть приложение
    - assert: Приложение продолжает работать стабильно

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Завершение фонового ведения после выгрузки приложения:
    - do: |
        Построить маршрут
        Тап Поехали
        Запустить ведение по маршруту с помощью дебаг-панели
    - assert: Курсор движется по маршруту
    - do: Свернуть приложение
    - do: Выгрузить приложение из памяти
    - assert: Уведомлений о маршруте нет

    - platforms:
        - android
    - tags:
        - assessors
    - tesing:
        - acceptance_navi


  Фоновое ведение офлайн:
    - do: |
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
       - Скачать кэш текущего региона
       - Отключить интернет
    - do: |
       - Построить маршрут
       - Тап Поехали
       - Запустить симуляцию ведения по маршруту через дебаг-панель
    - assert: Курсор движется по маршруту
    - do: Свернуть приложение
    - assert: |
       - Продолжается ведение по маршруту в фоне
       - Звучат аннотации по маршруту

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - tesing:
        - acceptance_navi


  Фоновое ведение с настройкой DKA:
    - do: |
       - В настройках девайса включена настройки Dont keep activity
       - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Вкл
       - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Вкл
    - do: |
       - Построить маршрут
       - Тап Поехали
       - Запустить симуляцию движения через дебаг-панель
       - Свернуть приложение
    - assert: |
       - Службы локации не отключаются
       - Ведение по маршруту в фоне продолжается
       - Звучат аннотации по маршруту и отображаются нотификации
    - do: Развернуть приложение
    - assert: Приложение продолжает стабильно работать, курсор движется по маршруту

    - platforms:
        - android
    - tags:
        - assessors
    - tesing:
        - acceptance_navi


  Отключение фонового ведения:
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Построить маршрут
        Тап Поехали
        Запустить симуляцию движения через дебаг-панель
    - do: Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
    - do: Оставить девайс без движения на 60 минут
    - assert: Фоновое ведение прекращается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Запрет фонового ведения:
    - do: |
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Подсказки в фоновом режиме -> on
        - Системные настройки телефона -> Приложения -> Навигатор -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        - Меню - Настройки - Навигация - Работа в фоне - С маршрутом - Выкл
        - Меню - Настройки - Навигация - Работа в фоне - Без маршрута - Выкл
    - do: |
        Построить автомаршрут с маневрами и подтвердить его 
        Свернуть приложение
    - assert: Приложение в фоне
    - do: Раскрыть шторку свайпом вниз
    - assert: |
        В шторке отсутствуют оповещения от приложения о предстоящих маневрах, о камерах контроля скорости
        Отсутствуют голосовые аннотации
    - do: Свернуть шторку свайпом вверх
    - assert: |
        Heads-up оповещения о предстоящих маневрах, камерах контроля скорости не появляются
        Отсутствуют голосовые аннотации

    - platforms:
        - android
    - tags:
        - assessors
    - tesing:
        - acceptance_navi