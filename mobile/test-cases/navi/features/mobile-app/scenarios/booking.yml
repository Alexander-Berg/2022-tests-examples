components: booking
testing:
  - regress

specs-integration:
  aliases:
    - &Инфо_booking
      - info: |
          - Использовать интент:
            [collapsed-image](https://jing.yandex-team.ru/files/lsherst/navi_booking){title=QR-код}

            `yandexnavi://add_exp?navi_feature_bookings_personal=enabled`
          - Перезапустить приложение

    - &plus_in_bookings
      - do: |
          - Использовать интент:
            [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/r.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_plus_in_bookings_navi=enabled&navi_feature_bookings_personal=enabled`
      - do: Перезапустить приложение

specs:
  Запись на услугу через CTA-кнопку Бронирований в карточке организации с авторизацией:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        Открыта карточка Кофейни Кирилла (52.559750, 55.577015)
        
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=QR-код}
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - assert: Открывается вебвью с выбором услуг
    - do: Пройти все этапы записи до экрана "Проверьте запись"
    - assert: |
        Открылся экран "Проверьте запись"
        Следующие пункты соответствуют выбранным:
        - Специалист
        - Дата и время записи
        - Фамилия и имя/псевдоним (из профиля)
        - Номер телефона (из профиля)
    - do: Тап на "Подтвердить запись"
    - assert: |
        Отображается экран "Вы записаны"
        На электронную почту пришло сообщение с информацией о записи
    - do: Закрыть экран тапом на "Отлично" или крестик
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  Запись на услугу через CTA-кнопку Бронирований в карточке организации с дальнейшей авторизацией в процессе записи на услугу:
    - *Инфо_booking
    - info: |
        Пользователь неавторизован
        Открыта карточка Кофейни Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - assert: Открывается вебвью с выбором услуг
    - do: Пройти все этапы записи до экрана "Проверьте запись"
    - assert: |
        Открылся экран "Проверьте запись"
        На экране есть блок авторизации с кнопками "Войти и продолжить" и "Продолжить без авторизации"
    - do: Тап на "Войти и продолжить"
    - assert: Открывается экран авторизации
    - do: Авторизоваться
    - assert: |
        Открывается экран "Проверьте запись"
        Специалист, дата, время и услуги остались теми же, что были до авторизации
        Появился блок с именем и фамилией/псевдонимом и номером телефона из профиля
        Блок авторизации не отображается
    - do: Тап на кнопку "Подтвердить запись"
    - assert: |
        Отображается экран "Вы записаны"
        На электронную почту пришло сообщение с информацией о записи
    - do: Закрыть экран тапом на "Отлично" или крестик
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  Сниппет Бронирований в карточке организации при активной записи:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        У пользователя имеется активная запись на услугу
        Запись сделана через Кофейню Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Открыть мини-карточку Кофейни Кирилла
    - assert: Над action-баром отображается сниппет Бронирования с датой и временем записи (при наличии нескольких записей бронирования, отображается ближайшая к текущей дате запись бронирования)
    - do: Раскрыть полную карточку организации
    - assert: Над CTA-кнопкой "Записаться онлайн" отображается сниппет Бронирования
    - do: Тап на сниппет Бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью
    - assert: Над CTA-кнопкой "Записаться онлайн" отображается сниппет Бронирования

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отображение виджета Бронирования в карточке организации при активной записи:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        У пользователя имеется активная запись на услугу
        Запись сделана через Кофейню Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Открыть полную карточку Кофейни Кирилла
    - do: Проскроллить карточку до виджета бронирования
    - assert: Отображается виджет Бронироваиня с кнопками "Перенести запись" и "Отменить запись"
    - do: Тап на виджет Бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью свайпом вниз или тапом на крестик
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отображение виджета Бронирования в карточке организации при прошедшей записи:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        У пользователя имеется прошедшая запись на услугу (достаточно перевести время вперёд на девайсе, чтобы запись стала прошедшей)
        Запись была сделана через Кофейню Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Открыть мини-карточку Кофейни Кирилла
    - assert: Над экшен-баром НЕ отображается сниппет Бронирования
    - do: Раскрыть полную карточку организации (свайпом вверх или тапом)
    - do: Проскроллить карточку до виджета Бронирования
    - assert: Отображается виджет Бронирования с кнопками "Записаться снова" и "Оценить место"
    - do: Тап на виджет бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью свайпом вниз или тапом на крестик
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Взаимодействие с кнопками "Перенести запись" и "Отменить запись" в виджете Бронирования при активной записи:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        У пользователя имеется активная запись на услугу
        Запись сделана через Кофейню Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Открыть полную карточку Кофейни Кирилла
    - do: Проскроллить карточку до виджета бронирования
    - assert: Отображается виджет Бронироваиня с кнопками "Перенести запись" и "Отменить запись"
    - do: Тап на "Перенести запись"
    - assert: Отображается вебвью с выбором даты и времени
    - do: Закрыть вебвью
    - do: Тап на "Отменить запись"
    - assert: |
        Отображается вебвью записи
        Поверх вебвью появляется поп-ап с подтверждением отмены записи
        Присутствуют кнопки "Отменить запись" и "Не отменять"
    - do: Тап на "Не отменять"
    - assert: |
        Отображается вебвью записи
        Запись не отменена
    - do: Закрыть вебвью
    - do: Тап на "Отменить запись"
    - do: Тап на "Отменить запись" в поп-апе
    - assert: |
        Отображается вебвью записи
        Запись отменена

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Взаимодействие с кнопками "Записаться снова" и "Оценить место" в виджете Бронирования при прошедшей записи:
    - *Инфо_booking
    - info: |
        Пользователь авторизован
        У пользователя имеется прошедшая запись на услугу (достаточно перевести время вперёд на девайсе, чтобы запись стала прошедшей)
        Запись была сделана через Кофейню Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Открыть полную карточку Кофейни Кирилла
    - do: Проскроллить карточку до виджета Бронирования
    - assert: Отображается виджет Бронирования с кнопками "Записаться снова" и "Оценить место"
    - do: Тап на "Записаться снова"
    - assert: Отображается вебвью с выбором даты и времени
    - do: Закрыть вебвью
    - do: Тап на "Оценить место"
    - assert: Отображается экран написания отзыва
    - do: Написать отзыв
    - do: Выставить рейтинг тапом на любую из звезд
    - do: Тап на кнопку отправки отзыва
    - assert: Отображается поп-ап с благодарностью
    - do: Закрыть поп-ап тапом на кнопку "Закрыть" или свайпом вниз
    - assert: |
        Отображается карточка организации
        Присутствует виджет бронирования с кнопкой "Записаться снова"
        Кнопка "Оценить место" не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Открытие экрана бронирования через action-кнопку "Позвонить":
    - *Инфо_booking
    - info: |
        Открыта карточка организации с поддержкой бронирования (можно найти в поиске по категории "Красота")
        У организации несколько номеров телефона
    - do: Тап на action-кнопку звонка в организацию
    - assert: Открывается поп-ап с кнопкой "Записаться онлайн" с несколькими номерами телефона
    - do: Тап на "Записаться онлайн"
    - assert: Открывается вебвью с выбором услуг
    - do: Закрыть вебвью
    - do: Тап на action-кнопку звонка в организацию
    - assert: Открывается поп-ап с кнопкой "Записаться онлайн" несколькими номерами телефона
    - do: Тап на любой номер телефона
    - assert: |
        Отображается поп-ап с номером телефона, присутствует кнопка вызова и отмены
    - do: Закрыть поп-ап
    - assert: Открыта карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Звонок в организацию без поддержки Бронирования с несколькими номерами телефона:
    - *Инфо_booking
    - info: |
        Открыта полная карточка организации с несколькими номерами телефона
        Организация не поддерживает бронирование
    - do: Тап на экшен-кнопку звонка в организацию
    - assert: |
        Открыт экран "Выберите номер"
        Присутствует список с несколькими номерами телефонов
        Кнопка записи онлайн не отображается в списке
    - do: Тап на любой номер телефона
    - assert: |
        Появляется системный поп-ап с выбранным номером телефона
    - do: Тап на номер телефона в системном поп-апе
    - assert: Происходит набор номера
    - do: Вернуться в приложение
    - assert: Открыта полная карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Запись на услугу через CTA-кнопку Бронирований в карточке организации без авторизации в процессе записи на услугу:
    - *Инфо_booking
    - info: |
        Пользователь неавторизован
        Открыта карточка Кофейни Кирилла (52.559750, 55.577015) [Отсканировать QR](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - assert: |
        Открывается вебвью с выбором услуг
    - do: Пройти все этапы записи до экрана "Проверьте запись"
    - assert: |
        Открылся экран "Проверьте запись"
        На экране есть блок авторизации с активными кнопками "Войти и продолжить" и "Продолжить без авторизации"
    - do: Тап на "Продолжить без авторизации"
    - assert: |
        Открывается экран "Проверьте запись"
        Кнопка "Войти и продолжить активна"
        Кнопка "Продолжить без авторизации" неактивна
        Специалист, дата, время и услуги остались теми же, что и были указаны пользователем
        Появились пустые поля ввода имени и номера телефона, обязательные к заполнению
        Появилось пустое поле ввода Комментария, необязательное к заполнению
        Отображается неактивная кнопка "Укажите имя и телефон"
    - do: Ввести в поле ввода имени и номера телефона валидные значения
    - assert: |
        Отображаются введенные значения
        Кнопка "Укажите имя и телефон" стала активной
    - do: Тап на кнопку "Укажите имя и телефон"
    - assert: |
        Отображается вебвью с требованием ввести код с отправленного на указанный номер сообщения
        На указанный номер телефона отправлено sms сообщение с кодом для активации
    - do: Ввести присланный код
    - assert: |
        Отображается экран Вы записаны
        Отображаются кнопки "Отлично" и "Еще одна запись"
    - do: Тап на "Отлично"
    - assert: |
        Отображается карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Отображение оффера Плюса в списке результатов поиска при первом бронировании (пользователь c подпиской Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя не было записей    
        У пользователя есть подписка Я.Плюс
    - *plus_in_bookings 
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Отображение оффера Плюса в кнопке "Записаться онлайн" при первом бронировании (пользователь c подпиской Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя не было записей    
        У пользователя есть подписка Я.Плюс
    - *plus_in_bookings 
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Тап на организацию с возможностью записи онлайн и оффером Плюса
    - assert: |
        Открыта карточка организации
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Свернуть карточку организации в среднее состояние
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  Отображение оффера Плюса в списке результатов поиска при первом бронировании (пользователь без подписки Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя не было записей    
        У пользователя нет подписки Я.Плюс
    - *plus_in_bookings 
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"

    - tags:
        - assessors
    - platforms:
        - ios
        - android    
    - testing:
        - acceptance_navi

        
  Отображение оффера Плюса в кнопке "Записаться онлайн" при первом бронировании (пользователь без подписки Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя не было записей    
        У пользователя нет подписки Я.Плюс
    - *plus_in_bookings 
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Тап на организацию с возможностью записи онлайн и оффером Плюса
    - assert: |
        Открыта карточка организации
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Свернуть карточку организации в среднее состояние
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Отсутствие оффера Плюса в списке результатов поиска (изменения в серверной части):
    - info: |
        Переустановить приложение или почистить данные
        Пользователь авторизован
        У пользователя не было записей    
        У пользователя нет подписки Я.Плюс
        Устройство подключено к снифферу для перехвата трафика
    - *plus_in_bookings 
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
        В ответе ручки `https://geointernal.mob.maps.yandex.net/v1/booking/notifications` есть параметры notifications, totalCount, plusOffer со значением value с баллами Плюса
    - do: С помощью инструмента Map Local, подменить ответ ручки https://geointernal.mob.maps.yandex.net/v1/booking/notifications на https://jing.yandex-team.ru/files/vmnpopkova/json.json c готовым измененным ответом
    - do: Перезагрузить приложение с выгрузкой из памяти
    - do: Тап на Поиск в табе
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу Барбершоп 
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи не отображается оффер "N баллов на Плюс"
        В ответе ручки `https://geointernal.mob.maps.yandex.net/v1/booking/notifications` есть параметры notifications, totalCount, plusOffer со значением value=0

    - tags:
        - assessors
    - platforms:
        - ios
        - android       
