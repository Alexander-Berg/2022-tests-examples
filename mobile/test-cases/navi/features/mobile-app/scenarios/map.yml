components: map
testing:
  - regress

specs:
  Настройка "Вид карты":
    - info: В навигаторе установлен вид карты "Схема"
    - do: |
        - Перейти в Меню - Настройки 
        - Тап на настройку «Вид карты» 
    - assert: |
        Происходит переход к списку видов карт
        Отображается два пункта с иконками :
        - Схема
        - Спутник
        В строке "Схема" отображается активный чекбокс, т.к. данный вид карты выбран по умолчанию
    - do: |
        - Выбрать вид карты "Спутник"
        - Перейти на экран "Карта"
    - assert: Настройка применилась успешно. Спутниковые тайлы отображаются на всех зумах.
    - do: |
        - Перейти в Меню - Настройки 
        - Тап на настройку «Вид карты»
        - Выбрать вид карты "Схема"
        - Вернуться на экран Карта
    - assert: |
        - Карта отображается в виде схемы

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Скролл карты:
    - do: Перемещаем карту, проводя по экрану пальцем
    - assert: Приложение стабильно работает. Карта нормально перемещается движением пальца. Постепенно подгружаются элементы карты.
    - do: Тап значок лупы (Поиск) внизу, тап на любую категорию для поиска
    - assert: Карта передвигается автоматически к месту отображения результата поиска
    - do: |
        Сдвинуть карту таким образом, чтобы курсор оказался за границей экрана
        Тап на кнопку определения местоположения
    - assert: Производится сдвиг карты к текущему местоположению курсора
    - do: Отскролить карту отбрасыванием
    - assert: Карта продолжает движение по инерции после окончания жеста

    - platforms:
      - motrex
      - geely
      - renault
      - carsharing_t3
      - ios
      - android
      - vaz
      - t3am
      - nissan
      - autochip
      - first_run_hu
    - tags:
      - assessors
      - both_myspin
      - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
      - myspin


  Зум карты:
    - do: Изменять масштаб карты кнопками "+" и "-" справа на экране от самого близкого, до самого удаленного
    - assert: Масштабирование работает корректно. Если приближаться или отдаляться больше некуда, кнопка "+" или "-" становятся серее и не нажимается.
    - do: Изменять масштаб карты быстрым двойным нажатием на экран
    - assert: Карта приближается, если приближаться больше некуда, то кнопка "+" становится серее и не нажимается
    - do: Изменять масштаб карты быстрым двойным нажатием на экран двумя пальцами
    - assert: Карта отдаляется, если отдаляться больше некуда, то кнопка "-" становится серее и не нажимается
    - do: Изменять масштаб карты щипковым движением по карте двумя пальцами от самого близкого до самого удаленного
    - assert: Масштабирование работает корректно. Если приближаться или отдаляться больше некуда, кнопка "+" или "-" становятся серее и не нажимается.
    - do: |
       Двойной тап в угол экрана
       Не отрывая палец от экрана сделать несколько свайпов в противоположный угол экрана и обратно
    - assert: Карта отдаляется и приближается

    - platforms:
      - motrex
      - geely
      - renault
      - carsharing_t3
      - ios
      - android
      - vaz
      - t3am
      - nissan
      - autochip
      - first_run_hu
    - tags:
      - assessors
      - both_myspin
      - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
      - myspin

  Вращение карты:
    - do: Поворачивать карту двумя пальцами движением по кругу
    - assert: Карта плавно поворачивается
    - do: Тап на значок компаса внизу справа
    - assert: Карт возвращается в состояние "Север вверху"

    - platforms:
      - motrex
      - geely
      - renault
      - vaz
      - carsharing_t3
      - ios
      - android
      - t3am
      - nissan
      - autochip
      - first_run_hu
    - tags:
      - assessors
      - both_myspin
      - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
      - myspin


  Не action-интент для показа карты:
    - info: |
        Если на устройстве есть сторовский Навигатор, то удалить его.
        Открыть интент на устройстве с помощью adb **(сначала зайдите в режим редактирования этого кейса и оттуда скопируйте строку интента!!!)**:
        Отрыть карту в точке без балуна
        adb shell  am start -a ru.yandex.yandexnavi.action.SHOW_POINT_ON_MAP -e lat 55.758192 -e lon 37.642817 -e zoom 14 -e no-balloon 1
        Отрыть балун в точке с текстом
        adb shell am start -a ru.yandex.yandexnavi.action.SHOW_POINT_ON_MAP -e lat 55.758192 -e lon 37.642817 -e zoom 14 -e desc TestTest
        Открыть интент (на Анроиде - используя html-файл):
        Отрыть карту в точке без балуна
        yandexnavi://show_point_on_map?lat=55.758192&lon=37.642817&zoom=14&no-balloon=1
        Отрыть балун в точке с текстом
        yandexnavi://show_point_on_map?lat=55.758192&lon=37.642817&zoom=14&desc=TestTest
    - do: |
        Прокинуть интент "Отрыть карту в точке без балуна", когда Навигатор установлен, но не запускался
        `adb shell am start -a ru.yandex.yandexnavi.action.SHOW_POINT_ON_MAP -e lat 55.758192 -e lon 37.642817 -e zoom 14 -e no-balloon 1`
    - assert: |
        - Открыт Навигатор
        - Карта отскроллена к точке с указанными координатами (в Москве) 
    - do: |
        1. Свернуть Навигатор 
        2. Прокинуть интент "Отрыть балун в точке с текстом", когда Навигатор свернут:
        `adb shell am start -a ru.yandex.yandexnavi.action.SHOW_POINT_ON_MAP -e lat 55.758192 -e lon 37.642817 -e zoom 14 -e desc TestTest`
    - assert: |
        - Открыт Навигатор
        - Карта отскроллена к точке с указанными координатами (в Москве), установлен пин
    - do: |
        1. Выгрузить Навигатор 
        2. Прокинуть интент “Отрыть балун в точке с текстом”, когда Навигатор выгружен:
        `adb shell am start -a ru.yandex.yandexnavi.action.SHOW_POINT_ON_MAP -e lat 55.758192 -e lon 37.642817 -e zoom 14 -e desc TestTest`
    - assert: |
        - Открыт Навигатор
        - Карта отскроллена к точке с указанными координатами (в Москве), установлен пин

    - platforms:
      - ios
      - android
    - tags:
      - assessors


  Масштабирование карты в обзоре и на маршруте:
    - info: |
        Меню - Настройки - Dev Setting - Misc - Debug info enable - On
        Перезагрузить приложение
        Включить/выключить отображение зумов на карте можно через тычку `Developer Settings -> Map -> Map debug info enabled`
    - do: |
        Построить произвольный маршрут
        Призумить карту до максимального значения 21
        Отзумить карту до минимального значения (в пределах 1.00 - 1.99 зума)
    - assert: Приложение работает стабильно. Креша не происходит
    - do: Тап Поехали
    - do: |
        Призумить карту до максимального значения 21
        Отзумить карту до минимального значения (в пределах 1.00 - 1.99 зума)
    - assert: Приложение работает стабильно. Креша не происходит

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Отображение режима 2D/3D:
    - info: Меню - Настройки - Карта и интерфейс - 3D-режим - Выкл
    - do: |
        Перейти Меню - Настройки - Карта и интерфейс
        Тап на "3D-режим"
    - assert: Настройка становится активной
    - do: Перейти на экран Карта
    - assert: Активировался режим 3D
    - do: Найти Исторический музей в Москве
    - assert: Видна объемная модель здания
    - do: Сменить ориентацию устройства
    - assert: |
        Устройство в горизонтальной ориентации
        Режим 3D всё также активен
        Модель здания все так же объемная
    - do: |
        Перейти Меню - Настройки - Карта и интерфейс
        Тап на "3D-режим"
    - assert: |
        3D-режим не активен
        Карта отображается в 2D-режиме
    - do: Найти Исторический музей в Москве
    - assert: Здание стало простой фигурой на карте без объема
    - do: Перезапустить приложение
    - assert: |
        Отображается главный экран приложения
        Карта отображается в 2D режиме

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Приоритет подписей POI над номерами домов: 
    - do: Осуществить поиск по адресу Никольская улица, 10
    - assert: Видно название организации и номер дома
    - do: Позумить карту чтобы найденный объект оставался видимым
    - assert: При столкновении подписи POI с номером дома, номер дома вытесняется

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Кастомизация подложки. Скачанные карты отсутствуют:
    - info: Цель кейса - проверить, что на третий запуск после включения эксперимента меняется стиль подложки
    - info: Это происходит по следующей логике - 1)первый перезапуск - ничего не происходит 2)второй перезапуск - обновляются загруженные карты (если есть) 3)третий перезапуск - меняется стиль подложки, если все загруженные карты были обновлены; если карты не обновились, то подложка меняется только после полного обновления загруженных карт
    - info: Пример подложки до и после эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/new_vmap3.png){title=QR-код}
    - do: Использовать интент для включения эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/vmap3_enabled.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_vmap3_enabled=enabled`
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Дождаться смены темы
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Повернуть экран
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Чтобы удалить эксперимент, использовать интент
        [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

        `yandexnavi://reset_exp`
    - do: Перезагрузить приложение 2 раза
    - assert: Подложка карты вернулась к первоначальной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity
    - testing:
        - acceptance_navi


  Кастомизация подложки. Есть скачанные карты:
    - info: Цель кейса - проверить, что на третий запуск после включения эксперимента меняется стиль подложки
    - info: Это происходит по следующей логике - 1)первый перезапуск - ничего не происходит 2)второй перезапуск - обновляются загруженные карты (если есть) 3)третий перезапуск - меняется стиль подложки, если все загруженные карты были обновлены; если карты не обновились, то подложка меняется только после полного обновления карт
    - info: Пример подложки до и после эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/new_vmap3.png){title=светлая тема}
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Скачать кэш любого города
    - assert: Загрузка успешно завершена
    - do: Использовать интент для включения эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/vmap3_enabled.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_vmap3_enabled=enabled`
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - assert: Скачанный кэш начал обновляться
    - do: Дождаться завершения обновления скачанного кэша
    - do: Вернуться на главный экран приложения
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Чтобы удалить эксперимент, использовать интент
        [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

        `yandexnavi://reset_exp`
    - do: Перезагрузить приложение 2 раза
    - assert: Подложка карты вернулась к первоначальной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity
    - testing:
        - acceptance_navi


  Кастомизация подложки. Построение маршрута оффлайн:
    - info: Цель кейса - проверить, что на третий запуск после включения эксперимента меняется стиль подложки
    - info: Это происходит по следующей логике - 1)первый перезапуск - ничего не происходит 2)второй перезапуск - обновляются загруженные карты (если есть) 3)третий перезапуск - меняется стиль подложки, если все загруженные карты были обновлены; если карты не обновились, то подложка меняется только после полного обновления карт
    - info: Пример подложки до и после эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/new_vmap3.png){title=светлая тема}
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Скачать кэш любого города
    - assert: Загрузка успешно завершена
    - do: Использовать интент для включения эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/vmap3_enabled.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_vmap3_enabled=enabled`
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - assert: Скачанный кэш начал обновляться
    - do: Дождаться завершения обновления скачанного кэша
    - do: Вернуться на главный экран приложения
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Включить авиарежим
    - do: Построить маршрут в городе, где был скачан кэш
    - assert: Маршрут построен, карта загрузилась корректно
    - do: Чтобы удалить эксперимент, использовать интент
        [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

        `yandexnavi://reset_exp`
    - do: Перезагрузить приложение 2 раза
    - assert: Подложка карты вернулась к первоначальной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity


  Кастомизация подложки. Скачанные карты не обновляются по мобильному интернету:
    - info: Цель кейса - проверить, что на третий запуск после включения эксперимента меняется стиль подложки
    - info: Это происходит по следующей логике - 1)первый перезапуск - ничего не происходит 2)второй перезапуск - обновляются загруженные карты (если есть) 3)третий перезапуск - меняется стиль подложки, если все загруженные карты были обновлены; если карты не обновились, то подложка меняется только после полного обновления карт
    - info: Пример подложки до и после эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/new_vmap3.png){title=светлая тема}
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Скачать кэш любого города
    - assert: Загрузка успешно завершена
    - do: Использовать интент для включения эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/vmap3_enabled.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_vmap3_enabled=enabled`
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Отключить WIFI и включить мобильный интернет
    - do: Перезагрузить приложение
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - assert: Скачанный кэш начал обновляться и остановился на 0%
    - do: Вернуться на главный экран приложения
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Включить WIFI
    - assert: Скачанный кэш продолжил обновление
    - do: Дождаться завершения обновления скачанного кэша
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Чтобы удалить эксперимент, использовать интент
        [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

        `yandexnavi://reset_exp`
    - do: Перезагрузить приложение 2 раза
    - assert: Подложка карты вернулась к первоначальной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity
    - testing:
        - acceptance_navi


  Кастомизация подложки. Обновления карт оффлайн:
    - info: Цель кейса - проверить, что на третий запуск после включения эксперимента меняется стиль подложки
    - info: Это происходит по следующей логике - 1)первый перезапуск - ничего не происходит 2)второй перезапуск - обновляются загруженные карты (если есть) 3)третий перезапуск - меняется стиль подложки, если все загруженные карты были обновлены; если карты не обновились, то подложка меняется только после полного обновления карт
    - info: Пример подложки до и после эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/new_vmap3.png){title=светлая тема}
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Скачать кэш любого города
    - assert: Загрузка успешно завершена
    - do: Использовать интент для включения эксперимента
        [ collapsed-image ](https://jing.yandex-team.ru/files/polikashinaol/vmap3_enabled.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_vmap3_enabled=enabled`
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Включить авиарежим
    - do: Перезагрузить приложение
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - assert: Скачанный кэш начал обновляться и остановился на 0%
    - do: Вернуться на главный экран приложения
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка не изменилась
    - do: Перейти в меню
    - do: Выбрать "Загрузка карт"
    - do: Включить интернет
    - assert: Скачанный кэш продолжил обновление
    - do: Дождаться завершения обновления скачанного кэша
    - do: Перезагрузить приложение
    - assert: Карта загрузилась корректно, подложка изменилась
    - do: Чтобы удалить эксперимент, использовать интент
        [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.b60e70b.png){title=QR-код}

        `yandexnavi://reset_exp`
    - do: Перезагрузить приложение 2 раза
    - assert: Подложка карты вернулась к первоначальной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - parity
