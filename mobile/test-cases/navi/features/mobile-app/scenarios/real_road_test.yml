components: real_road_test
testing:
  - real_road_test

specs:
  aliases:
    - &Инфо
      - info: | 
          - Пользователь авторизован подпиской я.плюс
          - Девайс подключен к ГУ
          - Открыто приложение в CP/AA
    - &Платформа
      - platforms:
          - carplay
          - android_auto 
       

  Верное определение скорости в реальном заезде:
    - description: Допустимы небольшие колебания скорости и незначительные отличия от скорости спидометра
    - *Инфо
    - do: Ехать с постоянной скоростью
    - assert: Скорость в приложении соответствует скорости спидометра
    - do: Увеличить сокрость
    - assert: Скорость в приложении увеличивается в соответствии со спидометром
    - do: Уменьшить скорость до полной остановки машины
    - assert: |
        - Скорость в приложении уменьшается в соответствии со спидометром
        - После остановки автомобиля, скорость в приложении равна нулю

    - *Платформа


  Перемещение в тоннеле в реальном заезде:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - do: Заехать в тоннель с постоянной скоростью
    - assert: Продолжается ведение по маршруту
    - do: Изменить скорость на 10-20 км/ч
    - do: Выехать из тоннеля
    - assert: |
        - Курсор переносится в текущую позицию пользователя
        - Продолжается ведение по маршруту
        - Скорость в приложении обновляется и соответствует скорости на спидометре

    - *Платформа


  Ведение без маршрута:
    - *Инфо
    - info: | 
        Включены аннотации:
          - Карты: Настройки - Маршруты - Звук - Проигрывать уведомления
          - Навигатор: Настройки - Звуки и оповещения - Все звуки навигатора включены
    - do: Начать движение без маршрута
    - assert: |
        - Курсор пользователя перемещается по карте в соответствии с реальным перемещением
        - Местоположение изменяется плавно, без зависаний и последующих резких рывков 
        - Аннотации о ДС произносятся без задержек
        - Не озвучиваются аннотации о маневрах
    - do: Остановиться
    - assert: Курсор пользователя перестает перемещаться по карте

    - *Платформа


  Дорожные развязки с аннотацией “держитесь правее/левее” в реальном заезде:
    - description: |
        Лучше всего проверять на маршрутах по Садовому кольцу, ТТК и МКАДу
        Ближайшие к офису развязки: 
        https://yadi.sk/i/PswPywRpyYsrBQ
        https://yadi.sk/i/kEOmuNPjJLNGpg
        https://yadi.sk/i/ROYKoFpR-O3xJg
        
        Или любые другие, с аналогичными условиями
    - *Инфо
    - do: Построить маршрут, проходящий через развязку
    - assert: | 
        - Аннотации "держитесь правее/левее" произносятся
        - Балун полосности соответствует аннотациям

    - *Платформа


  Ведение с музыкой в реальном заезде:
    - description: Можно открыть музыку через приложение или использовать радио
    - *Инфо
    - do: |
        - Включить музыку на ГУ
        - Построить маршрут и начать ведение
        - Слушать аннотации
    - assert: |
        - Музыка заглушается/приглушается во время аннотации
        - Аннотации успешно воспроизводятся 

    - *Платформа


  Сворачивание приложения в реальном заезде. Аннотации:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - assert: Аннотации произносятся
    - do: Перейти в другое приложение на ГУ
    - assert: Аннотации произносятся

    - *Платформа


  Сворачивание приложения в реальном заезде. Маневры:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - assert: Скорость, ограничения скорости, маневры - отображаются 
    - do: Свернуть приложение
    - do: Развернуть приложение через 30 секунд
    - assert: |
        - Приложение развернулось
        - Маршрут сохранился и продолжатся ведение по нему
        - Определяется текущее местоположение 
        - Определяется скорость и ограничение скорости
        - Отображаются маневры

    - *Платформа

  Работа маневров:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - assert: |
        - Отображается плашка маневров в левом верхнем углу экрана
        - Полосность начинается отображаться за 1 км под маневром
    - do: Дождаться смены маневра с полосностью
    - assert: Полосность с маневром показывают информацию о следующем маневре

    - *Платформа


  Аннотации о маневрах:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - assert: При приближении к съезду/повороту - Алиса озвучивает маневр

    - *Платформа


  Аннотации о ДС:
    - *Инфо
    - do: Построить маршрут через ДС и начать ведение
    - assert: |
        - На маршруте отображается иконка о ДС
        - За 500 м озвучивается аннотация о ДС

    - *Платформа

    
  Завершение маршрута:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - do: Доехать до конца маршрута
    - assert: |
        - Озвучивается аннотация "Вы приехали"
        - Маршрут завершается

    - *Платформа


  Сход с маршрута в реальном заезде:
    - *Инфо
    - do: Построить маршрут и начать ведение
    - do: Поехать не по маршруту
    - assert: |
        - Озвучивается аннотация "Маршрут перестроен"
        - Маршрут перестраивается

    - *Платформа

    
  Сход с маршрута офлайн в реальном заезде:
    - description: Не скачен кеш
    - *Инфо
    - do: Построить маршрут и начать ведение
    - do: | 
        - Включить авиарежим
        - Поехать не по маршруту
    - assert: |
        - В момент расхождения маршрута звучит аннотация о сходе с маршрута
        - Новый маршрут не строится
    - do: Включить сеть
    - assert: |
        - Звучит аннотация: "Маршрут перестроен"
        - Маршрут перестраивается

    - *Платформа


  Звонки в реальном заезде:
    - *Инфо
    - do: |
        - Построить маршрут и начать ведение
        - Сделать вызов и принять его на ГУ во время ведения по маршруту
    - assert: Принятие вызова не блокирует работу приложения
    - do: Продолжить разговор в течении 1,5-2 минут
    - assert: Аннотации не произносятся
    - do: Завершить разговор на ГУ
    - assert: |
        - Приложение продолжает свою работу 
        - Аннотации произносятся вовремя и без заиканий
    
    - *Платформа


  Звонки в реальном заезде на ГУ:
    - *Инфо
    - do: |
        - Построить маршрут и начать ведение
        - Совершить вызов с ГУ
        - Завершить вызов чезез 10-20 секунд на телефоне
    - assert: |
        - Приложение продолжает свою работу
        - Аннотации произносятся вовремя и без заиканий

    - *Платформа


  Проверка Freedrive:
    - *Инфо
    - do: Начать движение без маршрута
    - assert: | 
        - Курсор движется по маршруту
        - Через ~10сек приложение переходит в режим Freedrive: Контролы и Таббар - скрываются, показан Спидлимит с текущей скоростью
    - do: Тап в любое место по карте
    - assert: Появляются Контролы и Таббар
    - do: Не взаимодействовать с ГУ
    - assert: Спустя ~10 секунд приложение переходит в режим Freedrive

    - *Платформа


  Переход в Freedrive с построенным маршрутом:
    - *Инфо
    - do: Построить маршрут и начать движение
    - assert: | 
        - Курсор движется по маршруту
        - Через ~10сек приложение переходит в режим Freedrive: Контролы и Таббар - скрываются, показан Спидлимит с текущей скоростью
    - do: Тап в любое место по карте
    - assert: Появляются Контролы и Таббар
    - do: Не взаимодействовать с ГУ
    - assert: Спустя ~10 секунд приложение переходит в режим Freedrive

    - *Платформа


  Дашборд в CP ведение по маршруту:
    - *Инфо
    - do: Построить маршрут и начать движение
    - do: Перейти в Дашборд
    - assert: | 
        Отображается Дашборд, разделенный на блоки:
          - Блок с картой, где отображаются: спидлимит, текущая скорость, плашка eta и движение по маршруту
          - Блок с маневрами, где отображаются: маневр и расстояние до него
    
    - platforms:
        - carplay


  Дашборд в CP ведение без маршрута:
    - *Инфо
    - do: Начать движение без маршрута
    - do: Перейти в Дашборд
    - assert: | 
        Отображается Дашборд, разделенный на блоки:
          - Блок с картой, где отображаются: спидлимит, текущая скорость и движение во freedrive
          - Блок с закладками, где отображаются иконки: дом и работа (если они добавлены)

    - platforms:
        - carplay


  Дашборд в CP сход с маршрута:
    - *Инфо
    - do: Построить маршрут и начать движение
    - do: Перейти в Дашборд
    - assert: В блоке с картой отображается ведение по маршруту
    - do: Поехать не по маршруту
    - assert: |
        - Озвучивается аннотация "Маршрут перестроен"
        - Маршрут перестраивается
    
    - platforms:
        - carplay


  Отключение сети и восстановление в реальном заезде:
    - *Инфо
    - do: | 
        - Построить маршрут и начать ведение 
        - Включить авиарежим
    - assert: |
        - Маршрут построился, присутсвуют аннотации
        - После отключения сети продолжается ведение по маршруту
    - do: Включить сеть
    - assert: |
        - Подгружаются пробки и незагруженные ранее участки карты
        - Продолжается ведение по маршруту

    - *Платформа


  Оффлайн ведение по кешам в реальном заезде:
    - *Инфо
    - info: Скачен кеш региона
    - do: |
        - Включить авиарежим
        - Построить маршрут и начать ведение
    - assert: |
        - Курсор пользователя перемещается по карте в соответствии с реальным перемещением
        - Маршрут выделяется синим цветом
        - Нет данных о пробках и ДС
        - Скорость в приложении соответствует скорости на спидометре
        - Местоположение изменяется плавно, без зависаний и последующих резких рывков.
        - Аннотации о ДС произносятся без задержек
    - do: Доехать до конца маршрута
    - assert: |
        - Звучит аннотация ‘Вы приехали’
        - Маршрут сбрасывается

    - *Платформа
