components: gas_promo
testing:
  - regress
integration_run:
  - tanker_sdk

specs-integration:
  aliases:
    - &Info_gas_promo
        - info: |
            - Промокоды: https://disk.yandex.ru/i/BJ7v15Pbw2ZhSA
    - &Настройки_промо_шаг
        - do: |
            - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/midway/download-11-2.png){title=QR-код}
        
             `yandexnavi://add_exp?navi_feature_gas_stations_force_test_mode=enabled&navi_feature_day_night_fast_switch=enabled&navi_feature_gas_stations_layer_geo_search=disabled`
            - Перезагрузить приложение

specs:
  Ввод действующего промокода:
    - *Info_gas_promo
    - info: Пользователь авторизован
    - *Настройки_промо_шаг  
    - do: Перейти в Меню - Яндекс.Заправки - Скидки и бонусы 
    - do: Тап на “Ввести промокод”
    - do: Ввести промокод 
    - assert: Введенный промокод вводится
    - do: Тап на "Активировать"
    - assert: |
        - Промокод активируется
        - Открывается экран "Скидки и бонусы"
        - В разделе "Скидки" появляется информация о купоне

    - platforms:
        - t3am
        - ios
        - android
    - tags:
        - assessors


  Отображение на аккаунте без промокода:
    - info: Пользователь авторизован с активированным промокодом
    - *Настройки_промо_шаг  
    - do: Выйти из аккаунта
    - do: Тап на колонку в таббаре
    - do: Открыть пин Тестировочной АЗС по адресу Москва, Лобное место
    - do: Выбрать любую колонку,вид топлива
    - do: Тап на оплатить
    - assert: Открывается окно авторизации
    - do: Авторизоваться аккаунтом без промокода
    - assert: |
        - Открываеся окно оплаты
        - Скидка с  раннего вышедшего аккаунта не применяется

    - platforms:
        - t3am
        - ios
        - android
    - tags:
        - assessors

  Промокоды заправки. Ввод пробела:
    - *Info_gas_promo
    - info: Пользователь авторизован
    - *Настройки_промо_шаг  
    - do: Перейти в Меню - Яндекс.Заправки - Скидки и бонусы 
    - do: Тап на "Ввести промокод"
    - assert: Открывается экран ввода промокода
    - do: Ввести "Пробел" на экранной клавиатуре
    - do: Тап на "Активировать"
    - assert: Выводится сообщение об ошибке

    - platforms:
        - t3am
        - ios
        - android
    - tags:
        - assessors



  Промокоды заправки. Недействующие промокоды:
    - info: Пользователь авторизован
    - *Настройки_промо_шаг  
    - do: Перейти в Меню - Яндекс.Заправки - Скидки и бонусы 
    - do: Тап на "Ввести промокод"
    - assert: Открывается экран ввода промокода
    - do: Ввести промокод "TST"
    - do: Тап на "Активировать"
    - assert: Выводится сообщение об ошибке

    - platforms:
        - t3am
        - ios
        - android
    - tags:
        - assessors



  Подтягивание данных о промокоде после авторизации:
    - info: Пользователь не авторизован
    - *Настройки_промо_шаг  
    - do: Перейти в Меню - Яндекс.Заправки - Скидки и бонусы 
    - assert: Открывается "Экран авторизации"
    - do: Авторизоваться аккаунтом  с активированным промокодом
    - assert: |
        - Открывается экран "Скидки и бонусы"
        - В разделе "Скидки" появляется купон на скидку с поясняющим текстом

    - platforms:
        - ios
        - t3am
        - android
    - tags:
        - assessors


  Аватар с заправочной скидкой при разлогине:
    - info: Пользователь авторизован с примененным промокодом
    - *Настройки_промо_шаг  
    - do: Перейти на экран "Карта"
    - assert: В левом нижнем углу над таббаром отображется аватар пользователя с подписью о размере скидки
    - do: Выйти из аккаунта
    - do: Перейти на экран "Карта"
    - assert: Аватар со скидкой не отображается
    - do: Авторизоваться аккаунтом без промокода
    - assert: Аватар со скидкой не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Аватар с заправочной скидкой:
    - info: Пользователь авторизован с примененным промокодом
    - *Настройки_промо_шаг  
    - do: Перейти на экран "Карта"
    - assert: В левом нижнем углу над таббаром отображется аватар пользователя с подписью о размере скидки
    - do: Тап на аватар
    - assert: Открывается экран "Яндекс.Заправки"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Скидки и бонусы. Отображение элементов:
    - info: Пользователь авторизован.
    - do: Перейти в Меню ->  Яндекс Заправки -> Скидки и бонусы
    - assert: Отображаются
        - Непривязанные Карты лояльности
        - Активные скидки при их наличии
        - Список скидок, при их наличии доступных к привязке и активации.
        - Промо
        - Действующие карты лояльности при их наличии
        - Кнопка "Ввести промокод"


    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Диплинк в скидки и бонусы. Авторизованный пользователь. Приложение не запущено:
    - info: Пользователь авторизован, приложение не запущено
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается приложение
        - Открывается экран "Скидки и бонусы"
    
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  
  Диплинк в скидки и бонусы. Авторизованный пользователь. Приложение свернуто:
    - info: Пользователь авторизован, приложение свернуто
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается приложение
        - Открывается экран "Скидки и бонусы"
    
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  
  Диплинк в скидки и бонусы. Авторизованный пользователь. Приложение запущено:
    - info: Пользователь авторизован, приложение открыто на экране "Карта"
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается экран "Скидки и бонусы"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Диплинк в скидки и бонусы. Неавторизованный пользователь. Приложение не запущено:
    - info: Приложение свернуто не запущен, пользователь неавторизован
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается приложение
        - Открывается форма для авторизации
    - do: Авторизоваться в приложении
    - assert: |
        - Открывается экран "Скидки и бонусы"

    - platforms:
        - ios
        - android
    - tags:
        - assessors



  Диплинк в скидки и бонусы. Неавторизованный пользователь. Приложение свернуто:
    - info: Приложение свернуто, пользователь неавторизован
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается приложение
        - Открывается форма для авторизации
    - do: Авторизоваться в приложении
    - assert: |
        - Открывается экран "Скидки и бонусы"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Диплинк в скидки и бонусы. Неавторизованный пользователь. Приложение запущено:
    - info: Приложение запущено на экране "Карта", пользователь неавторизован
    - do: |
        - Использовать интенты:
             [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/iosqr-code.gif){title=QR-код}
        
             "yandexnavi://show_ui/menu/gas_stations_promocodes"
    - assert: |
        - Открывается приложение
        - Открывается форма для авторизации
    - do: Авторизоваться в приложении
    - assert: |
        - Открывается экран "Скидки и бонусы"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Добавление карты лояльности:
    - info: |
        Для прохождения необходимо оформить карту в приложение EKA:
        Android: https://play.google.com/store/apps/details?id=ru.growapps.eka
        iOS:https://apps.apple.com/ru/app/%D0%B5%D0%BA%D0%B0/id990970485
        Подменить местоположоние на Мск
        Пользователь авторизован
    - do: Перейти в Меню -> Настройки -> Яндекс.Заправки -> Скидки и бонусы
    - do: Тап на EKA
    - assert: Открывается экран для ввода телефона
    - do: Ввести номер телефона с привязанной картой
    - do: Тап на "Продолжить"
    - assert: Происходит переход к экрану ввода кода из смс
    - do: Ввести код
    - assert: |
        - Происходит переход к экрану "Скидки и бонусы"
        - В блоке "Действующие карты лояльности" отображается добавленная карта

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Удаление карты лояльности:
    - info: |
        - Пользователь авторизован
        - К аккаунту привязанна карта лояльности
    - do: Перейти в Меню -> Настройки -> Яндекс.Заправки -> Скидки и бонусы
    - do: Тап на кнопку "Править" в правом верхнем углу
    - assert: |
        В блоке «Действующие карты лояльности» у карт появляется:
        на iOS -  минус в красном кружке
        на Android - красный крестик
    - do: |
       (iOS) - Тап на минус
       (iOS) - Тап на появившуюся кнопку "удалить"
       (Android) - Тап на крестик 
    - assert: |
        Страница "Скидки и бонусы" обновляется
        Карта лояльности удаляется из блока «Действующие карты лояльности»
        Компания удаленной карты отображается в блоке "Непривязанные карты лояльности"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Аватар с заправочной скидкой при движении по маршруту:
    - *Info_gas_promo
    - info: Пользователь авторизован c примененным промокодом
    - *Настройки_промо_шаг  
    - do: Перейти на экран "Карта"
    - assert: В левом нижнем углу над таббаром отображется аватар пользователя с подписью о размере скидки
    - do: Построить маршрут в любую точку, запустить ведение по нему
    - assert: Аватар со скидкой отсутствует
    - do: Сбросить маршрут
    - assert: Аватар со скидкой отображается внизу экрана

    - platforms:
        - ios
        - android
    - tags:
        - assessors