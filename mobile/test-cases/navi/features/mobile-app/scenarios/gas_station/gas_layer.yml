components: gas_layer
testing:
  - regress
integration_run:
  - tanker_sdk

specs-integration:
  aliases:
    - &Info_gas_layer
        - info: Подменить местоположение на Москву
    - &Отображение_слоя_шаг
        - do: |
            - Использовать интенты:
              [collapsed-image](https://jing.yandex-team.ru/files/midway/download-6-3.png){title=QR-код}
        
              `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_stations_layer_geo_search=disabled`
            - Перезагрузить приложение
        - do: Тап на колонку в таббаре
    - &Отображение_слоя_результат
        - assert: Отображаются зеленые пины с оплатой

specs:
  Смена ориентации при включенном заправочном слое:
    - info: Устройство в вертикальной ориентации
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Повернуть устройство в горизонтальную ориентацию
    - assert: |
        - Пины не пропадают
        - Пины не уменьшаются и не изменяются
        - Названия заправок не меняются
        - Зум не изменяется
    - do: Повернуть устройство в вертикальную ориентацию
    - assert: |
        - Пины не пропадают
        - Пины не уменьшаются и не изменяются
        - Названия заправок не меняются
        - Зум не изменяется

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Смена ориентации при включенном заправочном слое. Проверка при смене дня/ночь:
    - info: Устройство в вертикальной ориентации
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Дождаться смены темы
    - assert: |
        - Отображаются пины зеленые пины заправок с оплатой
        - UI не ломается
    - do: Повернуть устройство в горизонтальную ориентацию
    - do: Дождаться смены темы
    - assert: |
        - Отображаются зеленые пины заправок с оплатой
        - UI не ломается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Закрытие заправочного слоя при открытой миникарточке заправки:
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Тап по зеленому пину заправки
    - assert: Открыта карточка организации АЗС
    - do: Свернуть карточку заправки
    - assert: Отображается миникарточка организации АЗС
    - do: Тап на крестик закрытия заправочного слоя
    - assert: |
        - Заправочный слой закрывается
        - Миникарточка отображается на экране

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Сворачивание приложения при включенном заправочном слое:
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Свернуть приложение
    - do: Развернуть приложение
    - assert: Заправочный слой остается включенным

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Сворачивание приложения при включенном заправочном слое (DKA ON):
    - info: На девайсе включена настройка dont keep activity
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Свернуть приложение
    - do: Развернуть приложение
    - assert: |
        - Заправочный слой закрывается
        - Открывается экран карта

    - platforms:
        - android
    - tags:
        - assessors


  Заправочный слой после сброса ведения по маршруту:
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Тап по зеленому пину заправки
    - assert: |
        - Пин заправки выделяется
        - Открывается карточка организации АЗС
    - do: Тап по кнопке "Маршрут"
    - assert: |
        - Строится маршрут до выбранной заправки
        - Заправочный слой выключается
        - Пин конечной точки не скрывается за пином заправки
    - do: Тап по кнопке "Поехали"
    - assert: Запускается ведение
    - do: Сбросить маршрут
    - assert: Маршрут сброшен
    - do: Включить заправочный слой тапом на колонку в Таббаре
    - assert: |
        - Включается заправочный слой
        - Пин заправки, до который был построен маршрут, не выделен
        - Карточка заправки, до которой был построен маршрут, не открыта
        - Центрирование на заправку, до который был построен маршрут, не происходит

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Изменение заправочного слоя:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Тап Меню - Настройки- Developer Settings - Gas Stations - Switch to Test Mode
    - do: Перейти на экран Карты
    - do: Тап на колонку в таббаре
    - assert: На карте отображаются тестовые заправки
    - do: Тап Меню - Настройки - Developer Settings - Gas Stations - Switch to Stable Mode
    - do: Перейти на экран "Карта"
    - assert: На карте отображаются реальные Заправки с возможностью оплаты

    - platforms:
        - t3am
        - ios
        - android
    - tags:
        - assessors


  Включение заправочного слоя через пункт в меню:
    - do: |
        - Использовать интенты:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-7-3.png){title=QR-код}
        
          `yandexnavi://add_exp?navi_feature_parking_gas_from_menu=enabled&navi_feature_day_night_fast_switch=enabled&navi_feature_gas_stations_layer_geo_search=disabled`
        - Перезагрузить приложение
    - do: Тап на Меню -> Яндекс.Заправки
    - assert: |
        - Происходит отзум на 13 уровень
        - Показан слой с пинами заправок, в которых есть оплата из навигатора
        - Вместо кнопки с алисой отображается кнопка закрытия заправочного слоя

    - platforms:
        - ios
        - android
        - t3am
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Включение заправочного слоя через иконку в таббаре:
    - *Info_gas_layer
    - info: Открыт экран карта
    - do: Тап на иконку колонки в таббаре
    - assert: |
        - Показан слой с пинами заправок, в которых есть оплата из навигатора
        - Присутствуют плашки-подписи с названиями заправок.
        - Вместо кнопки с алисой - кнопка закрытия заправочного слоя
  
    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Работа зума в заправочном слое:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Уменьшить значение зума до 12
    - assert: |
        - Кружки заправок превратились в точки
        - Подписи к заправкам исчезли
    - do: Призумиться к значению зума >= 13.
    - assert: Появляются названия заправок над зелеными пинами.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Работа кластеров в заправочном слое:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Уменьшить значение зума 6
    - assert: |
        - Точки заправок обьединяются
        - Подписи с названиями отсутствуют
    - do: Тап по одному из кластеров
    - assert: |
        - Карта призумивается
        - Отображаюся пины заправок в области
        
    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi

  Закрытие заправочного слоя при поиске:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Произвести поиск по любой категории через пункт меню Поиск
    - assert: |
        - Заправочный слой выключается
        - На карте отображаются результаты поиска

    - platforms:
        - ios
        - android
        - t3am
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Закрытие заправочного слоя при построение маршрута:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Построить маршрут в любую точку
    - assert: |
        Заправочный слой не отображается вместе с построенным маршрутом
    - do: Тап на Поехали
    - assert: |
        - Прооисходит переход на карту в режим ведения
        - Заправочный слой выключен

    - platforms:
        - ios
        - android
        - t3am
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Закрытие заправочного слоя по крестику:
    - *Info_gas_layer
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - do: Тап по кнопке крестика
    - assert: Заправочный слой выключается.

    - platforms:
        - ios
        - android
        - t3am
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Интент на включение заправочного слоя:
    - *Info_gas_layer
    - do: |
       - Использовать интенты:
         [collapsed-image](https://jing.yandex-team.ru/files/midway/download-6-3.png){title=QR-код}
        
         `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_stations_layer_geo_search=disabled`
        - Перезагрузить приложение
    - do: |
        - Использовать интент:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-15.png){title=QR-код}
        
          `yandexnavi://search_gas_stations`
    - assert: Открывается заправочный слой

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Интент на включение поискового заправочного слоя:
    - *Info_gas_layer
    - do: |
        - Использовать интент:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-8-3.png){title=QR-код}

          `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_stations_layer_geo_search=enabled`
        - Перезагрузить приложение
    - do: |
        - Использовать интент:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-15.png){title=QR-код}
        
          `yandexnavi://search_gas_stations`
    - assert: Открывается поисковый слой

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Заправочный слой и ДС. Построение маршрута:
    - *Info_gas_layer
    - info: В настройках включено отоброжение всех дс на карте и маршруте
    - *Отображение_слоя_шаг
    - *Отображение_слоя_результат
    - asset: ДС на карте не отображаются
    - do: |
        - Построить маршрут и запустить симуляцию по нему
        - Включить заправочный слой любым способом: Тап в иконку колонки в левом верхнем углу либо через категорию поиска
    - assert: |
        - Начинается движение по маршруту
        - Показан слой с пинами заправок, в которых есть оплата из навигатора
        - ДС на карте отображаются ТОЛЬКО по маршруту
    - do: Начать ведение во freedrive (сбросить маршрут , не останавливая симуляции движения. спустя несколько секунд движение перейдет во freedrive)
    - assert: |
        - Начинается движение freedrive
        - Показан слой с пинами заправок, в которых есть оплата из навигатора
        - ДС на карте отображаются ТОЛЬКО по предполагаемому маршруту

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Включение региона с высокой плотностью заправок:
    - *Info_gas_layer
    - info: |
        Девайс находится в портретной ориентации
    - do: Включить Developer settings -> Gas stations -> High density regions visible
    - *Отображение_слоя_шаг
    - assert: |
        Открывается заправочный слой, на карте отображаются пины заправок.
        Вместе с пинами отображаются синие прямоугольники
    - do: Сменить ориентацию на альбмоную
    - assert: |
        - Заправочный слой не закрывается
        - Вместе с пинами отображаются синие прямоугольники

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Выключение региона с высокой плотностью заправок:
    - *Info_gas_layer
    - info: |
        Девайс находится в портретной ориентации
    - do: Вылючить Developer settings -> Gas stations -> High density regions visible
    - *Отображение_слоя_шаг
    - assert: |
        Открывается заправочный слой, на карте отображаются пины заправок.
        Вместе с пинами не отображаются синие прямоугольники
    - do: Сменить ориентацию на альбмоную
    - assert: |
        - Заправочный слой не закрывается
        - Вместе с пинамиy не отображаются синие прямоугольники
    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Отображение заправок в Таббаре:
    - info: |
       - Приложение установлено
       - Интроскрины пройдены, 2-3 запуск приложение
    - do: Запустить приложение 
    - assert: |
        - В таббаре отображается кнопка колонки
        - Над кнопкой отображается синий кружок
    - do: Изменить ориентацию приложения
    - assert: |
        - В таббаре отображается кнопка колонки
        - Над кнопкой отображается синий кружок
    - do: Тап по кнопке колонки в таббаре
    - assert: |
        - Открывается заправочный слой
        - Кнопка заправок становится черной с зеленой кругом
    - do: Тап по кнопке колонки в таббаре
    - assert: |
        - Заправочный слой закрывается
        - Кнопка заправок становится черной

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Логирование кнопки заправок в таббаре:
    - info: |
        - Приложение установлено
        - Интроскрины пройдены, 2-3 запуск приложение
    - do: Запустить приложение 
    - assert: Приходит событие `gas-stations.tabbar-button-appear`
    - do: Тап по кнопке колонки в таббаре
    - assert: Приходит событие `gas-stations.tabbar-button-click` с параметром `action:open`
    - do: Тап по кнопке колонки в таббаре
    - assert: Приходит событие `gas-stations.tabbar-button-click` с параметром `action:close`
    
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - metric
    - testing:
        - acceptance_navi


  Заправки в таббаре на маршруте:
    - info: Пользователь авторизован
    - do: |
        - Использовать интенты:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-9-2.png){title=QR-код}
        
          `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_layer_in_guidance=enabled`
        - Перезагрузить приложение
    - do: Построить любой маршрут
    - do: Запустить симуляцию
    - assert: Посередине в таббаре отображается иконка колонки
    - do: Перейти в режим FreeDrive
    - assert: Посередине в таббаре отображается иконка колонки

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_navi


  Слой заправок при первых запусках. Пользователь авторизован:
    - info: |
        Пользователь авторизован
        Местоположение Москва
        Чистая установка приложения
        Приложение еще ни разу не запускалось
    - do: Запустить приложение и пройти все интроскрины
    - aseert: 
        - Открывается экран карта
        - Кнопки колонки в таббаре нет
    - do: Перезагрузить приложение
    - assert: |
        - Открывается экран карта
        - Появляется кнопка колонки в таббаре
    - do: Тап по кнопке колонки в таббаре
    - assert: Открылся слой заправок


    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Слой заправок при первых запусках. Пользователь невторизован:
    - info: |
        Пользователь неавторизован
        Местоположение Москва
        Чистая установка приложения
        Приложение еще ни разу не запускалось
    - do: Запустить приложение и пройти все интроскрины
    - aseert: 
        - Открывается экран карта
        - Кнопки колонки в таббаре нет
    - do: Перезагрузить приложение
    - assert: |
        - Открывается экран карта
        - Появляется кнопка колонки в таббаре
    - do: Тап по кнопке колонки в таббаре
    - assert: Открылся слой заправок


    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Включение геопоиска заправок через таббар:
    - do: | 
        - Использовать интент:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-10-2.png){title=QR-код}

          `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_layer_in_guidance=enabled&navi_feature_gas_stations_layer_geo_search=enabled`
        - Перезагрузить приложение
    - do: Тап на кнопку колонки в таббаре
    - assert: | 
        - Карта отзумивается
        - Открывается геопоиск заправок
        - На карте отображаются пины азс
    - do: Тап на крестик в геопоиске заправок
    - assert: Геопоиск заправок закрывается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Включение геопоиска заправок через таббар на маршруте:
    - do: | 
        - Использовать интент:
          [collapsed-image](https://jing.yandex-team.ru/files/midway/download-10-2.png){title=QR-код}

          `yandexnavi://add_exp?navi_feature_day_night_fast_switch=enabled&navi_feature_gas_layer_in_guidance=enabled&navi_feature_gas_stations_layer_geo_search=enabled`
        - Перезагрузить приложение
    - do: Построить любой маршрут
    - do: Запустить ведение
    - do: Тап на кнопку колонки в таббаре
    - assert: | 
        - Карта отзумивается
        - Открывается геопоиск заправок
        - На маршруте отображются пины заправок
    - do: Тап на заправочный слой в таббаре
    - assert: Геопоиск заправок закрывается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Включение заправочного слоя из разных экранов:
    - preconditions: Открыта карта
    - do: Тап на Меню в таббаре
    - do: Тап на колонку в таббаре
    - assert: Отображаются пины заправок с оплатой
    - do: Закрыть заправочный слой тапом на крестик
    - do: Тап на мои места в таббаре
    - do: Тап на колонку в таббаре
    - assert: Отображаются пины заправок с оплатой
    - do: Закрыть заправочный слой тапом на крестик
    - do: Тап на музыку в таббаре
    - do: Тап на колонку в таббаре
    - assert: Отображаются пины заправок с оплатой
    
    - platforms:
        - ios
        - android
    - tags:
        - assessors