components: baloon
testing:
  - regress

specs:
  Контекстные балуны (Основные проверки):      
    - info: Настройки -> Север всегда наверху - Off
    - do: Построить маршрут с альтернативами не из дворовой территории и тап на "Поехали"
    - assert: |
        Маршрут построен. В левом верхнем углу отобразился контекстный балун, содержащий следующую информацию:
        - Стрелку, изображающую следующий маневр;
        - Расстояние до следующего маневра;
        - Название следующей улицы.
    - do: Подождать ~5 секунд.
    - assert: |
        - Кнопки и таббар скрылись. 
        - Контекстный балун переместился на линию маршрута. 
        - Нога балуна указывает на точку ближайшего маневра.
        - Содержание балуна то же, что и в предыдущем шаге.

    - platforms:
      - geely
      - carsharing_t3
      - ios
      - nissan
      - android
      - t3am
      - motrex
      - autochip
      - first_run_hu
    - tags:
        - assessors
    - testing:
      - acceptance_navi


  Контекстные балуны (Дополнительные проверки):
    - info: Настройки -> Север всегда наверху - Off
    - do: Построить маршрут с несколькими альтернативами и ближайшим маневром в пределах экрана, тап на поехали и подождать
        ~5 секунд.
    - assert: |
        - Маршрут построен. 
        - В левом верхнем углу отобразился контекстный балун. 
        - По завершению таймаута балун переместился к точке ближайшего маневра
        Контекстный балун перекрывает такие объекты на карте, как:
        - Линии и балуны альтернатив
        - Знаки ДС
        - Трехмерные объекты на карте
        - Линию маршрута
        Контекстный балун не перекрывает:
        - Курсор
    - do: Установить масштаб, при котором контекстный балун на маршруте будет перекрывать линию и/или балун альтернативы и подождать ~5 сек.
    - assert: |
        Балун на маршруте появился.

    - platforms:
      - ios
      - android
    - tags:
        - assessors


  Информация в контекстных балунах и балунах текущей улицы:
    - info: Настройки -> Север всегда наверху - Off
    - do: Построить маршрут, тап на Поехали и запустить симуляцию движения.
    - assert: |
        - Длинные надписи сокращаются троеточиями
        - Надписи в контекстных балунах, которые не помещаются на одну строчку более, чем на пять-шесть символов, переносятся на следующую
          строчку с символом "-"
        - Надписи в контекстных балунах, которые не помещаются на вторую строчку, сокращаются троеточием
        - Переносы реализуются согласно грамматике
        - Сокращения реализуются согласно грамматике
        - (горизонтальная ориентация) Если угловой балун рискует перекрыть кнопки на экране, следующая улица может в нем сокращаться до одной строки или вовсе отсутствовать
        - Для контекстных балунов, объединенных с балунами полосности, работает такой же алгоритм переносов и сокращений
    - do: Построить маршрут, на котором будут присутствовать балуны полосности (как объединенные, так и обычные) и проехать по нему.
    - assert: |
        - Стрелки в балунах отображаются корректно.
        - Подсвечены стрелки, которые соответствуют необходимому маневру
    - do: Построить маршрут, на котором будут присутствовать выделенные для общественного транспорта полосы, и проехаться по нему.
    - assert: |
        - В балунах присутствуют значки полос транспорта.
        - Подсвечены стрелки, которые соответствуют необходимому маневру

    - platforms:
      - motrex
      - autochip
      - carsharing_t3
      - ios
      - nissan
      - android
    - tags:
        - assessors
    - integration_run:
      - localization


  Локализация контекстных балунов:
    - info: |
        - Настройки -> Север всегда наверху - Off
        - Установить локаль tr-TR
    - do: |
        - Построить маршрут по России
        - Запустить ведение по нему
        - Несколько раз сменить ориентацию устройства
    - assert: |
        - Информация в контекстном балуне и балуне текущей улицы написана на латинице. 
        - Обозначения в ETA корректно локализованы.
    - do: |
        - Построить маршрут по Турции
        - Запустить ведение по нему
        - Несколько раз сменить ориентацию устройства
    - assert: Информация в контекстном балуне и балуне текущей улицы отображается корректно
    - do: Построить маршрут с полосой общественного транспорта
    - assert: Вместо буквы "А" в полосе общественного транспорта отображается буква "В"

    - platforms:
      - ios
      - android
    - tags:
        - assessors


  Отображение балуна полосности совместно с результатами поиска:
    - do: |
        - Построить маршрут, проходящий по многополосным дорогам
        - Тап Поехали
        - Запустить симуляцию движения по маршруту через дебаг-панель
    - assert: На маршруте отображается балун полосности
    - do: Изменить масштаб карты, чтобы балун оставался в пределах экрана
    - assert: Балун полосности не скрывается
    - do: |
        - Перейти на экран "Поиск"
        - Выполнить поиск по категории
        - Не скроллить карту
    - assert: Спустя примерно 10 секунд балун снова показывается
    - do: Поскроллить карту
    - assert: Балун скрывается
    - do: |
        - Построить маршрут по многополосной дороге со съездом на другую улицу
        - Начать ведение по маршруту
        - Убедиться, что есть объединеный балун с полосностью, маневром и улицей
        - Поскроллить карту
    - assert: Балун полосности скрывается

    - platforms:
      - motrex
      - autochip
      - renault
      - vaz
      - carsharing_t3
      - ios
      - nissan
      - android
    - integration_run:
      - mapkit
    - tags:
      - assessors
      - mapkit_ready


  Контекстные балуны. Альтернативные маршруты:
    - info: Настройки -> Север всегда наверху - Off
    - do: |
        - Построить маршрут
        - Запустить ведение по нему
        - Во время приближения к альтернативному маршруту тап на линию альтернативы или балун альтернативы.
    - assert: Информация в контекстном балуне актуализировалась согласно новому маршруту.
    - do: Вернуться в режим ведения.
    - assert: Контекстные балуны отображаются.
    - do: Сбросить маршрут.
    - assert: Контекстные балуны не отображаются.

    - platforms:
      - motrex
      - autochip
      - first_run_hu
    - testing:
      - acceptance_navi


  Контекстные балуны. Ведение по маршруту:
    - info: |
        - Настройки -> Север всегда наверху - Off
        - Построить маршрут и запустить ведение по нему
    - do: Двигаться по маршруту
    - assert: |
        - Расстояние в балунах (как угловом, так и на маршруте) корректно отображается.
        - Иконка маневра соответствует будущему маневру.
        - Нога балуна, когда он отображается на маршруте, всегда указывает на точку маневра
    - do: Тап по карте
    - assert: |
        - Появляются кнопки интерфейса
        - Балун с ножкой исчезает, появляется его аналог в левом верхнем углу
    - do: Тап на контекстный балун
    - assert: Производится автосдвиг карты к точке следующего маневра
    - do: Перейти в режим обзора маршрута по кнопке в тапбаре
    - assert: Контекстные балуны не отображаются

    - testing:
      - acceptance_navi
    - platforms:
      - geely
      - carsharing_t3
      - ios
      - nissan
      - android
      - t3am
      - motrex
      - autochip
      - first_run_hu
    - tags:
        - assessors


  Балун пин финиша:
    - info: Построить любой маршрут
    - do: Тап на пин финиша
    - assert: Открывается карточка организации с адресом финишной точки.
    - do: Передвинуть балун финиша пару раз в разные места (лонг-тап по финишу и перенести)
    - assert: Маршрут перестроился с учетом новой конечной точки

    - platforms:
      - motrex
      - autochip
      - renault
      - ios
      - android
      - vaz
      - carsharing_t3
      - nissan
      - t3am
    - tags:
        - assessors
        - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit


  Контекстные балуны (Смена ориентации):
    - info: |
        - Настройки -> Север всегда наверху - Off
        - Построить маршрут с несколькими альтернативами и ближайшим маневром в пределах экрана
        - Запустить ведение по нему и подождать ~5 секунд.
        - Установить масштаб, при котором контекстный балун на маршруте будет перекрывать линию и/или балун альтернативы и подождать ~5 сек.
    - do: Несколько раз сменить ориентацию устройства
    - assert: |
        - Балуны и линии альтернатив не перекрываются.
        - "Нога" контекстных балунов и балунов альтернатив не пропала.
        - Текст в балунах альтернатив отображается корректно

    - platforms:
      - ios
      - android
    - tags:
        - assessors


  Контекстные балуны при мобильной сети:
    - info: |
        - Настройки -> Север всегда наверху - Off
        - Проверить работу при мобильной сети
    - do: |
        - Лонг-тап по карте
        - Выбрать "Сюда"
        - Подтвердить маршрут
        - Запустить debug симуляцию
        - Обратить вниманиие на контекстный балун (левый верхний угол)
    - assert: |
        - Контекстные балуны корректно отображаются. 
        - Информация в балунах следующей улицы и текущей корректно обновляется

    - platforms:
      - motrex
      - autochip
      - carsharing_t3
      - ios
      - nissan
      - android
    - tags:
        - assessors


  Контекстные балуны в оффлайн:
    - info: |
        - Настройки -> Север всегда наверху - Off
        - Скачать карты региона
        - Отключить интернет на устройстве
    - do: |
        - Построить маршрут, запустить симуляцию ведения. Дождаться появления контекстного балуна
    - assert: |
        - Контекстные балуны корректно отображаются. 
        - Информация в балунах следующей улицы и текущей корректно обновляется

    - platforms:
      - motrex
      - autochip
      - carsharing_t3
      - ios
      - nissan
      - android
    - tags:
        - assessors


  Полосность в балунах при настройке "Север всегда сверху":
    - info: |
        - Настройки -> Север всегда наверху - On
        - Dev.Set -> Misc -> Fast day night switching - On
        - Проверку проводить в больших городах (Москва, Питер) на  многополосных дорогах
        - Полосность будет отображаться только если до маневра меньше 1,5 км
    - do: Построить маршрут в любую точку и запустить ведение и дождаться пока в балуне маневра будет отображаться полосность
    - assert: |
        - Полосность отображается в балуне маневра зафиксированном в углу экрана
        - При смене темы день/ночь балун отображается в установленной теме
        - В балуне помещается название улицы и полосы движения, ничего не обрезано
        - Стрелки в балунах отображаются корректно
        - Подсвечены стрелки соответствуют необходимому маневру
    - do: Во время отображения полосности в балуне изменить ориентацию устройства
    - assert: |
        - Полосность также отображается в балуне маневра зафиксированном в углу экрана
        - При смене темы день/ночь балун отображается в установленной теме
        - В балуне помещается название улицы и полосы движения, ничего не обрезано
        - Стрелки в балунах отображаются корректно.
        - Подсвеченые стрелки соответствуют необходимому маневру
        - После совершения маневра полосность перестает отображаться (сразу может отобразиться следующий маневр - это ок)

    - testing:
        - acceptance_navi
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Полосность в балунах при настройке Север всегда сверху. Общественный транспорт:
    - info: |
        - Настройки -> Север всегда наверху - On
        - Dev.Set -> Misc -> Fast day night switching - On
        - Проверку проводить в больших городах (Москва, Питер) на  многополосных дорогах
        - Полосность будет отображаться только если до маневра меньше 1,5 км
    - do: |
        - Построить маршрут, на котором будут присутствовать выделенные для общественного транспорта полосы, и проехаться по нему.
    - assert: |
        - Полосность отображается в балуне маневра зафиксированном в углу экрана
        - В балунах присутствуют значки полос транспорта
        - Подсвеченые стрелки соответствуют необходимому маневру
    - do: Во время отображения полосности в балуне изменить ориетацию приложения на горизонтальную
    - assert: |
        - Полосность также отображается в балуне маневра зафиксированном в углу экрана
        - При смене темы день/ночь балун отображается в установленной теме
        - В балуне помещается название улицы и полосы движения, ничего не обрезано
        - Стрелки в балунах отображаются корректно.
        - Подсвеченные стрелки соответствуют необходимому маневру

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Проверка протапывания контекстного балуна:
    - info: Dev.Set -> Misc -> Fast day night switching - On
    - do: Построить любой маршрут и подтвердить его
    - assert: |
        - Маршрут построился
        - В углу появился контекстный балун
    - do: |
        - Сдвинуть карту, что бы под балуном был пин любой организации
        - Тап балун
    - assert: |
        - При тапе на балун происходит сдвиг карты к точке следующего маневра
        - Карточка организации не открывается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отображение времени в балуне альтернативы:
    - info: |
        - Dev.Set -> Misc -> Fast day night switching - On
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут на котором буду альтернативы
        - Выбрать самый длинный маршрут и подтвердить его
        - Запустить симуляцию движения через дебаг-панель
    - assert: |
        - На карте отображаются альтернативыные маршруту
        - У альтернатив отображаются балуны
        - В балунах отображается время насколько маршрут дольше или быстрее
    - do: Тап на балун альтернативы
    - assert: |
        - Альтернатива становится основным маршрутом
        - Балун альтернативы скрывается

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Округление расстояний в балуне:
    - do: Построить маршрут интентом [collapsed-image](https://jing.yandex-team.ru/files/zaidova/Снимок%20экрана%202022-04-28%20в%2017.38.06.png){title=QR-код}

        yandexnavi://build_route_on_map?lat_from=60.046925&lon_from=30.426992&lat_to=60.091950&lon_to=30.380805
    - do: Запустить симуляцию движения
    - assert: |
        Происходит ведение по маршруту
        В левом верхнем углу отображается балун маневра
        Расстояние в балуне более 3 километров
        Расстояние отображается в километрах в виде целого числа в формате **5 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит от 1 до 3 километров
    - assert: |
        Расстояние в балуне отображается в километрах в виде десятичного числа в формате **2,6 км**
        Целое количество километров (1, 2, 3 километра) отображаются в виде целого числа в формате **2 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит менее 1 километра
    - assert: |
        Расстояние в балуне отображается в метрах в виде целого числа в формате **600 м**
        Шаг округления расстояния составляет 10 метров (610 м, 600 м, 590 м)
        Число и единица измерения разделены пробелом

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Положение балуна при ведении по прямому участку:
    - info: |
        - Девайс в вертикальной ориентации
        - Настройки -> Север всегда наверху - Off
    - do: Построить маршрут интентом [collapsed-image](https://jing.yandex-team.ru/files/vladover/Снимок%20экрана%202022-07-22%20в%2015.13.56.png){title=QR-код}

        yandexnavi://build_route_on_map?lat_from=55.779256&lon_from=37.580040&lat_to=55.802178&lon_to=37.526138
    - do: Запустить симуляцию движения
    - assert: |
        На маршруте отображается балун, указывающий на ближайший маневр
        Балун не меняет своего положения относительно линии маршрута и продолжает указывать на тот же маневр
    - do: Сменить ориентацию устройства
    - assert: Балун не меняет своего положения относительно линии маршрута и продолжает указывать на тот же маневр
    - do: Дождаться сближения курсора и балуна
    - assert: |
        При приближении курсора к балуну, балун скрывается
        Появляется баллун следующего маневра 

    - platforms:
        - ios
        - android
    - tags:
        - assessors