components: alternatives
testing:
  - regress

specs:
  Отображение альтернатив маршрута:
    - info: Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий маршрут
        - Тап "Поехали"
    - assert: На карте отображаются альтернативные маршруты.

    - platforms:
      - geely
      - vaz
      - carsharing_t3
      - ios
      - android
      - t3am
      - motrex
      - autochip
      - renault
      - nissan
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit
    - tags:
      - assessors
      - mapkit_ready


  Переключение на альтернативный маршрут тапом на него:
    - info: Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап "Поехали"
    - assert: На карте отображаются альтернативные маршруты.
    - do: Тап на альтернативу (линию маршрута на карте)
    - assert: |
        - Альтернатива стала активным маршрутом
        - В ЕТА сохранился пройденный прогресс и обновился будущий путь (с учетом изменения длины маршрута и пробок)

    - platforms:
        - geely
        - vaz
        - carsharing_t3
        - ios
        - android
        - t3am
        - motrex
        - autochip
        - renault
        - nissan
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - myspin
    - tags:
        - assessors
        - both_myspin
        - mapkit_ready


  Переключение на альтернативный маршрут тапом на балун альтернативы:
    - info: Настройки -> Карты и интерфейс -> Альтернативные маршруты -> On
    - do: |
        - Построить маршрут, на котором предположительно будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап "Поехали"
    - assert: На карте отображаются альтернативные маршруты.
    - do: Тап на балун альтернативы.
    - assert: |
        - Альтернатива стала активным маршрутом
        - В ЕТА сохранился пройденный прогресс и обновился будущий путь (с учетом изменения длины маршрута и пробок)

    - platforms:
        - geely
        - vaz
        - carsharing_t3
        - ios
        - android
        - t3am
        - motrex
        - autochip
        - renault
        - nissan
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - myspin
    - tags:
        - assessors
        - both_myspin
        - mapkit_ready


  Автоматическое перестроение маршрута при съезде на альтернативу:
    - info: Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап "Поехали"
        - Запустить симуляцию движения по маршруту
    - assert: Курсор движется по маршруту
    - do: |
        - Тап на альтернативу
        - Дождаться, когда курсор доедет до альтернативы
    - assert: |
        - Симуляция маршрута поехала по изначальному маршруту
        - Альтернатива стала активным маршрутом
        - В ЕТА сохранился пройденный прогресс и обновился будущий путь (с учетом изменения длины маршрута и пробок)

    - platforms:
        - geely
        - vaz
        - carsharing_t3
        - ios
        - android
        - t3am
        - motrex
        - autochip
        - renault
        - nissan
    - tags:
        - assessors
        - both_myspin
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - myspin


  Отключение альтернатив маршрута:
    - info: |
        - Настройки -> Карты и интерфейс -> Альтернативные маршруты - Off
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап "Поехали"
    - assert: Альтернативы не отображаются

    - platforms:
      - geely
      - vaz
      - carsharing_t3
      - ios
      - android
      - t3am
      - motrex
      - autochip
      - renault
      - nissan
    - tags:
        - assessors
        - mapkit_ready
    - testing:
      - acceptance_navi
    - integration_run:
      - mapkit


  Балуны вариантов маршрута в обзоре. Тапы по балунам:
    - info: |
        - Dev. Set. -> Misc -> Fast day&night switching - On
        - Перезагрузить приложение
    - do: |
        - Построить маршрут, на котором будут альтернативы
    - assert: |
        - Произошло построение маршрута в указанную точку
        - На экране обзора к каждому маршруту приставлены балуны
        - Синий балун приставлен к текущей альтернативе
        - В синем балуне отображается время поездки
        - К остальным альтернативам приставлены бауны белого(светлая тема)/черного(темная тема) цвета
        - Время в белых/черных балунах указано в формате +/-n минут от времени текущей альтернативы
        - Время -n минут указано зеленым цветом, время +n минут указано красным цветом
    - do: Перебирать варианты маршрута тапом по балунам
    - assert: |
        - Выбираемый маршрут окрашивается в цвет пробок
        - Цвет и надписи балунов меняются по вышеописанной логике

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - parity
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Балуны вариантов маршрута при ведении. Тапы по балунам:
    - info: |
        - Dev. Set. -> Misc -> Fast day&night switching - On
        - Перезагрузить приложение
        - Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап на Поехали, запустить симуляцию ведения
        - Отскролить курту до ближайших альтернатив
    - assert: |
        - К альтернативным маршрутам приставлены бауны белого(светлая тема)/черного(темная тема) цвета
        - Время в белых/черных балунах указано в формате +/-n минут от времени текущей альтернативы
        - Время -n минут указано зеленым цветом, время +n минут указано красным цветом
    - do: Выбрать альтернативу тапом по балуну
    - assert: |
        - Выбираемый маршрут становится активным

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - parity
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Тап на линии и балуны альтернатив (Контекстное ведение):
    - info: |
        - Меню - Настройки - Север всегда сверху - Off
        - Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут с несколькими альтернативами и ближайшим маневром в пределах экрана
        - Запустить симуляцию ведения
    - assert: Курсор двигается по маршруту
    - do: |
        - Установить зум, при котором контекстный балун на маршруте будет перекрывать линию и/или балун альтернативы и подождать ~5 сек.
        - Потапать на линии и балуны альтернатив
    - assert: Активируются альтернативные маршруты
    - do: Тап на контекстный балун, перекрывающий линию или балун альтернативы
    - assert: |
        - Контекстный балун свернулся и переместился в угол
        - Появился таббар и кнопки
        - Альтернативный маршрут не активировался

    - platforms:
        - motrex
        - autochip
        - carsharing_t3
        - t3am
        - ios
        - nissan
        - android
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - mapkit


  Балуны вариантов маршрута. Промежуточные точки.:
    - info: Настройки -> Карты и интерфейс -> Альтернативные маршруты - On
    - do: |
        - Построить маршрут, на котором будут альтернативы
        - Выбрать самый долгий из вариантов
        - Тап на поехали
    - assert: |
        - Построен маршрут в указанную точку
        - К каждому маршруту приставлен балун, указывающий непосредственно на маршрут
    - do: |
        - Лонг-тап в любом месте на карте
        - Тап “Через”
    - assert: Маршрут перестроен, балуны отображаются у новых альтернатив
    - do: |
        - Лонг-тап по промежуточной точке
        - Перенести промежуточную точку в другое место
    - assert: Маршрут перестроен, балуны отображаются у новых альтернатив
    - do: Сбросить маршрут
    - assert: Балуны скрылись

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Балуны вариантов маршрута в оффлайне. Промежуточные точки:
    - info: |
        - Меню - Загрузка карт - Скачать оффлайн карты двух соседних областей
        - Отключить интернет на устройстве
    - do: Построить маршрут между регионами, карты которых скачаны
    - assert: |
        - Маршрут построен
        - На экране обзора отображается один вариант маршрута в оффлайне, окрашенный в синий цвет
        - К маршруту приставлен балун.
    - do: |
        - Лонг-тап в любом месте на карте
        - Тап “Через”
    - assert: Маршрут перестроен, балун отображается у нового маршрута
    - do: |
        - Лонг-тап по промежуточной точке
        - Перенести промежуточную точку в другое место
    - assert: Маршрут перестроен, балун отображается у нового маршрута
    - do: Сбросить маршрут
    - assert: |
        - Маршрут сброшен 
        - На карте не отображаются: линия маршрута и балун 

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Отображение балунов вариантов маршрута в обзоре при зуме карты:
    - do: Построить маршрут, на котором предположительно будут альтернативы
    - assert: |
        - Произошло построение маршрута в указанную точку.
        - На экране обзора к каждому из вариантов приставлен балун.
    - do: Двигать и зумить карту в области маршрутов
    - assert: |
        - Балуны значительно не пересекают маршрут, умещаются в экран полностью
        - Перестраиваются по необходимости раз в две секунды или по окончанию движения камеры

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Отображение балунов вариантов маршрута в обзоре при перетаскивании финиша:
    - do: Построить маршрут, на котором будут альтернативы
    - assert: |
        - Построен маршрут в указанную точку
        - На экране обзора к каждому из вариантов приставлен балун
    - do: Двигать пин финиша
    - assert: Маршрут перестроен, балуны отображаются у новых альтернатив

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Балуны вариантов маршрута в обзоре в оффлайне:
    - info: |
        - Меню - Загрузка карт - Скачать оффлайн карты двух соседних областей
        - Отключить интернет на устройстве
    - do: |
        - Построить маршрут между регионами, карты которых скачаны
    - assert: |
        - Маршрут построен
        - Отображается один вариант маршрута в оффлайне, окрашенный в синий цвет
        - У маршрута отображается балун
    - do: Двигать и зумить карту в области маршрута
    - assert: |
        - Балун значительно не пересекает маршрут, умещается в экран полностью.
        - Перестраивается по необходимости раз в две секунды или по окончанию движения камеры.
    - do: Двигать конечный пин
    - assert: Маршрут перестроен, балун отображается у нового маршрута
    - do: Сбросить маршрут
    - assert: Балун скрылся

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Проверка цветов альтернативных маршрутов в обзоре в дневной и ночной темах:
    - info: |
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
        - Developer settings -> Misc -> Fast day & night switching - On
        - Перезапустить приложение.
    - do: Построить маршрут с альтернативными вариантами, когда приложение в дневном режиме.
    - assert: |
        Цвет альтернативных маршрутов в светлой теме - синий
        Места, где образовалась пробка, соответствующие на активном маршруте:
        - красному цвету, окрашены в более темный синий.
        - бордовому цвету, выделены конкретно темно-синим цветом.
        - желтому цвету, не выделяется никак, маршрут там окрашен обычным синим.
    - do: Дождаться смены темы на темную
    - assert: |
        Альтернативные маршруты перекрашиваются в фиолетовый цвет
        Места, где образовалась пробка, соответствующие на активном маршруте:
        - красному цвету, окрашены в темный фиолетовый
        - бордовому цвету, выделены конкретно темно-фиолетовым цветом
        - желтому цвету, не выделяется никак, маршрут там окрашен обычным фиолетовым цветом.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - map_search


  Проверка цветов альтернативных маршрутов при ведении:
    - info: |
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
        - Developer settings -> Misc -> Fast day & night switching - On
        - Перезапустить приложение.
    - do: |
        - Построить маршрут с альтернативными вариантами, когда приложение в дневной теме
        - Выбрать самый длительный маршрут
        - Тап Поехали
    - assert: Начинается ведение по маршруту
    - do: Отскроллить карту до ближайшей альтернативы
    - assert: |
        Цвет альтернативных маршрутов соответствует дневной теме - синий
        Места, где образовалась пробка, соответствующие на активном маршруте:
        - красному цвету, окрашены в более темный синий.
        - бордовому цвету, выделены конкретно темно-синим цветом.
        - желтому цвету, не выделяется никак, маршрут там окрашен обычным синим.
    - do: Дождаться смены темы на темную.
    - assert: |
        Альтернативные маршруты перекрашиваются в фиолетовый цвет.
        Места, где образовалась пробка, соответствующие на активном маршруте:
        - красному цвету, окрашены в более темный фиолетовый.
        - бордовому цвету, выделены конкретно темно-фиолетовым цветом.
        - желтому цвету, не выделяется никак, маршрут там окрашен обычным фиолетовым цветом.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit
        - map_search


  Отсутствие альтернатив при сбросе маршрута:
    - info: |
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
        - Developer settings -> Misc -> Fast day & night switching - On
        - Перезагрузить приложение
    - do: |
        - Построить маршрут с альтернативными вариантами
        - Тап Поехали
    - assert: Маршрут подтвержден
    - do: Сбросить маршрут тапом по крестику в ЕТА
    - assert: |
        - Маршрут сброшен
        - На карте не отображаются альтернативные маршруты

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Скрытие альтеранативы:
    - info: |
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
        - Developer settings -> Misc -> Fast day & night switching - On
        - Перезагрузить приложение
    - do: |
        - Построить маршрут с альтернативными вариантами
        - Запустить ведение через дебаг-панель
        - Проехать развилку с альтернативой
    - assert: Альтернатива скрывается

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit


  Альтернативы с платной дорогой:
    - info: |
        - Настройки -> Карта и интерфейс -> Альтернативные маршруты - On
        - Настройки - Избегать платные дороги - Off
        - Developer settings -> Misc -> Fast day & night switching - On
        - Перезагрузить приложение
    - do: |
        - Построить маршрут на котором будут платные альтернативы
        - Выбрать маршрут без платной дороги
        - Подтвердить маршрут
    - assert: |
        - Маршрут подтвержден
        - На экране отображаются альтернативные маршруты
        - У альтернатив с платной дорогой отображается балун со знаком платной дороги
    - do: Тап по альтернативе через платную дорогу
    - assert: Маршрут перестроен
    - do: Тап Обзор в таббаре
    - assert: Выбран активный маршрут через платную дорогу

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - testing:
        - acceptance_navi
    - integration_run:
        - mapkit