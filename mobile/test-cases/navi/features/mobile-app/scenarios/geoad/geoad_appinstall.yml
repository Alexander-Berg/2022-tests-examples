components: geoad_appinstall
testing:
  - regress

specs-integration:
  aliases:
    - &Инфогеодапинстал
      - info: |
          - Использовать интенты по очереди:
            [collapsed-image](https://jing.yandex-team.ru/files/midway/download-7.png){title=QR-код}

            `yandexnavi://reset_exp`
          - Перезапустить приложение
            [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download.7ed8e87.png){title=QR-код}

            `yandexnavi://set_ad_page_id?page_id=null`
            [collapsed-image](https://jing.yandex-team.ru/files/midway/download-2-1.png){title=QR-код}

            `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad&navi_ads_overview_ad_queue=geo_ad_location,geo_ad_route&navi_ad_product_cooldown_overview_banner=30&navi_feature_day_night_fast_switch=enabled`
            [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/testing_overview_resolve_appinstall.png){title=QR-код}

            `yandexnavi://set_ad_page_id?page_type=overview_geo_ad&page_id=overview_banner_6/testing_overview_resolve_appinstall`

          - Dev. Set. -> Misc -> Debug config enable - On
          - Перезапустить приложение
    - &Построение_маршрута_геоэд_апинстал_шаг
      - do: |
          - Построить любой маршрут по Москве
          - Тап по баннеру
    - &Построение_маршрута_геоэд_апинстал_результат
      - assert: |
          - Баннер GeoAd закрывается
          - Открывается поп-ап с заголовком, основным текстом, кнопками ОК/Отмена.

specs:
  GeoAd AppInstall проверка UI поп-апа:
    - *Инфогеодапинстал
    - info: |
        - Девайс в вертикальной ориентации
    - do: Построить любой маршрут по Москве
    - assert: |
        - Над карточкой обзора появляется баннер GeoAd
        - Картинка баннера не обрезана, отображается без рамок.
    - do: Тап по баннеру
    - assert: |
        - Баннер GeoAd закрывается
        - Открывается поп-ап с заголовком, основным текстом, кнопками ОК/Отмена
        - Текст помещается в поп-ап
        - Кнопки активны
        - Кнопка ОК справа, Отмена – слева.
    - do: Сменить ориентацию девайса
    - assert: |
        - При смене ориентации поп-ап не пропадает, не разъезжается.
        - Баннер GeoAd скрывается

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка UI баннера:
    - *Инфогеодапинстал
    - do: |
        - Построить любой маршрут по Москве
    - assert: |
        - Над карточкой обзора появляется баннер GeoAd
    - do: Посмотреть на отображенния баннера
    - assert: |
        - Баннер отображается на всю ширину экрана "Обзор Маршрута"
        - Картинка не обрезана
        - UI не ломается
    - do: |
        - Сменить ориентацию
    - assert: |
        - Баннер отображается на всю ширину экрана "Обзор Маршрута"
        - Картинка не обрезана
        - UI не ломается

    - platforms:
      - ios
      - android


  GeoAd AppInstall логирование взайимодействия с баннером:
    - *Инфогеодапинстал
    - info: Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: Построить любой маршрут по Москве
    - assert: |
        - Над карточкой обзора появляется баннер GeoAd
        В логи приходят события:
        - `geoadv.bb.pin.show` - навигатор
        - `mapkit.search.logger.billboard.show` - МапКит
        - `route.geo-ad-visibility` с параметром `visible: true`
    - do: Тап по баннеру
    - assert: |
        - Баннер GeoAD закрывается
        - Открывается поп-ап с заголовком, основным текстом, кнопками ОК/Отмена.
        В логи приходят события:
        - `geoadv.bb.pin.tap` - навигатор
        - `mapkit.search.logger.billboard.click` - МапКит
        - `route.geo-ad-click` с параметром `isUri= true`
        - `route.geo-ad-visibility` с параметром `visible: false`

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  GeoAd AppInstall проверка в оффлайне:
    - *Инфогеодапинстал
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: |
        - Отключить интернет
        - Тап на кнопку ОК
    - assert: |
        - Происходит переход в браузер
        - Страница не загружается

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка работы кнопки ОК(Рекламное приложение не установлено):
    - *Инфогеодапинстал
    - info: |
        - Браузер по умолчанию установлен на девайсе
        - Рекламное приложение не установлено
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап по кнопке ОК
    - assert: |
        - Открывается браузер, выбранный по умолчанию
        - Происходит переход из браузера в магазин приложений
        - Открывается рекламное приложение в магазине с кнопкой "Скачать"
        - Открытие ссылки в браузере не дублируется (нет задублированных вкладок с этой ссылкой)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка работы кнопки ОК(Рекламное приложение установлено):
    - *Инфогеодапинстал
    - info: |
        - Браузер по умолчанию установлен на девайсе
        - Рекламное приложение установлено
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап по кнопке ОК
    - assert: |
        - Открывается браузер, выбранный по умолчанию
        - Происходит переход из браузера в магазин приложений
        - Открывается рекламное приложение в магазине с кнопкой "Открыть"
        - Открытие ссылки в браузере не дублируется (нет задублированных вкладок с этой ссылкой)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка работы кнопки ОК на Android (Браузер по умолчанию не выбран):
    - *Инфогеодапинстал
    - info: |
        - Браузер по умолчанию не установлен на девайсе
        - Рекламное приложение не установлено
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап по кнопке ОК
    - assert: |
        - Открывается диалоговый экран с выбором браузера
    - do: Выбрать любой бразуер
    - assert: |
        - При выборе браузера происходит открытие в нём трекинговой ссылки
        - Происходит переход из браузера в магазин приложений
        - Открывается магазин приложений
        - Открывается рекламное приложение в магазине с кнопкой "Установить"
        - Открытие ссылки в браузере не дублируется (нет задублированных вкладок с этой ссылкой)

    - platforms:
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall логирование кнопки ОК:
    - *Инфогеодапинстал
    - info: |
        - Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап по кнопке ОК
    - assert: |
        В логи приходят события:
        - `geoadv.bb.action.openSite` - Навигатор
        - `mapkit.search.logger.billboard.action.open_site` - МапКит
        - `geoadv.bb.action.dialog.ok`

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  GeoAd AppInstall скрытие поп-апа на iOS тапом по карте :
    - *Инфогеодапинстал
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: |
        - Тап по Карте
    - assert: Поп-ап не скрывается
    - do: Тап на отмена в поп-апе
    - assert: Поп-ап скрывается

    - platforms:
        - ios
    - testing:
        - acceptance_navi


  GeoAd AppInstall скрытие поп-апа на Android тапом по карте :
    - *Инфогеодапинстал
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: |
        - Тап по Карте
    - assert: Поп-ап скрывается

    - platforms:
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall скрытие поп-апа на Android тапом по кнопке Отмена:
    - *Инфогеодапинстал
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: |
        - Тап по кнопке отмена
    - assert: Поп-ап скрывается

    - platforms:
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка системной кнопки Back на Android:
    - *Инфогеодапинстал
    - do: |
        - Построить любой маршрут по Москве
        - Тап по баннеру
        - Тап на системную кнопку back
    - assert: |
        - Поп-ап закрывается
        - GeoAd не отображается
        - Карта и элементы интерфейса тапабельны

    - platforms:
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall логирование скрытие поп-апа:
    - *Инфогеодапинстал
    - info: |
        - Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап по кнопке Отмена
    - assert: |
        - Поп-ап закрывается
        - Баннер не отображается.
        В логи приходит событие: `geoadv.bb.action.dialog.cancel`

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi
    - tags:
        - metric


  GeoAd AppInstall логика скрытия баннера при открытии браузера:
    - *Инфогеодапинстал
    - info: |
        - Бразуер по умолчанию выбран
        - Рекламное приложение не установлено на девайсе
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап на ОК
    - assert: |
        - Открывается браузер, выбранный по умолчанию
        - Происходит переход из браузера в магазин приложений
        - Открывается рекламное приложение в магазине с кнопкой "Скачать"
        - Открытие ссылки в браузере не дублируется (нет задублированных вкладок с этой ссылкой)
    - do: После открытия ссылки вернуться в навигатор
    - assert: |
        - При возврате в приложение после открытия ссылки - баннер скрыт
        - Карта и интерфейс остаются тапабельными

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_navi


  GeoAd AppInstall проверка логики скрытия при невыбранном браузере на Android:
    - *Инфогеодапинстал
    - info: |
        - На устройстве не выбран браузер по умолчанию
    - *Построение_маршрута_геоэд_апинстал_шаг
    - *Построение_маршрута_геоэд_апинстал_результат
    - do: Тап на ОК
    - assert: |
        - Отображается диалог выбора браузера
        - Баннер GeoAd скрывается сразу после тапа по нему
    - do: Закрыть диалог выбора браузера, не совершив выбор
    - assert: |
        - Диалог выбора браузера закрывается
        - Баннер скрыт
        - Карта и интерфейс остаются тапабельными

    - platforms:
        - android
    - testing:
        - acceptance_navi