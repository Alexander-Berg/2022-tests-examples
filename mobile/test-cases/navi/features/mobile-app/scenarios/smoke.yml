components: smoke
platforms:
  - ios
  - android
testing:
  - smoke_navi

specs:
  Авиарежим. Определение местоположения:
    - info: Запущен навигатор.
    - do: |
        - Включить на девайсе авиарежим
        - Перезагрузить приложение
    - assert: |
        - Открывается главный экран приложения
        - Отображается либо курсор, либо метка “Я”, вокруг метки “Я” выделена область
    - do: Выключить авиарежим на девайсе
    - assert: Отображается курсор


  Построение, подтверждение и сброс маршрута лонг-тапом:
    - info: |
        Запущен навигатор
        На устройстве включен звук
    - do: |
        - Выполнить лонг-тап в любой области на карте
        - Выбрать "Сюда".
    - assert: |
        - Открывается экран обзора
        - Отображаются альтернативные маршруты
        - Выбран самый оптимальный маршрут
        - Звучит аннотациия о построенном маршруте
    - do: Подтвердить построение маршрута
    - assert: |
        - Маршрут построен
        - Отображается ЕТА
    - do: |
        - Тап на крестик у ЕТА
        - Подтвердить отмену маршрута в появившемся окне
    - assert: Маршрут сброшен


  Построение маршрута из избранного и отмена в момент выбора:
    - info: |
        Запущен навигатор
        В избранное добавлена хотя бы одна точка
    - do: |
        Открыть избранное
        Тап по любой точке из избранного
    - assert: |
        - Открывается экран обзора
        - Отображаются альтернативные маршруты
        - Выбран самый оптимальный маршрут
    - do: Тап на кнопку "Отмена"
    - assert: Построение маршрута отменено


  Проверка Авторизации:
    - info: Запущен навигатор
    - do: |
        Открыть меню
        Тап по кнопке "Войти"
    - assert: Открывается WebView авторизации
    - do: |
        - Ввести данные существующей учетной записи
        - Подтвердить вход
    - assert: |
        - Произошла авторизация
        - Открыто меню, вместо "Войти" отображается имя или логин пользователя


  Установка любой ДС:
    - info: |
        Запущен навигатор
        Пользователь авторизован
    - do: Лонг-тап по карте
    - assert: Открывается лонг-тап меню
    - do: |
        - Выбрать "Установить"
        - Выбрать любой тип ДС
        - Тап "Установить"
    - assert: |
        - Лонг-тап меню скрывается
        - Устанавливается выбранный тип ДС


  Запуск музыки:
    - info: |
        Запущен навигатор и пользователь авторизован с активной музыкой
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
    - do: Тап на тапбар музыки
    - assert: Открывается интерфейс музыки
    - do: Запустить любую композицию
    - assert: Прогрывается композиция


  Разлогин:
    - info: |
        Запущен навигатор
        Пользователь авторизован
    - do: |
        - Открыть меню
        - Тап по кнопке "выйти"
    - assert: Пользователь разлогинен


  Добавление и удаление в избранном:
    - info: Запущен навигатор
    - do: |
        - Лонг-тап по карте
        - В лонг-тап меню выбрать "в мои места"
        - Выбрать папку "избранное"
    - assert: Появляется поле для заполнения названия точки
    - do: |
        - Указать любое имя
        - Подтвердить
    - assert: Точка добавлена в избранное
    - do: |
        - Открыть избранное
        - Включить режим редактирования
        - Выбрать точку
        - Тап на удалить
    - assert: Появлется поп-ап удаления
    - do: Подтвердить удаление
    - assert: Точка удалена из избранного


  Поиск по адресу:
    - info: |
        Запущен навигатор, используется поиск МЯК
    - do: |
        - Открыть поиск
        - Ввести сууществующий адрес в строку поиска
        - Подтвердить поиск
    - assert: |
        - Начался поиск по искомому адресу
        - Варианты отображаются на карте


  Поиск по категории:
    - info: Запущен навигатор
    - do: |
        - Открыть поиск
        - Тап по любой категории из списка (например, аптека)
    - assert: |
        - Начался поиск по искомой категории (например, аптека)
        - На карте отображаются точки объектов, соответствующих искомой категории (например, аптеки)


  Вызов Алисы голосом:
    - info: |
        Запущен навигатор
        Выдано разрешение на доступ к микрофону
    - do: Сказать "привет алиса"
    - assert: |
        - Вызывается Алиса
        - Отображается интерфейс Алисы
    - do: Сказать "поехали в Бургер Кинг"
    - assert: Алиса строит маршрут до ближайшего Бургера Кинга


  Вызов Алисы кнопкой:
    - info: |
        Запущен навигатор
        Выдано разрешение на доступ к микрофону
    - do: Вызвать Алису тапом по кнопке
    - assert: |
        - Вызывается Алиса
        - Отображается интерфейс Алисы
    - do: Сказать "Какая сегодня погода?"
    - assert: Алиса сообщает погоду
    - do: Тап по саджесту у Алисы
    - assert: Алиса реагирует на выбранный саджест и корректно отвечает


  Использовать mapkitsim замоканные:
    - info: |
        mapkitsim доступен только в inhouse-сборке
        Запущен навигатор
    - do: |
        - Открыть debbug панель
        - Выбрать любой замоканный mapkitsim(тап Mock-mapkitsim-4261)
        - Запустить его
    - assert: |
        Через несколько секунд mapkitsim начинает воспроизведение
        Происходит ведение по маршруту
        Произносятся аннотации


  Наличие деталей в маршруте:
    - info: |
        Запущен навигатор
        На устройстве включен звук
        Пользователь не авторизован
        Не менялись настройки аннотации после первого запуска
    - do: |
        - Построить любой маршрут
        - Запустить debug симуляцию
        - Проверить наличие элементов ведения по маршруту
    - assert: |
        - Отображается ближайший маневр
        - Есть аннотации о маневрах / дс


  Взаимодействие с картой (скролл/зумм/тач):
    - info: Запущен навигатор
    - do: Двумя пальцами делать зум/отзум карты
    - assert: Выполняется Зум/Отзум карты
    - do: Листать карту
    - assert: Карта успешно листается
    - do: Дабл-тап по карте
    - assert: Карта зумиться
    - do: Дабл-тап по карте и не отпуская пальца свайп влево (медленно) или вниз
    - assert: Карта зумиться
    - do: Дабл-тап по карте и не отпуская пальца свайп вправо (медленно) или верх
    - assert: Карта отдаляется (отзум)


  Открытие меню:
    - info: Запущен навигатор
    - do: Открыть меню
    - assert: Открывается меню
    - do: Открыть раздел "О программе"
    - assert: Открывается раздел "О программе"
    - do: Сделать 5 тапов по иконке приложения
    - assert: Открывается debug-info


  Штрафы:
    - info: Запущен навигатор
    - do: |
        - Открыть меню
        - Тап на "Штрафы ГИБДД"
    - assert: Открывается экран штрафов
    - do: Перейти к вводу данных бумажного постановления
    - assert: Отображается экран с полем для ввода номера постановления
    - do: Ввести номер любого постановления
    - assert: Штраф успешно найден и отображается


  Парковки:
    - info: |
        Dev set -> Parking -> parking_landing_ampp_url указан любой url (например, https://www.google.ru)
        Открыт спан г. Москвы
    - do: |
        - Включить парковочный слой
        - Построить любой маршрут
    - assert: Парковочные артефакты отображаются корректно, не наезжают на линию маршрута, ДС, ПИНы, балуны
    - do: Тап на любую платную парковку(шильдик с не нулевой ценой)
    - assert: Открывается карточка парковки
    - do: Тап на кнопку "Как оплатить"
    - assert: Открывается url, указанный в значении эксперимента parking_landing_ampp_url


  Заправки открытие UI:
    - info: Запущен навигатор
    - do: Тап по кнопке заправочного слоя
    - assert: На карте отображаются пины заправок
    - do: Тап по любому пину заправки на карте
    - assert: Открывается карточка заправки


  Поймать любой ZSB (не геомедийный):
    - info: |
        - Dev. Set. -> Misc -> Debug config enable - On
        - Использовать интенты:
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-4.7e0aa5e.png){title=QR-код iOS}

          `yandexnavi://set_ad_page_id?page_type=zero_speed_yas_source&page_id=R-IM-588231-9`
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-5.2e69065.png){title=QR-код Android}

          `yandexnavi://set_ad_page_id?page_type=zero_speed_yas_source&page_id=R-IM-588230-9`
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-14.7a6b2c6.png){title=QR-код}

          `yandexnavi://add_exp?navi_feature_tgo_zsb=enabled&navi_zero_ads_use_yas_ad=enabled&navi_feature_zsb_statuses_logging=enabled&navi_feature_day_night_fast_switch=enabled&navi_ad_product_cooldown_zero_speed_banner=10&navi_ads_logging_zsb_closing_errors=enabled`
        - Перезапустить приложение
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB


  Любая реклама в обзоре:
    - info: |
        - Dev. Set. -> Misc -> Debug config enable - On
        - Использовать интенты:
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-2.05d2a84.png){title=QR-код}

          `yandexnavi://set_ad_page_id?page_type=overview_geo_ad&page_id=overview_banner_6/testing_overview_regular_site`
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-3.0b57607.png){title=QR-код}

          `yandexnavi://add_exp?navi_overview_ads_priority_for_RU=overview_geo_ad,brand_route,via&navi_ads_overview_ad_queue=geo_ad_location,geo_ad_route,direct,yas&navi_ad_product_cooldown_overview_banner=60&navi_feature_day_night_fast_switch=enabled`
        - Перезапустить приложение
    - do: Построить маршрут мимо БЦ Красная Роза (Москва, ул.Льва Толстого 16)
    - assert: |
        Над карточкой обзора возникает OverviewGeoAd - представлен карточкой с баннером в виде картинки в хедере с закругленными верхними краями и указанием “Реклама”
        Содержит:
        - заголовок(допускается неполное отображение)
        - дисклеймер
        - текст карточки фиксированного размера
    - do: |
        Раскрыть карточку.
        Проскроллить весь текст, просмотреть карточку полностью.
    - assert: |
        Карточка представлена:
        - Баннером
        - Текстом акции/предложения и др.
        - Контролами (экшены) в виде ссылок( обернутых текстом) - кнопки “Телефон”, “Найти на карте”,“Сохранить”
        - Дисклеймером.
    - do: Тап по имеющимся контролам карточки
    - assert: |
        Присутствие всех контролов не обязательно
        По тапу на:
        **Позвонить** - производится переход в приложение для звонков. Номер набран и соответствует указанному в карточке. Приложение не крашится;
        **Найти на карте** - происходит поиск, маршрут (если был) не сбрасывается, по результату маршрута на карте отображается результат поиска в виде пинов;
        **Сохранить** - предложение сохраняется, кнопка сменяется на кнопку “Посмотреть”;
        **На сайт** - происходит переход на сайт.
        **Закрыть** - баннер закрывается.
    - do: |
        Повернуть девайс в альбомную ориентацию и повторить пункты 1-3.
        На шаге 2 при раскрытой и свернутой карточке произвести поворот устройства с портретной в альбомную ориентацию и обратно.
    - assert: |
        Поведение GeoAd не меняется в зависимости от положения устройства -
        при смене ориентации устройства отображение и взаимодействие с GeoAd соответствует основным требованиям.


  Любой пин на маршруте:
    - info: |
        - Dev. Set. -> Misc -> Debug config enable - On
        Использовать интенты:
          - [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download-1.2cdb466.png){title=QR-код}

          `yandexnavi://set_ad_page_id?page_type=route&page_id=navi_billboard_7/testing_pin_call_by`
        - Перезапустить приложение
    - do: Через дебаг-панель запустить MAPKITSIM-4261
    - assert: Отображается брендированный пин по маршруту
    - do: Тап по пину
    - assert: Открывается карточка организации


  Любой биллборд:
    - info: |
        - Dev. Set. -> Misc -> Debug config enable - On
        Использовать интенты:
          - [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/testing_billboard_call_site.png){title=QR-код}

          `yandexnavi://set_ad_page_id?page_type=route&page_id=navi_billboard_7/testing_billboard_call_site`
        - Перезапустить приложение
    - do: Через дебаг-панель запустить MAPKITSIM-4261
    - assert: Рядом с маршрутом отображается рекламный биллборд
    - do: Тап на биллборд
    - assert: Открывается карточка Биллборда


  Жук + отправка mapkitsim:
    - info: |
        Запущен навигатор
        Выполнена авторизация с яндексовым акканутом
    - do: Тап на кнопку жука на карте
    - assert: Отображается тост "Спасибо" на карте
    - do: |
        - Открыть меню
        - Тап "Баг-репорт о поездке"
    - assert: Открывается меню со списком отметок по Жуку
    - do: |
        - Тап на любой трек из списка
        - Указать название
        - Тап "сохранить"
    - assert: mapkitsim отправлен


  Успешное подключение к CarPlay:
    - do: Запустить CarPlay, подключившись к подходящей для этого ГУ
    - assert: |
        - CarPlay запускается
        - В списке приложений (меню) CarPlay присутствует Навигатор


  Успешное подключение к AndroidAuto:
    - do: Запустить AndroidAuto, подключившись к подходящей для этого ГУ
    - assert: |
        - AndroidAuto запускается
        - В списке приложений (меню) AndroidAuto присутствует Навигатор


  Отображение и скрытие геомедийного ZSB:
    - info: |
        - Dev. Set. -> Misc -> Debug config enable - On
        - Использовать интенты:
          [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/testing_zsb_regular.png){title=QR-код}

          `yandexnavi://set_ad_page_id?page_type=zero_speed&page_id=navi_zero_speed_banner_10/testing_zsb_regular`
          [collapsed-image](https://jing.yandex-team.ru/files/mikhail-vin/download.aa02dcc.png){title=QR-код}

          `yandexnavi://add_exp?navi_feature_zsb_statuses_logging=enabled&navi_feature_day_night_fast_switch=enabled&navi_ad_product_cooldown_zero_speed_banner=10`
        - Перезапустить приложение
    - do: |
        - Запустить проигрывание MAPKITSIM-4261
        - Дождаться остановки движения перед светофором
    - assert: |
        - Приложение перешло в режим ведения
        - На остановке появляется баннер ZSB
    - do: |
        - Не взаимодействовать с картой, контроллами и самим баннером ZSB
        - Продолжить движение с отображаемым ZSB.
    - assert: ZSB автоматически скрывается


  Ведение по маршруту. Линия маршрута, элементы дороги:
    - info: |
        Включить настройки:
        DevSettings -> Misc -> Fast day&night switching вкл (для автоматической смены дня/ночи)
    - do: |
       - Построить маршрут через несколько ДС.
       - Тап на "Поехали"
    - assert: |
       - Строится маршрут.
       - Линия маршрута выделена цветом, в зависимости от пробок на маршруте.
    - do: Отскролить карту по всей длине маршрута
    - assert: |
       - Визуально линия маршрута шире относительно дороги.
       - ДС, светофоры и названия улиц отображаются над линией маршрута.


  Поделиться точкой из Навигатора через Лонг-Тап меню:
    - info: Открыт главный экран приложения
    - do: лонг-тап на карте
    - assert: открывается Лонг-Тап меню, в котором в правом нижнем углу есть кнопка Поделиться
    - do: тап "Поделиться"
    - assert: открывается список программ для шаринга
    - do: выбрать программу и пользователя для передачи (например Telegram)
    - assert: точка доставлена выбранному контакту
    - do: тап на переданную точку в стороннем приложении
    - assert: происходит переход в Навигатор, на экране карточка с кнопкой Маршрут для переданной точки

    - tags:
        - assessors


  Поделиться точкой из Навигатора через Карточку организации:
    - info: Открыт главный экран приложения
    - do: тап на пин организации
    - assert: переход к карточке организации
    - do: тап на кнопку Поделиться в карточке организации
    - assert: открывается список программ для шаринга
    - do: выбрать программу и контакт для передачи точки (например Telegram)
    - assert: точка доставлена выбранному контакту
    - do: тап на переданную точку в стороннем приложении
    - assert: происходит переход в Навигатор, на экране карты карточка с кнопкой Маршрут

    - tags:
        - assessors


  Оплата Самовывоза Еды с помощью карты:
    - info: |
        Открыт главный экран приложения
        Пользователь авторизован аккаунтом с картой
    - do: |
        Developer settings -> Search -> Show Eda takeaway - ON
        Перезапустить приложение
        Для возврата личных средств, затраченных в целях тестирования (если не успели отменить заказ) использовать [инструкцию] (https://wiki.yandex-team.ru/jandekskarty/testing/navi/rasxody-po-korp-karte/)
    - do: Открыть полную карточку организации с поддержкой заказа еды на вынос
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды
    - do: Добавить товар в корзину
    - assert: Появилась кнопка оформления заказа
    - do: Тап на кнопку оформления заказа
    - assert: Открылась форма оформления заказа
    - do: Тап на кнопку "Далее"
    - assert: Открылся блок для подтверждения данных оплаты и получения заказа
    - do: Тап на кнопку "Оплатить"
    - assert: |
        Происходит успешная оплата
        Открывается экран со статусом заказа
    - do: Тап на кнопку  "Отменить заказ"
    - assert: |
        Заказ отменен
        Средства возвращены на карту (может потребоваться несколько минут)


  Подключение к MySpin:
    - do: Подключить телефон физически к гу (кабель + блютуз)
    - assert: Запускается проджектед режим в котором работает навигатор на ГУ

    - platforms:
      - renault
      - nissan


  Открытие и просмотр содержимого карточки организации:
    - info: Открыт главный экран приложения
    - do: Тап на пин любой организации на карте
    - assert: Открыта мини-карточка организации
    - do: Свайпом развернуть карточку в полный вид
    - do: Проскроллить содержимое карточки вниз
    - assert: Элементы в карточке отображаются и не перекрывают друг друга, текст читабельный
    - do: Перейти по всем имеющимся табам (при наличии других таб кроме "Обзор")
    - assert: Приложение работает стабильно, информация отображается, текст читабельный


  Построение маршрута из карточки организации:
    - info: Открыт главный экран приложения
    - do: Тап на пин любой организации на карте
    - assert: Открыта мини-карточка организации
    - do: Тап на кнопку "Маршрут"
    - assert:  |
        Открывается экран обзора маршрута
        Отображаются альтернативные маршруты
        Выбран самый оптимальный маршрут


  Просмотр сохраненных и недавних мест:
    - info: |
        Открыт главный экран приложения
        В избранное добавлена хотя бы одна точка
        После установки приложения был построен хотя бы один маршрут
    - do: Тап в таббаре по кнопке избранного
    - assert: Открыт экран "Мои места", таб "Сохраненные"
    - do: Тап по табу "Недавние"
    - assert: |
        Открыт экран "Мои места", таб "Недавние"
        Отображается список построенных ранее маршрутов
    - do: Тап по табу "Сохраненные"
    - assert: |
        Открыт экран "Мои места", таб "Сохраненные"
        Отображаются места, добавленные в избранное


  UI ведения по маршруту:
    - info: Открыт главный экран приложения
    - do: Построить маршрут в любую точку
    - assert: Открыт экран обзора маршрута
    - do: |
        - Тап "Поехали"
        - Подождать ~2-5 секунд
    - assert: |
        Запускается режим ведения:
        - Отображается карта
        - Отображается полоса маршрута внизу экрана (с отображением: дистанции, времени прибытия, времени в пути)
        - Отображается сам маршрут
        - Ближайший маневр
        - Дорожные События на маршруте (могут не быть на маршруте)
        - Текущая скорость (белый круг в правом верхнем углу)
        - Ограничение скорости в текущей точке (круг в красной окантовке в правом верхнем углу)
    - do: |
        - Запустить движение по маршруту (через дебаг панель)
        - Подождать ~5 секунд
    - assert: |
        Запускается режим ведения:
        - Курсор начинает движение по маршруту
        - Текущая скорость начинает расти и отображается та, которая указана в дебаг меню
        - Может меняться ограничение скорости
