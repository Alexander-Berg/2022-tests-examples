components: route_balloons
testing:
  - regress

aliases:
#Включение симуляции движения:
  - &demo-movement
    - do: Включить симуляцию движения (Меню -> Настройки -> Debug Panel -> Routes -> Demo Movement)
#Пресет для отображения балунов на линии маршрута
  - &baloon-on-line
    - do: Включить симуляцию движения (Меню -> Настройки -> Debug Panel -> Routes -> Demo Movement)
    - do: Выключить настройку "Север всегда сверху" (Меню -> Настройки -> Маршруты)

  #Включить старый десигн настроек
  - &old_ui_settings
    - do: Выключить эксперименты `use_datasync_settings` и `new_maps_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Закрыть дебаг панель
    - do: Перезапустить приложение
  #Включить новый десигн настроек
  - &new_ui_settings
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/new_maps_settings.png){title=QR-код}

        `yandexmaps://add_exp?new_maps_settings`
    - do: Перезапустить приложение
#Дубль пресета на симуляцию(другой путь у настроек)
  - &demo-movement_new
    - do: Включить симуляцию движения (Меню -> Настройки -> Дебаг-панель -> Debug Panel -> Routes -> Demo Movement)
#Дубль пресета для отображения балунов на линии маршрута(другой путь у настроек)
  - &baloon-on-line_new
    - do: Включить симуляцию движения (Меню -> Настройки -> Дебаг-панель -> Debug Panel -> Routes -> Demo Movement)
    - do: Выключить настройку "Север всегда сверху" (Меню -> Настройки -> Автомаршруты)

specs:
  Взаимодействие с балуном манёвра на линии маршрута:
    - *old_ui_settings
    - *baloon-on-line
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/manevr-balloon-1.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=55.748811&lon_from=37.702854&lat_to=55.749198&lon_to=37.699280`
    - do: Тап на кнопку старта маршрута
    - assert: По мере движения на линии маршрута появляется балун манёвра
    - do: Повращать камеру двумя пальцами
    - assert: |
        Появляется интерфейс ведения по маршруту
        Балун манёвра смещается с линии маршрута в левый верхний угол
    - do: Тап на балун манёвра
    - assert: Спан переключается на ближайший манёвр
    - do: Ничего не делать
    - assert: |
        Интерфейс пропадает
        Балун манёвра вновь отображается на линии маршрута

    - integration_run:
        - mapkit
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready

  Новые настройки. Взаимодействие с балуном манёвра на линии маршрута:
    - *new_ui_settings
    - *baloon-on-line_new
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/manevr-balloon-1.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=55.748811&lon_from=37.702854&lat_to=55.749198&lon_to=37.699280`
    - do: Тап на кнопку старта маршрута
    - assert: По мере движения на линии маршрута появляется балун манёвра
    - do: Повращать камеру двумя пальцами
    - assert: |
        Появляется интерфейс ведения по маршруту
        Балун манёвра смещается с линии маршрута в левый верхний угол
    - do: Тап на балун манёвра
    - assert: Спан переключается на ближайший манёвр
    - do: Ничего не делать
    - assert: |
        Интерфейс пропадает
        Балун манёвра вновь отображается на линии маршрута

    - integration_run:
        - mapkit
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - new_settings


  Взаимодействие с балуном полосности на линии маршрута:
    - *old_ui_settings
    - *baloon-on-line
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/ballon-without-strips.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=55.746818&lon_from=37.682717&lat_to=55.746766&lon_to=37.678847`
    - do: Тап на кнопку старта маршрута
    - assert: По мере движения на линии маршрута появляется балун полосности
    - do: Повращать камеру двумя пальцами
    - assert: Балун подстраивается под направление камеры

    - integration_run:
        - mapkit
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready


  Отображение балуна полосности с выделенной полосой ОТ на линии маршрута:
    - *old_ui_settings
    - *baloon-on-line
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/public-traffic-road.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=59.932564&lon_from=30.3491&lat_to=59.935368&lon_to=30.326892`
    - do: Тап на кнопку старта маршрута
    - do: Дождаться исчезновения интерфейса ведения
    - assert: |
        По мере движения на линии маршрута появляется балун полосности
        Полоса общественного транспорта обозначается знаком 'А'

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Разделение балунов полосности и маршрута при включённой настройке фиксации манёвров в углу экрана:
    - *old_ui_settings
    - *baloon-on-line
    - do: Включить настройку "Зафиксировать подсказки о манёврах в углу экрана" (Меню -> Настройки -> Маршруты)
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/polosa-manevr-baloon.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=55.746843&lon_from=37.672077&lat_to=55.748107&lon_to=37.668070`
    - do: Тап на кнопку старта маршрута
    - do: Дождаться исчезнования интерфейса ведения
    - assert: |
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Новые настройки. Разделение балунов полосности и маршрута при включённой настройке фиксации манёвров в углу экрана:
    - *new_ui_settings
    - *baloon-on-line_new
    - do: Включить настройку "Зафиксировать подсказки о манёврах в углу экрана" (Меню -> Настройки -> Автомаршруты)
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/polosa-manevr-baloon.png){title=Скриншот}

        `yandexmaps://build_route_on_map/?lat_from=55.746843&lon_from=37.672077&lat_to=55.748107&lon_to=37.668070`
    - do: Тап на кнопку старта маршрута
    - do: Дождаться исчезнования интерфейса ведения
    - assert: |
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - new_settings


  Отображение балунов при включённой настройке "Север всегда сверху":
    - *old_ui_settings
    - *demo-movement
    - do: Включить настройку "Север всегда сверху" (Меню -> Настройки -> Маршруты -> "Север всегда сверху"
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/polosa-manevr-baloon.png){title=QR-код}

        `yandexmaps://build_route_on_map/?lat_from=55.746843&lon_from=37.672077&lat_to=55.748107&lon_to=37.668070`
    - do: Тап на кнопку старта маршрута
    - assert: |
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра
    - do: Тап на карту
    - assert: |
        Появлятется интерфейс ведения
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Новые настройки. Отображение балунов при включённой настройке "Север всегда сверху":
    - *new_ui_settings
    - *demo-movement_new
    - do: Включить настройку "Север всегда сверху" (Тап Меню -> Настройки -> Автомаршруты -> Север всегда сверху)
    - do: |
        Построить маршрут по интенту:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/polosa-manevr-baloon.png){title=Скриншот}

        `yandexmaps://build_route_on_map/?lat_from=55.746843&lon_from=37.672077&lat_to=55.748107&lon_to=37.668070`
    - do: Тап на кнопку старта маршрута
    - assert: |
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра
    - do: Тап на карту
    - assert: |
        Появлятется интерфейс ведения
        На линии маршрута отображается балун полосности
        В левом верхнем углу отображается балун манёвра

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - new_settings


  Округление расстояний в балуне:
    - *old_ui_settings
    - *baloon-on-line
    - do: Тап Настройки -> Основные -> Единицы измерения -> Километры
    - do: Закрыть настройки
    - assert: Открыт главный экран
    - do: Использовать интент для построения маршрута [collapsed-image](https://jing.yandex-team.ru/files/zaidova/Снимок%20экрана%202022-04-28%20в%2017.23.24.png){title=QR-код}

        https://yandex.ru/maps/-/CCUFyZxwcB
    - do: Тап Поехали
    - assert: |
        Происходит ведение по маршруту
        В левом верхнем углу отображается балун маневра
        Расстояние в балуне более 3 километров
        Расстояние отображается в километрах в виде целого числа в формате **5 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит от 1 до 3 километров
    - assert: |
        Расстояние в балуне отображается в километрах в виде десятичного числа в формате **2,6 км**
        Целое количество километров (1, 2, 3 километра) отображаются в виде целого числа в формате **2 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит менее 1 километра
    - assert: |
        Расстояние в балуне отображается в метрах в виде целого числа в формате **600 м**
        Шаг округления расстояния составляет 10 метров (610 м, 600 м, 590 м)
        Число и единица измерения разделены пробелом

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Совместное отображение брендированных пинов и баллунов в автомобильном ведении:
    - *demo-movement
    - do: |
        Построить автомобильный маршрут с маневрами вдоль брендированного пина
        Например, использовать интент [collapsed-image](https://jing.yandex-team.ru/files/ekusheleva/Снимок%20экрана%202022-06-15%20в%2013.26.03.png){title=QR-код}

        `https://yandex.ru/maps?rtext=51.517073%2C46.009795~51.515809%2C46.00191&rtt=auto`
    - assert: Отображается экран выбора вариантов маршрута с построенным маршрутом
    - do: Тап Поехали
    - assert: |
        Отображается ведение по маршруту
        Около маршрута отображается брендированный пин
    - do: Дождаться появления балуна маневра
    - do: Повернуть спан карты так, чтобы совместить балун маневра и брендированный пин
    - assert: Балун маневра перекрывает брендированный пин

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Новые настройки. Округление расстояний в балуне:
    - *new_ui_settings
    - *baloon-on-line_new
    - do: Тап Меню -> Настройки -> Карта и интерфейс -> Километры
    - do: Закрыть настройки
    - assert: Открыт главный экран
    - do: Использовать интент для построения маршрута [collapsed-image](https://jing.yandex-team.ru/files/zaidova/Снимок%20экрана%202022-04-28%20в%2017.23.24.png){title=QR-код}

        https://yandex.ru/maps/-/CCUFyZxwcB
    - do: Тап Поехали
    - assert: |
        Происходит ведение по маршруту
        В левом верхнем углу отображается балун маневра
        Расстояние в балуне более 3 километров
        Расстояние отображается в километрах в виде целого числа в формате **5 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит от 1 до 3 километров
    - assert: |
        Расстояние в балуне отображается в километрах в виде десятичного числа в формате **2,6 км**
        Целое количество километров (1, 2, 3 километра) отображаются в виде целого числа в формате **2 км**
        Число и единица измерения разделены пробелом
    - do: Дождаться, когда расстояние до маневра составит менее 1 километра
    - assert: |
        Расстояние в балуне отображается в метрах в виде целого числа в формате **600 м**
        Шаг округления расстояния составляет 10 метров (610 м, 600 м, 590 м)
        Число и единица измерения разделены пробелом

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - new_settings
