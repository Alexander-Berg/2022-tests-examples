testing:
  - regress
components: voice_search
tags:
  - not_suitable_for_farm

specs:
  Голосовой поиск, открытый с главного экрана:
    - info: |
        Открыт главный экран
    - do: Выключить Алису в настройках (Меню -> Настройки -> Основные -> Алиса)
    - do: Перейти на главный экран
    - do: Тап по микрофону в строке поиска
    - assert: |
        Открыт экран голосового поиска
        Если голосовой поиск проводится впервые, то запрашивается доступ к микрофону
    - do: Продиктовать запрос
    - assert: |
        Запускается голосовой поиск и показываются его результаты либо варианты на выбор
        Если в данной области поиска ничего не найдено, отображено сообщение 'Ничего не найдено'
        При нахождении только одного результата сразу открывается миникарточка объекта, тогда тап 'Назад'
    - do: Тап на строку поискового запроса
    - assert: |
        Открыта форма поиска
        Поле ввода в фокусе, на экране отображается клавиатураn
        В поле ввода отображается запрос
        Под полем ввода отображаются поисковые сниппеты
    - do: Изменить поисковой запрос
    - assert: |
        Открыта форма поиска с поисковым полем
        Поле ввода в фокусе, на экране отображается клавиатура
        Под полем ввода отображаются поисковые сниппеты
    - do: Тап по 'Найти'
    - assert: |
        Клавиатура скрыта
        Отображается поисковая выдача
        На карты отмечены пины поисковой выдачи

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Голосовой поиск, открытый с формы поиска:
    - info: |
        Алиса выключена (Меню -> Настройки -> Основные)
        Открыта форма поиска
    - do: Тап по кнопке микрофона
    - assert: |
        Открыт экран голосового поиска
        Если голосовой поиск проводится впервые, то запрашивается доступ к микрофону
    - do: Продиктовать запрос
    - assert: |
        Запускается голосовой поиск и показываются его результаты либо варианты на выбор
        Если в данной области поиска ничего не найдено, отображено сообщение 'Ничего не найдено'
        При нахождении только одного результата сразу открывается миникарточка объекта, тогда тап 'Назад'
    - do: Тап по строке поискового запроса
    - assert: |
        Открыта форма поиска, поле ввода в фокусе, на экране отображается клавиатура
        В поле ввода отображается запрос
        Под полем ввода отображаются поисковые сниппеты
    - do: Изменить поисковой запрос
    - assert: |
        Открыта форма поиска с поисковым полем поле ввода в фокусе, на экране отображается клавиатура
        Под полем ввода отображаются поисковые сниппеты
    - do: Тап по ‘Найти’
    - assert: Клавиатура скрыта, отображается поисковая выдача, на карты отмечены пины поисковой выдачи

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
    - integration_run:
        - speechkit
    - testing:
        - lite_acceptance_maps


  Выбор языка ввода для голосового поиска:
    - info: Открыт экран настроек 'Основные'
    - do: Тап 'Язык голосового ввода'
    - assert: |
        Открыт экран 'Язык голосового ввода'
        На экране перечислены языки (Русский, Английский, Украинский, Турецкий)
        В левом верхнем углу кнопка 'Назад'
    - do: Выбрать любой язык
    - assert: Слева от выбранного языка появился активный чекбокс
    - do: Тап Назад
    - assert: |
        Открыт экран 'Основные'
        Напротив пункта 'Язык голосового ввода' отображается выбранный язык
    - do: Перезапустить приложение с выгрузкой из памяти
    - assert: Отображается главный экран приложения
    - do: Открыть экран настроек Основные
    - assert: |
        Открыт экран 'Основные'
        Напротив пункта 'Язык голосового ввода' отображается выбранный язык

    - platforms:
        - ios
    - tags:
        - assessors
    - integration_run:
        - speechkit


  Голосовой поиск при отсутствии интернет соединения:
    - info: |
        Открыт главный экран с картой
        Включен авиарежим
    - do: Тап на иконку с микрофоном
    - assert: На экране отображается надпись 'Ошибка подключения'

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - integration_run:
        - speechkit


  Разрешение на доступ к записи аудио через системный запрос:
    - info: |
        Проверка runtime permissions проводится только на >=6 android
        Алиса отключена (Меню -> Настройки -> Основные -> Алиса)
        Голосовой поиск/ввод до этого не запускался Открыт главный экран приложения с картой
    - do: Тап на кнопку голосового ввода (микрофон)
    - assert: Появился системный запрос на доступ МЯКа к записи аудио В запросе две кнопки (Отклонить и Разрешить)
    - do: Тап Разрешить
    - assert: |
        Открылся экран голосового поиска
        Если что-нибудь сказать, например 'Где поесть', будет произведен этот поиск
    - do: Перезапустить приложение с выгрузкой из памяти
    - assert: Открыт главный экран приложения
    - do: Там на кнопку голосового ввода
    - assert: |
        Запрос на доступ к записи аудио не появился
        Открылся экран голосового поиска
        Если что-нибудь сказать, например 'Где поесть', будет произведен этот поиск

    - platforms:
        - android
    - tags:
        - assessors
        - newbie
    - integration_run:
        - speechkit
    - testing:
        - lite_acceptance_maps


  Запрет на доступ к записи аудио:
    - info: |
        Настройки > Основное > Алиса > выкл
        Проверка runtime permissions проводится только на >=6 android
        Голосовой поиск/ввод до этого не запускался
        Открыт главный экран приложения с картой
    - do: Тап на кнопку голосового ввода (микрофон)
    - assert: Появился системный запрос на доступ МЯКа к записи аудио В запросе "Запретить - Только в этот раз - При использовании приложения"
    - do: Тап 'Отклонить'
    - assert: |
        Системный запрос пропал
        Открыт главный экран приложения
        Экран голосового ввода не появился
    - do: Тап на кнопку голосового ввода
    - assert: |
        Появился поп-ап с заголовком 'Разрешите доступ к микрофону' и текстом 'Вы сможете не набирать поисковые запросы, а просто произносить их вслух'
        В поп-апе две кнопки (Не сейчас и Разрешить)
    - do: Тап 'Не сейчас'
    - assert: |
        Поп-ап пропал
        Экран голосового ввода не появился
    - do: Тап на кнопку голосового ввода
    - assert:  |
        Появился поп-ап с заголовком 'Разрешите доступ к микрофону' и текстом 'Вы сможете не набирать поисковые запросы, а просто произносить их вслух'
        В поп-апе две кнопки (Не сейчас и Разрешить)
    - do: Тап 'Разрешить'
    - assert:  |
        Появился системный запрос на доступ к записи аудио
        В запросе присутствуют кнопки 'Отклонить', 'Разрешить' и чекбокс 'Больше не спрашивать'
    - do: Тап на чекбокс Больше не спрашивать
    - assert:  Кнопка 'Разрешить' задизейбленна
    - do: Тап Отклонить
    - assert:  |
        Системный запрос пропал
        Открыт главный экран приложения
        Экран голосового ввода не появился
    - do: Тап на кнопку голосового ввода
    - assert: |
        Появился поп-ап с заголовком 'ЯндексКартам вас не слышно' и текстом 'Чтобы заработал голосовой поиск, дайте приложению доступ к микрофону в настройках устройства'
        На поп-апе присутствует кнопка 'Настройки', при тапе на которую открываются настройки для МЯКа

    - platforms:
        - android
    - tags:
        - assessors
        - newbie
    - integration_run:
        - speechkit
    - testing:
        - lite_acceptance_maps


  Разрешение на доступ к записи аудио через поп-ап:
    - info: |
        Проверка runtime permissions проводится только на >=6 android
        Голосовой поиск/ввод до этого не запускался
        Открыт главный экран приложения с картой
    - do: Тап на кнопку голосового ввода (микрофон)
    - assert: |
        Появился системный запрос на доступ МЯКа к записи аудио
        В запросе две кнопки 'Отклонить' и 'Разрешить'
    - do: Тап 'Отклонить'
    - assert: |
        Системный запрос пропал
        Открыт главный экран приложения
        Экран голосового поиска не появился
    - do: Тап на кнопку голосового ввода
    - assert: |
        Появился поп-ап с заголовком 'Разрешите доступ к микрофону' и текстом 'Вы сможете не набирать поисковые запросы, а просто произносить их вслух'
        В поп-апе две кнопки 'Не сейчас' и 'Разрешить'
    - do: Тап 'Разрешить'
    - assert: |
        Появился системный запрос на доступ к записи аудио
        В запросе присутствуют кнопки 'Отклонить', 'Разрешить' и чекбокс 'Больше не спрашивать'
    - do: Тап 'Разрешить'
    - assert: |
        Открылся экран голосового поиска
        Если что-нибудь сказать, например 'Где поесть', будет произведен этот поиск

    - platforms:
        - android
    - tags:
        - assessors
    - integration_run:
        - speechkit

  Локализация интерфейса после смены языка:
    - info: Открыт экран настроек 'Основные'
    - do: Тап 'Язык'
    - assert: |
        Открыт экран 'Язык'
        На экране перечислены языки (Английский, Русский, Турецкий, Украинский, Узбекский)
        В правом нижнем углу кнопка 'Отменить'
    - do: Выбрать любой язык
    - assert: |
        Открыт главный экран приложения
        Интерфейс локализован на выбранный язык
    - do: Тап по кнопке микрофона
    - assert: |
        Открыт экран голосового поиска
        Если голосовой поиск проводится впервые, то запрашивается доступ к микрофону
    - do: Продиктовать запрос на выбранном языке
    - assert: |
        Запускается голосовой поиск и показываются его результаты либо варианты на выбор
        Если в данной области поиска ничего не найдено, отображено сообщение 'Ничего не найдено'

    - platforms:
        - android
    - tags:
        - assessors
    - integration_run:
        - speechkit

  Голосовой поиск при нераспознанном запросе:
    - info: |
        Отключить Алису открыв Меню > Настройки > Основные
        Открыт главный экран
    - do: Тап на микрофон
    - assert: |
        Открывается запрос на доступ к микрофону (если доступ не был дан прежде)
        Открывается экран для голосового ввода
    - do: Издать неразборчивый звук, например, подуть в микрофон
    - assert: |
        Отображается текст 'Не удалось распознать'
        В нижней части экрана кнопка 'Повторить'
    - do: Тап 'Повторить'
    - assert:  Открывается экран для голосового ввода с сообщением 'Слушаю...'


    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - assessors
        - newbie

  Проверка отображения запроса пермишена на доступ к микрофону после сворачивания приложения:
    - info: |
        Проверка runtime permissions проводится только на >=6 android
        Разрешения на доступ к микрофону ранее не давалось
        Открыт главный экран приложения
    - do: Тап по табу 'Поиск'
    - assert: |
        Открыт экран поиска
        Сверху отображены слева-направо: иконка лупы, поисковая строка с микрофоном, кнопка закрытия поиска
        Ниже отображаются иконки с поисковыми категориями
    - do: Тап на иконку микрофона в строке поиска
    - assert: |
        Появился системный запрос на доступ приложения ЯндексКарты к микрофону
        В запросе присутствуют кнопки: 'Отклонить' и 'Разрешить'
    - do: Свернуть приложение
    - assert: |
        Приложение свернуто
        Отображается рабочий стол устройства
    - do: Запустить приложение через иконку на рабочем столе или в списке приложений
    - assert: |
        Открыт главный экран приложения
        Отображается системный запрос на доступ приложения ЯндексКарты к микрофону
        В запросе присутствуют кнопки: 'Отклонить' и 'Разрешить'

    - platforms:
        - android
    - tags:
        - assessors

  Голосовой поиск в ведении:
    - info: |
        Девайс в вертикальной ориентации
    - do: Построить произвольный автомаршрут и перейти в ведение
    - assert: |
        Отображается экран ведения по маршруту
        Слева по центру микрофон и кнопка добавления ДС
    - do: Тап на микрофон
    - assert: |
        Появился системный запрос на доступ приложения Яндекс.Карты к микрофону
    - do: Тап 'Разрешить'
    - assert: |
        Открывается экран для голосового ввода
        Отображается текст 'Слушаю...'
    - do: Произнести запрос, например Кафе
    - assert: |
        Экран ввода голосового запроса скрылся
        Произошел поиск по запросу 'Кафе'
        На карте отображаются поисковые пины вдоль маршрута
        Под кнопкой меню отображается текст запроса с крестиком

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map

  Отсутствие голосового поиск в оффлайне:
    - info: |
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Выключен интернет
        Выключен голосовой помощник Алиса (Меню -> Настройки -> Основные)
        Включена симуляция движения (Debug-panel > Routes > Demo movement)
    - do: Тап на микрофон в поиске
    - assert: |
        Открылась шторка голосового поиска с надписью Слушаю
        Спустя какое то время появилась сообщение ошибка подключения и кнопка Повторить
    - do: Включить интернет
    - do: Тап на Повторить и повторить голосовой запрос
    - assert: Появилась поисковая выдача по запросу
    - do: Отключить интернет и начать ведение по авто маршруту
    - assert: Ведение по авто маршруту в оффлайне
    - do: Тап на микрофон
    - assert: |
        Открылась шторка голосового поиска с надписью Слушаю
        Спустя какое то время появилась сообщение ошибка подключения и кнопка Повторить
    - do: Включить интернет
    - do: Тап на Повторить и повторить голосовой запрос
    - assert: Появились пины на карте по запросу

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps
    - tags:
        - assessors
        - newbie

  Голосовой ввод на экране построения маршрута:
    - info: |
        Отображается главный экран приложения
        Местоположение определено
    - do: Тап по табу Маршруты
    - do: Тап поле Куда
    - do: Тап по Голосовой ввод
    - assert: Отображается запрос на доступ
    - do: Выдать разрешение на доступ
    - do: Произвести поиск по адресу топонима или названию организаций в единственном экземпляре
    - assert: Для поиска с единичным результатом отображается экран выбора вариантов маршрута
    - do: Произвести поиск по адресу топонима или названию организаций не в единственном экземпляре (например Пятерочка)
    - do: Тап по сниппету
    - assert: Отображается экран выбора вариантов маршрута

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps


  Проверка прав доступа к микрофону в приложении:
    - info: |
        Ранее не выдавался доступ к микрофону
    - do: Тап на значок Алисы в строке поиска
    - assert: |
        Отображается запрос доступа к микрофону
    - do: Отклонить запрос доступа
    - assert: |
        Отображается главный экран приложения
    - do: Тап на значок Алисы в строке поиска
    - assert: |
        Отображается запрос доступа к микрофону
    - do: Разрешить доступ
    - assert: |
        Отображается шторка Алисы

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
    - testing:
        - acceptance_maps
