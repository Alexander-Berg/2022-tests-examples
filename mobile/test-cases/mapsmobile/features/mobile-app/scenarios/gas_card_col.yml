testing:
  - regress
components: gas_card_col
integration_run:
  - tanker_sdk

aliases:
  - &preconditions_gas_starts
    - do: Включить тестовое окружение заправок (Debug Panel -> Environment -> Refuel environment -> TESTING)
    - do: (iOS) Тап Debug Panel -> Various -> Load refuel stations for current location
    - do: (iOS) Тап чекбокс "Установить геопозицию на заправку", выбрать АЗС на Красной площади на Лобном месте
    - do: (Android) Произвести поиск по категории заправок (Тап таб "Поиск" -> Яндекс Заправки)
    - do: (Android) Тап на любой пин "Яндекс Заправок"
    - do: (Android) Тап "Заправиться"
    - assert: |
        Отображается экран выбора колонки

specs:
  Отображение карточки заправки:
    - preconditions: |
        Устройство в вертикальной ориентации
        Отображается главный экран приложения
    - do: Тап таб "Поиск"
    - do: Тап "Яндекс Заправки"
    - assert: |
        На карте отображаются пины АЗС
    - do: Тап по пину АЗС с оплатой в картах
    - assert: |
        Отображается карточка АЗС
        В карточке присутствует кнопка "Заправиться"
    - do: Тап "Заправиться"
    - assert: |
        Открыт экран заправки
    - do: Тап по любой колонке
    - assert: |
        Открыт экран выбора топлива

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android


  Отсутствие кнопки QR-кода при выборе заправщика:
    - preconditions: |
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Тап на любую колонку
    - assert: |
        Отображается экран выбора топлива
    - do: Тап на любой вид топлива
    - assert: |
        Отображается экран с возможностью выбрать количество заправляемых литров или сумму
    - do: Выбрать количество бензина На сумму или Литры
    - do: Тап "Оплатить"
    - assert: |
        Отображается экран выбора способов оплаты
        Присутствует блок "Меня заправляет"
    - do: Тап "Выбрать" в блоке "Меня заправляет"
    - assert:
        Открыт экран "Выберите заправщика"
        Отображается поле ввода номера телефона заправщика и саджесты с именами заправщиков
        Отсутствует кнопка QR-кода

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android


  Отображение блока Оцените обслуживание на АЗС после оплаты:
    - preconditions: |
        Android: Подменить МПП с помощью Mock Location на Москву
        Пользователь авторизован
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Отображается экран "Выбора заправщика" и "Способа оплаты"
    - do: Тап по иконке любого заправщика
    - do: Выбрать **VISA ****0123 платежной картой
    - assert: |
        Отображается только выбранный заправщик
        VISA ***0123 выбрана для оплаты заправки
    - do: Тап "Подтвердить"
    - assert: |
        Отображается процесс заправки
        Через несколько секунд открывается экран чека с блоками "Сумма заправки", "Чаевые заправщику" и "Оцените обслуживание"
    - do: Тап любую звезду в блоке "Оценить обслуживание"
    - assert: |
        Цвет звезд рейтинга изменяется
        Отображаются свитчеры с дополнительными оценками
    - do: Тап еще раз по этой звезде
    - assert: |
        Рейтинг сбрасывается дополнительные оценки не отображаются

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - payment_sdk


  Ввод данных заправщика после заправки:
    - preconditions: |
        Пользователь авторизован
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Открыта форма оплаты
        В Блоке "Меня заправляет" размещена иконка заправщика с подписью "Меня заправляет"
        Отображается кнопка "Выбрать"
        Отображается не более 3 саджестов заправщиков с позывными
    - do: Тап "Выбрать"
    - assert: |
        Открывается форма "Выберите заправщика" с возможностью:
        - указать номер телефона заправщика
        - выбрать заправщика из списка саджестов
    - do: Ввести произвольный номер телефона
    - do: Тап на кнопку "Подтвердить"
    - assert: |
        Отображается экран формы оплаты
        В блоке "Меня заправляет" отображается аватар заправщика с позывным в виде его номера (формат +7ХХХ...ХХ)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Выбор заправщика после заправки:
    - preconditions: |
        Пользователь авторизован
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Открыта форма оплаты
        В Блоке "Меня заправляет" размещена иконка заправщика с подписью "Меня заправляет"
        Отображается кнопка "Выбрать"
        Отображается не более 3 саджестов заправщиков с позывными
    - do: Тап "Выбрать"
    - assert: |
        Открывается форма "Выберите заправщика" с возможностью:
        - указать номер телефона заправщика
        - выбрать заправщика из списка саджестов
    - do: Тап любой саджест с именем заправщика
    - do: Тап на кнопку "Подтвердить"
    - assert: |
        Отображается экран формы оплаты
        В блоке "Меня заправляет" отображается аватар заправщика с позывным в виде его номера (формат +7ХХХ...ХХ)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Выбор заправщика из нескольких предложенных:
    - preconditions: |
        Пользователь авторизован
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Открыта форма оплаты
        Отображаются не более 3 саджестов с выбором заправщиков
    - do: Тап на любого из предложенных заправщиков
    - assert: |
        В блоке "Меня заправляет" отображается только выбранный заправщик
        Кнопка "Выбрать" и саджесты с другими заправщиками не отображаются
    - do: Тап на выбранного заправщика
    - assert: |
        В блоке "Меня заправляет" появляется кнопка "Выбрать"
        Отображаются не более 3 саджестов с выбором заправщиков

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Форма оплаты (чекаут), если не подключен Я.Плюс:
    - preconditions: |
        Пользователь авторизован
        У Пользователя нет подписки на Я.Плюс
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Открывается форма оплаты с чекаутом
        На ней размещены блоки:
        - Меня заправляет (выбор заправщика)
        - Способ оплаты
        - Кнопка "Подтвердить"

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Форма оплаты (чекаут), если подключен Я.Плюс:
    - preconditions: |
        Пользователь авторизован
        У пользователя есть подписка на Я.Плюс
        Android: Подменить МПП с помощью Mock Location на Москву
    - *preconditions_gas_starts
    - do: Выбрать колонку 1
    - do: Выбрать любой тип топлива
    - do: Указать количество литров или стоимость топлива
    - do: Тап "Оплатить"
    - assert: |
        Открывается форма оплаты с чекаутом
        На ней размещены блоки:
        - Меня заправляет (выбор заправщика)
        - Способ оплаты
        - Работа сервиса
        - Баллы плюса
        - Кнопка "Подтвердить"

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps