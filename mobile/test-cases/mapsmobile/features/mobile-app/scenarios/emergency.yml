components: emergency
testing:
  - regress

specs:
  Отображение ЧС-предупреждений в карточках транспорта:
    - info: |
        Отображается спан города, для которого есть ЧС нотификация
        Устройство подключено к снифферу (дебаг-сборка на Android, любая сборка с дебаг-панелью на iOS)
    - do: Тап на пин остановки ОТ
    - assert: |
        Открылась карточка остановки
        В карточке отображается ЧС-нотификация с содержимым:
        Описание
        Кнопка ОК
        Кнопка Подробнее (может не отображаться)
    - do: Дважды сменить ориентацию устройства
    - assert: |
        В карточке по-прежнему отображается нотификация
        Элементы карточки не пропадают и не перемещаются
    - do: Тап ОК
    - assert: Нотификация закрылась
    - do: Закрыть карточку остановки
    - assert: |
        Карточка остановки закрылась
        Отображается главный экран приложения
    - do: Повторно открыть карточку остановки
    - assert: Нотификация не появилась
    - do: Перезапустить приложение и открыть карточку остановки
    - assert: Нотификация не появилась
    - do: |
        iOS - Переустановить приложение
        Android - Очистить память приложения
    - assert: В приложении нет данных о нотификации
    - do: Запустить приложение и открыть карточку остановки
    - assert: |
        Открылась карточка остановки
        В карточке отображается ЧС-нотификация с содержимым:
        Описание
        Кнопка ОК
        Кнопка Подробнее (может не отображаться)
    - do: |
        Открыть https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/showcase/v3/search/by_point/notifications в сниффере
    - assert: Отображается список всех полученных нотификаций
    - do: Тап Подробнее
    - assert: Выполняется действие, описанное в action.url нотификации с типом открытой карточки

    - platforms:
        - ios
        - android


  Отображение ЧС-нотификации на экране выбора маршрутов:
    - info: |
        Дебаг-панель -> Environment -> Mobmaps Proxy host -> testing
        Построен произвольный маршрут на спане Москвы
        Открыт экран вариантов выбора маршрутов
        Устройство в вертикальной ориентации
    - do: Тап на таб "Все"
    - assert: Над списком типов маршрута отображается ЧС-нотификация
    - do: Тап на "Подробнее" у ЧС-нотификации (У некоторых нотификаций может не отображаться, тогда пропускаем шаг)
    - assert: Открывается WebView со страницей, характерной ЧС-нотификации
    - do: Закрыть WebView
    - assert: |
        Отображается активный таб "Все"
        ЧС-нотификация **не** отображается
    - do: Тап на таб Автомаршрут
    - assert: Над списком вариантов маршрута отображается ЧС-нотификация
    - do: Сменить ориентацию устройства на горизонтальную
    - assert: ЧС-нотификация не отображается в горизонтальной ориентации, исключение - ЧС-нотификация в табе "Все"
    - do: Сменить ориентацию устройства обратно на вертикальную
    - assert: Над списком вариантов маршрута отображается ЧС-нотификация
    - do: Свернуть/Развернуть приложение
    - assert: ЧС-нотификация отображается
    - do: Тап на “ОК” у ЧС-нотификации
    - assert: ЧС-нотификация пропадает
    - do: Тап на оставшиеся типы маршрутов
    - assert: |
        Над списком вариантов маршрута отображается ЧС-нотификация
        ЧС-нотификация может не отображаться, если не пришла в данных
        ЧС-нотификация может не отображаться, если была закрыта ЧС-нотификация(с одинаковым id), которая была показана на нескольких табах
    - do: Перезапустить приложение
    - assert: |
        ЧС-нотификация продолжает отображаться на табах, где не была закрыта
        ЧС-нотификация может не отображаться, если была закрыта ЧС-нотификация(с одинаковым id), которая была показана на нескольких табах

    - platforms:
        - ios
        - android
    - tags:
        - newbie


  Отображение ЧС-нотификации в поиске:
    - info: |
        Открыт экран поиска
        Вертикальная ориентация устройства
    - do: Тап по категории "Где поесть"
    - assert: |
        Отображается экран с результатами поиска
        Над поисковыми результатами отображается ЧС-нотификация "Режим работы некоторых организаций мог изменится. Свяжитесь с ними, чтобы уточнить"
        У некоторых организаций, в сниппете, может отображаться "Закрыта на вход"
    - do: Тап на организацию с плашкой "Закрыта на вход" (например, Старый Город)
    - assert: |
        Открывается карточка организации
        Над табами "Обзор", "Фото..." отображается ЧС-нотификация "Закрыто для посещения. Возможно организация предоставляет услуги дистанционно. Свяжитесь с ней, чтобы уточнить"
    - do: Свернуть карточку организации до мини-состояния
    - assert: ЧС-нотификация отображается над action-кнопками
    - do: Произвести поиск по категории "Продукты"
    - assert: |
        Отображается экран с результатами поиска
        Над поисковыми результатами отображается ЧС-нотификация "Режим работы некоторых организаций мог изменится. Свяжитесь с ними, чтобы уточнить"
        У некоторых организаций, в сниппете, может отображаться "Закрыта на вход"
    - do: Тап на организацию **без** плашки "Закрыта на вход" (например, Перекресток)
    - assert: |
        Открывается карточка организации
        Над табами "Обзор", "Фото..." отображается ЧС-нотификация "Режим работы организации мог измениться. Свяжитесь с ней, чтобы уточнить"
    - do: Сменить ориентацию устройства на горизонтальную
    - assert: |
        Отображается карточка организации
        ЧС-нотификация продолжает отображаться
    - do: Свернуть/Перезапустить приложение
    - assert: ЧС-нотификация продолжает отображаться

    - platforms:
        - ios
        - android


  Android - Отображение ЧС-нотификации на главном экране (Интро):
    - info: |
        Установить старую версию приложения - просмотреть онбординг, дать пермишн на местоположение - авторизоваться - в дебаг панели Enviroment - Mobmaps proxy host - Testing - обновиться на тестируемую версию
        Устройство подключено к снифферу (дебаг-сборка на Android)
    - do: Запустить приложение
    - assert: Отображается приветственное интро
    - do: Закрыть интро, выдать разрешения, закрыть WebView авторизации
    - assert: |
        Отображается главный экран на спане с местоположением
        Отображается плашка с подсветкой саджестов
    - do: Не закрывая плашку с подсветкой переместить спан карты на город с ЧС нотификацией
    - assert: Нотификация не отображается
    - do: Закрыть плашку с подсветкой
    - assert: |
        Спан карты не изменился
        Плашка с подсветкой не отображается
        ЧС нотификация не отображается
    - do: Свернуть и развернуть приложение
    - assert: Нотификация по-прежнему не отображается
    - do: Дважды сменить ориентацию устройства
    - assert: |
        Главный экран адаптируется под выбранную ориентацию
        Нотификация не отображается
    - do: Перезапустить приложение с выгрузкой из фона
    - assert: Отобразилась нотификация
    - do: Тап на ОК
    - assert: Нотификация закрылась
    - do: Перезапустить приложение
    - assert: |
        Закрытая в предыдущем шаге нотификация не отображается
        Может отобразиться нотификация с другим  id
    - do: Очистить память приложения
    - assert: В приложении нет данных о нотификации
    - do: Повторить шаги для отображения  ЧС нотификации
    - assert: |
        Над табами отобразилась ЧС-нотификация с содержимым:
        Описание
        Кнопка ОК
        Кнопка Подробнее (может не отображаться)
    - do: Тап Подробнее
    - assert: Выполняется действие, описанное в action.url текущей нотификации
    - do: Вернуться в приложение/на спан с нотификацией
    - assert: |
        Нотификация закрылась и больше не отображается
        Может отобразиться нотификация с другим id

    - platforms:
        - android
    - tags:
        - newbie



  Отображение ЧС-нотификации для слоев на главном экране:
    - info: |
        Устройство подключено к снифферу (дебаг-сборка на Android, любая сборка с дебаг-панелью на iOS)
        Устройство в вертикальной ориентации
        Приложение запущено на спане города с нотификацией
        Слой транспорта и пробок выключен
        Нотификация для главного экрана была закрыта и не отображается
    - do: Тап на слой Транспорта
    - assert: Над саджестами отображается нотификация для слоя Транспорта
    - do: Выключить слой Транспорта
    - do: Тап на Пробки
    - assert: |
        Контрол пробок переключился в активное состояние
        На спане карты отображаются пробки
        Отображается нотификация для слоя пробок
    - do: Включить слой Транспорта
    - assert: |
        На спане карты отображаются живые метки ОТ
        Слой пробок не выключился и продолжает отображаться на карте
        Отображается нотификация, выше остальных расположенная в запросе полученном в сниффере
    - do: Тап по кнопке ОК
    - assert: |
        Приоритетная нотификация закрылась
        Отображается нотификация, идущая дальше по списку
    - do: Дважды сменить ориентацию устройства
    - assert: |
        В горизонтальной ориентации нотификация не отображается
        При возврате в вертикальную ориентацию нотификация снова отображается
    - do: Тап на Подробнее
    - assert: Выполняется действие, описанное в action.url текущей нотификации
    - do: Вернуться в приложение/на спан с нотификацией
    - assert: |
        Нотификация закрылась и больше не отображается
        Может отобразиться нотификация с другим id (только подходящего типа)

    - platforms:
        - ios
        - android


  Индикация дистанционного режима работы организации в СЕРПе:
    - info: |
        Открыт главный экран приложения
        Подстрочник отображается в период ограничений
    - do: Выполнить произвольный поисковый запрос, например "Доставка еды"
    - assert: |
        Отображаются результаты поиска
        У некоторых сниппетов в подстрочнике присутствует оранжевая подпись с восклицательным знаком "Закрыто на вход"
    - do: Свернуть поисковую выдачу и установить зум >=15
    - assert: |
        На карте отображаются пины организаций из поисковой выдачи
        В подстрочнике некоторых пинов отображается подпись "Закрыто на вход"

    - platforms:
        - ios
        - android



  Отображение плашки о дистанционном режиме работы в карточке организации:
    - info: |
        Открыт главный экран приложения
        Плашка отображается в период ограничений
    - do: Выполнить произвольный поисковый запрос, например “Доставка еды”
    - assert: |
        Отображаются результаты поиска
        У некоторых сниппетов в подстрочнике присутствует оранжевая подпись с восклицательным знаком “Закрыто на вход”
    - do: Перейти в карточку организации, которая не является геопродуктом, либо геопродукт без действующей акции с подстрочником "Закрыто на вход"
    - assert: |
        Отображается карточка организации
        Присутствует оранжевая плашка с восклицательным знаком и текстом "Организация может работать дистанционно или с ограничением на посещение. Свяжитесь с ней, чтобы уточнить"
        Если у организации присутствуют конкретные признаки дистанционной работы (доставка, самовывоз, выезд на дом и т.п.), то текст плашки будет иметь иной вид, например "Организация работает дистанционно: самовывоз"
        Если у организации несколько признаков сразу, то они все перечислены в тексте плашки
    - do: Закрыть текущую карточку организации и открыть карточку геопродукта с действующей акцией и подстрочником "Закрыто на вход"
    - assert: |
        Отображается карточка организации
        Присутствует оранжевая плашка без восклицательного знака и с текстом "Организация может работать дистанционно или с ограничением на посещение. Свяжитесь с ней, чтобы уточнить"
        Если у организации присутствуют конкретные признаки дистанционной работы (доставка, самовывоз, выезд на дом и т.п.), то текст плашки будет иметь иной вид, например "Организация работает дистанционно: самовывоз"
        Если у организации несколько признаков сразу, то они все перечислены в тексте плашки
    - do: Закрыть текущую карточку организации и открыть карточку со статусом "Закрыта" или "Временно закрыта"
    - assert: |
        Отображается карточка организации
        Плашка о дистанционном режиме работы отсутствует

    - platforms:
        - ios
        - android


  iOS - Отображение ЧС-нотификации на главном экране (Интро):
    - info: |
        Устройство подключено к снифферу (дебаг-сборка на Android, любая сборка с дебаг-панелью на iOS)
        Ранее приложение не было запущено
        Debug Panel - Environment - Mobmaps proxy host - Testing
        В дебаг-панели выбрать Startup screens and hints - Reset startup actions
    - do: Запустить приложение
    - assert: Отображается приветственное интро
    - do: Закрыть интро, выдать разрешения, закрыть WebView авторизации
    - assert: |
        Отображается главный экран на спане с местоположением
        Отображается плашка с подсветкой саджестов
    - do: Не закрывая плашку с подсветкой переместить спан карты на город с ЧС нотификацией
    - assert: Нотификация не отображается
    - do: Закрыть плашку с подсветкой
    - assert: |
        Спан карты не изменился
        Плашка с подсветкой не отображается
        Над табами отобразилась ЧС-нотификация
    - do: Свернуть и развернуть приложение
    - assert: Нотификация по-прежнему отображается
    - do: Сменить ориентацию устройства
    - assert: |
        Главный экран адаптируется под горизонтальную ориентацию
        Нотификация не отображается
    - do: Повторно сменить ориентацию устройства и тап на ОК
    - assert: Нотификация закрылась
    - do: Перезапустить приложение
    - assert: |
        Закрытая в предыдущем шаге нотификация не отображается
        Может отобразиться нотификация с другим  id
    - do: Переустановить приложение
    - assert: В приложении нет данных о нотификации
    - do: Повторить шаги для отображения  ЧС нотификации
    - assert: |
        Над табами отобразилась ЧС-нотификация с содержимым:
        Описание
        Кнопка ОК
        Кнопка Подробнее (может не отображаться)
    - do: Тап Подробнее
    - assert: Выполняется действие, описанное в action.url текущей нотификации
    - do: Вернуться в приложение/на спан с нотификацией
    - assert: |
        Нотификация закрылась и больше не отображается
        Может отобразиться нотификация с другим id

    - platforms:
        - ios
    - tags:
        - newbie


  Отображение ЧС-нотификации на главном экране (Интро заправок):
    - info: |
        Устройство подключено к снифферу (дебаг-сборка на Android, любая сборка с дебаг-панелью на iOS)
        Ранее приложение не было запущено
        Транспорт не установлен
        Если в проверяемой прод.сборке нет нотификации и необходимо включить тестовый сервер - после включения можно сбросить получение интро с помощью функций в дебаг-панели:
        iOS: Сбросить новые промо-элементы
        Android: Startup screens and hints - Reset tips on restart
    - do: Запустить приложение и перезапустить несколько раз
    - assert: Отобразились все группы интро
    - do: Обновить приложение и запустить
    - assert: Отобразилось интро заправок
    - do: Закрыть интро
    - assert: Отображается главный экран на спане с местоположением
    - do: Переместить спан карты на город с ЧС нотификацией
    - assert: |
        Над табами отобразилась ЧС-нотификация с содержимым:
          Описание
          Кнопка ОК
          Кнопка Подробнее (может не отображаться)
    - do: Свернуть и развернуть приложение
    - assert: Нотификация по-прежнему отображается
    - do: Сменить ориентацию устройства
    - assert: |
        Главный экран адаптировался под горизонтальную ориентацию
        Нотификация не отображается
    - do: Повторно сменить ориентацию устройства
    - assert: |
        Главный экран адаптировался под вертикальную ориентацию
        Нотификация отображается
    - do: Тап на ОК
    - assert: Нотификация закрылась
    - do: Перезапустить приложение
    - assert: |
        Закрытая в предыдущем шаге нотификация не отображается
        Может отобразиться нотификация с другим id
    - do: iOS - Переустановить приложение / Android - Очистить память приложения
    - assert: В приложении нет данных о нотификации
    - do: Повторить шаги для отображения ЧС нотификации
    - assert: |
        Над табами отобразилась ЧС-нотификация с содержимым:
          * Описание
          * Кнопка ОК
          * Кнопка Подробнее (может не отображаться)
    - do: Тап Подробнее
    - assert: Выполняется действие, описанное в action.url текущей нотификации
    - do: Вернуться в приложение/на спан с нотификацией
    - assert: |
        Нотификация закрылась и больше не отображается
        Может отобразиться нотификация с другим id

    - platforms:
        - ios
        - android


  Отображение ЧС-нотификации на экране сервиса Транспорт:
    - info: |
        Для Android: Включен эксперимент service_architecture
        Debag panel -> Environment -> Mobmaps Proxy host -> testing
        Отображается главный экран приложения на спане Москвы
    - do: Тап на таб Транспорт
    - assert: |
        Отображается экран сервиса Транспорт
        Присутсвует ЧС-нотификация с кнопкой Ок
    - do: Тап на кнопку Ок
    - assert: |
        Отображается экран сервиса Транспорт
        ЧС-нотификация с кнопкой Ок отсутствует

    - platforms:
        - android
        - ios
    - tags:
        - assessors
