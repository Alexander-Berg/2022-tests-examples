components: debug_panel
testing:
  - regress

specs-integration:
  aliases:
    - &ИнфоЗаписьТреков
      - info: |
          Смотреть логи нужно на сборках без подписи store
          Девайс подключен к инструментам снятия логов
      - do: Включить симуляцию ведения по маршруту (Debug Panel -> Routes -> Demo Movement)
      - do: |
          Включить эксперименты воспользовавшись интентом:
          [collapsed-image](https://jing.yandex-team.ru/files/normalman/mapkitsim_feedback_report%26mapkitsim_feedback_report_send_count%3D3%26mapkitsim_feedback_report_min_duration_minutes%3D1.7605612.png){title=QR-код}

          `yandexmaps://add_exp?mapkitsim_feedback_report&mapkitsim_feedback_report_send_count=3&mapkitsim_feedback_report_min_duration_minutes=1`
      - do: Перезапустить приложение

specs:
  Недоступность дебаг-панели внешним пользователям:
    - info: |
        (Android) Проходится на сборке из Google Play/Teamcity
        (iOS) Проходится на TestFlight-сборке
        На устройстве нет учетных записей Яндекса привязанных к staff
    - do: Открыть Меню
    - assert: Отображается Меню
    - do: Тап Настройки
    - assert: Отображается экран Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: Кнопка Debug Panel не отображается
    - do: Свайп влево от края экрана
    - assert: |
        Открыт экран Настройки
        Меню дебаг-панели не появилось
    - do: Свайп вправо от края экрана
    - assert: |
        Отображается экран Настройки
        Экран логов не появился

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - integration_run:
        - kotlin
    - tags:
        - refactor_ready


  Отображение дебаг-панели авторизованным пользователем (Android) (не staff):
    - info: |
        Проходится на сборке из Google Play/Teamcity
        Пользователь авторизован аккаунтом, не привязанным к staff
        На устройстве нет сохраненных аккаунтов привязанных к staff
        Открыт главный экран приложения
    - do: Свайп влево от края экрана
    - assert: |
        Происходит изменение спана карты.
        Дебаг панель не отображается
    - do: Открыть Меню
    - do: Тап Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: Кнопка Debug Panel не отображается

    - platforms:
        - android
    - testing:
        - acceptance_maps
    - integration_run:
        - kotlin
    - tags:
        - refactor_ready


  Отображение дебаг-панели авторизованным пользователем (iOS) (не staff):
    - info: |
        Проходится на TestFlight-сборке
        Пользователь авторизован аккаунтом, не привязанным к staff
        На устройстве нет сохраненных аккаунтов привязанных к staff
        Открыт главный экран приложения
    - do: Открыть Меню
    - do: Тап Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: Кнопка Debug Panel не отображается

    - platforms:
        - ios
    - testing:
        - acceptance_maps
    - integration_run:
        - kotlin
    - tags:
        - refactor_ready


  Отображение дебаг-панели авторизованным пользователем (staff):
    - info: |
        Пользователь авторизован аккаунтом привязанным к staff.
        Открыт главный экран приложения
    - do: Открыть Меню
    - do: Тап Настройки
    - do: Проскроллить Настройки до последнего пункта
    - assert: |
        Последним пунктом отображается дебаг-панель.
        (Android) Отображается свитчер 'Открывать дебаг-панель свайпом'
    - do: Тап по кнопке дебаг-панели
    - assert: Отображается дебаг-панель
    - do: (Android) Тап по системной кнопке Назад / (iOS) Тап на Настройки в верхней части экрана
    - assert: |
        (Android) Отображается экран Меню
        (iOS) Отображается экран настроек
    - do: (Android) Тап по свитчеру 'Открывать дебаг-панел свайпом'
    - assert: Состояние свитчера изменилось на активное
    - do: (Android) Тап по системной кнопке Назад
    - assert: Отображается меню приложения
    - do: (Android) Свайп влево от края экран
    - assert: Дебаг панель отображается

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - refactor_ready


  Вызов плашки с логом на develop сборках:
    - info: |
        Проверяем, что в dev-сборках возможно вызвать панель с логами
        Установлена trunk сборка
    - do: Включить возможность просмотров логов (Debug Panel -> Various -> Device Log)
    - do: Перезапустить приложение
    - assert: Открыт главный экран приложения
    - do: Свайп сверху вниз тремя пальцами
    - assert: Отображается панель с логами
    - do: Свайп тремя пальцам снизу вверх, начиная с нижней трети экрана
    - assert: Плашка уехала вверх и исчезла с экрана

    - platforms:
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Активация прозрачности в плашке с логом:
    - info: |
        Установлена trunk сборка
    - do: Включить возможность просмотров логов (Debug Panel -> Various -> Device Log)
    - do: Перезапустить приложение
    - assert: Открыт главный экран приложения
    - do: Свайп сверху вниз тремя пальцами
    - assert: Отображается панель с логами
    - do: Двойной тап по плашке с логом тремя пальцами
    - assert: Плашка с логом стала полупрозрачной
    - do: Двойной тап по плашке с логом тремя пальцами
    - assert: Плашка с логом снова стала непрозрачной
    - do: Прокрутить текст лога несколькими свайпами вниз -> вверх
    - assert: Текст лога успешно прокручивается

    - platforms:
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Копирование фрагмента лога из панели логов:
    - info: |
        Установлена trunk сборка
    - do: Включить возможность просмотров логов (Debug Panel -> Various -> Device Log)
    - do: Перезапустить приложение
    - assert: Открыт главный экран приложения
    - do: Свайп сверху вниз тремя пальцами
    - assert: Отображается панель с логами
    - do: |
        Скопировать и вставить фрагмент текста из панели логов:
        Лонгтап по тексту лога -> Выделить кусок текста -> Скопировать -> Вставить скопированное значение, например, в Заметки
    - assert: |
        По лонгтапу выделяется кусок текста, после меняется выделение
        Текст копируется и вставляется

    - platforms:
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Открытие дебаг панели из панели логов:
    - info: |
        Установлена trunk сборка
    - do: Включить возможность просмотров логов  (Debug Panel -> Various -> Device Log)
    - do: Перезапустить приложение
    - assert: Открыт главный экран приложения
    - do: Свайп сверху вниз тремя пальцами
    - assert: Отображается панель с логами
    - do: Тап на кнопка с изображением ракеты
    - assert: |
        Отображается дебаг-панель

    - platforms:
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Проверка работы кнопки "Жук":
    - info: |
        Пользователь авторизован под стафф-аккаунтом
    - do: Включить симуляцию ведения по маршруту (Debug Panel -> Routes  -> Demo movement)
    - do: Включить настройку Button Visible (Debug Panel -> Routes  -> Button Visible)
    - do: Перезапустить приложение
    - do: Тап "Маршруты"
    - do: Построить произвольный автомаршрут
    - do: Тап по 'Поехали'
    - assert: |
        Открывается экран ведения по маршруту
    - do: Тап по кнопке 'жук'
    - assert: Продолжается ведение по маршруту
    - do: Закрыть ведение и перейти в Настройки (Меню - Настройки)
    - do: Тап Маршруты
    - do: Тап Сохраненные маршруты
    - assert: |
        Отображается экран Сохраненные маршруты
        Есть сохраненный маршрут
        Дата сохранения совпадает с датой создания записи
    - do: Тап на маршрут
    - assert: |
        Появился поп-ап для отправки
        Есть поле ввода комментария
    - do: Тап Отменить
    - assert: |
        Отображается экран Сохраненные маршруты
        Под маршрутом нет комментария с номером тикета
    - do: Тап Удалить записи
    - assert: Нет записей о сохраненных маршрутах

    - platforms:
        - ios
    - tags:
        - newbie
        - refactor_ready


  Запись треков у автомобильных маршрутов:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой автомобильный маршрут
    - do: Тап "Поехали"
    - assert: |
        Началось ведение по автомаршруту
        В логах отображается событие `report recoding started`
    - do: Сбросить текущий маршрут тапом на крестик
    - assert: |
        Маршрут сброшен
        Открыт главный экран приложения
        В логах отображается событие `report recording finished`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Запись треков у пеших маршрутов:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой пеший маршрут
    - do: Тап "Начать"
    - assert: |
        Началось ведение по пешему маршруту
        В логах отображается событие `report recoding started`
    - do: Сбросить текущий маршрут тапом на крестик
    - assert: |
        Маршрут сброшен
        Открыт главный экран приложения
        В логах отображается событие `report recording finished`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Окончание записи трека автомобильного маршрута при достижении финиша:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой автомобильный маршрут
    - do: Тап "Поехали"
    - assert: |
        Началось ведение по автомобильному маршруту
        В логах отображается событие `report recoding started`
    - do: Свернуть/развернуть приложение
    - assert: Запись трека продолжается с момента построения маршрута
    - do: Доехать до конца маршрута
    - assert: |
        Маршрут завершен
        Открыт главный экран приложения
        В логах отображается событие `report recording finished`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Окончание записи трека пешеходного маршрута при достижении финиша:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой пешеходный маршрут
    - do: Тап "Начать"
    - assert: |
        Началось ведение по пешему маршруту
        В логах отображается событие `report recoding started`
    - do: Свернуть/развернуть приложение
    - assert: Запись трека продолжается с момента построения маршрута
    - do: Дойти до конца маршрута
    - assert: |
        Маршрут завершен
        Открыт главный экран приложения
        В логах отображается событие `report recording finished`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Окончание записи трека автомобильного маршрута при изменении точек назначения:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой автомобильный маршрут
    - do: Тап "Поехали"
    - assert: |
        Началось ведение по автомобильному маршруту
        В логах отображается событие `report recoding started`
    - do: Лонг-тап по карте
    - assert: Открылось лонг-тап меню
    - do: Тап Сюда
    - assert: |
        Завершилась запись первого трека, в логах отображается событие `report recording finished`
        Открыт экран вариантов маршрута
    - do: Подтвердить новый автомобильный маршрут
    - assert: |
        Началось ведение по автомобильному маршруту
        Началась запись второго трека, в логах отображается событие `report recoding started`
    - do: Лонг-тап по карте
    - do: Тап Заехать
    - assert: |
        Завершилась запись второго трека, в логах отображается событие `report recording finished`
        Открыт экран вариантов маршрута

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Окончание записи трека пешеходного маршрута при изменении точек назначения:
    - *ИнфоЗаписьТреков
    - do: Тап Маршруты
    - do: Построить любой пешеходный маршрут
    - do: Тап "Начать"
    - assert: |
        Началось ведение по пешему маршруту
        В логах отображается событие `report recoding started`
    - do: Лонг-тап по карте
    - assert: Открылось лонг-тап меню
    - do: Тап Сюда
    - assert: |
        Завершилась запись первого трека, в логах отображается событие `report recording finished`
        Открыт экран вариантов маршрута
    - do: Подтвердить новый пеший маршрут
    - assert: |
        Началось ведение по пешему маршруту
        Началась запись второго трека, в логах отображается событие `report recoding started`
    - do: Лонг-тап по карте
    - do: Тап Зайти
    - assert: |
        Завершилась запись второго трека, в логах отображается событие `report recording finished`
        Открыт экран вариантов маршрута

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Перезапись трека при длительном автомобильном ведении:
    - *ИнфоЗаписьТреков
    - do: Поменять значение настройски Debug Panel -> Routes -> Mapkitsim feedback report maximum duration in minutes - 3
    - do: Тап Маршруты
    - do: Построить любой автомобильный маршрут
    - do: Тап "Поехали"
    - assert: |
        Началось ведение по автомобильному маршруту
        В логах отображается событие `report recoding started`
    - do: Подождать 3 минуты
    - assert: |
        Спустя 3 минуты в логах отображаются события:
            - завершение записи `report recording finished`
            - начало записи `report recoding started`
        Промежуток у событий 1-3 секунды

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Перезапись трека при длительном пешеходном ведении:
    - *ИнфоЗаписьТреков
    - do: Поменять значение настройски Debug Panel -> Routes -> Mapkitsim feedback report maximum duration in minutes - 3
    - do: Тап Маршруты
    - do: Построить любой пешеходный маршрут
    - do: Тап "Начать"
    - assert: |
        Началось ведение по пешеходному маршруту
        В логах отображается событие `report recoding started`
    - do: Подождать 3 минуты
    - assert: |
        Спустя 3 минуты в логах отображаются события:
           - завершение записи `report recording finished`
           - начало записи `report recoding started`
        Промежуток у событий 1-3 секунды

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Фильтрация длительности треков при отправке:
    - *ИнфоЗаписьТреков
    - do: |
        Записать первый трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: |
        Записать второй трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: |
        Записать трек по пешеходному маршруту длительностью менее 1 минуты
        (Построить пеший маршрут - перейти в ведение - подождать менее 1 минуты - сбросить маршрут)
    - do: Открыть Меню - Настройки - О приложении - Написать разработчикам
    - assert: |
        Открывается WebView для отправкии обратной связи
        Происходит отправка 2-х треков
        В логах отображаются 2 события `submitted report`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Фильтрация отправленных треков:
    - *ИнфоЗаписьТреков
    - do: |
        Записать трек по пешеходному маршруту длительностью более 1 минуты
        (Построить пеший маршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: Открыть Меню - Настройки - О приложении - Написать разработчикам
    - assert: |
        Открывается WebView для отправкии обратной связи
        Происходит отправка 1 трека
        В логах отображается 1 событие `submitted report`
    - do: Построить и запустить автомобильный маршрут
    - do: Подождать более 1 минуты
    - do: Сбросить маршрут
    - do: Открыть Меню - Настройки - О приложении - Написать разработчикам
    - assert: |
        Открывается WebView для отправкии обратной связи
        Происходит отправка 1 трека
        В логах отображается 1 событие `submitted report`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Максимальное колличество отправлемых треков:
    - *ИнфоЗаписьТреков
    - do: |
        Записать первый трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: |
        Записать второй трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: |
        Записать третий трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: |
        Записать четвертый трек по автомаршруту длительностью более 1 минуты
        (Построить автомаршрут - перейти в ведение - подождать более 1 минуты - сбросить маршрут)
    - do: Открыть Меню - Настройки - О приложении - Написать разработчикам
    - assert: |
        Открывается WebView для отправкии обратной связи
        Происходит отправка 3 треков
        В логах отображаются 3 события `submitted report`
    - do: Переоткрыть WebView для отправкии обратной связи
    - assert: |
        Происходит отправка последнего трека
        В логах отображаются только одно событие вида `submitted report`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Отправка треков после завершения автомаршрута:
    - info: |
        Девайс подключен к инструментам снятия логов
        Ранее не было записанных треков
    - do: |
        Включить эксперименты использую интент:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/mapkitsim_feedback_report%26mapkitsim_feedback_report_send_count%3D3%26mapkitsim_feedback_report_min_duration_minutes%3D1%26mapkitsim_collect_user_reports%26mapkitsim_collect_user_reports_min_duration_minutes%3D1.50bee3c.png){title=QR-код}

        `yandexmaps://add_exp?mapkitsim_feedback_report&mapkitsim_feedback_report_send_count=3&mapkitsim_feedback_report_min_duration_minutes=1&mapkitsim_collect_user_reports&mapkitsim_collect_user_reports_min_duration_minutes=1`
    - do: Тап Маршруты
    - do: Построить любой автомобильный маршрут
    - do: Тап "Поехали"
    - assert: |
        Началось ведение по автомобильному маршруту
        В логах отображается событие `report recoding started`
    - do: Через минуту завершить маршрут
    - assert: |
        Веденее по автомаршруту завершилось
        В логах отображаются события:
          - завершения записи `report recording finished`
          - отправка трека `submitted report`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Отправка треков после завершения пешего маршрута:
    - info: |
        Девайс подключен к инструментам снятия логов
        Ранее не было записанных треков
    - do: |
        Включить эксперименты использую интент:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/mapkitsim_feedback_report%26mapkitsim_feedback_report_send_count%3D3%26mapkitsim_feedback_report_min_duration_minutes%3D1%26mapkitsim_collect_user_reports%26mapkitsim_collect_user_reports_min_duration_minutes%3D1.50bee3c.png){title=QR-код}

        `yandexmaps://add_exp?mapkitsim_feedback_report&mapkitsim_feedback_report_send_count=3&mapkitsim_feedback_report_min_duration_minutes=1&mapkitsim_collect_user_reports&mapkitsim_collect_user_reports_min_duration_minutes=1`
    - do: Тап Маршруты
    - do: Построить любой пешеходный маршрут
    - do: Тап "Начать"
    - assert: |
        Началось ведение по пешему маршруту
        В логах отображается событие `report recoding started`
    - do: Через минуту завершить маршрут
    - assert: |
        Веденее по пешему завершилось
        В логах отображаются события:
          - завершения записи `report recording finished`
          - отправка трека `submitted report`

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Проверка версии мапкита и навикита в дебаг-панели:
    - info: |
        Приложение запущено
    - do: Открыть Debug Panel (Настройки -> Debug Panel)
    - do: Тап на "General information"
    - assert: |
        Открылось меню с информацией
        MapKit version отображается полностью
        NaviKit version отображается полностью

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Проверка работы мапкитсим трека:
    - info: Пользователь авторизован под стафф-аккаунтом
    - do: Включить симуляцию ведения по маршруту (Debug Panel -> Routes  -> Demo movement)
    - do: Построить короткий автомаршрут
    - do: Тап на 'Поехали'
    - assert: Открывается экран ведения по маршруту
    - do: Дождаться окончания автомаршрута
    - do: Открыть Настройки - Маршруты - Сохраненные маршруты
    -  assert: |
        Отображается сохраненный маршрут
        Дата сохранения совпадает с датой создания записи
    - do: Тап на маршрут
    - assert: |
        Появился поп-ап для отправки
        Есть поле ввода комментария
    - do: Тап Не сейчаc
    - assert: Отображается экран Сохраненные маршруты
    - do: Тап на маршрут
    - do: Тап на Отправить
    - assert: |
        Мапкитсим отправился
        Отображается номер тикета
    - do: Тап на Удалить записи
    - assert: Нет записей о сохраненных маршрутах

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        