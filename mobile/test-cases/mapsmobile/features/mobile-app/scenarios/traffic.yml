testing:
  - regress
components: traffic

specs:
  Включение пробок:
    - info: Слой пробок выключен
    - do: Включить слой пробок
    - assert: |
        Слой пробок включен
        На кнопке светофора указан балл пробок
        При отсутствии пробок отображается серая заглушка
    - do: Включить слой пробок в Большие Яндекс.Карты для этого же спана карты
    - assert: Данные о пробках одинаковые
    - do: Выключить слой пробок
    - assert: Слой пробок выключен

    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android

  Сохранение статуса отображения пробок после перезапуска приложения:
    - info:
        ММП в городе с баллом пробок (например, Москва, санкт Петербург, Екатеринбург и др)
        Слой пробок выключен
    - do: Включить слой пробок
    - assert: |
        Слой пробок включен
        На кнопке светофора указан балл пробок
        При отсутствии пробок отображается серая заглушка
    - do: Перезапустить приложение
    - assert: Данные о пробках одинаковые
    - do: Выключить слой пробок
    - assert: Слой пробок выключен
    - do: Перезапустить приложение
    - assert: Слой пробок выключен

    - tags:
        - assessors
        - newbie
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - platforms:
        - ios
        - android

  Выключение слоя "Пробки" через меню:
    - info: Слой пробок включен
    - do: Тап по кнопке "Слои"
    - assert: |
        Открыт экран Слои
        Пункт пробки включен
        На видимой части спана карты отображается слой пробок
    - do: Тап на Пробки
    - assert: |
        Пункт пробки выключен
        На видимой части спана карты не отображается слой пробок
    - do: Закрыть экран "Слои"
    - assert: |
        Открыт главный экран приложения
        Слой пробок выключен

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - use_map
        - mapkit_ready
    - platforms:
        - ios
        - android

  Включение слоя "Пробки" через меню:
    - info: |
        Слой пробок выключен
        Отображается главный экран приложения
    - do: Тап по кнопке слоев
    - assert: |
        Открыт экран слоев
        Пункт пробки выключен
        На видимой части спана карты не отображается слой пробок
    - do: Тап на Пробки
    - assert: |
        Пункт пробки включен
        На видимой части спана карты отображается слой пробок
    - do: Закрыть экран слоев
    - assert: |
        Открыт главный экран приложения
        Слой пробок включен

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - use_map
        - mapkit_ready
    - platforms:
        - ios
        - android

  Включение/выключение пробок из меню в режиме ведения по маршруту:
    - info: |
        Debug-panel > Experiments > no_toolbar_in_guidance > on
        Слой пробок выключен
        Отображается экран ведения по маршруту
    - do: Тап на Меню > Пробки
    - assert: |
        Пункт пробки включен
        На видимой части спана карты отображается слой пробок
    - do: Закрыть меню
    - assert: |
        Открыт экран ведения по маршруту
        Слой пробок включен
    - do: Тап на Меню > Пробки
    - assert: |
        Пункт пробки выключен
        На видимой части спана карты не отображается слой пробок
    - do: Закрыть меню
    - assert: |
        Открыт экран ведения по маршруту
        Слой пробок выключен

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - use_map
        - mapkit_ready
    - platforms:
        - ios


  Переключение между слоями:
    - info: |
        Слой пробок выключен
        Отображается главный экран приложения
    - do: Включить слой пробок
    - assert: Слой пробок включен
    - do: Включить слой парковок
    - assert: |
        Слой пакровок включен
        Слой пробок выключен
    - do: Включить слой ОТ
    - assert: |
        Слой пакровок включен
        Слой ОТ включен
    - do: Включить слой пробок
    - assert: |
        Слой пробок включен
        Слой парковок выключен
        Слой ОТ включен

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - newbie
        - mapkit_ready
    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps


  Сохранение статуса отображения пробок в режиме автоведения по маршруту:
    - info: |
        Debug-panel > Experiments > no_toolbar_in_guidance > on
        Слой пробок выключен
        Отображается экран выбора вариантов маршрута
    - do: Включить слой пробок
    - assert: |
        Слой пробок включен
        Отображается экран выбора вариантов маршрута
    - do: Перестроить маршрут
    - assert: |
        Слой пробок включен
        Отображается экран выбора вариантов маршрута
        Маршрут перестроен
    - do: Перейти в ведение по маршруту
    - assert: |
        Слой пробок включен
        Происходит ведение по маршруту
    - do: Тап на Меню > Пробки
    - assert: |
        Пункт пробки выключен
        На видимой части спана карты не отображается слой пробок
    - do: Закрыть меню
    - assert: |
        Открыт экран ведения по маршруту
        Слой пробок выключен
    - do: Сбросить маршрут
    - assert: |
        Открыт главный экран приложения
        Слой пробок выключен

    - tags:
        - assessors
        - use_map
    - platforms:
        - ios


  Включение слоя пробок при переходе в таб Навигатор:
    - info: |
        Первый запуск приложения после установки
        Открыт главный экран
        Слой пробок выключен
    - do: Перейти в таб Навигатор
    - assert: Слой пробок включен
    - do: Выйти из таба Навигатор
    - assert: |
        Открыт главный экран
        Слой пробок выключен
    - do: Тап на кнопку слоя пробок в виде светофора
    - assert: Слой пробок включен
    - do: Перейти в таб Навигатор
    - assert: Слой пробок включен
    - do: Выйти из таба Навигатор
    - assert: Слой пробок включен

    - tags:
        - parity
        - assessors
        - use_map
        - newbie
    - platforms:
        - ios


  Идентичное состояние слоя пробок на главном экране и в табе Навигатор:
    - info: |
        Открыт главный экран
        Слой пробок выключен
    - do: |
        Включить слой пробок
        Выключить слой пробок
    - assert: |
        Открыт главный экран
        Слой пробок выключен
    - do: Перейти в таб Навигатор
    - assert: Слой пробок выключен
    - do: Включить слой пробок
    - assert: Слой пробок выключен
    - do: Выйти из таба навигатор
    - assert: |
        Открыт главный экран
        Слой пробок выключен

    - tags:
        - parity
        - assessors
        - use_map
    - platforms:
        - ios


  Идентичное состояние слоя пробок на главном экране и в табе Навигатор во фридрайве:
    - info: |
        Происходит симуляция движения:
        На iOS: через Настройки->Debug-Panel->Routes->Enter your route(*)
        *Для запуска симуляции нужно отметить начальную и конечную точки маршрута на карте, сохранить и вернуться на главный экран приложения.
        Курсор ммп движется по карте
        Включен таб Навигатор
        Выключен слой пробок
    - do: Включить слой пробок
    - assert: Слой пробок включен
    - do: Выйти из таба Навигатор
    - assert: |
        Открыт главный экран
        Слой пробок включен
    - do: Выключить слой пробок
    - assert: Слой пробок выключен
    - do: Перейти в таб Навигатор
    - assert: Слой пробок выключен

    - tags:
        - parity
        - assessors
        - use_map
    - platforms:
        - ios


  Мультизум при включенном слое пробок:
    - info: |
        При зуме кнопками +/- может создаваться ощущение перезагрузки пробок на 15 и 18 зумах, так как пробки перезагружаются между 14-15 и 17-18 зумах
        Отображается главный экран приложения
        Пробки выключены
        Установлен 14 зум (самый ближний 21)
    - do: Включить слой пробок
    - assert: Слой пробок включен
    - do: Зумить карту от 14 до 21 зума
    - assert: |
        Пробки не перезагружаются в пределах 15-17 и 18-21 зумов
        Перезагрузка происходит на 17-18
    - do: Два раз тап на светофор
    - assert: Пробки выключились-включились
    - do: Зумить карту от 14 до 21 зума
    - assert: |
        Пробки не перезагружаются в пределах 15-17 и 18-21 зумов
        Перезагрузка происходит на 17-18

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android


  Отображение пробок с включенным экспериментом vulkan_rendering:
    - info: |
        Включен экперимент vulkan_rendering
        Отображается главный экран приложения
        Пробки выключены
    - do: Тап на светофор
    - assert: Включен слой пробок
    - do: Позумить, поскролить карту
    - assert: |
        На карте присутствуют пробки зеленого, желтого, красного и черного цвета
        Пробки отобажаются корректно

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android


  Длинные тесты на стабильность пробок, если vulkan_rendering включен:
    - info: |
        Включен экперимент vulkan_rendering
        Отображается главный экран приложения
        Пробки выключены
    - do: Тап на светофор
    - assert: Слой пробок включен
    - do: Заблокировать экран устройства
    - do: Подождать 15-20 минут
    - do: Разблокировать экран
    - assert: |
        Отображается главный экран приложения
        Пробки включены
    - do: Поскроллить карту на разных масштабах по длинному маршруту (от Питера до Владивостока и обратно) в течение 10-15 мин
    - assert: |
        Отображается главный экран приложения
        Пробки включены
    - do: Отключить экперимент vulkan_rendering
    - do: Перезапустить приложение
    - assert: |
        Отображается главный экран приложения
        Пробки включены

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android
    - estimatedTime: 25m


  Длинные тесты на стабильность пробок, если vulkan_rendering выключен:
    - info: |
        Выключен экперимент vulkan_rendering
        Отображается главный экран приложения
        Пробки выключены
    - do: Тап на светофор
    - assert: Слой пробок включен
    - do: Заблокировать экран устройства
    - do: Подождать 15-20 минут
    - do: Разблокировать экран
    - assert: |
        Отображается главный экран приложения
        Пробки включены
    - do: Поскроллить карту на разных масштабах по длинному маршруту (от Питера до Владивостока и обратно) в течение 10-15 мин
    - assert: |
        Отображается главный экран приложения
        Пробки включены

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android
    - estimatedTime: 25m


  Работа пробок в обычном режиме, если vulkan_rendering включен:
    - info: |
        Включен экперимент vulkan_rendering
        Темный режим выключен (Меню -> Настройки -> Основные)
        Отображается главный экран приложения
        Карта в режиме 2D
        Пробки выключены
    - do: Тап на светофор
    - assert: Слой пробок включен
    - do: Отзумиться до самого обзорного масштаба, на котором начинают показываться пробки
    - assert: Пробки начинают показываться на 3.5 зуме
    - do: Начать зумиться по одному масштабу за раз, пока не достигли самого подробного
    - do: На каждом масштабе крутить карту, таскать из стороны в сторону, менять ориентацию устройства
    - assert: |
        Пробки отображаются на зумах 3.5 и выше
        Стрелки пробок не обрезаются
    - do: Свайп двумя пальцами вверх
    - do: Свайп двумя пальцами вниз
    - assert: Пробки наклонились вместе с картой, потом вернулись
    - do: Передвинуть и позумить карту так, что в центре экрана Москва
    - assert: Отображается балл пробок на светофоре
    - do: Передвинуть карту на Иркутск
    - assert: Отображается балл пробок на светофоре
    - do: Передвинуть карту так, что в центре экрана находится Европа
    - assert: Балл пробок на светофоре не отображается
    - do: Включить темный режим
    - do: Вернуться на главный экран приложения
    - assert: Карта и пробки начали отображаться в ночном режиме
    - do: Выключить темный режим
    - do: Вернуться на главный экран приложения
    - assert: Карта и пробки начали отображаются в дневном режиме

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android


  Работа пробок в обычном режиме, если vulkan_rendering выключен:
    - info: |
        Выключен экперимент vulkan_rendering
        Темный режим выключен (Меню -> Настройки -> Основные)
        Отображается главный экран приложения
        Карта в режиме 2D
        Пробки выключены
    - do: Тап на светофор
    - assert: Слой пробок включен
    - do: Отзумиться до самого обзорного масштаба, на котором начинают показываться пробки
    - assert: Пробки начинают показываться на 3.5 зуме
    - do: Начать зумиться по одному масштабу за раз, пока не достигли самого подробного
    - do: На каждом масштабе крутить карту, таскать из стороны в сторону, менять ориентацию устройства
    - assert: |
        Пробки отображаются на зумах 3.5 и выше
        Стрелки пробок не обрезаются
    - do: Свайп двумя пальцами вверх
    - do: Свайп двумя пальцами вниз
    - assert: Пробки наклонились вместе с картой, потом вернулись
    - do: Передвинуть и позумить карту так, что в центре экрана Москва
    - assert: Отображается балл пробок на светофоре
    - do: Передвинуть карту на Иркутск
    - assert: Отображается балл пробок на светофоре
    - do: Передвинуть карту так, что в центре экрана находится Европа
    - assert: Балл пробок на светофоре не отображается
    - do: Включить темный режим
    - do: Вернуться на главный экран приложения
    - assert: Карта и пробки начали отображаться в ночном режиме
    - do: Выключить темный режим
    - do: Вернуться на главный экран приложения
    - assert: Карта и пробки начали отображаются в дневном режиме

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android


  Отображение пробок с мобильной сетью:
    - info: |
        Вставлена сим-карта в устройство
        Режим сети 4G
        Отображается главный экран приложения
        Пробки выключены
    - do: Тап по светофору
    - assert: Слой пробок включен
    - do: Отключить интернет
    - do: Перевести режим сети в "Только 3G"
    - do: Включить интернет спустя 2 минуты
    - assert: Пробки и карта загружаются
    - do: Отключить интернет
    - do: Подождать 2 минуты
    - do: Включить интернет
    - assert: Пробки и карта загружаются

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android


  Состояние светофора после запуска приложения без сети:
    - info: |
        Отображается главный экран приложения на спане Москвы
        Пробки выключены
    - do: Закрыть приложение выгрузив из памяти
    - do: Отключить интернет
    - do: Запустить приложение на спане Москвы
    - assert: Отображается главный экран приложения на спане Москвы
    - do: Тап по светофору
    - assert: |
        Пробки не отображаются на карте
        Светофор в состоянии загрузки
    - do: Позумиться и подвигать карту
    - assert: |
        Пробки не отображаются на карте
        Светофор в состоянии загрузки
    - do: Включить интернет
    - assert: |
        Отображается пробки на карте
        На светофоре отображается балл пробок
    - do: Выключить пробки
    - assert: |
        Пробки перестали отображаться на карте
        На светофоре балл пробок не отображается
    - do: Выключить интернет
    - do: Включить пробки
    - assert: |
        Светофор показывает балл и цвет пробок
        Пробки отображаются на карте
    - do: Подождать >20 минут (экран телефона должен оставаться включенным)
    - assert: Светофор перешел в состояние устаревания (серый)
    - do: Выключить пробки
    - assert: |
        Пробки перестали отображаться на карте
        На светофоре балл пробок не отображается
    - do: Включить пробки
    - assert: Светофор в состоянии загрузки
    - do: Включить интернет
    - do: Несколько раз сменить ориентацию устройства
    - assert: |
        Пробки обновились
        Светофор стал показывать актуальный балл и цвет пробок

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android
    - estimatedTime: 25m


  Устаревание пробок:
    - info: |
        Интернет включен
        Пробки выключены
        Приложение не запущено
    - do: Запустить приложение на спане Москвы
    - do: Тап по светофору
    - assert: |
        Отображаются пробки на карте
        На светофоре отображается балл пробок
    - do: Выключить пробки
    - assert: |
        Пробки перестали отображаться на карте
        На светофоре балл пробок не отображается
    - do: Выключить интернет
    - do: Включить пробки
    - assert: |
        Светофор показывает балл и цвет пробок
        Пробки отображаются на карте
    - do: Подождать >20 минут (экран телефона должен оставаться включенным)
    - assert: Светофор перешел в состояние устаревания (серый)
    - do: Включить интернет
    - assert: |
        Пробки обновились
        Светофор стал показывать актуальный балл и цвет пробок

    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
    - platforms:
        - ios
        - android
    - estimatedTime: 25m