testing:
  - regress
components: route_guidance_search

specs:
  Поиск по категории рядом с полилинией очень короткого автомаршрута:
    - info: |
        Построен автомаршрут от текущего местоположения с 1 точкой маневра
        Открыт режим ведения по автомаршруту
        Происходит симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап по кнопке поиска.
    - assert: |
        Открывается форма поиска
        Вверху на форме кнопка голосового поиска
    - do: Тап по категории. Например, по Где поесть.
    - assert: |
        Форма Поиск свернулась
        На кнопке лупы теперь также отображается название поисковой категории и белый крестик для закрытия поиска
        На карте, вокруг линии автомаршрута, отображаются пины результатов поиска по выбранной категории
        Если рядом с линией автомаршрута не найдено результатов, то они могут быть разбросаны поблизости

    - platforms:
      - ios
      - android
    - tags:
      - assessors

  Поиск по категории рядом с полилинией короткого автомаршрута между точками, не совпадающими с текущим местоположением:
    - info: |
        Проложен короткий маршрут между точками, не совпадающими с текущим местоположением
        Открыта форма ведения по автомаршруту
        Происходит симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Отзумиться на более высокий зум, чтобы был виден маршрут и точка текущего местоположения.
    - assert: Масштаб карты уменьшился, виден масштаб и точка текущего местоположения.
    - do: Тап по кнопке Поиск -> тап по категории, например, Где поесть.
    - assert: Пины результатов поиска расположились на пути между начальной точкой маршрута и точкой В.

    - platforms:
      - ios
    - tags:
      - assessors
      - use_map


  Поиск по категории на форме ведения по автомаршруту после включения в него промежуточных точек:
    - info: |
        Построен короткий автомаршрут из точки текущего местоположения
        Отображается экран ведения по автомаршруту
        Происходит симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап по кнопке поиска
    - assert: Отображается меню поиска
    - do: Тап по любой категории
    - assert: |
         Отображается экран ведения по маршруту
         На карте вдоль линии маршрута отображаются пины результатов поиска
    - do: Подвинуть карту так, чтобы появились результаты поиска в стороне от маршрута
    - assert: На открытом участке карты появились пины результатов поиска
    - do: Тап по пину результата поиска
    - do: Тап на Заехать
    - assert: На экране маршрута отображается перестроенный маршрут с учетом промежуточной точки
    - do: Тап Поехали
    - assert: Возобновляется ведение по маршруту от начальной точки
    - do: Тап по кнопке поиска
    - do: Тап по любой категории
    - assert: |
        Отображается экран ведения по маршруту
        Вдоль линии перестроенного маршрута отображаются пины результатов поиска

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - mapkit_ready
    - integration_run:
      - mapkit


  Поиск по категории рядом с полилинией длинного автомаршрута:
    - info: |
        ММП пользователя определено
        Открыт экран ведения по автомаршруту
        Происходит симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап на лупу
    - assert: Отображается меню с поисковыми категориями
    - do: Тап по любой категории
    - assert: Пины результатов поиска расположены вдоль линии маршрута
    - do: Тап на любой поисковый пин
    - assert: |
        Пин изменил состояние на активный
        Открылась мини-карточка организации
        Отображаются кнопки Сюда и Заехать
    - do: Тап на Заехать
    - assert: |
        К общему времени маршрута прибавилось время, которое было указанно под кнопкой Заехать
        На маршруте появилась промежуточная точка
    - do: Перейти в режим ведения
    - assert: |
        Произошел переход в режим ведения
        Маршрут проходит через добавленную промежуточную точку

    - platforms:
      - ios
      - android
    - tags:
      - assessors
      - newbie
    - testing:
      - acceptance_maps
      - lite_acceptance_maps


  Поиск в ведении по длинному маршруту:
    - info: |
        Построен длинный автомобильный маршрут в пределах текущего города
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап Поехали
    - assert: Открывается экран ведения по маршруту
    - do: Тап по кнопке поиска
    - assert: |
        Отображается меню поиска с поисковым категориями
        Над категориями отображается кнопка голосового поиска
    - do: Тап по любой категории
    - assert: |
        Карта отдаляется
        На карте отображаются пины соответствующей категории на пути маршрута
        Поисковые пины располагаются вдоль маршрута
        Некоторые могут быть сбоку, но основная часть должна быть на маршруте
        На кнопке поиска отображается название поисковой категории и крестик
    - do: Тап по крестику
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются
    - do: Тап по кнопке поиска
    - assert: |
        Отображается меню поиска с поисковым категориями
        Над категориями отображается кнопка голосового поиска
    - do: Тап на Ещё
    - assert: Открывается экран поиска с поисковыми категориями
    - do: Тап Назад или Закрыть
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - testing:
        - lite_acceptance_maps
    - tags:
        - assessors
        - mapkit_ready
        - newbie


  Отображение пустой истории в новом объединенном поиске:
    - info: |
        Включен таб навигатора
        У пользователя нет истории поиска
    - do: Тап по табу Поиск
    - assert: |
        Отображается список категорий
        Под списком категорий отображается блок истории с заглушкой
    - do: Перейти в режим ведения по маршруту
    - assert: Отображается экран ведения
    - do: Тап по поиску
    - do: Тап еще
    - assert: |
        Отображается список категорий
        Под списком категорий отображается блок истории с заглушкой

    - platforms:
      - ios
      - android
    - tags:
      - assessors
    - testing:
      - acceptance_maps

  Отображение и сохранение истории поиска в новом обьединенном поиске при включенном табе навигатора:
    - info: |
        Включен эксперимент search_screen_with_history
        Включен таб навигатора
    - do: Тап по табу Поиск
    - assert: |
        Отображается список категорий
        Под списком категорий отображается блок истории
    - do: Произвести поиск
    - assert: Отображаются результаты поиска
    - do: Закрыть результаты поиска
    - do: Тап по табу Поиск
    - assert: В блоке истории отображается последний запрос

    - platforms:
      - ios
      - android
    - tags:
      - assessors

  Отображение и сохранение истории поиска в новом обьединенном поиске при ведении:
    - info: |
        Включен эксперимент search_screen_with_history
        Отображается экран ведения
    - do: Тап по Поиску
    - do: Тап еще
    - assert: |
        Отображается список категорий
        Под списком категорий отображается блок истории
    - do: Произвести поиск
    - assert: Отображаются результаты поиска
    - do: Закрыть результаты поиска
    - assert: Отображается экран ведения по маршруту
    - do: Тап по Поиску
    - do: Тап еще
    - assert: |
        Отображается список категорий
        Под списком категорий отображается блок истории
        В блоке истории присутствует последний запрос

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps

  Война пинов. Поиск в ведении по маршруту:
    - info: |
        iOS: Включен эксперимент mpp_search_layer
        Построен автомобильный маршрут
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап Поехали
    - assert: Открывается экран ведения по маршруту
    - do: Тап по кнопке поиска
    - assert: |
        Открывается экран выбора категорий
        Над категориями отображается кнопка голосового поиска
    - do: Тап по любой категории
    - assert: |
        Карта отдаляется
        Поисковые пины располагаются вдоль маршрута
        Некоторые могут быть сбоку, но основная часть должна быть на маршруте
        На кнопке поиска отображается название поисковой категории и крестик
    - do: Тап по крестику
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются
    - do: Тап по кнопке поиска
    - assert: |
        Открывается экран выбора категорий
        Над категориями отображается кнопка голосового поиска
    - do: Тап Ещё
    - assert: Открывается экран поиска с поисковыми категориями
    - do: Тап Назад или Закрыть
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - kotlin
        - mapkit


  Обновление поисковой выдачи при движении по маршруту:
    - info: |
        Построен маршрут в пределах текущего города (около 3 - 5 км.)
        Отображается экран ведения по автомаршруту
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап по кнопке поиска
    - do: Выполнить поиск по любой категории
    - do: Тап на контролл ММП
    - assert: |
        Отображается экран ведения по маршруту
        Вдоль линии маршрута отображаются поисковые пины, соответствующие поисковой выдаче
        По мере движения по маршруту поисковая выдача обновляется
    - do: Дождаться завершения маршрута
    - assert: |
        Звучит аннотация "Вы приехали"
        Ведение по маршруту завершено
        Отображается главный экран приложения
        Поисковые пины не отображаются

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - mapkit


  Поиск в офлайн ведении:
    - info: |
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Выключен интернет
        Построен автомобильный маршрут
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Тап Поехали
    - assert: Открывается экран ведения по маршруту
    - do: Тап по кнопке поиска
    - assert: |
        Отображается меню поиска с поисковым категориями
        Над категориями отображается кнопка голосового поиска
    - do: Тап по любой категории
    - assert: |
        Карта отдаляется
        На карте отображаются пины соответствующей категории на пути маршрута
        Поисковые пины располагаются вдоль маршрута
        Некоторые могут быть сбоку, но основная часть должна быть на маршруте
        На кнопке поиска отображается название поисковой категории и крестик
    - do: Тап по крестику
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются
    - do: Тап по кнопке поиска
    - assert: |
        Отображается меню поиска с поисковым категориями
        Над категориями отображается кнопка голосового поиска
    - do: Тап на Ещё
    - assert: Открывается экран поиска с поисковыми категориями
    - do: Тап Назад или Закрыть
    - assert: |
        Открыт экран ведения по маршруту
        Поисковые пины не отображаются

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - testing:
        - lite_acceptance_maps
    - tags:
        - assessors
        - mapkit_ready
        - newbie


  Поиск в ведении при переключении на альтернативный маршрут:
    - info: |
        Включить: Настройки - Маршруты - Показывать альтернативные маршруты во время движения
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
        Открыт экран обзора с построенным автомаршрутом с альтернативами
    - do: Тап на альтернативный маршрут
    - assert: |
        Выбранный сниппет маршрута окрашивается в синий цвет
        Выбранный маршрут окрашивается в цвет пробок
    - do: Тап на "Поехали"
    - assert: начинается ведение по выбранному маршруту
    - do: Тап на кнопку поиска
    - assert: |
        Отображается меню поиска с поисковыми категориями
        Над категориями отображается кнопка голосового поиска
    - do: Тап по любой категории
    - assert: |
        Происходит отзум карты
        На карте отображаются пины соответствующей категории на пути маршрута
        Поисковые пины располагаются вдоль маршрута
        На кнопке поиска отображается название поисковой категории и крестик
    - do: Закрыть поиск
    - assert: |
        Кнопка поиска категории закрывается
        Открыт экран ведения по маршруту
        Выбранные поисковые пины не отображаются вдоль маршрута
    - do: Тап по альтернативному маршруту
    - assert: |
        Открыт экран ведения по маршруту
        Кнопка поиска категории не появляется

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps
