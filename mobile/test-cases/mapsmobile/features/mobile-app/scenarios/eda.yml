components: eda
testing:
  - regress
tags:
  - advertisement

specs:
  Переход к оформлению заказа самовывозом через СТА-кнопку "Заказать с собой" в негеопродуктовой организации:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка негеопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отображается СТА-кнопка "Заказать с собой"
    - do: Тап на кнопку "Заказать с собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - assessors


  Переход к оформлению заказа самовывозом через action-бар в негеопродуктовой организации:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка негеопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отображается СТА-кнопка "Заказать с собой"
    - do: Свернуть карточку организации до состояния мини-карточки
    - assert: |
        Открыта мини-карточка организации
        В action-баре отображается СТА-кнопка "Заказать с собой"
    - do: Тап на кнопку "Заказать с собой"
    - assert: |
        Открывается полная карточка организации
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Переход к оформлению заказа самовывозом через таб "С собой" в негеопродуктовой организации:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка негеопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отображается СТА-кнопка "Заказать с собой"
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - newbie


  Открытие плашки заказа Еды из единой плашки:
    - info: |
        Девайс в вертикальной ориентации
        Пользователем оформлены заказы самоката, Еды, такси
        Отображается единая плашка с иконками Самоката, Такси, Еды
    - do: Тап на плашку
    - assert: |
        Единая плашка раскрылась
        Отображаются плашки заказов самоката, Такси и Еды
        У каждой плашки отображается актуальный статус
    - do: Сменить ориентацию девайса
    - assert: |
        Отображается Webview заказа Еды
    - do: Сменить ориентацию девайса
    - assert: |
        Плашки не свернулись в единую плашку
    - do: Тап на плашку заказа Еды
    - assert: |
        Отображается Webview заказа Еды
    - do: Закрыть Webview заказа Еды
    - assert: |
        Отображаются плашки заказов такси, Еды, самоката
    - do: Тап на пустое пространство на карте
    - assert: |
        Отображается Webview заказа Еды

    - platforms:
        - ios
    - testing:
        - acceptance_maps


  Переход к оформлению заказа самовывозом через СТА-кнопку "Заказать с собой" в геопродуктовой организации без СТА-кнопки:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка геопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отсутсвует СТА-кнопка геопродукта (пример Il Letterato Петроверигский пер., 4, стр. 4 https://yandex.ru/maps/org/il_letterato/77138636089)
        Над табами отображается СТА-кнопка "Заказать с собой"
    - do: Тап на кнопку "Заказать с собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - newbie


  Переход к оформлению заказа самовывозом через action-бар в геопродуктовой организации без СТА-кнопки:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка геопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отсутсвует СТА-кнопка геопродукта (пример Il Letterato Петроверигский пер., 4, стр. 4 https://yandex.ru/maps/org/il_letterato/77138636089)
        Над табами отображается СТА-кнопка "Заказать с собой"
    - do: Свернуть карточку организации до состояния мини-карточки
    - assert: |
        Открыта мини-карточка организации
        В action-баре отсутсвует СТА-кнопка геопродукта
        В action-баре отображается СТА-кнопка "Заказать с собой"
    - do: Тап на кнопку "Заказать с собой"
    - assert: |
        Открывается полная карточка организации
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps
        - acceptance_maps
    - tags:
        - assessors


  Переход к оформлению заказа самовывозом через таб "С собой" в геопродуктовой организации с СТА-кнопкой:
    - info: |
        Получен эксперимент show_eda_takeaway
        Открыта полная карточка геопродуктовой организации
        В организации поддерживается самововывоз Еды - отображается таб "С собой" (самовывоз поддерживается не во всех организациях)
        В карточке организации отсутсвует СТА-кнопка "Заказать с собой"
        Над табами отображается СТА-кнопка геопродукта
    - do: Свернуть карточку организации до состояния мини-карточки
    - assert: |
        Открыта мини-карточка организации
        В action-баре отображается СТА-кнопка геопродукта
        В action-баре отсутствует кнопка "Заказать с собой"
    - do: Развернуть карточку организации до полной
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - assessors


  Отображение кнопки заказа еды на вынос в табе Меню:
    - info: |
        Получен эксперимент show_eda_takeaway
        Заказ еды на вынос поддерживается не во всех организациях
    - do: Открыть полную карточку организации с поддержкой заказа еды на вынос и табом "Меню"
    - do: Тап на таб "Меню" в карточке организации
    - assert: |
        Отображается меню организации
        В action-баре присутствует кнопка "Заказать с собой"
        В action-баре отсутствует кнопка "Заказать доставку"
    - do: Тап на кнопку "Заказать с собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отображение статуса заказа самовывоза Еды:
    - info: |
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
        Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
        В вебвью оформить заказ с оплатой наличными
        Пользователь после создания заказа находится в вебвью в табе "С собой", отображается текущий заказ
    - do: Тап на крестик в карточке организации
    - assert: |
        Карточка организации закрылась
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа "Заказ создан"
    - do: Свернуть и развернуть приложение
    - assert: |
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа
    - do: Тап на плашку со статусом заказа
    - assert: |
        Открывается карточка организации с вебвью со статусом заказа
    - do: Тап на крестик в карточке организации
    - assert: |
        Вебвью закрылось
        Открылся главный экран приложения
        Внизу экрана отображается плашка отслеживания статуса заказа

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - newbie


  Отображение статуса заказа самовывоза Еды в режиме фридрайв:
    - info: |
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
        Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
        В вебвью оформить заказ с оплатой наличными
        Пользователь после создания заказа находится в вебвью в табе "С собой", отображается текущий заказ
    - do: Тап на крестик в карточке организации
    - assert: |
        Карточка организации закрылась
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа "Заказ создан"
    - do: Тап на таб Навигатор
    - assert: |
        Произошел переход в режим фридрайв
        Маршрутный саджест не перекрывает иконку местоположения
        Отображается плашка отслеживания статуса заказа
    - do: Тап на плашку со статусом заказа
    - assert: |
        Открывается карточка организации с вебвью со статусом заказа
    - do: Тап на крестик в карточке организации
    - assert: |
        Вебвью закрылось
        Открылся режим фридрайв
        Внизу экрана отображается плашка отслеживания статуса заказа

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение статуса заказа самовывоза Еды в ведении:
    - info: |
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
        Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
        В вебвью оформить заказ с оплатой наличными
        Пользователь после создания заказа находится в вебвью в табе "С собой", отображается текущий заказ
    - do: Тап на крестик в карточке организации
    - assert: |
        Карточка организации закрылась
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа "Заказ создан"
    - do: Любым способом построить автомобильный машрут в любую точку
    - do: Тап "Поехали"
    - assert: |
        Произошел переход в режим ведения по маршруту
        Отображается плашка отслеживания статуса заказа
    - do: Тап на плашку со статусом заказа
    - assert: |
        Открывается карточка организации с вебвью со статусом заказа
    - do: Тап на крестик в карточке организации
    - assert: |
        Вебвью закрылось
        Открылся режим ведения по маршруту
        Внизу экрана отображается плашка отслеживания статуса заказа

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps

  Смена статуса заказа самовывоза Еды:
    - info: |
        Необходим доступ к тестовой админке https://testing-admin.eda.tst.yandex.net
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
        Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
        В вебвью оформить заказ с оплатой наличными
        Пользователь после создания заказа находится в вебвью в табе "С собой", отображается текущий заказ
    - do: Тап на крестик в карточке организации
    - assert: |
        Карточка организации закрылась
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа "Заказ создан"
    - do: В Charles скопировать значение "orderId" из ответа ручки https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/eats/get_active_orders
    - do: На компьютере в браузере открыть урл https://testing-admin.eda.tst.yandex.net/orders/{номер_заказа}/edit, вставив вместо {номер_заказа} номер заказа скопированный из Charles
    - assert: Открывается тестовая админка с заказом
    - do: В админке клик на кнопку "Подтверждено рестораном"
    - do: В админке в поп-апе клик "Продолжить"
    - assert: В приложении статус заказа меняется на "Заказ {последние 4 цифры номера заказа} готовят"
    - do: В админке клик на кнопку "Заказ готов"
    - do: В админке в поп-апе клик "Продолжить"
    - assert: В приложении статус заказа меняется на "Заказ {последние 4 цифры номера заказа} готов"
    - do: В админке клик на кнопку "Доставлено"
    - do: В админке в поп-апе клик "Продолжить"
    - assert: В приложении статус заказа меняется на "Миссия выполнена"
    - do: Тап на плашку со статусом заказа
    - assert: Отображается сообщение "Как вам заказ?"
    - do: Тап "Закрыть"
    - assert: |
        Отображается вебвью со статусом заказа самовывоза Еды
    - do: Тап на крестик
    - assert: |
        Вебвью закрылось
        Открылся главный экран приложения
        Внизу экрана отображается плашка отслеживания статуса заказа "Миссия выполнена"
        Через несколько минут плашка со статусом исчезает (до 20 минут)

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - newbie


  Оплата Самовывоза Еды с помощью Apple Pay/Google Pay:
    - info: |
        Кейс проходится только на продовых или TF сборках
        Добавлена карта в Apple Pay/Google Pay
        Получен эксперимент show_eda_takeaway
        Получен эксперимент: iOS: taxi_webview_applepay; Android:taxi_webview_googlepay
        Для возврата личных средств, затраченных в целях тестирования (если не успели отменить заказ) использовать [инструкцию] (https://wiki.yandex-team.ru/jandekskarty/testing/navi/rasxody-po-korp-karte/)
        Пользователь авторизован
        Открыта полная карточка организации с поддержкой заказа еды на вынос
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды
    - do: Добавить товар в корзину
    - assert: Появилась кнопка оформления заказа
    - do: Тап на кнопку оформления заказа
    - assert: Открылась форма оформления заказа
    - do: Тап Далее
    - assert: Открылся блок для подтверждения данных оплаты и получения
    - do: Тап на пункт выбора способа оплаты
    - assert: Открывается экран с выбором способа оплаты
    - do: Тап на способ оплаты Apple Pay/Google Pay
    - assert: |
        Экран с выбором способа оплаты закрылся
        Для оплаты выбран Apple Pay/Google Pay
    - do: Тап Оплатить
    - assert: |
        Происходит успешная оплата
        Открывается экран со статусом заказа
    - do: Тап Отменить заказ
    - assert: |
        Заказ отменен
        Средства возвращены на карту (может потребоваться несколько минут)

    - platforms:
        - ios
        - android


  Отображение способа оплаты Apple Pay/Google Pay при отсутствии добавленной карты:
    - info: |
        Не добавлена карта в Apple Pay/Google Pay
        Получен эксперимент show_eda_takeaway
        Получен эксперимент: iOS: taxi_webview_applepay; Android:taxi_webview_googlepay
        Пользователь авторизован
        Открыта полная карточка организации с поддержкой заказа еды на вынос
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды
    - do: Добавить товар в корзину
    - assert: Появилась кнопка оформления заказа
    - do: Тап на кнопку оформления заказа
    - assert: Открылась форма оформления заказа
    - do: Тап Далее
    - assert: Открылся блок для подтверждения данных оплаты и получения
    - do: Тап на пункт выбора способа оплаты
    - assert: |
        Открывается экран с выбором способа оплаты
        Среди способов оплаты присутствует Apple Pay/Google Pay
    - do: Тап на Apple Pay/Google Pay
    - assert: Происходит переход в приложение Apple Pay/Google Pay для добавления карты

    - platforms:
        - ios
        - android


  Авторизация в приложении через вебвью самовывоза еды:
    - info: |
        Получен эксперимент show_eda_takeaway
        Пользователь не авторизован в приложении
        Открыта полная карточка организации с поддержкой заказа еды на вынос
    - do: Тап на таб "С собой"
    - assert: |
        Открывается таб "С собой"
        Отображается вебвью оформления заказа самовывоза Еды
    - do: Добавить товар в корзину
    - assert: Появилась кнопка оформления заказа
    - do: Тап на кнопку оформления заказа
    - assert: Открылся блок авторизации в приложении
    - do: Авторизоваться в приложении
    - assert: |
        Пользователь авторизован
        Открылся экран оформления заказа на добавленный ранее товар

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отображение статуса "Заказ создан" заказа самовывоза Еды:
    - info: |
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
        Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
        В вебвью оформить заказ с оплатой наличными
        Пользователь после создания заказа находится в вебвью в табе "С собой", отображается текущий заказ
    - do: Тап на крестик в карточке организации
    - assert: |
        Карточка организации закрылась
        Открыт главный экран приложения
        Отображается плашка отслеживания статуса заказа "Заказ создан"
    - do: Построить пешеходный маршрут
    - do: Тап "Поехали"
    - assert: |
        Произошел переход в режим ведения по маршруту
        Отображается плашка отслеживания статуса заказа
    - do: Тап на плашку со статусом заказа
    - assert: |
        Открывается карточка организации с вебвью со статусом заказа
    - do: Тап на крестик в карточке организации
    - assert: |
        Вебвью закрылось
        Открылся режим ведения по маршруту
        Внизу экрана отображается плашка отслеживания статуса заказа

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение плашки заказа Еды в режиме автомобильного ведения:
    - info: |
        Девайс в вертикальной ориентации
        Отображается главный экран приложения
    - do: |
        Необходимо находиться во внутренней сети VPN через Charles
        Получен эксперимент show_eda_takeaway
        Выставлен Debug Panel > Environment > MobmapsProxyHost = TESTING
        Выставлен Debug Panel > Environment > Passport Environment = TESTING
        Авторизоваться тестовым паспортом, в котором заполнено Имя (подробнее [тут](https://wiki.yandex-team.ru/maps/mobile/testing/fichi/samovyvoz-jandeks.eda/#kaktestirovatsamovyvozedyinformaciiizmetodichki))
        В Debug-panel > Webview > Debug card-tab url в поле вставить урл https://testing.eda.tst.yandex.ru/restaurant/chajxona_barakat_taganskaya_ploshhad_88s4?maps_pickup=true
    - do: Открыть вебвью заказа самовывоза Еды в табе "Debug" в любой карточке организации
    - do: Оформить заказ с оплатой наличными
    - do: Вернуться на главный экран приложения
    - assert: |
        Отображается главный экран приложения
        Отображается плашка со статусом заказа Еды
    - do: Построить автомаршрут
    - do: Тап на Поехали
    - assert: |
        Плашка заказа Еды отображается под ЕТА плашкой
        Название улицы не перекрывает курсор
    - do: Сменить ориентацию девайса на горизонтальную
    - assert: |
        Плашка ЕТА отображается в левой нижней части экрана
        Плашка заказа Еды отображается под плашкой ЕТА
        Название улицы не перекрывает курсор

    - platforms:
        - ios
    - testing:
        - acceptance_maps


  Открытие плашки заказа Еды из единой плашки заказов:
    - info: |
        Девайс в вертикальной ориентации
        Пользователем оформлены заказы самоката, Еды, такси
        Отображается единая плашка с иконками Самоката, Такси, Еды
    - do: Тап на плашку
    - assert: |
        Единая плашка раскрылась
        Отображаются плашки заказов самоката, Такси и Еды
        У каждой плашки отображается актуальный статус
    - do: Сменить ориентацию девайса
    - assert: |
        Плашки не свернулись в единую плашку
    - do: Сменить ориентацию девайса
    - assert: |
        Плашки не свернулись в единую плашку
    - do: Тап на плашку заказа Еды
    - assert: |
        Отображается Webview заказа Еды
    - do: Закрыть Webview заказа Еды
    - assert: |
        Отображаются плашки заказов такси, Еды, самоката
    - do: Тап на пустое пространство на карте
    - assert: |
        Отображается единая плашка заказов

    - platforms:
        - ios
    - testing:
        - acceptance_maps


  Изменение кнопки заказа с собой в карточке организации:
    - info: |
        Открыт главный экран приложения
        Устройство в вертикальной ориентации
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/maaryma/Снимок%20экрана%202022-05-06%20в%2011.43.51.png){title=QR-код}

        `yandexmaps://add_exp?transactional_button_redesign`
    - do: Перезагрузить приложение
    - do: Открыть карточку организации, поддерживающую самовывоз (Например, г. Москва, ул Большая Никитская 12, "Ugolёk")
    - assert: Отображается полная карточка орги с прозрачной СТА-кнопкой "Заказать с собой"
    - do: Открыть мини-карточку орги свайпом вниз
    - assert: Отображается мини-карточка организации с прозрачной СТА-кнопкой "Заказать с собой"
    - do: Изменить ориентацию устройства на горизонтальную
    - assert: Отображается прозрачная СТА-кнопка заказа с собой
    - do: Открыть таб "Меню"
    - assert: Внизу отображается прозрачная СТА-кнопка заказа с собой

    - tags:
        - assessors
    - platforms:
        - android