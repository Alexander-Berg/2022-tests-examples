testing:
  - regress
tags:
  - not_suitable_for_farm
  - bt_headset
components: bluetooth

aliases:
  - &settings_old_ui
    - info: К девайсу подключена BT-гарнитура
    - do: Выключить эксперимент `new_maps_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Выключить эксперимент `use_datasync_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Включить симуляция движения (Меню -> Настройки -> Debug-panel -> Routes -> Demo movement)
    - do: Перезапустить приложение
    - do: Включить настройку 'Фоновое ведение'(Меню -> Настройки -> Маршруты)
    - do: Включить проигрывание уведомлений (Меню -> Настройки -> Маршруты -> Звук -> Проигрывание уведомлений )

  - &settings_new_ui
    - info: К девайсу подключена BT-гарнитура
    - do: Выключить эксперимент `use_datasync_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/new_maps_settings.png){title=QR-код}

        `yandexmaps://add_exp?new_maps_settings`
    - do: Включить симуляция движения (Меню -> Настройки -> Debug-panel -> Routes -> Demo movement)
    - do: Перезапустить приложение
    - do: Включить настройку 'Фоновое ведение' (Меню -> Настройки -> Навигация)
    - do: Включить настройку 'Звуковое сопровождение' (Меню -> Настройки -> Звуки и оповещения)


specs:
  Проверка работы аннотаций через bluetooth-гарнитуру:
    - info: |
        Проверяем, что аннотации озвучиваются через bluetooth-гарнитуру корректно
        Подключить bluetooth-гарнитуру к устройству
        Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
        Запустить карты
    - do: Включить симуляция движения (Меню -> Настройки -> Дебаг-панель -> Routes -> Demo movement)
    - do: Включить проигрывание уведомлений (Меню -> Настройки -> Маршруты -> Звук -> Проигрывание уведомлений )
    - do: Вернуться на главный экран
    - do: Лонгтап на карте
    - assert: Открывается лонг-тап меню
    - do: Тап 'Сюда'
    - assert: Открывается экран построения маршрутов
    - do: Выбрать маршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации проигрываются через гарнитуру
        Музыка не затихает перед началом аннотации

    - platforms:
        - android
    - tags:
        - assessors
        - use_map

  Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'A2DP':
    - *settings_old_ui
    - do: Перейти в Меню > Настройки > Маршруты > Звук
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'A2DP'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors


  Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'Headset':
    - *settings_old_ui
    - do: Перейти в Меню > Настройки > Маршруты > Звук
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'Headset'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - testing:
        - acceptance_maps
    - platforms:
        - ios
    - tags:
        - assessors


  Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'По умолчанию':
    - *settings_old_ui
    - do: Перейти в Меню > Настройки > Маршруты > Звук
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'По умолчанию'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через динамик телефона
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через динамик телефона

    - testing:
        - acceptance_maps
    - platforms:
        - ios
    - tags:
        - assessors


  Новый UI. Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'A2DP':
    - *settings_new_ui
    - do: Перейти в Меню > Настройки > Звуки и оповещения
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'A2DP'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors
        - new_settings


  Новый UI. Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'Headset':
    - *settings_new_ui
    - do: Перейти в Меню > Настройки > Звуки и оповещения
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'Headset'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors
        - new_settings


  Новый UI. Озвучивание аннотаций через bluetooth-гарнитуру. Настройка 'По умолчанию':
    - *settings_new_ui
    - do: Перейти в Меню > Настройки > Звуки и оповещения
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'По умолчанию'
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через динамик телефона
    - do: Запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
    - do: Вернуться в приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру
    - do: Выключить музыку
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через динамик телефона

    - platforms:
        - ios
    - tags:
        - assessors
        - new_settings


  Озвучивание пешеходных аннотаций  в фоне через bluetooth-гарнитуру:
    - *settings_old_ui
    - do: Перейти в Меню > Настройки > Маршруты > Звук
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'A2DP'
    - do: |
        Построить маршрут с большим количеством маневром, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/walking_route.png){title=Маршрут}

    - do: Выбрать пешеходный маршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - testing:
        - acceptance_maps
    - platforms:
        - ios
    - tags:
        - assessors


  Новый UI. Озвучивание пешеходных аннотаций через bluetooth-гарнитуру:
    - *settings_new_ui
    - do: Перейти в Меню > Настройки > Звуки и оповещения
    - assert: |
        Присутствует настройка Bluetooth
        Настройка имеет три позиции: 'По умолчанию', 'Headset' и 'A2DP'
    - do: Выбрать значение 'A2DP'
    - do: |
        Построить маршрут с большим количеством маневром, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/walking_route.png){title=Маршрут}

    - do: Выбрать пешеходный маршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors
        - new_settings


  Проверка голосового поиска через bluetooth-гарнитуру:
    - info: |
        Проверяем, что голосовй поиск работает bluetooth-гарнитуру корректно
        Подключить bluetooth-гарнитуру к устройству
        запустить на устройстве музыку через стандартный плеер (или Яндекс.Радио)
        Запустить карты
    - do: (ios) Включить работу с гарнитурой (Настройки > Маршруты > Звук > Bluetooth > Headset
    - do: Тап на иконку микрофона в строке поиска
    - assert: |
        Открывается голосовой поиск
        Музыка затихает
    - do: Произнести в микрофон bluetooth-гарнитуры голосовой запрос (делать это нужно отойдя на несколько метров от устройства, так, чтобы сам микрофон устройства не воспринимал звук)
    - assert: |
        Голосовой поиск корректно распознаёт запрос
        Открывается карточка топонима запрос
        Возобновляется воспроизведение музыки
    - do: Тап на иконку микрофона
    - assert: |
        Открывается голосовой поиск
        Музыка затихает
    - do: Выйти из голосового поиска (смахнуть вниз)
    - assert: Возобновляется воспроизведение музыки
    - do: Тап на иконку микрофона
    - assert: |
        Открывается голосовой поиск
        Музыка затихает
    - do: Произнести в микрофон устройства запрос (делать это нужно отойдя на несколько метров от bluetooth-гарнитуры, так, чтобы сам микрофон гарнитуры не воспринимал звук)
    - assert: Появляется ошибка 'Вас не слышно'

    - platforms:
        - ios
    - tags:
        - assessors