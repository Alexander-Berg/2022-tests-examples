components: cache_webview_cookie
testing:
  - regress
tags:
  - assessors

specs:
  Сookiе при просмотре всех отзывов в карточке организации:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Просмотр логирования доступен только на сборках без подписи store
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Вернуться на главный экран приложения
    - do: Открыть карточку организации где больше 20 отзывов
    - assert: |
        Отображается карточка организации
        В блоке отзывов отображается кнопка "Посмотреть N комментариев"
    - do: Тап на "Посмотреть N комментариев"
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться в карточку организации на таб Обзор
    - do: Тап на "Посмотреть N комментариев"
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android
    - testing:
        - acceptance_maps


  Сookiе при просмотре всех отзывов в карточке организации, без эксперимента:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Выключен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Вернуться на главный экран приложения
    - do: Открыть карточку организации где больше 20 отзывов
    - assert: |
        Отображается карточка организации
        В блоке отзывов отображается кнопка "Посмотреть N комментариев"
    - do: Тап на "Посмотреть N комментариев"
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться в карточку организации на таб Обзор
    - do: Тап на "Посмотреть N комментариев"
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=

    - platforms:
        - android


  Валидация логина по сookiе при открытии debug-webcard:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
        Девайс подключен к Charles
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Открыть дебаг панель -> webview -> debug-webview url (https://yandex.ru)
    - do: Тап на Open debug-webcard
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Закрыть вебвью
    - do: Тап на Open debug-webcard
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует
        В Charles отображается запрос в ручку https://geointernal.mob.maps.yandex.net/v1/auth/check

    - platforms:
        - android


  Валидация логина по сookiе при открытии экрана комментатора:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Открыть карточку организации с отзывами, где присутствуют комментарии
    - do: Тап на комментарии
    - assert: Отображается экран комментатора
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Закрыть экран комментариев
    - do: Тап снова на комментарии
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android


  Валидация логина по сookiе при добавлении сторис в карточку организациии:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: |
        Авторизоваться аккаунтом владельца организации
        yndx.tula.testers@yandex.ru / thisislegitpassword
    - assert: Пользователь авторизован
    - do: Открыть [Кофейню Кирилла](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Добавить любую сторис
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться в карточку организации
    - do: Добавить любую сторис
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android


  Логирование валидации логина по сookiе при добавлении сторис в карточку организациии:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: |
        Авторизоваться аккаунтом владельца организации
        yndx.tula.testers@yandex.ru / thisislegitpassword
    - assert: Пользователь авторизован
    - do: Открыть [Кофейню Кирилла](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif)
    - do: Добавить любую сторис
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться в карточку организации
    - do: Добавить любую сторис
    - do: Посмотреть логи
    - assert: |
        В логах не отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android
    - testing:
        - acceptance_maps

  Валидация логина по сookiе при добавлении фидбека:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Открыть экран фидбека через карточку топонима/организации
    - do: Отправить любой фидбек
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться в карточку организации/топонима
    - do: Отправить любой фидбек
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android


  Валидация логина по сookiе при открытии вебвью такси:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Включен эксперимент taxi_open_webview - web_view_always_open
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Открыть вебвью такси (Построить маршрут на такси -> Тап на кнопку заказа)
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Закрыть вебвью
    - do: Открыть вебвью снова
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android


  Валидация логина по сookiе при открытии таба Новости:
    - info: |
        Для просмотра логов подключить устройство к компьютеру, либо воспользоваться Device log внутри приложения
        Включен эксперимент cache_webview_cookie
        Пользователь неавторизован
        Отображается меню приложения
    - do: Авторизоваться
    - assert: Пользователь авторизован
    - do: Открыть карточку организации с табом Новости
    - do: Тап на таб Новости
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Присутсвует параметр url -> https://passport.yandex.ru/auth/session?track_id=
    - do: Вернуться на таб Обзор
    - do: Тап на таб Новости
    - do: Посмотреть логи
    - assert: |
        В логах отображается событие webview.load
        Параметр url -> https://passport.yandex.ru/auth/session?track_id= отсутсвует

    - platforms:
        - android
