components: discovery
testing:
  - regress

specs:
  Отображение блока подборок в карточке (более трех подборок):
    - info: Отображается главный экран приложения
    - do: Открыть карточку организации, которая включена более чем в три подборки (напр., https://yandex.ru/maps/org/table/1561323338)
    - assert: Отображается миникарточка организации
    - do: Тап по миникарточке организации
    - assert: |
        Отображается полная карточка организации
        В блоке подборок отображается список из трех подборок
        Ниже отображается кнопка с количеством подборок,в которые входит организация
    - do: Тап по кнопке количества подборок
    - assert: Раскрылся список всех подборок

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Переход на сайт автора подборки Discovery:
    - info: |
        Отображается главный экран приложения на спане г. Москва
    - do: Тап по табу "Поиск"
    - assert: Отображается полная штора
    - do: Тап по одной из подборок в шторе
    - assert: |
        Отображается подборка Discovery
        Под описанием подборки отображается автор подборки
        Автором может выступать как отдельный человек так и целая организация
        В строке автора отображается фото или логотип и краткое описание
    - do: Тап по строке автора
    - assert: |
        Отображается сайт автора в кастом табе
        (Если автор Яндекс, то перехода в кастом таб не будет, ничего не откроется)

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Шаринг Discovery через кнопку Поделиться:
    - info: |
        Открыта карта Москвы/Санкт-Петербурга/Воронежа
    - do: Открыть таб "Поиск"
    - assert: |
        Открывается полная штора
        В шторе есть блок подборок
    - do: Тап на подборку
    - assert: |
        Открывается карточка подборки с информацией
        Вверху карточки отображается заголовок и кнопка Закрыть в виде крестика
        Под названием расположена информация о количестве мест в списке
        Под кнопкой Закрыть расположена кнопка Поделиться
        Ниже расположено изображение и описание подборке
        Под описанием информация об авторе
    - do: Пролистать список вниз
    - assert: |
        Отображается список миникарточек организаций
        Список состоит из; Названия, Описания, Рейтинга, Фотогалереи, Режима работы (если указан в карточке организации), Может отображаться Средний счет Билеты или иной пункт со стоимостью посещения
        В конце списка отображается кнопка Поделиться подборкой
        В зависимости от подборки может еще отображаться стоимость
    - do: Тап на кнопку Поделиться подборкой
    - assert: Открывается панель с выбором способа отправки подборки
    - do: Выбрать любой метод отправки сообщения
    - assert: Предлагается выбрать получателя для получения подборки
    - do: Отправить подборку на свой аккаунт
    - assert: Подборка отображается на полученном аккаунте
    - do: Открыть подборку по пришедшей ссылке
    - assert: Подборка открывается в МЯК (Для  iOS ссылка откроется в приложении только на прод и сборках из TestFlight) При тестировании на master сборке из беты - ссылка откроется в браузере

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Переход в подборку Discovery в шторе:
    - info: |
        Открыт главный экран приложения, спан карты - г. Москва
    - do: Тап по табу "Поиск"
    - assert: |
        Раскрыта штора
        В шторе есть блок с подборками (например, 'Где есть и пить')
    - do: Тап по одной из подборок (например Где пить коктейли)
    - assert: Отображается подборка мест
    - do: Тап по одному из пинов организаций подборки на карте
    - assert: |
        Карточка подборки скрылась
        Отображается миникарточка организации
    - do: Тап по пину организации на карте не относящихся к подборке
    - assert: |
        Android; Пин не из подборки не тапается (перейти к шагу 5)
        iOS; Карточка организации из подборки скрылась
        iOS; Отображается миникарточка новой организации
    - do: Тап по крестику в карточке организации
    - assert: |
        Карточка организации скрылась
        Отображается карточка подборки
    - do: Тап по крестику в подборке
    - assert: |
        Подборка скрылась
        Отображается штора
        Состояние скрола шторы сохранилось

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie

  Переход в Discovery из карточки организации:
    - info: |
        Спан карты Москва,
        Открыта миникарточка организации, состоящей в подборке, например Dr. Живаго,
        Открыть в БЯК такую же карточку организации
    - do: Тап на мини-карточку
    - assert: |
        Открылась полная карточка организации,
        Над блоком с панорамой отображается блок 'Место в подборках',
        Если подборок больше двух, отображается кнопка 'Все подборки'
    - do: Тап по подборке
    - assert: Отображается подборка мест
    - do: Открыть такую же подборку мест в карточке организации БЯК
    - assert: Отображается подборка мест в БЯК
    - do: Сравнить информацию в карточках организаций подборок МЯК и БЯК
    - assert: |
        Информация в карточках организаций одинаковая,
        Если у карточки в БЯК есть доп. информация (например ср. счет, график работы и т.д.), то аналогичная информация отображается и в карточке организации в МЯК
    - do: Тап на крестик
    - assert: |
        Карточка Discovery закрылась,
        Открылась полная карточка организации,
        Отображается блок с подборкой

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
    - testing:
        - lite_acceptance_maps

  Поделиться c главной карточки Discovery:
    - info: |
        Открыта любая подборка мест (например Где завтракать, обедать и ужинать на Патриарших),
        Попасть в подборку можно через карточку организации Рецептор
    - do: Тап на иконку 'Поделиться'
    - assert: Появляется меню с выбором способа отправки сообщения
    - do: Выбрать электронную почту
    - assert: |
        Открылась форма отправки email,
        В письме ссылка на подборку,
        Пример ссылки https://yandex.ru/maps/discovery/luchshie-mesta-na-patriarshih
    - do: Отправить письмо на yasocialmaps@yandex.ru
    - assert: Письмо успешно отправлено
    - do: Проверить почту yasocialmaps@yandex.ru / yasocialmaps!
    - assert: |
        Отправленное письмо пришло,
        В письме содержится отправленная ссылка

    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Карточка организации в Discovery:
    - info: |
        Отображается главный экран приложения
    - do: Тап по табу поиск
    - do: Тап по подборке связанной с едой
    - do: Раскрыть полную карточку подборки
    - assert: |
        Вверху отображается заголовок подборки, количество мест в подборке и кнопка поделиться,
        Под фото отображается текст с описанием,
        Под текстом отображается автор подборки или сервис, который составил список,
        Ниже отображаются список карточек организаций,
        Карточка организации состоит из: название, описание, оценка, фотогалерея,
        Под фотогалереей отображается средний счет и время работы организации,
        В конце списка подборки присутствует кнопка 'Поделиться подборкой',
        iOS: ниже список других подборок
    - do: Тап по карточке организации состоящей в подборке
    - assert: |
        Отображается полная карточка организации,
        Отличие данной карточки от обычной, это наличие текста с описанием организации из подборки,
        Поднятый пин организации отображается на спане карты
    - do: Пролистать карточку до списка подборок
    - assert: В списке есть подборка из описания
    - do: Тап по крестику в правом верхнем углу карточки
    - assert: |
        Отображается подборка мест из описания,
        Состояние скролла подборки сохранилось

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - lite_acceptance_maps

  Сохранение организации в закладки с карточки организации в Discovery:
    - info: |
        Отображается подборка 'Где поесть пироги' (в подборку можно попасть через карточку организации Dr. Живаго)
        Пользователь авторизован
    - do: Тап по карточке организации
    - assert: |
        Отображается полная карточка организации,
        В карточке отображается текст с описанием из подборки
    - do: Добавить организацию в закладки
    - assert: Организация в закладках
    - do: Открыть главный экран приложения
    - assert: Отображается главный экран приложения
    - do: Тап по пину добавленной организации
    - assert: Отображается миникарточка организации
    - do: Тап по миникарточке организации
    - assert: |
        Отображается полная карточка организации,
        Блок с описанием организации не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Отображение блока подборок в карточке (не более трех подборок):
    - info: Отображается главный экран приложения
    - do: Тап по пину организации, которая включена в три подборки (например, Паб Чак Норрис в Москве)
    - assert: Отображается миникарточка организации
    - do: Тап по миникарточке организации
    - assert: |
        Отображается полная карточка организации,
        В блоке подборок отображается список из трех подборок,
        Кнопка 'Все подборки' не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Переход в подборку Discovery из блока тематических подборок:
    - info: |
        Открыт главный экран приложения, спан карты - г. Москва
    - do: Тап по табу 'Поиск'
    - assert: |
        Раскрыта штора,
        В шторе есть блок с подборками (например, 'Где есть и пить')
    - do: Тап по одной из подборок в блоке тематических подборок (например Главные магазины хобби)
    - assert: Отображается подборка мест
    - do: Тап по крестику в подборке
    - assert: |
        Подборка скрылась,
        Отображается штора,
        Состояние скрола шторы сохранилось

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie


  Открытие карточки Дискавери с карты:
    - info: |
        Спан карты в районе города, у которого есть подборки дискавери, например Москва,
        Выбрана любая подборка дискавери,
        Устройство находится в вертикальной ориентации
    - do: Тап на пин объекта из подборки дискавери
    - assert: |
        Подборка дискавери скрывается,
        Открывается полная карточка организации,
        Пин выбранной организации поднят
    - do: Поменять ориентацию экрана на горизонтальную
    - assert: Отображается полная карточка организации в горизонтальной ориентации
    - do: Свернуть карточку свайпом до миникарточки
    - assert: |
        Отображается миникарточка организации,
        Подборка дискавери не отображается,
        На карте отображаются пины из подборки дискавери,
        Пин выбранной организации поднят
    - do: Тап по крестику в карточке организации
    - assert: |
        Миникарточка закрылась,
        Открылась подборка дискавери,
        На карте отображаются пины из подборки дискавери,
        Поднятый пин уменьшился
    - do: Тап на пин объекта из подборки дискавери
    - assert: |
        Подборка дискавери скрывается,
        Открывается полная карточка организации,
        Пин выбранной организации поднят
    - do: Поменять ориентацию экрана на вертикальную
    - assert: Отображается полная карточка организации в вертикальной ориентации
    - do: Свернуть карточку свайпом до миникарточки
    - assert: |
        Отображается миникарточка организации,
        Подборка дискавери не отображается,
        На карте отображаются пины из подборки дискавери,
        Пин выбранной организации поднят
    - do: Тап по крестику в карточке организации
    - assert: |
        Миникарточка закрылась,
        Открылась подборка дискавери,
        На карте отображаются пины из подборки дискавери,
        Поднятый пин уменьшился

    - platforms:
        - android
    - tags:
        - assessors

  Шаринг Discovery из заголовка подборки:
    - info: |
        Открыта карта Москвы
    - do: Тап на таб "Поиск"
    - assert: |
        Открывается полная штора,
        В шторе есть блок с подборками
    - do: Тап на подборку
    - assert: |
        Открывается карточка подборки с информацией,
        Вверху карточки отображается заголовок и кнопка 'Закрыть' в виде крестика,
        Под названием расположена информация о количестве мест в списке,
        Под кнопкой 'Закрыть' расположена кнопка 'Поделиться',
        Ниже расположено изображение и описание подборке,
        Под описанием информация об авторе
    - do: Тап на кнопку 'Поделиться'
    - assert: Открывается панель с выбором способа отправки подборки
    - do: Выбрать любой метод отправки сообщения
    - assert: Предлагается выбрать отправителя для получения подборки
    - do: Отправить подборку на свой аккаунт
    - assert: Подборка отображается на полученном аккаунте
    - do: Открыть подборку по пришедшей ссылке
    - assert: |
        Подборка открывается в МЯК,
        Для iOS ссылка откроется в приложении только на прод и сборках из TestFlight,
        При тестировании на master сборке из беты ссылка откроется в браузере

    - platforms:
        - ios
        - android
    - tags:
        - assessors

  Авторизация в WebView для экспериментального таба (пользователь авторизован):
    - info: |
        Включен эксперимент replace_discovery_tab_url с параметром https://mail.yandex.ru
        Включен эксперимент replace_discovery_tab_name_en с параметром EN
        Включен эксперимент replace_discovery_tab_name_ru с параметром RU
        (Android) Включен эксперимент exp_tab_in_webview
        Перезапустить приложение с выгрузкой из памяти
        Пользователь авторизован
        Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert: |
        Открылся WebView
        Пользователь авторизован на сайте той же учетной записью, что и в приложении
    - do: Тап на крестик
    - assert: |
        WebView закрылся
        Открыт главный экран приложения
    - do: В приложении авторизоваться под другой учётной записью
    - assert: Пользователь авторизован под другой учётной записью
    - do: Открыть главный экран приложения
    - do: Тап на таб 'RU'
    - assert: |
        Открылся WebView
        Пользователь авторизирован под другой учётной записью на сайте

    - platforms:
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - newbie


  Авторизация в WebView для экспериментального таба (пользователь не авторизован):
    - info: |
        Включен эксперимент replace_discovery_tab_url с параметром https://mail.yandex.ru
        Включен эксперимент replace_discovery_tab_name_en с параметром EN
        Включен эксперимент replace_discovery_tab_name_ru с параметром RU
        (Android) Включен эксперимент exp_tab_in_webview
        Перезапустить приложение с выгрузкой из памяти
        Пользователь не авторизован
        Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert: Открылся WebView
    - do: Тап на крестик
    - assert: |
        WebView закрылся
        Открыт главный экран приложения
    - do: Авторизоваться в приложение
    - assert: |
        Пользователь авторизован
    - do: Открыть главный экран приложения
    - assert: Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert: |
        Открылся WebView
        Пользователь авторизован на сайте той же учетной записью, что и в приложении
    - do: Тап на крестик
    - assert: |
        WebView закрылся
        Открыт главный экран приложения

    - platforms:
        - ios


  Возвращение в вебвью из нативного экрана:
    - info: |
        Получены эксперименты replace_discovery_tab_url c параметром https://yandex.ru/promo/maps/gasstations/how
        replace_discovery_tab_name_en с параметром EN
        replace_discovery_tab_name_ru с параметром RU
        (Android) Включен эксперимент exp_tab_in_webview
    - do: Тап на таб "RU"
    - assert: Открылся Webview заправок
    - do: Пролистать экран Webview вниз и тап по "Посмотреть заправки"
    - assert: В приложении открыт экран поиска с Яндекс.Заправками
    - do: Закрыть экран поиска
    - assert: Открылся Webview заправок

    - platforms:
        - ios


  Авторизация в WebView для экспериментального таба (проверка на очистку cookie):
    - info: |
        Включен эксперимент replace_discovery_tab_url с параметром https://mail.yandex.ru
        Включен эксперимент replace_discovery_tab_name_en с параметром EN
        Включен эксперимент replace_discovery_tab_name_ru с параметром RU
        (Android) Включен эксперимент exp_tab_in_webview
        Пользователь не авторизован,
        Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert:
        Открылся WebView,
        Пользователь не авторизован в табе
    - do: Тап на крестик
    - assert: |
        WebView закрылся,
        Открыт главный экран приложения
    - do: Авторизоваться в приложение (Меню - Личный кабинет - Войти)
    - assert: |
        Пользователь авторизован
    - do: Перейти к главному экрану приложения
    - assert: Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert: |
        Открылся WebView,
        Пользователь авторизован на сайте той же учетной записью, что и в приложении
    - do: Тап на крестик
    - assert: |
        WebView закрылся,
        Открыт главный экран приложения
    - do: Перейти в личный кабинет и разлогиниться
    - assert: |
        Пользователь не авторизован
    - do: Перейти к главному экрану приложения
    - assert: Открыт главный экран приложения
    - do: Тап на таб 'RU'
    - assert: |
        Открылся WebView
        Пользователь не авторизован на сайте

    - platforms:
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Загрузка stories с девайса внутри WebView в карточке организации:
    - info: |
        - Для Android включить эксперименты exp_tab_in_webview
        - Перезапустить приложение с выгрузкой из памяти
        - Пользователь авторизован аккаунтом yndx.tula.testers@yandex.ru / thisislegitpassword
        - Открыта организация Кофейня Кирилла yandexmaps://yandex.ru/maps/?ll=55.577015%2C52.559750&mode=search&oid=46405325255&ol=biz&z=17
    - do: Тап на Добавить историю
    - assert: |
        Открыто внутреннее вебвью
        Пользователь авторизован
        Присутствует кнопка Добавить фото
    - do: Тап на Добавить фото
    - assert: |
        (Android) Отображается запрос на доступ к галерее/камере
        (iOS) Отображаются поп-ап с источниками фото
    - do: (Android) Запретить доступ к галерее/камере / (iOS) Тап вне поп-апа
    - assert: |
        Открыто внутреннее вебвью
        Присутствует кнопка Добавить фото
    - do: Тап на Добавить фото
    - assert: |
        (Android) Отображается запрос на доступ к галерее/камере
        (iOS) Отображаются поп-ап с источниками фото
    - do: (Android) Разрешить доступ к галерее/камере
    - do: Выбрать любую фотографию из галереи
    - do: Тап на Далее
    - do: Ввести название для сторис
    - do: Тап на Опубликовать
    - assert: |
        Отображается экран с сообщением об успешном добавлении сторис
        Присутствует кнопка Закрыть
    - do: Тап на Закрыть
    - do: Перезайти в карточку организации
    - assert: В блоке со сторис отображается только что добавленная сторис

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps

  Загрузка файлов с девайса внутри WebView в кастомном табе:
    - info: |
        Включен экперимент replace_discovery_tab_url со значением https://disk.yandex.ru
        Включены эксперименты replace_discovery_tab_name_en, replace_discovery_tab_name_ru со значением Актуальное
        Для Android дополнительно включить эксперименты exp_tab_in_webview
        Перезапустить приложение с выгрузкой из памяти
        Пользователь авторизован Яндекс аккаунтом
        Открыт главный экран приложения
    - do: Тап на таб Акутальное
    - assert: |
        Открыт экран Я.Диск "Безлимитное место для ваших фото"
        Присутствуют кнопки Начать пользоваться и Перейти на сайт
    - do: Тап Перейти на сайт
    - assert: |
        Открыто внутреннее WebView
        Пользователь авторизован
    - do: Тап на + в строке Файлы
    - do: Тап на Загрузить файлы
    - assert: |
        Отображается экран добавления файлов
        Может отобразиться popup с запросом доступа к галерее/камере
    - do: Запретить доступ к галерее/камере, если появился popup
    - assert: |
        Отображается экран добавления файлов
    - do: Добавить файл с камеры
    - assert: |
        Отображается экран добавления файлов
        Может отобразиться popup с запросом доступа к галерее/камере
    - do: Запретить доступ к галерее/камере
    - assert: |
        Отображается экран добавления файлов
    - do: Добавить файл с камеры
    - assert: |
        Отображается экран добавления файлов
    - do: Разрешить доступ к галерее/камере
    - assert: |
        Файлы загружены на Я.Диск
    - do: Добавить файл из карусели галереи
    - assert: |
        Файлы загружены на Я.Диск
    - do: Переоткрыть WebView
    - assert: |
        Открыто внутреннее WebView
        Пользователь авторизован
        Файлы загружены на Я.Диск

    - platforms:
        - ios


  Открытие карточки Дискавери из карты:
    - info: |
        Спан карты в районе города, у которого есть подборки дискавери, например Москва,
        Выбрана любая подборка дискавери,
        Устройство находится в вертикальной ориентации
    - do: Тап на пин объекта из подборки дискавери
    - assert: |
        Подборка дискавери скрывается,
        Открывается полная карточка организации,
        Пин выбранной организации поднят
    - do: Поменять ориентацию экрана на горизонтальную
    - assert: Отображается полная карточка организации в горизонтальной ориентации
    - do: Свернуть карточку свайпом до миникарточки
    - assert: |
        Отображается миникарточка организации,
        Подборка дискавери не отображается,
        На карте отображаются пины из подборки дискавери,
        Пин выбранной организации поднят
    - do: Тап по крестику в карточке организации
    - assert: |
        Миникарточка закрылась,
        Открылась подборка дискавери,
        На карте отображаются пины из подборки дискавери,
        Поднятый пин уменьшился
    - do: Тап на пин объекта из подборки дискавери
    - assert: |
        Подборка дискавери скрывается,
        Открывается полная карточка организации,
        Пин выбранной организации поднят
    - do: Поменять ориентацию экрана на вертикальную
    - assert: Отображается полная карточка организации в вертикальной ориентации
    - do: Свернуть карточку свайпом до миникарточки
    - assert: |
        Отображается миникарточка организации,
        Подборка дискавери не отображается,
        На карте отображаются пины из подборки дискавери,
        Пин выбранной организации поднят
    - do: Тап по крестику в карточке организации
    - assert: |
        Миникарточка закрылась
        Отображается подборка дискавери
        На карте отображаются пины из подборки дискавери
        Поднятый пин уменьшился

    - platforms:
        - android
    - testing:
        - acceptance_maps


  Просмотр подборки:
    - info: Открыт главный экран приложения на спане города, например Москва
    - do: Тап на таб Поиск
    - assert: |
        Открыт экран Поиск
    - do: Проскролить поиск до блока с подборками
    - assert: |
        Отображается блок с подборками
    - do: Тап на любую подборку
    - assert: |
        Открыта карточка подборки
        На спане отобразились пины организаций из подборки
        Отсутствуют пины подмешанных геопродуктов

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps
        - acceptance_maps
    - tags:
        - assessors


  Переход из организации в подборку:
    - info: Открыта организация из подборки
    - do: Тап на подборку в блоке Место в подборках
    - assert: |
        Открыта карточка подборки
        На спане отобразились пины организаций из подборки
        Отсутствуют пины подмешанных геопродуктов

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Просмотр подборки из блока Смотрите также:
    - info: Открыта любая подборка
    - do: Проскроллить подборку в самый низ до блока Смотрите также
    - assert: Отображается блок Смотрите также
    - do: Тап на любую подборку из блока Смотрите также
    - assert: Открылась карточка новой подборки
    - do: Тап по кнопке Закрыть
    - assert: |
        Текущая подборка закрылась
        Отобразилась карточка открытой ранее подборки

    - platforms:
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps



  Просмотр организации из подборки:
    - info: Открыта подборка организаций
    - do: Тап на организацию в подборке
    - assert: |
        Открыта карточка организации
        Присутствует блок с описанием из подборки
        Присутствует блок Место в подборках

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
