components: intro_screens
testing:
  - regress

specs:

  Интро заправок при обновлении приложения:
    - info:
        1. На старой версии просмотреть онбординг, дать пермишн на местоположение.
        2. Приложение обновлено.
        3. Приложение до этого не запускалось .
        4. Отображается рабочий стол устройства с приложением Яндекс.Карты.
        5. Устройство в вертикальной ориентации.
        6. {Android} нужно включить эксперимент show_intro=static
    - do: Тап на приложение Яндекс.Карты
    - assert:
        Открывается приложение.
        Отображается интро Заправок.
        В правом верхнем углу крестик для закрытия.
        Отображается картинка заправок.
        Ниже заголовок 'Заправляйтесь в Картах, не выходя из машины'.
        Ниже текст 'Оплачивайте топливо в приложении'.
        Ниже синяя кнопка 'Подробнее'.
        Ниже кнопка 'Закрыть'.
    - do: Сменить ориентацию на горизонтальную
    - assert: Ориентация не меняется. Интро отображается только в вертикальной ориентации
    - do: Тап на Подробнее
    - assert: Отображается история с подробностями Яндекс.Заправок.
    - do: Тап историю до последнего слайда
    - assert: |
        Отображается история
        Появилась кнопка Посмотреть
    - do: Тап на Посмотреть
    - assert: |
        Открыт экран поиска по запросу АЗС с оплатой в картах
        Отображаются саджесты по результатам поиска
    - do: (Android) Тап Назад
    - assert: Отображается история на слайде с тапом Посмотреть
    - do: (Android) Дождаться окончания/тап на крестик/на картинку
    - assert: Отображается главный экран приложения

    - platforms:
      - ios
      - android
    - testing:
      - acceptance_maps
      - lite_acceptance_maps
    - tags:
      - assessors
      - newbie


  Интро заправок при обновлении приложения (не Россия):
    - info: |
        Местоположение пользователя не в России:
        На Android подменить местоположение через приложение Mock Location
        На iOS через Xcode
        Приложение обновлено
        На старой версии просмотрены все экраны (в т.ч. онбординг, аккаунт менеджер, поп-ап и тд)
        Приложение до этого не запускалось
        Отображается рабочий стол устройства с приложением Яндекс.Карты
        Устройство в вертикальной ориентации
    - do: Тап на приложение Яндекс.Карты
    - assert: |
        Не отображается интро о заправках
        Отображается главный экран приложения

    - platforms:
      - ios
      - android
    - testing:
      - acceptance_maps


  Вторая группа элементов онбординга (/w wifi):
    - info:
        На следующие сессии после установки  показывается самый приоритетный экран из группы 2, условия показа которого выполняются
        Второй запуск приложения. **Если выкатили Emergency-нотификацию, то она покажется первее всех элементов второй группы)**.
        Подключен  wifi. Кэш не скачен. Нет логина в картах, но есть логины Яндекса на устройстве. Дан пермишен на местоположение.
    - do: Запустить приложение
    - assert: Приложение запустилось . Появляется предложение скачать кеш, центр которого ближе всего к местоположению.
    - do: Тап 'Не сейчас'
    - assert: Предложение скачать кеш скрылось. Открыт главный экран приложения.
    - do: (Только для ios) Перезапустить приложение
    - assert: Приложение запустилось. Появился запрос на отправку уведомлений.
    - do: (Только для ios) Тап 'Разрешить'
    - assert: Запрос на отправку уведомлений закрылся. Открыт главный экран приложения
    - do: Перезапустить приложение
    - assert: Приложение запустилось. Отображается карусель АМ, если есть аккаунты Яндекс на устройстве, но нет логина в картах.
    - do: Пропустить авторизацию
    - assert: Пользователь не авторизован. Открыт главный экран приложения
    - do: Перезапустить приложение
    - assert: Над таббаром показывается discovery-нотификация(если выкачена в прод,тестинг)
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются

    - platforms:
      - ios
      - android


  Вторая группа элементов онбординга (без wifi):
    - info:
        На следующие сессии после установки показывается самый приоритетный экран из группы 2, условия показа которого выполняются
        Второй запуск приложения. **Если выкатили Emergency-нотификацию, то она покажется первее всех элементов второй группы**.
        wifi отключен . Кэш не скачен. Нет логина в картах, но есть логины Яндекса на устройстве. Дан пермишен на местоположение.
    - do: (Только для ios) Запустить приложение.
    - assert: Приложение запустилось. Появился запрос на отправку уведомлений.
    - do: (Только для ios) Тап 'Разрешить'
    - assert: Запрос на отправку уведомлений закрылся. Открыт главный экран приложения.
    - do: Перезапустить приложение
    - assert: Приложение запустилось. Отображается карусель АМ, если есть аккаунты Яндекс на устройстве, но нет логина в картах
    - do: Пропустить авторизацию.
    - assert: Пользователь не авторизован. Открыт главный экран приложения.
    - do: Перезапустить приложение.
    - assert: Над таббаром показывается discovery-нотификация(если выкачена в прод,тестинг)
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются
    - do: Подключить Wi-Fi и перезапустить приложение
    - assert: Приложение запущено. Появляется предложение скачать кеш, центр которого ближе всего к местоположению
    - do: Тап 'Не сейчас'
    - assert: Предложение скачать кеш скрылось. Открыт главный экран приложения
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются

    - platforms:
      - ios
      - android


  Вторая группа элементов онбординга:
    - info:
        На следующие сессии после установки показывается самый приоритетный экран из группы 2, условия показа которого выполняются.
        Второй запуск приложения. **Если выкатили Emergency-нотификацию, то она покажется первее всех элементов второй группы**.
        Подключен wifi. Кэш не скачен. Нет логина в картах, но есть логины Яндекса на устройстве. Дан пермишен на местоположение.
    - do: Запустить приложение
    - assert: Приложение запустилось. Появляется предложение скачать кеш, центр которого ближе всего к местоположению.
    - do: Тап 'Загрузить'
    - assert: Открывается экран 'Офлайн-карты'. Начинается скачивание кеша.
    - do: (Только для ios) Перезапустить приложение.
    - assert: Приложение запустилось. Появился запрос на отправку уведомлений
    - do: (Только для ios) Тап 'Разрешить'.
    - assert: Запрос на отправку уведомлений закрылся. Открыт главный экран приложения.
    - do: Перезапустить приложение.
    - assert: Приложение запустилось. Отображается карусель АМ, если есть аккаунты Яндекс на устройстве, но нет логина в картах
    - do: Авторизоваться тестовым аккаунтом
    - assert: Пользователь авторизован . Открыт главный экран приложения
    - do: Перезапустить приложение
    - assert: Приложение запущено. Напротив иконки аккаунта показан тултип владельца организации ('Рекламируйте ваш бизнес на Яндекс.Картах')
    - do: Перезапустить приложение
    - assert: Над таббаром показывается discovery-нотификация(если выкачена в прод,тестинг)
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, тултип к кнопке владельца организации, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются

    - platforms:
      - ios
      - android
    - tags:
        - newbie


  Отсутствие предложения скачать кеш и карусели АМ:
    - info:
        На следующие сессии после установки показывается самый приоритетный экран из группы 2, условия показа которого выполняются
        Второй запуск приложения. **Если выкатили Emergency-нотификацию, то она покажется первее всех элементов второй группы)**.
        Подключен  wifi. Скачан кеш, пользователь авторизован . Дан пермишен на местоположение.
    - do: (Только для ios) Перезапустить приложение
    - assert: Приложение запустилось. Появился запрос на отправку уведомлений
    - do: (Только для ios) Тап 'Разрешить'.
    - assert: Запрос на отправку уведомлений закрылся. Открыт главный экран приложения
    - do: Перезапустить приложение
    - assert: Приложение запущено. Напротив иконки аккаунта показан тултип владельца организации ('Рекламируйте ваш бизнес на Яндекс.Картах')
    - do: Перезапустить приложение
    - assert: Над таббаром показывается discovery-нотификация(если выкачена в прод,тестинг)
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, тултип к кнопке владельца организации, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются

    - platforms:
      - ios
      - android


  Вторая группа элементов онбординга (with update):
    - info:
        На следующие сессии после установки показывается самый приоритетный экран из группы 2, условия показа которого выполняются
        На старой версии не был просмотрен тултип к кнопке владельца организации . Обновить  на тестируемую версию приложения.
        Второй запуск приложения после обновления . **Если выкатили Emergency-нотификацию, то она покажется первее всех элементов второй группы**.
        Пользователь не авторизован.
    - do: Запустить приложение.
    - assert: Приложение запущено. Отображается карусель АМ, если есть аккаунты Яндекс на устройстве, но нет логина в картах.
    - do: Авторизоваться тестовым аккаунтом
    - assert: Пользователь авторизован. Открыт главный экран приложения
    - do: Перезапустить приложение.
    - assert: Приложение запущено. Напротив иконки аккаунта показан тултип владельца организации ('Рекламируйте ваш бизнес на Яндекс.Картах)
    - do: Перезапустить приложение
    - assert: Над таббаром показывается discovery-нотификация(если выкачена в прод,тестинг)
    - do: Перезапустить приложение несколько раз
    - assert: Карусель АМ, тултип к кнопке владельца организации, предложение скачать кеш, пермишен на определение геолокации, discovery-нотификация не показываются

    - platforms:
      - ios
      - android


  Отсутствие повторного отображения интро вне зависимости от подзума к ММП:
    - info:
        Экраны второй группы - Предложение скачать кеш. Разрешение на пуши на iOS. Карусель АМ. Тултип к кнопке владельца организации. Нотификация на главном экране (из дискавери).
        Первый запуск приложения.
    - do: Запустить приложение и закрыть интро/авторизацию
    - assert: Отображается разрешение на доступ к местоположению
    - do: Выдать разрешение на доступ к местоположению и сразу же выгрузить приложение из трея
    - assert: Приложение не отображается в списке запущенных
    - do: Запустить приложение
    - assert: Интро не отображается. Отображается один из экранов из второй группы (см.логику в описании)
    - do: Очистить память приложения и повторить первый запуск с закрытием интро/авторизации
    - assert: Отображается разрешение на доступ к местоположению
    - do: Выдать разрешение на доступ к местоположению и дождаться подзума к метке ММП
    - assert: В центре спана карты отображается пин Я. Местоположение пина совпадает с местоположением устройства
    - do: Выгрузить приложение из трея
    - assert: Приложение не отображается в списке запущенных
    - do: Запустить приложение
    - assert: Интро не отображается. Отображается один из экранов из второй группы (см.логику в описании)

    - platforms:
      - android
    - testing:
      - acceptance_maps
    - tags:
      - assessors
      - newbie


  Показ универсального онбординга:
    - info:
        На устройстве не установлен Навигатор
        Первый запуск приложения при чистой установке (не обновление)
        На устройстве есть доступ к интернету
    - do: Запустить приложение
    - assert: |
        Отображается экран универсального интро
        На экране:
        Текстовый логотип Яндекс Карт
        Заголовок
        Описание
        Кнопка "Что умеют карты" с иконкой
        Кнопка "Начать пользоваться"
        На фоне показано динамическое изображение места с названием и пином
    - do: Тап на кнопку "Что умеют карты"
    - assert: Открылся проигрыватель сторис
    - do: Дождаться автоматического перелистывания элемента сторис
    - assert: Элементы сторис автоматически перелистываются
    - do: Лонгтап на сторис
    - assert: Сторис останавливаются
    - do: Открыть последнюю сторис и тап на область экрана справа
    - assert: Отображается главный экран приложения
    - do: Переустановить приложение
    - assert: Приложение переустановлено
    - do: Запустить приложение
    - assert: |
        Отображается экран универсального интро
        Присутствуют кнопки :"Что умеют карты" и "Начать пользоваться"
    - do: Тап на кнопку "Начать пользоваться"
    - assert: Онбординг закрыт, отображается главный экран приложения
    - do: Переустановить приложение
    - assert: Приложение переустановлено
    - do: Запустить приложение
    - assert: Отображается экран универсального интро
    - do: Закрыть экран системным способом (для Android тап на кнопку back)
    - assert: Онбординг закрыт, отображается главный экран приложения
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Отображается главный экран приложения
        Универсальный онбординг больше не появляется

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - newbie


  Отсутствие показа универсального онбординга в офлайн режиме:
    - info:
        Первый запуск приложения при чистой установке (не обновление)
        Включен авиарежим
    - do: Запустить приложение
    - assert: |
        Отображается главный экран приложения
        Интро не отображается
    - do: Выключить авиарежим и перезапустить приложение
    - assert: |
        Доступ к интернету предоставлен
        Приложение перезапущено
        Отображается экран универсального интро
        На экране:
        Текстовый логотип Яндекс Карт
        Заголовок
        Описание
        Кнопка "Что умеют карты" с иконкой
        Кнопка "Начать пользоваться"
        На фоне показано динамическое изображение места с названием и пином

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отсутствие показа универсального онбординга при обновлении приложения:
    - info:
        Установлена более ранняя версия приложения
        Просмотрен универсальный онбординг при первом открытии приложения
        На устройстве есть доступ к интернету
    - do: Обновить приложение на тестируемую версию
    - assert: Приложение обновлено
    - do: Запустить приложение
    - assert: |
        Отображается главный экран приложения
        Универсальный онбординг не отображается

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Заправки. История при обновлении приложения:
    - info:
        1. На старой версии просмотреть онбординг, дать пермишн на местоположение.
        2. Приложение обновлено.
        3. Приложение до этого не запускалось .
        4. Отображается рабочий стол устройства с приложением Яндекс.Карты.
        5. Устройство в вертикальной ориентации.
        6. {Android} нужно включить эксперимент show_intro=static
    - do: Тап на приложение Яндекс.Карты
    - assert:
        Открывается приложение.
        Отображается интро Заправок.
        В правом верхнем углу крестик для закрытия.
        Отображается картинка заправок.
        Ниже заголовок 'Заправляйтесь в Картах, не выходя из машины'.
        Ниже текст 'Оплачивайте топливо в приложении'.
        Ниже зеленая кнопка 'Подробнее'.
        Ниже кнопка 'Закрыть'.
    - do: Сменить ориентацию на горизонтальную
    - assert: Ориентация не меняется. Интро отображается только в вертикальной ориентации
    - do: Тап на Подробнее
    - assert: Отображается история с подробностями Яндекс.Заправок.
    - do: Тап историю до последнего слайда
    - assert: |
        Отображается история
        Появилась кнопка Подробнее
    - do: Тап на Подробнее
    - assert: |
        Открыт экран поиска по запросу АЗС с оплатой в картах
        Отображаются саджесты по результатам поиска
    - do: (Android) Тап Назад
    - assert: Отображается история на слайде с тапом Подробнее
    - do: (Android) Дождаться окончания/тап на крестик/на картинку
    - assert: Отображается главный экран приложения

    - platforms:
      - ios
      - android
    - testing:
      - acceptance_maps


  Отсутствие интро на Android 5:
    - info: |
        ОС Android 5,
        Установлена сборка с версией ниже актуальной
        МПП Россия
        Не первый запуск
    - do: |
       Установить актуальную сборку поверх предыдущей версии,
       Открыть приложение
    - assert: Интро про AA не отобразилось

    - platforms:
        - android



  Показ анимированного интро про парковки:
    - info: |
        Включен эксперимент animated_parking_intro
        В дебаг панели в Startup Screens and Hints включен свитчер Intro thinks application is updating
        В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
        ММП в Москве или в МО
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Появляется анимированное интро с оплатой парковок
        В интро есть кнопки "Да, хочу узнать больше", "В другой раз" и крестик
    - do: Тап на крестик
    - assert: |
        Интро закрылось
        Открыт главный экран приложения

    - platforms:
        - android


  Просмотр сториз в интро оплаты парковок:
    - info: |
        Включен эксперимент animated_parking_intro
        В дебаг панели в Startup Screens and Hints включен свитчер Intro thinks application is updating
        В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
        ММП в Москве или в МО
    - do: Перезапускать приложение до появления анимированного интро с оплатой парковок
    - assert: |
        Приложение перезапущено
        Появляется анимированное интро с оплатой парковок
        В интро есть кнопки "Да, хочу узнать больше", "В другой раз" и крестик
    - do: Тап на кнопку "Да, хочу узнать больше"
    - assert: |
        Интро закрылось
        Открыт сториз про парковки

    - platforms:
        - android
    - testing:
        - acceptance_maps


  Показ анимированного интро оплаты парковок после обновления в регионе с поддержкой:
    - info: |
        Включен эксперимент animated_parking_intro
        Алиса выключена (Меню -> Настройки -> Основные)
        В дебаг панели в Startup Screens and Hints включен свитчер Intro thinks application is updating
        В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
        ММП в Москве
    - do: Перезапустить приложение несколько раз
    - assert: |
        Приложение перезапущено
        Появляется интро с оплатой парковок
        В интро есть кнопки "Да, хочу узнать больше", "В другой раз" и крестик
    - do: Тап на кнопку "В другой раз"
    - assert: |
        Интро закрылось
        Открыт главный экран приложения

    - platforms:
        - android
    - testing:
        - acceptance_maps


  Отсутствие показа анимированного интро оплаты парковок после обновления в регионе без поддержки:
    - info: |
        Включен эксперимент animated_parking_intro
        Алиса выключена (Меню -> Настройки -> Основные)
        В дебаг панели в Startup Screens and Hints включен свитчер Intro thinks application is updating
        В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
        ММП не в Москве и не в Московской области
    - do: Перезапустить приложение несколько раз
    - assert: |
        Приложение перезапущено
        Отсутствует анимированное интро с оплатой парковок

    - platforms:
        - android
    - testing:
        - acceptance_maps


  Проверка отображения интро Заправок в виде сторис:
    - info: |
        Включена тычка always show intro
        Включена тычка always show intro stories
        Включена тычка intro always think the application is updated
        Включить testing hosts (iOS)
        Включить ENV ->  Mobmaps proxy host (Android)
        Включен эксперимент show_intro=static (Android)
        Включить эксперимент intro_stories_id с параметром 9ec8a468-8efb-4899-8d8d-2d179d59d460
        Или через '[adb shell am start -a android.intent.action.VIEW -d yandexmaps://add_exp/?intro_stories_id=9ec8a468-8efb-4899-8d8d-2d179d59d460]'
    - do: Перезапустить приложение
    - assert: Отображается интро заправок в виде сторис
    - do: Поставить просмотр на паузу, удерживая палец на экране
    - assert: Сторис на паузе
    - do: Тап по правому краю экрана
    - assert: Открывается новый элемент сторис
    - do: Тап по левому краю экрана
    - assert: Открывается предыдущий элемент сторис
    - do: Свернуть и развернуть приложение
    - assert: Отображается сторис на той же странице что и до сворачивания приложения
    - do: Перевести устройство в горизонтальную ориентацию
    - assert: Сторис отображается в вертикальной ориентации
    - do: Тап по закрыть
    - assert: Отображается главный экран приложения

    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - platforms:
        - android
    - integration_run:
        - tanker_sdk


  Проверка отображения интро Заправок в виде сторис после восстановления доступа к интернету:
    - info: |
        Включена тычка always show intro
        Включена тычка always show intro stories
        Включена тычка intro always think the application is updated
        Включить testing hosts
        Включен эксперимент show_intro=static (Android)
        Включить эксперимент intro_stories_id с параметром 9ec8a468-8efb-4899-8d8d-2d179d59d460
        Или через '[adb shell am start -a android.intent.action.VIEW -d yandexmaps://add_exp/?intro_stories_id=9ec8a468-8efb-4899-8d8d-2d179d59d460]'
    - do: Включить авиа-режим
    - assert: Доступ к интернету отсутствует
    - do: Перезапустить приложение
    - assert: Не отображается интро заправок в виде сторис
    - do: Выключить авиа-режим
    - assert: Есть доступ к интернету
    - do: Перезапустить приложение
    - assert: Отображается интро заправок в виде сторис
    - do: Тап по закрыть
    - assert: Отображается главный экран приложения

    - tags:
        - assessors
    - platforms:
        - android
    - integration_run:
        - tanker_sdk


  Алиса. Онбординг:
    - info: |
        Алиса включена (Меню -> Настройки -> Основные)
        Доступ к микрофону выдан
        Ранее Алиса не запускалась
    - do: Активировать Алису любым способом
    - assert: |
        Открылась Алиса
        Проигрывается звук начала записи с микрофона
        Алиса зачитывает что она умеет делать
        Тот же текст дублируется в шторке Алисы

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - not_suitable_for_farm


  Закрытие интро-шторы для приходящих из Навигатора при тапе на Отлично:
    - info: |
        Установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение карты
    - assert: |
        Карты открываются
        На экране появился запрос на доступ к местоположению
        Android: На заднем плане отображается интро-штора "Тот самый Навигатор теперь в Картах"
    - do: Разрешить доступ к местоположению
    - assert: Отображается интро-штора с кнопкой "Отлично"
    - do: Тап "Отлично"
    - assert: |
        Интро-штора закрывается
        Открыт экран карты

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Сворачивание интро-шторы для приходящих из Навигатора:
    - info: |
        Установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение Карты и разрешить доступ к местоположению
    - assert: |
        Отображается интро-штора с кнопкой "Отлично"
        В интро-шторе отображается анимация движения курсора
    - do: Свернуть интро-штору
    - assert: |
        Интро-штора закрывается
        Открыт экран карты

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Разворачивание интро-шторы для приходящих из Навигатора:
    - info: |
        Установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение Карты и разрешить доступ к местоположению
    - assert: |
        Отображается интро-штора с кнопкой "Отлично"
        В интро-шторе отображается анимация движения курсора
    - do: Свернуть и развернуть приложение
    - assert: |
        Отображается интро-штора с кнопкой "Отлично"
        В интро-шторе отображается анимация движения курсора

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Показ интро-шторы для приходящих из Навигатора:
    - info: |
        Установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение Карты
    - assert: Отображается пермишен на доступ к геолокации
    - do: Разрешить доступ к местоположению
    - assert: (Android) Отображается системный запрос на доступ к местоположению
    - do: (Android) Тап на Разрешить
    - assert: |
        Отображается интро-штора с кнопкой "Отлично" поверх карты
        Область с картой затемнена
        В интро-шторе отображается анимация движения курсора
    - do: Перезагрузить приложение несколько раз
    - assert: Интро-штора больше не появляется

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Закрытие интро-шторы для приходящих из Навигатора тапом на системную кнопку назад:
    - info: |
        Установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение Карты и разрешить доступ к местоположению
    - assert: |
        Отображается интро-штора с кнопкой "Отлично"
        В интро-шторе отображается анимация движения курсора
    - do: Нажать системную кнопку назад
    - assert: |
        Интро-штора закрывается
        Открыт экран карты

    - platforms:
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отсутствие интро-шторы для приходящих из Навигатора:
    - info: |
        Не установлено приложение Навигатор
        Первый запуск приложения Карты
    - do: Открыть приложение Карты
    - assert: Отображается универсальный онбординг якарт
    - do: Тап "Начать пользоваться"
    - assert: |
        - Открывается экран карты
        - Интро-штора не появляется
    - do: Перезагрузить приложение несколько раз
    - assert: Интро-штора больше не появляется

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отсутствие интро и подсказок Алисы для новых пользователей, которые увидели ее до первого обновления:
    - info: |
        Установлена локаль на устройстве ru_RU
        Проверка для релизных сборок
    - do: |
        Установить старую версию приложения, в которой пользователь увидит Алису раньше первого обновления:
        [collapsed-image](https://jing.yandex-team.ru/files/linakolpakova/qr%20%283%29.png){title=QR-код для Android}

        `https://beta.m.soft.yandex.ru/description?app=maps&platform_shortcut=android&branch=releases_10.7.6-store`
        [collapsed-image](https://jing.yandex-team.ru/files/linakolpakova/qr%20%284%29.png){title=QR-код для iOS}

        `https://beta.m.soft.yandex.ru/description?app=maps&platform_shortcut=iphoneos&autodetect=1&branch=release-13.7.0`
    - do: Запустить старую версию карт
    - assert: Приложение запущено
    - do: Закрыть приложение, выгрузив из памяти
    - do: Обновить приложение на актуальную версию
    - assert: Приложение обновлено
    - do: Запустить приложение
    - assert: |
        Приложение запущено
        Интро Алисы не отображается

    - platforms:
        - ios
        - android
    - tags:
        - refactor_ready


  Показ интро Онлайн бронирований:
    - do: |
        Включить эксперимент 'bookings_introscreen', используя интент:
        [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR.jpeg){title=QR-код}

        `yandexmaps://add_exp?bookings_introscreen`
    - do: Перезапустить приложение
    - do: |
        Включить отображение интро в настройках:
        Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: |
        Сбросить показ интро в настройках:
        Debug Panel-> Startup Screens and Hints -> Reset startup actions
    - do: Перезапускать приложение до появления интро Онлайн бронирований
    - assert: |
        Отображается интро Онлайн бронирований
        На экране отображаются:
        - текст "Записаться в салоны красоты можно в Картах"
        - кнопка "Понятно"
        - кнопка "Искать салоны красоты"
        - в правом верхнем углу крестик для закрытия

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Открытие результатов поиска при тапе на "Искать салоны красоты" в интро Онлайн бронирований:
    - do: |
        Включить эксперимент 'bookings_introscreen', используя интент:
        [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR.jpeg){title=QR-код}

        `yandexmaps://add_exp?bookings_introscreen`
    - do: Перезапустить приложение
    - do: |
        Включить отображение интро в настройках:
        Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: |
        Сбросить показ интро в настройках:
        Debug Panel-> Startup Screens and Hints -> Reset startup actions
    - do: Перезапускать приложение до появления интро Онлайн бронирований
    - assert: Отображается интро Онлайн бронирований
    - do: Тап на "Искать салоны красоты"
    - assert: Открывается список результатов поиска

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Закрытие интро Онлайн бронирований при тапе на "Понятно":
    - do: |
        Включить эксперимент 'bookings_introscreen', используя интент:
        [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR.jpeg){title=QR-код}

        `yandexmaps://add_exp?bookings_introscreen`
    - do: Перезапустить приложение
    - do: |
        Включить отображение интро в настройках:
        Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: |
        Сбросить показ интро в настройках:
        Debug Panel-> Startup Screens and Hints -> Reset startup actions
    - do: Перезапускать приложение до появления интро Онлайн бронирований
    - assert: Отображается интро Онлайн бронирований
    - do: Тап на "Понятно"
    - assert: |
        Интро Онлайн бронирований закрылось
        Открыт спан карты

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Закрытие интро Онлайн бронирований тапом на крестик:
    - do: |
        Включить эксперимент 'bookings_introscreen', используя интент:
        [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR.jpeg){title=QR-код}

        `yandexmaps://add_exp?bookings_introscreen`
    - do: Перезапустить приложение
    - do: |
        Включить отображение интро в настройках:
        Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: |
        Сбросить показ интро в настройках:
        Debug Panel-> Startup Screens and Hints -> Reset startup actions
    - do: Перезапускать приложение до появления интро Онлайн бронирований
    - assert: Отображается интро Онлайн бронирований
    - do: Тап на крестик
    - assert: |
        Интро Онлайн бронирований закрылось
        Открыт спан карты

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отображение интро Онлайн бронирований по порядку:
    - info: Установлено приложение Навигатор
    - do: |
        Включить эксперимент 'bookings_introscreen', используя интент:
        [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR.jpeg){title=QR-код}

        `yandexmaps://add_exp?bookings_introscreen`
    - do: Перезапустить приложение
    - do: |
        Включить отображение интро в настройках:
        Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: |
        Сбросить показ интро в настройках:
        Debug Panel-> Startup Screens and Hints -> Reset startup actions
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Отображается экран универсального интро
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Отображается интро "Тот самый Навигатор- в Картах"
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Отображается интро Онлайн бронирований
    - do: Перезапустить приложение
    - assert: |
        Приложение перезапущено
        Отображается интро "Заправляйтесь в Картах, не выходя из машины"

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Интро без релиза. UI:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза.
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: |
        Показывается тестовый интро
        У интро всегда есть крест в правом верхнем углу, заголовок и кнопка (Primary-кнопка)
        У интро может быть картинка и вторая прозрачная кнопка (Secondary-кнопка)
    - do: Повернуть экран
    - assert: Ориентация интро не изменилась
    - do: Сменить тему в приложении
    - assert: Интро не изменилось
    - do: Нажать на крестик
    - assert: |
        Интро скрылось
        Отображается главный экран приложения
        Нет других интро или нотификаций

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Интро без релиза. Primary-кнопка:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза.
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: |
        Показывается тестовый интро
        У интро всегда есть крест в правом верхнем углу, заголовок и кнопка (Primary-кнопка)
        У интро может быть картинка и вторая прозрачная кнопка (Secondary-кнопка)
    - do: Тап на Primary-кнопку (верхняя, непрозрачная)
    - assert: |
        Интро скрылось
        Открыт список Избранное

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Интро без релиза. Secondary-кнопка:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза.
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: |
        Показывается тестовый интро
        У интро всегда есть крест в правом верхнем углу, заголовок и кнопка (Primary-кнопка)
        У интро может быть картинка и вторая прозрачная кнопка (Secondary-кнопка)
    - do: Найти интро с двумя кнопками
    - do: Тап на Secondary-кнопку (нижняя, прозрачная)
    - assert: Интро скрылось

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Интро без релиза. Оффлайн:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: Показывается первый тестовый интро
    - do: Выключить интернет на девайсе
    - do: Перезапустить приложение
    - assert: Следующее интро не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Интро без релиза. Открытие приложения по диплинку:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: Показывается первый тестовый интро
    - do: Выгружить приложение
    - do: Открыть приложение по диплинку [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/deeplink.png){title=Deeplink}

    - assert: Интро не отображается
    - do: Перезапустить приложение
    - do: Отображается следующий тестовый интро

    - platforms:
        - ios
        - android


  Интро без релиза. Формат данных API:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - info: Девайс подключен к Чарльз для перехвата трафика
    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - assert: |
        Дергается ручка `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
        В ручке присутствуют обязательные параметры `lat`, `lon`, `origin`
    - do: Перезапустить приложение
    - assert: |
        Дергается ручка `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
        Показывается первый тестовый интро
        Тексты на интро соответствуют json в ответе ручке
        Первым показано интро, имеющее наибольшее значение поля `priority`
        Если поле `priority` у нескольких интро совпадает, то раньше показывается интро с более ранней датой в поле `startDate`
    - do: Закрыть интро
    - do: Свернуть и развернуть приложение
    - assert: |
        Дергается ручка `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
        Тестовый интро не показывается
    - do: Перезапуская приложение, просмотреть все запущенные на бэкенде интро
    - assert: Последовательность показа интро соответствует вышеописанной логике

    - platforms:
        - ios
        - android


  Интро без релиза. Отсутствие интро без включенного эксперимента:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - info: Девайс подключен к Чарльз для перехвата трафика
    - do: Переустановить приложение
    - do: Выключить эксперимент `backend_driven_intro_on` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Закрыть дебаг-панель
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - assert: |
        Не уходят запросы в `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
    - do: Перезапустить приложение
    - assert: |
        Не уходят запросы в `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
        Интро отсутствует
    - do: Свернуть и развернуть приложение
    - assert: |
        Не уходят запросы в `https://mobmaps-proxy-api-ext.c.maps.yandex.net/v1/discovery/search/intro?`
        Интро отсутствует

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Интро без релиза. Удаление из кэша показанных интро:
    - info: Если интро не показалось после второго перезапуска, возможно показу мешают другие нотификации (Предложение скачать кеш, Карусель АМ и тд). Тогда приложение надо перезапустить до конца показа всех нотификаций и еще два раза
    - info: Интро без релиза [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/пример_интро_без_релиза.png){title=Пример}

    - info: Девайс подключен к устройству для снятия логов и отфильтрованы по тэгу `BackendDrivenIntroUpdaterService`
    - do: Переустановить приложение
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/backend_driven_intro_on.png){title=QR-код}

        `yandexmaps://add_exp?backend_driven_intro_on`
    - do: Включить тычку Environment -> Intro and notifications draft branch
    - do: Включить тычку Environment -> Mobmaps proxy host > testing
    - do: Перезапустить приложение и подождать около 30 сек (это нужно для скачивания интро)
    - do: Перезапустить приложение
    - do: При необходимости перезапустить приложение еще несколько раз
    - assert: Показывается тестовый интро
    - do: Перезапустить приложение
    - assert: В логи приходит событие `BackendDrivenIntroUpdaterService:Removing intro:...`

    - platforms:
        - ios
        - android


  Отображение экранов интро при обновлении незалогиненным пользователем:
    - info: |
        - Экраны интро отображаются только при первом запуске после обновления
        - Если в данном релизе не было интро экрана, отобразиться последний добавленный
    - do: Установить МЯК предыдущей версии. (Например, при тестировании МЯК версии 9.1 установленная версия карт должна быть 9.0 или более ранней)
    - do: Запустить МЯК, при необходимости разлогиниться, обновиться до текущей (тестируемой) версии и запустить приложение.
    - assert: |
        - После сплеш скрина отображаются экраны интро
        - Экран интро состоит из значка закрытия, картинки, названия, пояснения, счётчика экранов и кнопки Далее
        - Переключение экранов происходит свайпом или нажатием Далее
        - При переходе от одного экрана к другому изменяется положение счётчика экранов
        - На последнем экране отображается кнопка 'Войти' - Крестик или Back закрывает интро

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отображение экранов интро при обновлении залогиненным пользователем:
    - info: |
        Экраны интро отображаются только при первом запуске после обновления
        Если в данном релизе не было интро экрана, отобразиться последний добавленный
    - do: Установить МЯК предыдущей версии (Например, при тестировании МЯК версии 9.1 установленная версия карт должна быть 9.0 или более ранней)
    - do: Запустить МЯК, залогиниться, обновиться до текущей (тестируемой) версии и запустить приложение
    - assert: |
        После сплеш скрина отображаются экраны интро
        Экран интро состоит из крестика закрытия, картинки, названия, пояснения и кнопки Далее (Android) и Ясно (iOS).
        iOS на последнем экране отображается 'Понятно' - Крестик, Далее или Back закрывает интро.

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - tags:
        - assessors
