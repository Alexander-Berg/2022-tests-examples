components: alice_working_with_music
testing:
  - regress
tags:
  - assessors
  - not_suitable_for_farm
integration_run:
  - alicekit

aliases:
  - &info_voice_activation_on_and_mic_on
    - info: Установлена локаль на устройстве ru_RU
    - do: Выключить эксперименты `use_datasync_settings` и `new_maps_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Перезапустить приложение
    - do: Включить Алису (Меню -> Настройки -> Основные -> Алиса)
    - do: Включить голосовую активацию Алисы (Меню -> Настройки -> Основные -> Алиса)
    - do: В настройках приложения на устройстве выдать доступ к микрофону девайса
    - do: Открыть главный экран приложения

specs:
  Алиса. Взаимодействие с Яндекс.Музыкой - приложение Яндекс.Музыка установлено:
    - info: Приложение Яндекс.Музыка установлено
    - *info_voice_activation_on_and_mic_on
    - do: Вызвать Алису
    - do: Сказать "Включи мою музыку"
    - assert: |
        Открывается приложение Яндекс.Музыка
        Включается персональная радиостанция

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Алиса. Взаимодействие с Яндекс.Музыкой - приложение Яндекс.Музыка не установлено:
    - info: Приложение Яндекс.Музыка не установлено
    - *info_voice_activation_on_and_mic_on
    - do: Вызвать Алису
    - do: Сказать "Включи мою музыку"
    - assert: Открывается сайт персональной радиостанции

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Работа Алисы в автоведении с включенной музыкой/радио:
    - *info_voice_activation_on_and_mic_on
    - do: Включить симуляцию ведения `Demo movement` (Меню -> Настройки -> дебаг-панель -> Routes)
    - do: Закрыть дебаг-панель
    - do: Перезапустить приложение
    - do: Включить музыку на девайсе
    - do: Открыть главный экран приложения
    - do: Построить произвольный маршрут
    - do: Тап на Поехали
    - assert: |
        Отображается экран автоведения
        Воспроизводятся аннотации по маршруту
        Воспроизводится музыка/радио на девайсе
    - do: Тап по экрану
    - do: Тап на кнопку Алисы
    - assert: |
        Музыка/радио мьютится в момент вызова Алисы
        Отображается штора Алисы
        Аннотации не воспроизводятся
    - do: Завершить разговор с Алисой
    - assert: |
        Экран Алисы скрывается
        (Android) Музыка/радио возобновляется / (iOS) Музыка/радио не возобновляется
        Воспроизводятся аннотации по маршруту

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready
