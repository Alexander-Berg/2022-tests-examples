components: alice_calls
testing:
  - regress
tags:
  - assessors
  - not_suitable_for_farm
integration_run:
  - alicekit

aliases:
  - &info_voice_activation_on_and_mic_on
    - info: Установлена локаль на устройстве ru_RU
    - do: Выключить эксперименты `use_datasync_settings` и `new_maps_settings` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Перезапустить приложение
    - do: Включить Алису (Меню -> Настройки -> Основные -> Алиса)
    - do: Включить голосовую активацию Алисы (Меню -> Настройки -> Основные -> Алиса)
    - do: В настройках приложения на устройстве выдать доступ к микрофону девайса
    - do: Открыть главный экран приложения


specs:
  Алиса. Отсутствие анимации и баблов о новом навыке при показе поп-апа c предложением загрузки кэша:
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение с выгрузкой из памяти
    - assert: |
        Открыт главный экран приложения
        Отображается поп-ап с предложением загрузки кэша
        Анимация и баблы Алисы отсутствуют
    - do: Сменить ориентацию устройства
    - assert: |
        Устройство в горизонтальной ориентации
        Отображается поп-ап с предложением загрузки кэша
        Анимация и баблы Алисы отсутствуют

    - platforms:
        - android
        - ios
    - tags:
        - refactor_ready


  Алиса. Отсутствие анимации и баблов о новом навыке при отображении карусели АМ:
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение несколько раз до появления карусели АМ (появляется примерно на 2-3 перезапуск)
    - assert: |
        Открыт главный экран приложения
        Отображается карусель АМ
        Анимация и баблы Алисы отсутствуют
    - do: Закрыть карусель АМ
    - assert: |
        Отображается главный экран приложения
        Анимация и баблы Алисы отсутствуют

    - platforms:
        - ios
        - android
    - tags:
        - refactor_ready


  Алиса. Отображение анимации и баблов о новом навыке - звонки контактам:
    - info: |
        Установлена локаль на устройстве ru_RU
        Алиса включена
        Чистая установка приложения
        Открыт главный экран приложения
    - do: Перезапустить приложение 5-7 раз
    - assert: |
        Открыт главный экран приложения
        Кнопка Алисы справа от строки поиска трансформировалась в анимацию звонящего телефона и пульсирующую кнопку Алисы
        Под кнопкой Алисы появляются 4 бабла, рассказывающие о возможности звонить контактам из телефона
    - do: Смахнуть баблы с сообщениями свайпом вверх, вправо или тапом вне их
    - assert: |
        Открыт главный экран приложения
        Наверху справа от строки поиска отображается кнопка Алисы
        Анимация и баблы Алисы отсутствуют

    - platforms:
        - ios
        - android
    - tags:
        - refactor_ready


  Алиса. Отсутствие анимации и баблов о новом навыке при последующем перезапуске:
    - info: |
        Установлена локаль на устройстве ru_RU
        Алиса включена
        Чистая установка приложения
        Открыт главный экран приложения
    - do: Перезапустить приложение 5-7 раз
    - assert: |
        Открыт главный экран приложения
        Кнопка Алисы справа от строки поиска трансформировалась в анимацию
        Под кнопкой Алисы появляются баблы про навык звонков контактам
    - do: Перезапустить приложение
    - assert: |
        Открыт главный экран приложения
        Наверху справа от строки поиска отображается кнопка Алисы
        Анимация и баблы Алисы отсутствуют

    - platforms:
        - ios
        - android
    - tags:
        - refactor_ready


  Алиса. Отображение анимации и баблов о новом навыке при сворачивании и разворачивании приложения:
    - info: |
        Установлена локаль на устройстве ru_RU
        Алиса включена
        Устройство в вертикальной ориентации
        Чистая установка приложения
        Открыт главный экран приложения
    - do: Перезапустить приложение 5-7 раз
    - assert: |
        Открыт главный экран приложения
        Появляются баблы Алисы про навык звонков контактам
    - do: Свернуть приложение
    - do: Развернуть приложение
    - assert: |
        Открыт главный экран приложения
        Отображаются баблы Алисы

    - platforms:
        - ios
        - android
    - tags:
        - refactor_ready


  Звонок через Алису, если пользователь неавторизован и после авторизации:
    - info: |
        Добавлены контакты в адресную книгу на девайсе
        Пользователь неавторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Попросить Алису позвонить одному из контактов в адресной книге (напр., "Позвони, маме")
    - assert: |
        Отображается штора Алисы
        В шторе отображается сообщение о необходимости авторизации
    - do: Авторизоваться
    - do: Попросить Алису позвонить одному из контактов в адресной книге
    - assert: Сообщение о необходимости авторизации не появляется

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Звонок через Алису:
    - info: |
        Добавлены контакты в адресную книгу на девайсе
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - (Android) к телефону
        Ранее доступ к контактам из адресной книги не выдавался
        Пользователь авторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Попросить Алису позвонить одному из контактов в адресной книге с одним номером телефона (напр., "Позвони, маме")
    - assert: |
        В шторе Алисы отображается сообщение, что необходимо предоставить доступ к контактам
        Через несколько секунд штора закрывается
        Отображается запрос на выдачу доступа к контактам
        Присутствуют кнопки Запретить и Разрешить
    - do: Тап на Разрешить
    - assert: |
        Запрос скрылся
        Звучит сообщение от Алисы о начале синхронизации контактов
        Отображается главный экран приложения
    - do: Подождать 30 сек.
    - do: Вызвать Алису
    - do: Попросить Алису позвонить одному из контактов в адресной книге
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд появляется:
        (iOS) Системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready
    - testing:
        - acceptance_maps


  Звонок через Алису контакту, которого нет в адресной книге:
    - info: |
        Добавлены контакты в адресную книгу на девайсе
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - к контактам из адресной книги
        Пользователь авторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту, которого нет в адресной книге
    - assert: Алиса отвечает голосом и текстом, что этого контакта нет

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Звонок через Алису нескольким контактам, подходящим под запрос:
    - info: |
        В адресную книгу добавлено несколько схожих контактов (напр., Саша, Саша Белый, Александр)
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - к контактам из адресной книги
          - (Android) к телефону
        Пользователь авторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту для которого есть схожие запросы (напр., "Позвони, Саше")
    - assert: |
        Алиса отвечает голосом и текстом, что нужно выбрать контакт
        В шторе отображаются саджесты контактов
    - do: Тап по одному из саджестов
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту
    - do: Отменить вызов
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту для которого есть схожие запросы (напр., "Позвони, Саше")
    - assert: |
        Алиса отвечает голосом и текстом, что нужно выбрать контакт
        В шторе отображаются саджесты контактов
    - do: Назвать номер саджеста (напр., второй, третий)
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту
    - do: Отменить вызов
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту для которого есть схожие запросы (напр., "Позвони, Саше")
    - assert: |
        Алиса отвечает голосом и текстом, что нужно выбрать контакт
        В шторе отображаются саджесты контактов
    - do: Сказать фамилию контакта
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Звонок через Алису контакту с несколькими номерами:
    - info: |
        В адресную книгу добавлены контакты с несколькими номерами телефона
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - к контактам из адресной книги
          - (Android) к телефону
        Пользователь авторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту, у которого несколько номеров
    - assert: |
        Алиса отвечает голосом и текстом, что нужно выбрать номер телефона
        Присутствую саджесты со всеми телефонными номерами
    - do: Тап по одному из саджестов
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту
    - do: Отменить вызов
    - do: Вызвать Алису
    - do: Попросить Алису позвонить контакту, у которого несколько номеров
    - assert: |
        Алиса отвечает голосом и текстом, что нужно выбрать номер телефона
        В шторе отображаются саджесты контактов
    - do: Назвать номер саджеста (напр., второй, третий)
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready


  Алиса. Набор номеров экстренных служб:
    - info: |
        Добавлены контакты в адресную книгу
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - к контактам из адресной книги
          - (Android) к телефону
        Пользователь авторизован
    - *info_voice_activation_on_and_mic_on
    - do: Перезапустить приложение
    - do: Вызвать Алису
    - do: Сказать "Вызови МЧС"
    - assert: |
        (Android) Открывается штора набора номера с введенным номером "101" и осуществляется вызов
        (iOS) Открывается системный поп-ап с номером "101" и кнопками отмены и звонка
    - do: Отменить вызов
    - do: Вызвать Алису
    - do: Сказать "Вызови полицию"
    - assert: |
        (Android) Открывается штора набора номера с введенным номером "102" и осуществляется вызов
        (iOS) Открывается системный поп-ап с номером "102" и кнопками отмены и звонка
    - do: Отменить вызов
    - do: Вызвать Алису
    - do: Сказать "Позвони в скорую"
    - assert: |
        (Android) Открывается штора набора номера с введенным номером "103" и осуществляется вызов
        (iOS) Открывается системный поп-ап с номером "103" и кнопками отмены и звонка

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - not_suitable_for_farm
        - refactor_ready


  Звонок через Алису только что добавленному контакту:
    - info: |
        Установлена локаль на устройстве ru_RU
        Алиса включена
        Добавлены контакты в адресную книгу
        Выданы доступы в настройках приложения на устройстве:
          - к микрофону
          - к контактам из адресной книги
          - (Android) к телефону
        Пользователь авторизован
        Приложение запущено
        Отображается главный экран устройства
    - do: Перезапустить приложение
    - do: Добавить в адресную книгу новый контакт
    - do: Вернуться в приложение
    - do: Подождать 3 - 5 минут
    - do: Вызвать Алису
    - do: Попросить Алису позвонить только что добавленному контакту
    - assert: |
        Алиса отвечает голосом и текстом о начале набора номера
        Через несколько секунд:
        (iOS) Появляется системный поп-ап с номером телефона и кнопками отмены и звонка
        (Android) Осуществляется вызов выбранному контакту

    - platforms:
        - ios
        - android
    - tags:
        - not_suitable_for_farm
        - refactor_ready
