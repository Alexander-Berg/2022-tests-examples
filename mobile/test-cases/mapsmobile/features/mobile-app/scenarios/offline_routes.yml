components: offline_routes
testing:
  - regress

specs:
  Индикация турбо офлайн-режима на экране построения маршрута:
    - info: |
        Загрузить офлайн кэш текущего региона.
        Нет доступа к сети
        Местоположение определено.
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Лонг-тап на карте
    - assert: |
        Открылось лонг-тап меню
        В меню присутствуют кнопки: "Сохранить", "Отсюда", "Сюда"
        Ниже расположены: "Что здесь?", "Добавить объект", "Добавить дорожное событие", "Измерить расстояние" блок с панорамой
        Может быть блок AR"
    - do: Тап Сюда
    - assert: |
        Построился маршрут
        Открыт экран выбора вариантов маршрута
        Под навбаром отображается турбо-кнопка
        Отображается контрол слоев - пробки и парковки
        Линия маршрута выделена
        Кнопка "Поехали!"
    - do: Перенести начальную точку на другое место
    - assert: |
        Маршрут успешно перестроился
        Интерфейс не изменился
    - do: Тап на турбо-кнопку
    - assert: |
        Появился поясняющий поп-ап "Маршруты без интернета"
        На поп-апе присутствует кнопка "Понятно"
    - do: Сменить ориентацию девайса
    - assert: Поп-ап никуда не пропал
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - newbie


  Загрузка офлайн-карт из карточки маршрута:
    - info: |
        Офлайн кэши не загружены. Включен авиарежим, местоположение определено.
        Последний построенный маршрут был автомобильным.
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Лонг-тап на карте
    - assert: |
        Открылось лонг-тап меню
        В меню присутствуют кнопки: “Сохранить”, “Откуда”, “Куда”
        Ниже расположены: “Что здесь?”, “Добавить дорожное событие” и блок с панорамой"
    - do: Тап "Сюда"
    - assert: |
        Маршрут не построился
        Открыт экран выбора вариантов маршрута
        Появилась плашка "Нет соединения с интернетом"
        В карточке маршрута присутствуют кнопки "Повторить" и "Запланировать загрузку карты"
    - do: Тап "Запланировать загрузку карты"
    - assert: |
        Появился поп-ап "Маршруты и поиск без интернета"
        Загрузите офлайн-карту (Город, N МБ). Тогда автомобильные маршруты и поиск будут работать без подключения к сети.
        (Отображение название города и вес кэша означает, что определено местоположение и подобран необходимый для загрузки кэш карты)
        На поп-апе присутствует кнопка "Загрузить"
    - do: Сменить ориентацию девайса
    - assert: Поп-ап не пропал
    - do: Тап "Загрузить"
    - assert: |
        Предыдущий поп-ап сменился на "Карта скоро загрузится"
        На поп-апе присутствует кнопка "Понятно"
    - do: Ещё раз сменить ориентацию девайса
    - assert: Поп-ап не пропадает
    - do: Тап "Понятно"
    - assert: |
        Поп-ап скрылся
        Открыт экран выбора вариантов маршрута
        В карточке маршрута присутствуют кнопки “Повторить” и “Запланировать загрузку карты”
    - do: Перейти на экран "Офлайн-карты" (Меню → Офлайн-карты)
    - assert: |
        Открыт экран офлайн-карты
        В очереди на загрузку карта текущего региона
    - do: Выключить авиарежим/подключиться к wi-fi
    - assert: Как только появилось соединение с интернетом, сразу началась загрузка офлайн-карты
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - newbie


  Оффлайн ведение по маршруту:
    - info: |
        Скачан кэш текущего региона (Меню - Загрузка карт)
        Выключен интернет
        ММП определено
        Маршрут до этого ни разу не строился
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Лонг-тап на карте
    - do: Тап “Сюда”
    - assert: |
        Построился маршрут
        Открыт экран выбора вариантов маршрута
        Линия маршрута окрашена
    - do: Тап "Поехали"
    - assert: |
        Открыт экран ведения по маршруту
        Появился поясняющий поп-ап “Маршруты без интернета”
        На поп-апе присутствует кнопка “Понятно”
        Линия маршрута на карте и в навбаре окрашена
        Возможен запрос на фоновое ведение по маршруту
    - do: Тап в пустую область на карте
    - assert: |
        Поп-ап закрылся
        Открыт экран ведения по маршруту

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - tags:
        - assessors
        - use_map
        - newbie


  Переключение из офлайн в онлайн маршрутизацию:
    - info: |
        Скачан кэш текущего региона (Меню -> Загрузка карт -> Тап на кэш в блоке Рядом с вами)
        Интернет выключен
        ММП определено
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Построить произвольный автомаршрут
    - assert: |
        Отображается экран выбора маршрута
        Линия маршрута не окрашена в цвет пробок
        (Android) Отображается турбо-кнопка
        Отображается кнопка Поехали
    - do: Тап на турбо-кнопку (Android)
    - assert: |
        Отображается поп-ап Маршрут без интернета
        В поп-апе присутствует кнопка Понятно
    - do: (Android) Свайпом вниз скрыть поп-ап
    - assert: |
        Открыт экран выбора вариантов маршрута
        Линия маршрута не окрашена в цвет пробок
        (Android) Отображается турбо-кнопка
        Отображается кнопка Поехали
    - do: Включить интернет
    - assert: |
        Открыт экран выбора вариантов маршрута
        (Android) Турбо-кнопка не отображается
        Линия маршрута окрашена в цвет пробок
    - do: Выключить интернет
    - assert: |
        Открыт экран выбора вариантов маршрута
        (Android) Турбо-кнопка не отображается
        Линия маршрута окрашена в цвет пробок
    - do: Тап Поехали
    - assert: |
        Отображается экран ведения по маршруту
        Отображается поп-ап Маршрут без интернета (если не появился, то следующий шаг пропустить)
        В поп-апе присутствует кнопка Понятно
        Линия маршрута не окрашена в цвет пробок
    - do: Свернуть поп-ап свайпом вниз
    - assert: |
        Поп-ап закрылся
        Открыт экран ведения по маршруту
    - do: Включить интернет
    - assert: |
        Открыт экран ведения по маршруту
        Линия маршрута окрашена в цвет пробок

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - newbie


  Построение маршрута между разными кэшами:
    - info: |
        Скачаны кэши Московской обл., Москвы, Тульской обл., Тулы (Меню -> Загрузка карт)
        Интернет выключен
        ММП в Москве
        Для подмены ММП использовать (Android) Mosk Location / (iOS) Enter your route
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
        Устройство в вертикальной ориентации
        Офлайн маршрут ранее не строился
    - do: Построить маршрут в один из городов Московской области
    - assert: |
        Отображается экран выбора маршрута
        Линия маршрута не окрашена в цвет пробок
        Отображается кнопка Поехали
    - do: Свернуть приложение
    - do: Сменить ориентацию устройства
    - do: Развернуть приложение
    - do: С помощью лонг-тапа построить маршрут к другому месту
    - assert: Маршрут перестроился
    - do: Тап Поехали
    - assert: |
        Открыт экран ведения по маршруту
        Отображается поп-ап Маршруты без интернета
        В поп-апе присутствует кнопка Понятно
    - do: Закрыть поп-ап
    - do: Завершить маршрут
    - do: Подменить ММП на город в Московской области
    - assert: |
        Открыт главный экран приложения
        ММП в городе, куда была сделана подмена
    - do: Построить маршрут в Тулу
    - assert: |
        Открыт экран выбора вариантов маршрута
        Линия маршрута не окрашена в цвет пробок
        Отображается кнопка Поехали
    - do: Выгрузить приложение из памяти
    - do: Запустить приложение
    - assert: |
        (iOS) Показан ранее построенный маршрут
        (Android) Ранее построенный маршрут не восстанавливается
    - do: (iOS) Тап Поехали
    - assert: Отображается экран ведения по маршруту

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - use_map
        - mapkit_ready


  Невозможность построения маршрута офлайн, если кэш не скачан, ранее был доступ к интернету:
    - info: |
        Кэши не скачаны (Меню -> Загрузка карт -> нет загруженных)
        Интернет включен
        Отображается главный экран приложения
        ММП определено
    - do: Выключить интернет
    - do: Построить произвольный маршрут
    - assert: |
        Маршрут не строится
        Отображается сообщение об отсутствии интернета
        Присутствует кнопка Повторить
    - do: Тап Повторить
    - assert: |
        Отображается спиннер загрузки
        Маршрут не строится
        После отображается сообщение об отсутствии интернета
        Присутствует кнопка Повторить
    - do: Включить интернет
    - do: Тап Повторить
    - assert: |
        Маршрут построен
        Отображается экран выбора маршрута

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Невозможность построения маршрута офлайн, если кэш не скачан, ранее не было доступа к интернету:
    - info: |
        Кэши не скачаны (Меню -> Загрузка карт -> нет загруженных)
        Интернет выключен
        Приложение не запущено
    - do: Запустить приложение
    - assert: Отображается главный экран приложения
    - do: Тап на контролл ММП
    - assert: ММП определено
    - do: Построить произвольный маршрут
    - assert: |
        Маршрут не строится
        Отображается спиннер загрузки
        Сообщение об отсутствии интернета не появляется
    - do: Включить интернет
    - assert: |
        Маршрут построен
        Отображается экран выбора маршрута

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Невозможность построения ОТ маршрута офлайн:
    - info:
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Включен интернет
        ММП определено
    - do: Выключить эксперимент no_routes_tab (Настройки - Debug Panel - Experiments)
    - do: Перезапустить приложение
    - do: Тап на таб Маршруты
    - do: Выбрать тип маршрута ОТ
    - do: Выключить интернет
    - do: Построить маршрут в любое место текущего региона
    - assert: |
        Отображается экран выбора маршрута
        Маршрут на ОТ не построен
        Отображается сообщение, что построить ОТ маршрут без интернета невозможно
        Присутствует кнопка Повторить
    - do: Включить интернет
    - do: Тап на кнопку Повторить
    - assert: |
        Маршрут построен
        Отображается экран выбора ОТ-маршрута
    - do: Закрыть приложение
    - do: Выключить интернет
    - do: Запустить приложение
    - do: Построить маршрут ОТ
    - assert: |
        Маршрут не строится
        Отображается спиннер загрузки
        Сообщение об отсутствии интернета не появляется
    - do: Включить интернет
    - assert: |
        Маршрут построен
        Отображается экран выбора ОТ-маршрута

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Невозможность построения веломаршрута офлайн:
    - info:
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Включен интернет
        ММП определено
    - do: Выключить эксперимент no_routes_tab (Настройки - Debug Panel - Experiments)
    - do: Перезапустить приложение
    - do: Тап на таб Маршруты
    - do: Выбрать тип маршрута вело
    - do: Выключить интернет
    - do: Построить маршрут в любое место текущего региона
    - assert: |
        Отображается экран выбора маршрута
        Маршрут на велосипеде не построен
        Отображается сообщение, что построить веломаршрут без интернета невозможно
        Присутствует кнопка Повторить
    - do: Включить интернет
    - do: Тап на кнопку Повторить
    - assert: |
        Маршрут построен
        Отображается экран выбора веломаршрута
    - do: Закрыть приложение
    - do: Выключить интернет
    - do: Запустить приложение
    - do: Построить веломаршрут
    - assert: |
        Маршрут не строится
        Отображается спиннер загрузки
        Сообщение об отсутствии интернета не появляется
    - do: Включить интернет
    - assert: |
        Маршрут построен
        Отображается экран выбора веломаршрута

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Невозможность построения самокатного маршрута офлайн:
    - info:
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Включен интернет
        ММП определено
    - do: Выключить эксперимент no_routes_tab (Настройки - Debug Panel - Experiments)
    - do: Перезапустить приложение
    - do: Тап на таб Маршруты
    - do: Выбрать тип маршрута самокат
    - do: Выключить интернет
    - do: Построить маршрут в любое место текущего региона
    - assert: |
        Отображается экран выбора маршрута
        Маршрут на самокате не построен
        Отображается сообщение, что построить самокатный маршрут без интернета невозможно
        Присутствует кнопка Повторить
    - do: Включить интернет
    - do: Тап на кнопку Повторить
    - assert: |
        Маршрут построен
        Отображается экран выбора самокатного маршрута
    - do: Закрыть приложение
    - do: Выключить интернет
    - do: Запустить приложение
    - do: Построить самокатный маршрут
    - assert: |
        Маршрут не строится
        Отображается спиннер загрузки
        Сообщение об отсутствии интернета не появляется
    - do: Включить интернет
    - assert: |
        Маршрут построен
        Отображается экран выбора самокатного маршрута

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
