testing:
  - regress
components: gas_card_org
integration_run:
  - tanker_sdk
import-steps:
  - ../../features/mobile-app/steps/common.yml

specs:
  Кнопка "Заправиться" на заправках партнёров:
    - attach: ["Открыть карточку АЗС с оплатой в картах"]
    - do: Закрыть карточку АЗС
    - assert: На карте отображаются пины АЗС
    - do: Закрыть поиск
    - assert: Отображается главный спан карты
    - do: Тап на таб Маршрут
    - assert: Открыт экран Маршрут
    - do: Тап в поле Куда
    - do: Ввести произвольный адрес
    - assert: Открыт экран выбора вариантов маршрута
    - do: Тап на Поехали
    - assert: Открыт экран ведения по маршруту
    - do: Тап на поиск
    - assert: Открывается экран поиска
    - do: Тап по категории АЗС (с оплатой в Картах)
    - assert: Открыт экран ведения с результатами поиска по выбранной категории
    - do: Тап по пину заправки
    - assert: |
        Открывается миникарточка заправки
        На iPad открывается полная карточка заправки
        В карточке присутствует кнопка Заправитсья
    - do: Закрыть карточку АЗС
    - assert: Открыт экран ведения с результатами поиска по выбранной категории
    - do: Выйти из режима ведения
    - assert: Открыт главный спан карты

    - tags:
        - use_map
        - assessors
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Кнопка "Заправиться" в горизонтальной ориентации:
    - info: Утройство в вертикальной ориентации
    - do: Открыть карточку АЗС с оплатой картой
    - assert: |
        Отображается карточка АЗС
        В карточке присутствует кнопка Заправиться
    - do: Повернуть устройство в горизонтальную ориентацию
    - assert: |
        Отображается карточка АЗС
        В карточке присутствует кнопка Заправитсья
    - do: Повернуть устройство в вертикальную ориентацию
    - do: Cвернуть полную карточку организации до мини
    - assert: |
        Отображается миникарточка организации.
        В action-баре отображается кнопка Заправиться
        На iPad карточка сворачивается до микро состояния

    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android


  Автооткрытие карточки заправки:
    - info: |
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Включить Prod окружение (Настройки - Debag Panel - Environment - Refuel environment - Prod)
    - do: Перезапустить приложение
    - do: Тап на Маршрут в карточке АЗС с оплатой картой
    - assert: Отображается экран выбора вариантов маршрута
    - do: Перейти в ведение по автомаршруту и доехать до конечной точки
    - assert: |
        Метка ММП отображается рядом с АЗС
        Открылась карточка АЗС на экране выбора колонки

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Автооткрытие карточки заправки c включенным табом Навигатор:
    - info: |
        Включен таб Навигатор
        Включено Prod окружение (Настройки - Debag Panel - Environment - Refuel environment - Prod)
        Построен  маршрут на полигон заправки АЗС с оплатой картой:
        На Android через приложение Mock Location
        На iOS через Enter your route в дебаг панели
    - do: Начать симуляцию движения по заданному маршруту
    - assert: |
        Стрелка ММП движется на спане карты
    - do: Дождаться ведения до полигона заправки АЗС
    - assert: |
        Метка ММП отображается рядом с АЗС
        Открылась карточка АЗС на экране выбора колонки

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Отсутствие автооткрытия карточки АЗС при движении мимо АЗС с включенным табом Навигатор:
    - info: |
        Включен таб Навигатор
        Построен  маршрут мимо АЗС с оплатой картой без заезда в полигон:
        На Android через приложение Mock Location
        На iOS через Enter your route в дебаг панели
    - do: Начать симуляцию движения по заданному маршруту
    - assert: |
        Стрелка ММП движется на спане карты
    - do: Дождаться ведения рядом с АЗС
    - assert: |
        Карточка АЗС не открылась во время проезда рядом с АЗС

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Отсутствие автоматического открытия карточки АЗС при движении по маршруту рядом с АЗС:
    - info: |
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Перейти в ведение по маршруту, проходящему мимо АЗС с оплатой в картах без заезда в полигон заправки
    - screenshot: Screenshot [https://jing.yandex-team.ru/files/katurkin/2476-корректно_НЕ_УДАЯТЬ.jpeg]
    - assert: Карточка АЗС не открылась во время проезда рядом с АЗС

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Автоматическое закрытие карточки заправки:
    - info: |
        Cкорость при движении не более 20 км/ч
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
        Скорость меняется с помощью параметра Demo movement speed, km/h
    - do: Построить маршрут с заездом в АЗС (прям на полигон заправки) с оплатой в картах
    - assert: |
        Отображается экран выбора вариантов маршрута
    - do: Перейти в ведение по автомаршруту и доехать до конечной точки
    - assert: |
        При заезде на АЗС автоматически открывается карточка заправки
        При выезде с АЗС карточка автоматически закрывается

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
        - lite_acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Автоматическое закрытие карточки заправки с табом Навигатор:
    - info: |
        Включен таб Навигатор
        Построен  маршрут с промежуточной точкой с заездом на полигон заправки АЗС с оплатой картой:
        На Android через приложение Mock Location
        На iOS через Enter your route в дебаг панели
        Задана скорость не более 20 км/ч
    - do: Начать симуляцию движения по заданному маршруту
    - assert: |
        Стрелка ММП движется на спане карты
    - do: Дождаться когда стрелка ММП окажется на полигоне заправки АЗС
    - assert: |
        При заезде на АЗС автоматически открывается карточка заправки
        При выезде с АЗС карточка автоматически закрывается

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Отсутствие автоматического открытия карточки АЗС при не автомобильном ведении мимо АЗС:
    - info: |
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Построить маршрут проходящий мимо АЗС с оплатой в картах без заезда на полигон заправки
    - assert: |
        Отображаются варианты маршрутов
    - do: Перейти в ведение по маршруту на ОТ/вело/пешему
    - assert: |
        Карточка АЗС не открылась во время движения рядом с АЗС

    - tags:
        - assessors
        - use_map
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Отсутствие автоматического открытия карточки АЗС при не автомобильном ведении с заездом на АЗС:
    - info: |
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Построить неавтомобильный маршрут с заездом в АЗС (прям на полигон заправки) с оплатой в картах
    - assert: |
        Отображается экран выбора вариантов маршрута
    - do: Перейти в ведение по пешему/велосипедному маршруту
    - assert: |
        При метке ММП на АЗС карточка заправки АЗС не открывается

    - tags:
        - assessors
        - use_map
    - platforms:
        - ios
        - android
    - integration_run:
        - kotlin


  Отсутствие открытия карточки заправки при местоположении у АЗС без движения:
    - info: |
        Происходит симуляция местоположения:
        На Android: через Mock Location
        На iOS: через Xcode
    - do: Симулировать местоположение около АЗС с оплатой в картах
    - do: Свернуть/развернуть приложение
    - assert: |
        Метка ММП отображается рядом с АЗС
        Карточка заправки не открывается
    - do: Перезапустить приложение
    - assert: |
        Метка ММП отображается рядом с АЗС
        Карточка заправки не открывается

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android


  Отображения цен на топливо в карточках заправок:
    - do: Осуществить поиск по категории АЗС
    - assert: Отображаются результаты поиска и пины на карте
    - do: Тап на пин АЗС без онлайн-оплаты
    - assert: |
        Отображается мини-карточка организации
        Отсутствует кнопка Заправиться
        (iPad) отображается полная карточка организации, кнопка заправиться отсутствует
    - do: (iPhone) Тап на мини-карточку
    - assert: |
        Отображается полная карточка организации
        Присутствует блок с ценами на топливо
        В блоке цен присутствует дата обновления цен и их источник
    - do: Тап на пин АЗС с онлайн-оплатой
    - assert: |
        Отображается мини-карточка организации
        Присутствует кнопка Заправиться
        (iPad):
        Присутствует блок с ценами на топливо
        В блоке цен присутствует дата обновления цен и их источник
    - do: (iPhone) Тап на мини-карточку
    - assert: |
        Отображается полная карточка организации
        Присутствует кнопка Заправиться
        Присутствует блок с ценами на топливо
        В блоке цен присутствует дата обновления цен и их источник
    - do: Сменить ориентацию устройства
    - assert: |
        В карточке присутствует кнопка Заправиться и блок с ценами на топливо
        В блоке цен присутствует дата обновления цен и их источник
    - do: Свернуть/развернуть приложение
    - assert: |
        В полной карточке присутствует кнопка Заправиться и блок с ценами на топливо
        В блоке цен присутствует дата обновления цен и их источник

    - tags:
        - assessors
        - use_map
    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android


  Отображение бейджа с надписью С оплатой в Картах в карточке АЗС:
    - info: |
        Девайс в вертикальной ориентации
        Открыт главный экран приложения
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: | 
        Открывается полная карточка заправки
        Под заголовком карточки заправки отображается бейдж с надписью "С оплатой в Картах"
    - do: Открыть мини-карточку заправки свайпом вниз
    - assert: Под заголовком карточки заправки отображается бейдж с надписью "С оплатой в Картах"
    - do: Сменить ориентацию девайса на горизонтальную
    - assert: |
        Отображается карточка заправки в горизонтальной ориентации
        Бейдж с надписью "С оплатой в Картах" отображается

    - tags:
        - assessors
    - platforms:
        - ios
        - android 


  Отображение блока Как оплачивать топливо в Картах в карточке АЗС:
    - info: |
        Девайс в вертикальной ориентации
        Открыт главный экран приложения
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: | 
        Открывается полная карточка заправки
        Отображается блок "Как оплачивать топливо в Картах" с кнопкой "Посмотреть" под блоком видов топлива
    - do: Сменить ориентацию девайса на горизонтальную
    - assert: |
        Отображается карточка заправки в горизонтальной ориентации
        Блок "Как оплачивать топливо в Картах" с кнопкой "Посмотреть" отображается

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Отображение сториз в карточке АЗС:
    - info: |
        Девайс в вертикальной ориентации
        Открыт главный экран приложения
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: |
        Открывается полная карточка заправки
        Отображается блок "Как оплачивать топливо в Картах" под блоком видов топлива
    - do: Тап на кнопку "Посмотреть" в блоке "Как оплачивать топливо"
    - assert: Отображается экран сториз
    - do: Тапом пролистать сториз до конца
    - assert: |
        Сториз закрываются
        Отображается карточка заправки
    - do: Открыть сториз тапом на кнопку "Посмотреть"
    - do: Закрыть экран сториз тапом на крестик
    - assert: Отображается карточка заправки 

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Тапабельность блока Как оплачивать топливо в Картах в карточке АЗС:
    - info: |
        Девайс в вертикальной ориентации
        Открыт главный экран приложения
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: |
        Открывается полная карточка заправки
        Отображается блок "Как оплачивать топливо в Картах" под блоком видов топлива
    - do: Сменить ориентацию девайса на горизонтальную
    - assert: |
        Отображается карточка заправки в горизонтальной ориентации
        блок "Как оплачивать топливо" отображается
    - do: Тап на пространство в блоке "Как оплачивать топливо" рядом с кнопкой "Посмотреть"
    - assert: Отсутствует переход на экран сториз

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Восстановление сети в сториз в карточке АЗС:
    - info: Открыт главный экран приложения
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: |
        Открывается полная карточка заправки
        Отображается блок "Как оплачивать топливо в Картах" под блоком видов топлива
    - do: Включить авиарежим
    - do: Тап на кнопку "Посмотреть" в блоке "Как оплачивать топливо"
    - assert: Отображается экран сториз с ошибкой об отсутствии сети
    - do: Тап на крестик
    - assert: |
        Сториз закрываются
        Отображается карточка заправки
    - do: Выключить авиарежим
    - do: Тап на кнопку "Посмотреть" в блоке "Как оплачивать топливо"
    - assert: | 
        Открываются сториз
        Экран с ошибкой сети отсутствует

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Изменение кнопки заправки в карточке АЗС:
    - info: | 
        Открыт главный экран приложения
        Устройство в вертикальной ориентации
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/maaryma/Снимок%20экрана%202022-05-06%20в%2011.43.51.png){title=QR-код}
        
        `yandexmaps://add_exp?transactional_button_redesign`
    - do: Перезагрузить приложение
    - do: Тап на поиск
    - do: Тап на категорию "Яндекс.Заправки"
    - assert: Отображаются результаты поиска Я.Заправок 
    - do: Тап на любой результат поиска
    - assert: |
        Открывается полная карточка заправки
        СТА-кнопка заправки в прозрачном цвете
    - do: Открыть мини-карточку заправки свайпом вниз
    - assert: СТА-кнопка заправки в прозрачном цвете
    - do: Изменить ориентацию устройства на горизонтальную
    - assert: Отображается СТА-кнопка заправки в прозрачном цвете

    - tags:
        - assessors
    - platforms:
        - android