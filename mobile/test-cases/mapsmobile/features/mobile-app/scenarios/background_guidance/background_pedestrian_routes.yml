components: background_pedestrian_routes
platforms:
  - android
testing:
  - regress
tags:
  - assessors

specs:
  Аннотации в пешеходном ведении в фоне в онлайн-режиме:
    - info: На девайсе включен интернет
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Построить пешеходный маршрут с различными маневрами
    - do: Тап Начать
    - assert: Отображается экран ведения
    - do: Свернуть приложение
    - assert: |
        Аннотации озвучиваются голосом Алисы
        Аннотации соответсвуют пешеходному маршруту (Идите прямо, перейдите дорогу и т.п)
    - do: Развернуть приложение
    - assert: |
        Метка ММП соответсвует пройденному участку маршрута
        Маршрут не сбросился, не вернулся к начальной точке
        Аннотации продолжают воспроизводиться голосом Алисы

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - mapkit_ready
        - newbie
    - integration_run:
        - mapkit


  Аннотации в пешеходном ведении в фоне в офлайн-режиме:
    - do: |
        Меню - Загрузка карт - Скачать кеш текущего региона
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
        Выключить интернет на устройстве
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Построить пешеходный маршрут с различными маневрами
    - do: Тап Начать
    - assert: Отображается экран ведения по пешеходному маршруту
    - do: Свернуть приложение
    - assert: |
        Аннотации озвучиваются голосом Алисы
        Аннотации соответсвуют пешеходному маршруту (Идите прямо, перейдите дорогу и т.п)
    - do: Развернуть приложение
    - assert: |
        Метка ММП соответсвует пройденному участку маршрута
        Маршрут не сбросился, не вернулся к начальной точке
        Аннотации продолжают воспроизводиться голосом Алисы

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - mapkit


  Офлайн пешеходное ведение в фоне с DKA:
    - do: |
        Меню - Настройки - Маршрут - Фоновое ведение - Вкл
        Меню - Загрузка карт - Скачать кэш текущего региона
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
        Выключить интернет на устройстве
    - do: |
        Включен режим Don’t keep activities (Настройки устройства -> Параметры разработчика -> блок Приложения)
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Построить пешеходный маршрут с различными маневрами
        Тап Начать
    - do: Свернуть приложение
    - assert: |
        Аннотации о маневрах озвучиваются в фоне
        Сверху экрана отображаются уведомления с информацией о маршруте
    - do: Развернуть приложение
    - assert: Продолжается ведение по маршруту

    - platforms:
        - android
    - testing:
        - acceptance_maps
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Завершение пешеходного ведения в фоне при достижении конечной точки:
    - do: |
        Меню -> Настройки -> Маршрут -> Фоновое ведение -> Вкл
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Построить пешеходный маршрут с различными маневрами
        Тап Начать
    - do: Свернуть приложение
    - assert: |
        Аннотации о маневрах озвучиваются в фоне
        (Android) Сверху экрана отображаются уведомления с информацией о маршруте
    - do: Дождаться завершения маршрута
    - assert: Озвучивается завершение маршрута
    - do: Развернуть приложение
    - assert: |
        Маршрут завершен
        Отображается главный экран приложения

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - newbie


  Завершение пешеходного ведения в фоне при достижении конечной точки c DKA:
    - do: |
        Меню -> Настройки -> Маршрут -> Фоновое ведение -> Вкл
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Включен режим Don’t keep activities (Настройки устройства -> Параметры разработчика -> блок Приложения)
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Построить пешеходный маршрут с различными маневрами
        Тап Начать
    - do: Свернуть приложение
    - assert: |
        Аннотации о маневрах озвучиваются в фоне
        Сверху экрана отображаются уведомления с информацией о маршруте
    - do: Дождаться завершения маршрута
    - assert: Озвучивается завершение маршрута
    - do: Развернуть приложение
    - assert: |
        Маршрут завершен
        Отображается главный экран приложения

    - platforms:
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready


  Отсутствие аннотаций в фоне в режиме пешеходного маршрута, если настройка Фоновое ведение выключена:
    - do: |
        Меню - Загрузка карт - Скачать кэш текущего региона
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Меню -> Настройки -> Маршрут -> Фоновое ведение -> Выкл
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: 
        Построить пешеходный маршрут с маневрами
        Тап Начать
    - assert: |
        Отображается экран ведения по пешеходному маршруту
        Воспроизводятся аннотации по маршруту
    - do: Свернуть приложение
    - assert: |
        (Android) Сверху экрана уведомления с информацией о маршруте не появляются
        Аннотаций не воспроизводятся
    - do: Развернуть приложение
    - assert: |
        Маршрут не сбросился, не вернулся к начальной точке
        Аннотации продолжают воспроизводиться

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - mapkit_ready
    - integration_run:
        - mapkit