components: background
testing:
  - regress
integration_run:
  - mapkit
tags:
  - mapkit_ready

specs:
  Фоновое ведение в офлайне:
    - do: |
        Скачать кэш текущего региона (Меню -> Загрузка карт)
        Выключен интернет
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        Включена симуляция ведения: Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами
        Подтвердить маршрут
    - assert: |
        Открыт экран ведения по автомаршруту
        Может появится плашка о ведении маршрута в офлайне
    - do: Свернуть приложение
    - assert: |
        Продолжается ведение по маршруту в фоне
        Произносятся голосовые аннотации

    - platforms:
        - ios
        - android
    - testing:
        - lite_acceptance_maps
    - tags:
        - assessors
    - tags:
        - newbie


  Фоновое ведение во freedrive:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        На Android: через Mock Location
        На iOS: через Enter your route в дебаг-панели
    - do: Тап на таб Навигатор
    - do: Начать симуляцию движения без построения маршрута в приложении
    - do: Свернуть приложение
    - assert: |
        Приложение продолжает работать в фоне
        Звучат аннотации о маршруте
    - do: Развернуть приложение
    - assert: Приложение продолжает работать стабильно

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Фоновое ведение. GPS при cворачивании приложения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Построить автомаршрут в любую точку и подтвердить его
        Свернуть приложение
    - assert: |
        Службы локации не отключаются
        iOS: Вверху экрана видна синяя плашка "Карты используют ваше местоположение\вашу геопозицию»
        Android: Из Status Barа не исчезает значок GPS
    - do: |
        Развернуть приложение
        Сбросить маршрут
        Свернуть приложение
    - assert: |
        Службы локации отключаются
        - iOS: Вверху экрана не отображается синяя плашка "Карты используют ваше местоположение\вашу геопозицию»
        - Android: Из Status Barа исчезает значок GPS

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Фоновое ведение при включенной настройке DKA:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        В настройках девайса включена настройки Dont keep activity
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Построить автомаршрут в любую точку
    - do: Тап на Поехали
    - do: Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
        Звучат аннотации по маршруту и отображаются нотификации
    - do: Развернуть приложение
    - assert: Приложение продолжает стабильно работать, курсор движется по маршруту

    - platforms:
        - android
    - tags:
        - assessors
    - tags:
        - newbie


  Отключение фонового ведения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement - Выкл
        iOS: Выдан доступ к Motion девайса
    - do: Построить автомаршрут в любую точку
    - do: Тап на Поехали
    - do: Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
        Движение по маршруту не симулируется
    - do: Оставить девайс без движения на 60 минут
    - assert: Фоновое ведение прекращается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Отключение фонового ведения. Пешая ходьба:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: Построить автомаршрут в любую точку
    - do: Тап на Поехали
    - do: Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
    - do: |
        Начать пешее движение
        Двигаться более 20 секунд
    - assert: Фоновое ведение прекращается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Переход из автонавигации в пешую:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут в любую точку
        Тап на Поехали
        Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
    - do: |
        Развернуть приложение
        Сбросить маршрут
        Построить пеший маршрут в любую точку
        Тап на Начать
        Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по пешему маршруту в фоне продолжается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Убийство процесса во время фонового ведения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
        Телефон подключен к ПК
    - do: |
        Построить автомаршрут
        Тап на Поехали
        Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
    - do:
        Выполнить в терминале команду для убийства процесса
        `adb shell am force-stop ru.yandex.yandexmaps.debug` или
        `adb shell am force-stop ru.yandex.yandexmaps.pr`
        В зависимости от сборки
    - assert:
        Службы геолокации отключаются
        Ведение по маршруту в фоне прекращается
        Аннотации по маршруту не звучат, нотификации не отображаются
    - do: Развернуть приложение
    - assert: Приложение заново стартует

    - platforms:
        - android
    - tags:
        - assessors
    - tags:
        - newbie


  Прекращение ведения после остановки приложения через настройки:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Построить маршрут и подтвердить его
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - assert: Курсор двигается по маршруту
    - do: Свернуть приложение
    - assert: Фоновое ведение продолжается, звучат аннотации по маршруту, отображаются нотификации
    - do: |
        Выгрузить приложение через настройки: Системные настройки телефона -> Приложения -> Яндекс.карты -> Остановить
    - assert: |
        Ведение прекращается, аннотации по маршруту не звучат, нотификации не отображаются
        В статус-баре отсутствует иконка геолокации

    - platforms:
        - android
    - testing:
        - regress
    - tags:
        - assessors


  Завершение фонового ведения после выгрузки приложения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: Построить маршрут в любую точку
    - do: Тап на Поехали
    - assert: Курсор движется по маршруту
    - do: Свернуть приложение
    - do: Выгрузить приложение свайпом из меню мультизадачности
    - assert: Уведомлений о маршруте нет

    - platforms:
        - android
        - ios
    - testing:
        - acceptance_maps
    - tags:
        - assessors