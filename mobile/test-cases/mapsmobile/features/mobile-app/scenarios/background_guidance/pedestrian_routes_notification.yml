components: pedestrian_routes_notification
testing:
  - regress
platforms:
  - android
tags:
  - assessors


specs:

  Отображение пешеходной нотификации в фоне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Настройки -> Маршрут -> Фоновое ведение)
        Построить и подтвердить пешеходный маршрут
        В маршруте присутствует несколько маневров
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение и развернуть системную шторку
    - assert: |
        Появляется всплывающее уведомление навигации, где указано:
        - Расстояние до следующего маневра
        - Стрелка маневра (поворот направо, поворот налево, разворот)
        - Кнопки завершения маршрута и выключения звука
        Аннотации о маневрах озвучиваются в фоне

    - testing:
        - acceptance_maps
    - integration_run:
        - mapkit
    - tags:
        - mapkit_ready


  Сброс пешеходного маршрута в фоне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Настройки -> Маршрут -> Фоновое ведение)
        Построить и подтвердить пешеходный маршрут
        В маршруте присутствует несколько маневров
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение и развернуть системную шторку
    - assert: |
        Появляется всплывающее уведомление навигации
    - do: Тап "Завершить"
    - assert: |
        Всплывающее уведомление навигации пропало
        Аннотации по маршруту не звучат
    - do: Развернуть приложение
    - assert: |
        Построенный маршрут отсутствует
        Отображается главный экран приложения

    - testing:
        - acceptance_maps


  Отключение аннотация по пешеходному маршруту в фоне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Настройки -> Маршрут -> Фоновое ведение)
        Построить и подтвердить пешеходный маршрут
        В маршруте присутствует несколько маневров
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение и развернуть системную шторку
    - assert: |
        Появляется всплывающее уведомление навигации
    - do: Тап на кнопку выключения звука (без уведомлений)
    - assert: |
        Кнопка меняет свое название на "С уведомлениями"
        Продолжается ведение по маршруту
        Аннотации не озвучиваются

    - testing:
        - acceptance_maps


  Включение аннотаций по пешеходному маршруту в фоне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Меню - Настройки -> Маршрут -> Фоновое ведение)
        Меню - Настройки - Маршруты - Звук - Проигрывать уведомления - Выкл
        Построить и подтвердить пешеходный маршрут
    - do: |
        В маршруте присутствует несколько маневров
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение и развернуть системную шторку
    - assert: Появляется всплывающее уведомление навигации
    - do: Тап на кнопку включения звука "С уведомлениями"
    - assert: |
        Кнопка меняет свое название на "Без уведомлений"
        Продолжается ведение по маршруту
        Звучат аннотации по маршруту


  Завершение пешего маршрута в фоне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Меню - Настройки -> Маршрут -> Фоновое ведение)
        Построить и подтвердить короткий пешеходный маршрут
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение
    - assert: |
        Начинается фоновое ведение по маршруту
        Звучат аннотации по маршруту
    - do: Дождаться окончания маршрута
    - assert: |
        Звучит фраза "Вы на месте"
        После окончания маршрута нотификации не отображаются и аннотации не звучат


  Отсутствие нотификаций пешого ведения в фоне при выгрузке приложения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Меню - Настройки -> Маршрут -> Фоновое ведение)
        Построить и подтверждить пешеходный маршрут
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение
    - assert: |
        Начинается фоновое ведение по маршруту
        Звучат аннотации по маршруту
    - do: |
        Свайпом удалить приложение из меню мультизадачности
        Подождать ~30 секунд
    - assert: Нотификации по маршруту и аннотации отсутствуют


  Отсутствие нотификаций пешого ведения в фоне при остановке приложения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включено фоновое ведение (Меню - Настройки -> Маршрут -> Фоновое ведение)
        Построен и подтвержден пешеходный маршрут
    - do: |
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: Свернуть приложение
    - assert: |
        Начинается фоновое ведение по маршруту
        Звучат аннотации по маршруту
    - do: |
        Остановить приложение через настройки:
        Настройки девайса - Приложения - Яндекс Карты - Остановить
    - assert: Нотификации по маршруту и аннотации отсутствуют


  Убийство фонового ведения по пешему маршруту:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
        Меню > Настройки > Debug-panel > Routes > Demo movement
        Телефон подключен к ПК
    - do: |
        Построить пеший маршрут и подтвердить его
        Свернуть приложение
    - assert: |
        Службы локации не отключаются
        Ведение по маршруту в фоне продолжается
    - do:
        Выполнить в терминале команду для убийства процесса
        `adb shell am kill ru.yandex.yandexmaps.debug` или
        `adb shell am kill ru.yandex.yandexmaps.pr`
        В зависимости от сборки
    - assert:
        Службы геолокации отключаются
        Ведение по маршруту в фоне прекращается
        Аннотации по маршруту не звучат, нотификации не отображаются
    - do: Развернуть приложение
    - assert: Приложение заново стартует


  Пешее ведение в фоне. Нотификации на заблокированном экране:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        В ведении должна происходить симуляция движения:
    - do: |
        Меню > Настройки > Debug-panel > Routes > Demo movement
        Телефон подключен к ПК
    - do: |
        Построить пеший маршрут и подтвердить его
        Заблокировать девайс
    - assert: Устройство заблокировано
    - do: Дождаться появления оповещения о предстоящем маневре на выключенном экране устройства
    - assert: |
        Появилось оповещение о предстоящем маневре на выключенном экране устройства
        В оповещении присутствуют:
          - логотип приложения
          - название приложения
          - изображение ближайшего маневра и расстояние до него
        Воспроизводятся звуковые аннотации о предстоящих маневрах


  Фоновое пешее ведение в офлайне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Скачан кэш текущего региона (Меню -> Загрузка карт)
        Выключен интернет
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        Включена симуляция ведения: Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: |
        Построить пеший маршрут с маневрами
        Подтвердить маршрут
    - assert: |
        Открыт экран ведения по маршруту
    - do: Свернуть приложение
    - assert: |
        Продолжается ведение по маршруту в фоне
        Произносятся голосовые аннотации


  Запрет фонового ведения в офлайне:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Выкл
        Включена симуляция ведения: Меню > Настройки > Debug-panel > Routes > Demo movement
    - do: |
        Построить пеший маршрут с маневрами
        Подтвердить маршрут
    - assert: |
        Открыт экран ведения по маршруту
    - do: Свернуть приложение
    - assert: |
        Продолжается ведение по маршруту в фоне
        Heads-up оповещения о предстоящих маневрах
        Отсутствуют голосовые аннотации
    - do: Раскрыть шторку свайпом вниз
    - assert: |
        В шторке отсутствуют оповещения от приложения о предстоящих маневрах
        Отсутствуют голосовые аннотации
