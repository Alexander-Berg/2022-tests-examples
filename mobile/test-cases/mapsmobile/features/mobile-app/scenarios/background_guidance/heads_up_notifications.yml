components: heads_up_notifications
platforms:
  - android
testing:
  - regress
integration_run:
  - mapkit
tags:
  - assessors
  - mapkit_ready

specs:
  Отображение нотификаций поверх других приложений:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить маршрут c несколькими ДС и различными маневрами
        Подтвердить маршрут
        Свернуть приложение
        Открыть любое другое приложение
    - assert: |
        Поверх приложения появляются нотификации с данными о ближайшем маневре и названием улицы, по которой производится движение
        Присутствуют кнопки "Сбросить маршрут" и "Без уведомлений"
        Расстояние до маневра обновляется


  Фоновое ведение. Heads-up. Камера контроля скорости:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню -> Настройки -> Маршруты -> Фоновое ведение -> Вкл
        Меню -> Настройки -> Карта -> Дорожные события -> Камера контроля скорости -> Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
        Установить скорость движения 100 км/ч
    - do: |
        Построить автомаршрут через камеру контроля скорости и подтвердить его
        Свернуть приложение
    - assert: Приложение в фоне
    - do: Дождаться появления Heads-up notifications с оповещением о приближении к камере контроля скорости
    - assert: |
        В Heads-up notifications присутствует оповещение о приближении к камере контроля скорости
        Присутствуют:
        - изображение в виде камеры и расстояние до нее
        - кнопка выключения звука (без уведомлений)
        - кнопка завершения маршрута
        При приближении к камере звучит голосовое предупреждение о приближении к камере контроля скорости и номинале разрешенной скорости
    - do: Продолжать двигаться по маршруту, обратить внимание на расстояние до камеры
    - assert: По мере приближения к камере расстояние динамически уменьшается

    - testing:
        - acceptance_maps


  Фоновое ведение. Heads-up. Маневр:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: |
        Приложение в фоне
        Присутствуют голосовые аннотации по маршруту
    - do: |
       Дождаться появления Heads-up notifications с оповещением о предстоящем маневре
       Звуковое оповещение может быть воспроизведено и после скрытия Heads-up notifications
    - assert: |
        Появилось Heads-up notifications с оповещением о предстоящем маневре
        В Heads-up notifications присутствует:
          - Изображение ближайшего маневра
          - Расстояние до ближайшего маневра
          - Название улицы, на которой будет произведен маневр, (Появляется за <= 200 метров)
          - Кнопка выключения звука (без уведомлений)
          - Кнопка завершения маршрута
        Присутствуют голосовые аннотации по маршруту
        Heads-up notifications отображаются несколько секунд, потом скрываются


  Heads-up нотификации. Тап по уведомлению:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: |
        Приложение в фоне
        Присутствуют голосовые аннотации и нотификации по маршруту
    - do: Тап по появившейся нотификации
    - assert: Открывается приложение


  Скрытие heads-up нотификации фонового ведения:
    - info: |
        Для проверки необходимо устройство с максимально большой плотностью (отношением dp/px) экрана
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: Приложение в фоне
    - do: Дождаться отображение нотификации
    - assert: |
        Отображается плашка нотификации по маршруту
        Присутствуют голосовые аннотации по маршруту
    - do: Закрыть нотификацию свайпом вверх
    - assert: Нотификация закрылась
    - do: Дождаться проезда нескольких мест с маневрами
    - assert: |
        Воспроизводятся звуковые аннотации о предстоящих маневрах
        Heads-up notifications не появляется


  Отсутствие нотификаций фонового ведения сразу после сворачивания приложения:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Включена симуляция движения в дебаг панели: Меню > Настройки > Debug-panel > Routes > Demo movement
        Построить автомобильный маршрут с несколькими маневрами
        Запустить ведение по маршруту
    - do: Свернуть приложение, так что бы до следующего маневра было более 50 метров
    - assert: |
        Сразу при сворачивании приложения нотификация не появляется
        При приближении к маневру появлятся всплывающая нотификация с предупреждением о нем
