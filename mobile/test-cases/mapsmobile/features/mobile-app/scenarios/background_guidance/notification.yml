components: notification
platforms:
  - android
testing:
  - regress
integration_run:
  - mapkit
tags:
  - assessors
  - mapkit_ready

specs:

  Фоновое ведение. Уведомление в шторке:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение  - Вкл
        Меню - Настройки - Карта - Дорожные события - Камеры - Вкл
        Меню -  Настройки - Маршруты - Камеры - Контроль скорости - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и камерами
        Подтвердить маршрут
        Свернуть приложение
    - assert: Приложение в фоне
    - do: Раскрыть системную шторку свайпом вниз
    - assert: |
        В шторке отображается нотификация в свернутом состоянии
        В нотификации присутствуют:
          - изображение ближайшего маневра
          - расстояние до ближайшего маневра
          - название улицы, на которой будет произведен маневр
          - оставшееся расстояние движения по маршруту
          - среднее время до окончания маршрута
        Присутствуют голосовые аннотации по маршруту
    - do: Свайпом вниз развернуть карточку до конца
    - assert: |
        Нотификация раскрылась до конца
        В ней присутствуют:
          - изображение ближайшего маневра
          - расстояние до ближайшего маневра
          - название улицы, на которой будет произведен маневр
          - оставшееся расстояние движения по маршруту
          - среднее время до окончания маршрута
          - кнопка выключения звука (без уведомлений)
          - кнопка завершения маршрута

    - testing:
        - lite_acceptance_maps
    - tags:
        - assessors
    - tags:
        - newbie

  Фоновое ведение. Уведомление в шторке. Маневр:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do:  Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
    - assert: Курсор движется по маршруту
    - do: Свернуть приложение
    - assert: Приложение в фоне
    - do: |
        Раскрыть системную шторку свайпом вниз
        Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - assert: |
        Плашка оповещения раскрылась до полной, в ней присутствуют:
          - изображение ближайшего маневра
          - расстояние до ближайшего маневра
          - название улицы, на которой будет произведен маневр
        Присутствуют голосовые аннотации по маршруту
    - do: Продолжать движение по маршруту, обратить внимание на расстояние до маневра
    - assert: По мере приближения к месту маневра расстояние динамически уменьшается

    - testing:
        - acceptance_maps
    - tags:
        - newbie


  Фоновое ведение. Уведомление в шторке. Без уведомлений:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: Приложение ушло в фон
    - do: |
        Раскрыть системную шторку свайпом вниз
        Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - assert: Плашка оповещения раскрылась до полной
    - do: Тап на кнопку выключения звука "Без уведомлений"
    - assert: |
        Кнопка переименована (с уведомлениями)
        Аннотации перестали проговариваться голосом
    - do: Свернуть системную шторку свайпом вверх
    - assert: |
        Аннотации не проговариваются голосом
        Всплывающие нотификации не отображаются
    - do: |
        Раскрыть системную шторку свайпом вниз
        Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - do: Тап на кнопку включения звука "С уведомлениям"
    - assert: |
        Кнопка переименована (без уведомлений)
        Аннотации проговариваются голосом
    - do: Свернуть системную шторку свайпом вверх
    - assert:
        Аннотации проговариваются голосом
        Всплывающие нотификации тображаются

    - testing:
        - lite_acceptance_maps
    - tags:
        - newbie


  Фоновое ведение. Уведомление в шторке. Завершение маршрута:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: Приложение в фоне
    - do: |
        Раскрыть системную шторку свайпом вниз
        Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - assert: |
        Плашка оповещения раскрылась до полной
    - do: Тап на кнопку "Завершить маршрут"
    - assert: |
        Оповещение приложения скрылось из шторки
        Аннотации по маршруту не звучат
    - do: Перейти в приложение
    - assert: |
        Открыт главный экран карты
        Ведение по маршруту остановлено
        Построенный маршрут отсутствует
        Голосовые аннотации отсутсвуют


  Фоновое ведение. Уведомление в шторке. Камера контроля скорости:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: |
        Меню - Настройки - Маршруты - Фоновое ведение - Вкл
        Меню - Настройки - Карта - Дорожные события - Камеры - Вкл
        Меню - Настройки - Маршруты - Камеры - Контроль скорости - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
        Установить скорость движения 100 км/ч
    - do: |
        Построить автомаршрут через камеру контроля скорости и подтвердить его
        Свернуть приложение
    - assert: Приложение в фоне
    - do: |
        Раскрыть системную шторку свайпом вниз
        Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - assert: |
        Плашка оповещения раскрылась до полной
        В плашке присутствует:
        - изображение камеры, расстояние до нее
        - изображение камеры контроля скорости и расстояние до нее
        - среднее время до окончания маршрута
        - кнопка выключения звука (без уведомлений)
        - кнопка завершения маршрута
        При приближении к камере звучит голосовое предупреждение о приближении к камере контроля скорости и номинале разрешенной скорости
    - do: Продолжать двигаться по маршруту, обратить внимание на расстояние до камеры
    - assert: По мере приближения к камере расстояние динамически уменьшается

    - testing:
        - lite_acceptance_maps


  Фоновое ведение. Нотификации при заблокированном экране:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Построен автомаршрут в пределах города, по маршруту имеются маневры
        Включить симуляцию движения: Debug-panel > Routes > Demo movement
        Открыт экран ведения по маршруту
    - do: Заблокировать устройство
    - assert: |
        Устройство заблокировано
        Экран устройства выключен
    - do: Дождаться появления оповещения о предстоящем маневре на выключенном экране устройства
    - assert: |
        Появилось оповещение о предстоящем маневре на выключенном экране устройства
        В оповещении присутствуют:
          - логотип приложения
          - название приложения
          - изображение ближайшего маневра и расстояние до него
        Воспроизводятся звуковые аннотации о предстоящих маневрах
        Содержимое оповещения может быть другим: операционная система сама определяет, что показывать


  Фоновое ведение. Отсутствие нотификации при заблокированном экране:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Выкл
    - do: |
        Построен автомаршрут в пределах города, по маршруту имеются маневры
        Включить симуляцию движения: Debug-panel > Routes > Demo movement
        Открыт экран ведения по маршруту
    - do: Заблокировать устройство
    - assert: |
        Отсутствуют оповещения о предстоящих маневрах, камерах контроля скорости на выключенном экране
        Отсутствуют голосовые аннотации


  Отсутствие нотификации фонового ведения при выгрузке приложения из меню многозадачности:
    - do: |
        Android:
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Вкл
    - do: |
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: |
        Приложение в фоне
        Присутствуют голосовые аннотации и нотификации по маршруту
    - do: |
        Свайпом удалить приложение из меню мультизадачности
        Подождать ~30 секунд
    - assert: Нотификации по маршруту и аннотации отсутствуют

    - testing:
        - acceptance_maps


  Фоновое ведение. Ведение в фоне запрещено:
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Уведомления на экране блокировки -> On
    - do: Меню - Настройки - Маршруты - Фоновое ведение - Выкл
    - do: |
        В ведении должна происходить симуляция движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и подтвердить его
        Свернуть приложение
    - assert: Приложение в фоне
    - do: Раскрыть шторку свайпом вниз
    - assert: |
        В шторке отсутствуют оповещения от приложения о предстоящих маневрах, о камерах контроля скорости
        Отсутствуют голосовые аннотации
    - do: Свернуть шторку свайпом вверх
    - assert: |
        Heads-up оповещения о предстоящих маневрах, камерах контроля скорости не появляются
        Отсутствуют голосовые аннотации

    - testing:
        - acceptance_maps
    - tags:
        - newbie


  Сохранение настроек уведомлений при обновлении приложения:
    - info: В зависимости от модели телефона настройки уведомлений могут находиться в различных местах. В шагах кейса описана общая логика настроек тестируемого устройства
    - do: Установить предыдущую версию Яндекс Карт
    - do: Запустить приложение несколько раз
    - do: |
        Проверить что приложению даны все разрешения:
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> Уведомления на экране блокировки -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> Уведомления на экране блокировки -> On
    - do: Обновиться до текущей (тестируемой) версии Яндекс Карт и запустить приложение
    - do: |
        Проверить что приложению даны все разрешения:
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> Уведомления на экране блокировки -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> Уведомления на экране блокировки -> On
    - assert: Все разрешения выданы
    - do: |
        Вернуться в приложение
        Включить симуляцию движения:
        Debug-panel > Routes > Demo movement
    - do: |
        Построить автомаршрут с маневрами и камерами
        Подтвердить маршрут
        Свернуть приложение
    - assert: |
        Звучат аннотации по маршруту
        Отображаются heads-up нотификации
    - do: Развернуть системную шторку. Для полного раскрытия уведомления используйте дополнительный свайп вниз
    - assert: В шторке отображается нотификация по маршруту


  Фоновое ведение. Подсказки в фоновом режиме запрещены в настройках устройства:
    - info: Выключен эксперимент "new_maps_settings" (Меню -> Настройки -> Debug-Panel -> Experiments)
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> off
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
    - do: Открыть Яндекс Карты
    - do: Перейти в настройки Фоновое ведение (Меню - Настройки - Маршруты - Фоновое ведение)
    - assert: Свитчер "Подсказки в фоновом режиме" неактивен
    - do: Тап по "Подсказки в фоновом режиме"
    - assert: |
        Появилось предупреждение о необходимости включить уведомление в настройках устройства
        В уведомлении есть кнопки "Открыть настройки" и "Позже"
    - do: Тап по "Открыть настройки"
    - assert: Открылись системные настройки Яндекс Карт
    - do: Тап по "Уведомления"
    - do: Включить "Подсказки в фоновом режиме"
    - do: Перейти в Яндекс Карты
    - assert: Настройка "Подсказки в фоновом режиме" включена

    - testing:
        - acceptance_maps


  Фоновое ведение. Ведение в фоне запрещено в настройках устройства:
    - info: Выключен эксперимент "new_maps_settings" (Меню -> Настройки -> Debug-Panel -> Experiments)
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> off
    - do: Открыть Яндекс Карты
    - do: Перейти в настройки Фоновое ведение (Меню - Настройки - Маршруты - Фоновое ведение)
    - assert: Свитчер "Фоновое ведение" неактивен
    - do: Тап по "Фоновое ведение"
    - assert: |
        Появилось предупреждение о необходимости включить уведомление в настройках устройства
        В уведомлении есть кнопки "Открыть настройки" и "Позже"
    - do: Тап по "Открыть настройки"
    - assert: Открылись системные настройки Яндекс Карт
    - do: Тап по "Уведомления"
    - do: Включить "Фоновое ведение"
    - do: Перейти в Яндекс Карты
    - assert: Свитчер "Фоновое ведение" активен


  Ведение в фоне запрещено в настройках устройства:
    - do: |
        Использовать интент:
        [collapsed-image](https://jing.yandex-team.ru/files/chernetsov71/qr_new_maps_settings.png){title=QR-код}

        `yandexmaps://add_exp?new_maps_settings`
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> on
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> off
    - do: Открыть Яндекс Карты
    - do: Перейти в настройки Автомашруты (Меню - Настройки - Навигация)
    - assert: Свитчер "Фоновое ведение" неактивен
    - do: Тап по "Фоновое ведение"
    - assert: |
        Появилось предупреждение о необходимости включить уведомление в настройках устройства
        В уведомлении есть кнопки "Открыть настройки" и "Позже"
    - do: Тап по "Открыть настройки"
    - assert: Открылись системные настройки Яндекс Карт
    - do: Тап по "Уведомления"
    - do: Включить "Фоновое ведение"
    - do: Перейти в Яндекс Карты
    - assert: Свитчер "Фоновое ведение" активен

    - tags:
        - new_settings


  Подсказки в фоновом режиме запрещены в настройках устройства:
    - do: |
        Использовать интент:
        [collapsed-image](https://jing.yandex-team.ru/files/chernetsov71/qr_new_maps_settings.png){title=QR-код}

        `yandexmaps://add_exp?new_maps_settings`
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> off
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
    - do: Открыть Яндекс Карты
    - do: Перейти в настройки Автомашруты (Меню - Настройки - Навигация)
    - assert: Свитчер "Подсказки в фоновом режиме" неактивен
    - do: Тап по "Подсказки в фоновом режиме"
    - assert: |
        Появилось предупреждение о необходимости включить уведомление в настройках устройства
        В уведомлении есть кнопки "Открыть настройки" и "Позже"
    - do: Тап по "Открыть настройки"
    - assert: Открылись системные настройки Яндекс Карт
    - do: Тап по "Уведомления"
    - do: Включить "Подсказки в фоновом режиме"
    - do: Перейти в Яндекс Карты
    - assert: Свитчер "Подсказки в фоновом режиме" активен

    - tags:
        - new_settings


  Фоновое ведение. Отказ в выдаче доступа к уведомлениям:
    - info: Выключен эксперимент "new_maps_settings" (Меню -> Настройки -> Debug-Panel -> Experiments)
    - do: |
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Подсказки в фоновом режиме -> off
        Системные настройки телефона -> Приложения -> Яндекс.карты -> Уведомления -> Фоновое ведение -> on
    - do: Открыть Яндекс Карты
    - do: Перейти в настройки Фоновое ведение (Меню - Настройки - Маршруты - Фоновое ведение)
    - assert: Свитчер "Подсказки в фоновом режиме" неактивен
    - do: Тап по "Подсказки в фоновом режиме"
    - assert: |
        Появилось предупреждение о необходимости включить уведомление в настройках устройства
        В уведомлении есть кнопки "Открыть настройки" и "Позже"
    - do: Тап по "Позже"
    - assert: |
        Уведомление скрылось
        Свитчер "Подсказки в фоновом режиме" неактивен

    - testing:
        - acceptance_maps
