testing:
  - regress
components: brand_point
tags:
  - advertisement

specs:
  Отображение брендированных пинов при поиске по запросу пользователя во время проведения рекламной акции:
    - info: Открыть главный экран приложения
    - do: Тап по табу "Поиск"
    - assert: Открылся экран поиска
    - do: Выбрать категорию, в результатах которой должны отображаться брендированные пины (например Кинотеатры во время проведения рекламы фильма или магазины одежды во время распродаж)
    - assert: |
        Внизу экрана отображается список поисковой выдачи
        На карте отображается поисковая выдача по запросу
        Среди пинов на карте отображаются брендированные пины по текущей рекламе
    - do:
        Тап в строку поиска
    - assert: |
        На экране отображается список совпадений с запросом
        В нижней части экрана отображается клавиатура
    - do: Удалить запрос
    - assert: |
        На экране отображаются категории поиска
        В нижней части экрана отображается клавиатура
        Курсор остается в строке поиска
    - do: Ввести запрос, в результатах которой должны отображаться брендированные пины (например Кафе во время проведения рекламы Макдоландс)
    - do: Тап "Найти"
    - assert: |
        Внизу экрана отображается список поисковой выдачи
        На карте отображается поисковая выдача по запросу
        Среди пинов на карте отображаются брендированные пины по текущей рекламе

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Отображение брендированных пинов при ведении по маршруту:
    - info: |
        Пины появляются по мере приближения к ним
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается рекламный пин организации
        У пина отображается лейбл
    - do: Тап на рекламный пин
    - assert: |
        Слежение за меткой местоположения прекратилось
        Отобразилась миникарточка организации
        В миникарточке отображается рекламная строка и СТА-кнопка
    - do: Закрыть миникарточку организации
    - assert: |
        Мини карточка организации закрыта
        Рекламный пин отображается
        Через несколько секунд приложение вернется в режим по направлению движения
    - do: Тап на крестик в плашке маршрута
    - assert: Появляется поп-ап подтверждения завершения маршрута с кнопками "Да, завершить" и "Отмена"(iOS)
    - do: Тап на "Да, завершить"
    - assert: |
        Маршрут закрыт
        Ведение по маршруту завершено
        Рекламный пин перестал отображаться

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отображение брендированных пинов в результатах поисковой выдачи:
    - info: Открыть главный экран приложения
    - do: Тап на таб Поиск
    - assert: Открылся экран поиска
    - do: Тап по рекламной категории
    - assert: |
        Отображается экран поисковой выдачи
        На карте отображаются пины поисковой выдачи
        Все пины организаций брендированные
        Сторонних пинов в поисковой выдаче нет
        В сниппетах поисковой выдачи отсутствует иконка геопродукта
    - do: Тап по карточке организации с рекламой в списке поисковой выдачи
    - assert: |
        Отображается полная карточка организации
        В карточке организации отображается строка с рекламой
        Вместо строки с рекламой может отображаться баннер
        На карте отображается активный пин организации
        В карточке организации отсутствует иконка геопродукта
    - do: Тап Назад или крестик в карточке организации
    - assert: |
        Отображается экран поисковой выдачи
        Отображается список организаций в нижней части экрана
    - do: Свайп вниз по списку поисковой выдачи
    - assert: |
        Список организаций свернулся
        Отображается поисковая строка с поисковым запросом
    - do: Тап по брендированному пину
    - assert: |
        Пин меняет состояние на открытый
        Отображается мини карточка организации
        В карточке организации отображается строка с рекламой
        Реклама может отображается в виде текста или баннера
        В карточке организации отсутствует иконка геопродукта

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отображение брендированных пинов в результатах поисковой выдачи при ведении по маршруту:
    - info: |
        Отображается главный экран приложения
    - do: Вклюить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: Открыт экран ведения по маршруту
    - do: Открыть поиск
    - do: Тап по категории Где поесть
    - assert: |
        Маршрут отображается в режиме обзора
        Вдоль маршрута отображаются результаты поисковой выдачи
        Среди данных результатов отображаются рекламные пины организаций
    - do: Тап по рекламному пину
    - assert: |
        Пин становится выделенным
        Отображается миникарточка организации
        В карточке организации отображается рекламная строка
        В рекламной строке отображается текст рекламы или рекламный баннер

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отображение рекламного баннера в карточке организации (для iPad):
    - info: |
        Открыт главный экран приложения
        Открыт спан Москвы
        Девайс расположен в вертикальной ориентации
    - do: Тап на таб Поиск
    - assert: Открылся экран поиска
    - do: Тап по рекламной категории
    - assert: |
        Отображается экран поисковой выдачи
        На карте отображаются пины поисковой выдачи
        Рекламный баннер не отображается в списке организаций
    - do: Тап по пину организации, у которой должен отобразиться рекламный баннер
    - assert: |
        В рекламной строке отображается баннер
        Баннер имеет соотношение сторон 3х1
        Используется один баннер на всю сеть организации
        В карточке организации отсутствует иконка геопродукта
    - do: Изменить ориентацию девайса на горизонтальную
    - assert: |
        Cоотношение сторон блока рекламы в карточке не изменилось, отобразится рекламный баннер

    - testing:
        - acceptance_maps
    - platforms:
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отображение брендированных пинов при поиске одной организации:
    - info: На экране город Воронеж
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Произвести поиск по запросу Тануки
    - assert: |
        Отображается миникарточка организации
        В центре экрана брендированный пин с картинкой
        В миникарточке может отображаться акция
    - do: Тап по кнопке Закрыть
    - assert: Отображается экран поиска

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready


  Проверка отсутствия геопродукта в организациях из рекламной категории при поиске через рекламную категорию:
    - info:
        Открыт спан города Москва
    - do: Тап по табу "Поиск"
    - assert: Открылся экран поиска
    - do: Тап по рекламной категории
    - assert: |
        Отображается экран результат поиска по запросу выбранной рекламной категории
        В поисковой выдаче отображаются сниппеты с организациями выбранной рекламной категории
        В сниппетах поисковой выдачи отсутствует значок геопродукта
    - do: Открыть произвольную организацию из поисковой выдачи
    - assert: |
        Открывается карточка организации
        В карточке организации отсутствуют признаки геопродукта

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отображение рекламного баннера в карточке организации:
    - info: |
        Открыт главный экран приложения
        Открыт спан Москвы
        Девайс расположен в вертикальной ориентации
    - do: Тап на таб Поиск
    - assert: Открылся экран поиска
    - do: Тап по рекламной категории
    - assert: |
        Отображается экран поисковой выдачи
        На карте отображаются пины поисковой выдачи
        Рекламный баннер не отображается в списке организаций
    - do: Тап по пину организации, у которой должен отобразиться рекламный баннер
    - assert: |
        В рекламной строке отображается баннер
        Баннер имеет соотношение сторон 3х1
        Используется один баннер на всю сеть организации
        В карточке организации отсутствует иконка геопродукта
        В блоке рекламы отобразится рекламный текст
    - do: Изменить ориентацию девайса на горизонтальную
    - assert: |
        Карточка отображается в горизонтальной ориентации

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Отсутствие брендированных пинов в обзоре маршрута:
    - info: |
        Отображается главный экран приложения
    - do: (iOS) Выключен эксперимент `no_toolbar_in_guidance` (Debug Panel > Experiments > no_toolbar_in_guidance)
    - do: |
        Включить симуляцию ведения `Demo movement`
        (Меню > Настройки > Debug Panel > Routes)
    - do: Вернуться на главный экран приложения
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - do: Дождаться появления брендированного пина
    - do: Тап на экран
    - do: Тап на кнопку обзора маршрута в тулбаре (кнопка с двумя стрелочками)
    - assert: |
        Отображается экран обзора маршрута
        Брендированные пины не отображаются
    - do: Медленно увеличивать зум
    - do: Менять спан на разные участки вдоль линии маршрута
    - assert: |
        На карте отсутствуют брендированные пины
    - do: Тап на "Продолжить маршрут"
    - assert: |
        Ведение по маршруту продолжается

    - testing:
        - acceptance_maps
    - platforms:
        - android
        - ios
    - tags:
        - assessors
        - parity
        - newbie
        - refactor_ready


  Отображение брендированных пинов вдоль маршрута в поиске:
    - info: |
        Отображается главный экран приложения
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап на Поехали
    - do: Дождаться появления брендированного пина
    - do: Тап на кнопку "Поиск"
    - assert: |
        Отображается экран поиска
    - do: Выбрать категорию появившегося брендированного пина
    - assert: |
        Автоматически появившийся брендированный пин заменился на пин геопродукта
    - do: Закрыть режим поиска тапом на крестик
    - assert: |
        Пин геопродукта снова отображается как брендированный пин

    - testing:
        - acceptance_maps
    - platforms:
        - android
        - ios
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Смена ориентации при поиске по брендированной категории:
    - info: |
        Открыт главный экран приложения
        Девайс в вертикальной ориентации
    - do: Тап на таб Поиск
    - assert: |
        Открыт экран поиска
    - do: Произвести поиск по брендированной категории
    - assert: |
        Открыт экран результатов поиска по брендированной категории
    - do: Сменить ориентацию устройства
    - assert: |
        Девайс в горизонтальной ориентации
        Открыт экран результатов поиска по брендированной категории

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Подгрузка результатов поиска по брендированной категории:
    - info: Открыт экран результатов поиска по брендированной категории
    - do: Изменить спан карты
    - assert: |
        Открыт экран результатов поиска по брендированной категории
        Подгрузились новые поисковые результаты

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Смена ориентации при подмешивании рекламных пинов вдоль маршрута:
    - info: |
        Девайс в вертикальной ориентации
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап на Поехали
    - do: Сменить ориентацию устройства
    - assert: |
        Идет ведение
        Девайс в горизонтальной оринтации
        Вдоль маршрута отображается рекламный пин Макдональдс/Бургер Кинг

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Открытие карточки при подмешивании рекламных пинов вдоль маршрута:
    - info: |
        Открыт главный экран приложения
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап на Поехали
    - do: Тап на появившийся подмешанный пин
    - assert: Открыта карточка соответствующего объекта

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Восстановление состояния при подмешивании рекламных пинов вдоль маршрута:
    - info: |
        Открыт главный экран приложения
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап на Поехали
    - do: Свернуть / развернуть приложение
    - assert: |
        Идет ведение
        Вдоль маршрута отображается рекламный пин Макдональдс/Бургер Кинг

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Отображение брендированных пинов при ведении по пешеходному маршруту:
    - info: |
        Открыт главный экран приложения
    - do: Включить симуляцию ведения Debug-panel > Routes > Demo movement
    - do: |
        Построить пеший маршрут вдоль брендированных пинов воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап по Начать
    - assert: |
        Приложение переходит в режим ведения по пешеходному маршруту
        Вдоль линии маршрута отображается рекламный пин организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps


  Отображение брендированных пинов во фридрайве:
    - info: |
        Пины появляются по мере приближения к ним
    - do: |
        Включить эксперимент ad_pins_in_freedrive_enabled, использовав интент:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/ad_pins_in_freedrive_enabled.622c953.png){title=QR-код}

        `yandexmaps://add_exp?ad_pins_in_freedrive_enabled`
    - do: Перезапустить приложение
    - do: |
        Включить симуляцию движения:
          (Android) через приложение Mock Locations
          (iOS) Debug Panel -> Routes -> Enter your route    
    - do: Открыть главный экран приложения
    - do: Тап на таб Навигатор
    - assert: |
        Приложение переходит в режим фридрайва
        Вдоль линии маршрута отображается рекламный пин организации
        У пина отображается лейбл
    - do: Тап на рекламный пин
    - assert: |
        Слежение за меткой местоположения прекратилось
        Отобразилась миникарточка организации
        В миникарточке отображается рекламная строка и СТА-кнопка
    - do: Закрыть миникарточку организации
    - assert: |
        Мини карточка организации закрыта
        Рекламный пин отображается
        Через несколько секунд происходит возврат к метке курсора

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready

  Брендированные пины не отображаются во фридрайве при выключенном эксперименте:
    - info: |
        Выключен эксперимент ad_pins_in_freedrive_enabled
        Открыт главный экран приложения
    - do: |
        Для Android Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/alina-butba/exp-11.png){title=QR-код}

        `yandexmaps://add_exp?service_navi`
    - do: |
        Запустить симуляцию движения (например, от станции метро Смоленская до Октябрьской в Москве)
        iOS - Настройки -> Debug-Panel -> Routes -> Enter your route
        Android - через приложение MockLocation
    - do: Тап на таб Навигатор
    - assert: |
        Запущен freedrive
        Открыта карта с движущимся курсором ММП
        По предполагаемому маршруту рекламный пин Бургер Кинг около станции метро Парк Культуры не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Брендированные пины при ведении по маршруту с включенным эксперементом новой рекламы (логирование показа):
    - info: |
        - Пины появляются по мере приближения к ним
        - Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: |
        Включить эксперимент navi_feature_use_navikit_billboard_logger, использовав интент
        [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/%D0%BF%D1%80%D0%B8%D1%80%D0%BE.eef144c.png){title=QR-код}

        `yandexmaps://add_exp?navi_feature_use_navikit_billboard_logger`
    - do: Перезапустить приложение
    - do: Включить симуляцию движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить автомобильный маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается рекламный пин
        В логи приходит событие: "geoadv.bb.pin.show"

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Брендированные пины при ведении по маршруту с включенным эксперементом новой рекламы (показ):
    - info: |
        - Пины появляются по мере приближения к ним
    - do: |
        Включить эксперимент navi_feature_use_navikit_billboard_logger, использовав интент
        [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/%D0%BF%D1%80%D0%B8%D1%80%D0%BE.eef144c.png){title=QR-код}

        `yandexmaps://add_exp?navi_feature_use_navikit_billboard_logger`
    - do: Перезапустить приложение
    - do: Включить симуляцию движения (Debug-panel > Routes > Demo movement)
    - do: |
        Построить автомобильный маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=QR-код}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается рекламный пин

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Показ брендированных пинов на новом рекламном слое:
    - do: Включить симуляцию движения (Debug-panel > Routes > Demo movement)
    - do: |
        Включить эксперимент воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(14).09c82cc.png){title=Скриншот}
        
        `yandexmaps://add_exp?kmm_advert_layer=enabled`
    - do: Перезапустить приложение 
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=Скриншот}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается рекламный пин организации
        У пина отображается лейбл

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Логирование показа брендированных пинов на новом рекламном слое:
    - info: |
        Девайс подключен к инструментам снятия логов или открыта Log-view панель
    - do: Включить симуляция движения (Debug-panel > Routes > Demo movement)
    - do: |
        Включить эксперимент воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/shindzhev/download%20(14).09c82cc.png){title=Скриншот}
        
        `yandexmaps://add_exp?kmm_advert_layer=enabled` 
    - do: Перезапустить приложение 
    - do: |
        Построить маршрут воспользовавшись интентом:
        [collapsed-image](https://jing.yandex-team.ru/files/normalman/Маршрут%20с%20пинам%20БК.f52fecb.png){title=Скриншот}

        `yandexmaps://maps.yandex.ru/?rt=37.588003,54.154344~37.597117,54.174461`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается рекламный пин организации
        В логи приходит событие: "geoadv.bb.pin.show" 

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors
        

  Лейбл брендированного пина не перекрывает курсор в ведении по маршруту:
    - info: |
        Девайс находится в вертикальной ориентации 
    - do: Включить симуляцию движения (Меню -> Настройки -> Debug Panel -> Routes -> Demo Movement)
    - do: Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/vladover/Снимок%20экрана%202022-07-14%20в%2013.34.55.png){title=QR-код}

        `https://yandex.ru/maps?rtext=51.517073%2C46.009795~51.515809%2C46.00191&rtt=auto`
    - do: Тап Поехали
    - assert: |
        Приложение переходит в режим ведения по маршруту
        Вдоль линии маршрута отображается брендированный пин
    - do: Выставить 16-й зум
    - assert: |
        При прохождении маршрута лейбл брендированного пина не перекрывает курсор
    - do: Сменить ориентацию девайса на горизональную
    - assert: |
        При прохождении маршрута лейбл брендированного пина не перекрывает курсор
    - do: Тап на брендированный пин
    - assert: |
        Брендированый пин сменился на поднятый
        При прохождении маршрута лейбл поднятого брендированного пина не перекрывает курсор    

    - testing:
        - acceptance_maps
    - platforms:
        - ios
        - android
    - tags:
        - assessors