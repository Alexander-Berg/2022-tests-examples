components: stories
tags:
    - assessors
testing:
  - regress

specs:

  Отображение stories:
    - do: Тап по табу "Поиск"
    - assert: |
        Отображается раскрытая шторка
        Вверху шторки отображается поисковая строка со спичкитом и кнопкой закрытия
        Ниже отображаются поисковые категории
        Рекламные категории отображаются после поисковых категорий
        (IOS) Ниже, под заголовком "Истории и подборки мест", отображаются  сторис и подборки мест
        (Android) Ниже, под заголовком "Истории" отображаются сторис, а под заголовком "Подборки мест" - подборки
        Подборки и сторис обновляются в соответствии с городом
    - do: Тап на сторис
    - assert: |
        Отображается спиннер загрузки
        После загрузки отображается сторис (картинка с анимацией, видеоролик, текст с описанием)
    - do: Тап по правой части экрана
    - assert: |
        Произошло переключение на следующую страницу сторис
        Наверху экрана индикатор проигрывания и кнопка закрытия
        Внизу экрана может присутствовать кнопка для перехода в подборку, в карточку организации или на сайт
        Сторис не обрезаются по бокам и краям, выглядят примерно одинаково на любых устройствах
    - do: Тап по левой части экрана
    - assert: |
        Отображается спиннер загрузки
        Произошло переключение на предыдущую страницу сторис
    - do: Тап на кнопку закрытия
    - assert: Отображается раскрытая шторка, не переоткрывается и не мигает
    - do: |
        Android: пролистать карусель сторис влево до конца
    - assert: В конце карусели отображаются, просмотренные ранее, сторис
    - do: Тап на сторис из ранее просмотренных
    - assert: |
        Отображается спиннер загрузки
        Воспроизводится сторис, ранее просмотренное
    - do: Свайп влево
    - assert: |
        Отображается спиннер загрузки
        Произошло переключение на следующую сторис
    - do: Свайп вправо
    - assert: |
        Отображается спиннер загрузки
        Произошло переключение на предыдущую сторис
    - do: Сменить ориентацию устройства на горизонтальную
    - assert: Экран истории отображается  вертикально

    - testing:
       - acceptance_maps
       - lite_acceptance_maps
    - platforms:
       - ios
       - android
    - tags:
        - newbie


  Открытие подборки из stories:
    - do: Устройство в вертикальной ориентации
    - do: Тап на таб Поиск в таббаре внизу экрана
    - do: Пролистать до блока со сторис
    - do: Тап на сторис, ведущую на подборку
    - assert: Открывается экран со сторис. При загрузки крутится спиннер. Если в сторис присутствует ссылка, под картинкой отображается кнопка с текстом
    - do: Свайп вверх или тап на кнопку подборки
    - assert: Сторис анимированно скрывается. Открывается подборка, связанная со сторис. Если сторис был со звуком, при переходе по ссылке звук останавливается
    - do: Закрыть подборку тапом на крестик
    - assert: Подборка закрывается. Анимировано открывается сторис. Воспроизведение продолжается с того места, где был осуществлен переход по ссылке
    - do: Перевести устройство в горизонтальную ориентацию
    - assert: Сторис отображается в вертикальной ориентации
    - do: Свайп вверх или тап на кнопку подборки
    - assert: Сторис анимированно скрывается. Открывается подборка, связанная со сторис. Если сторис был со звуком, при переходе по ссылке звук останавливается
    - do: Закрыть подборку тапом на крестик
    - assert: CustomTub закрывается. Анимировано открывается сторис в вертикальной ориентации. Воспроизведение продолжается с того места, где был осуществлен переход по ссылке
    - testing:
       - acceptance_maps
    - platforms:
       - ios
       - android


  Открытие сторонней ссылки из stories:
    - info: |
        Пример орги https://yandex.ru/maps/org/vesyoly_podarok/168825764315
        Необходимо открывать организацию со сторис, а не сторис в меню
    - do: Тап на сторис, ведущую на сторонний сайт
    - assert: |
        Воспроизводится сторис
        Присутствует кнопка, ведущая на сторонний сайт
    - do: Свайп вверх или тап на кнопку перехода по ссылке
    - assert: Сторис анимированно скрывается. Открывается сайт в кастом табе. Если сторис была со звуком, при переходе по ссылке звук останавливается
    - do: Тап на Закрыть
    - assert: Сайт закрывается. Анимировано открывается сторис. Воспроизведение продолжается с того места, где был осуществлен переход по ссылке
    - do: Перевести устройство в горизонтальную ориентацию
    - assert: Сторис отображается в вертикальной ориентации
    - do: Тап на кнопку перехода по ссылке
    - assert: Сторис анимированно скрывается. Открывается сайт в кастом табе. Если сторис была со звуком, при переходе по ссылке звук останавливается. Сайт отображается в горизонтальной ориентации
    - do: Тап на Закрыть
    - assert: Сайт закрывается. Анимировано открывается сторис. Воспроизведение продолжается с того места, где был осуществлен переход по ссылке. Сторис отображается в вертикальной ориентации

    - testing:
       - acceptance_maps
    - platforms:
       - ios
       - android


  Открытие карточки организации из stories:
    - info: |
        Устройство в вертикальной ориентации
        Отображается главный экран приложения на спане Санкт-Петербурга
    - do: Тап на таб Поиск
    - assert: |
        Отображается полная шторка поиска
        Присутствует блок со сторис (например, "Пригороды Петербурга")
    - do: Тап на сторис про организации
    - assert: |
        Открывается экран со сторис
        В момент загрузки крутится спиннер
        Внизу под картинкой отображается кнопка перехода по ссылке
    - do: Свайп вверх или тап на кнопку перехода по ссылке
    - assert: |
        Сторис анимированно скрывается
        Открывается карточка организации из сторис
    - do: Тап на крестик
    - assert: |
        Карточка закрывается
        Анимировано открывается сторис
        Воспроизведение продолжается с того места, где был осуществлен переход по ссылке
        Сторис проигрывается в вертикальной ориентации

    - testing:
       - acceptance_maps
    - platforms:
       - ios
       - android


  Открытие stories:
    - info: |
        Открыт главный экран
    - do: Тап на таб 'Поиск'
    - assert: |
        Открыт экран поиска
        Присутствует карусель со stories
    - do: Тап на одну из stories
    - assert: |
        Открыта stories
        Воспроизводится элемент stories

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  Отсутствие перемещения просмотренных stories в конец списка:
    - do: Тап на непросмотренную сторис
    - assert: Отображается спиннер загрузки. После загрузки отображается сторис
    - do: Просмотреть все элементы сторис
    - assert: При переходе на следующую страницу сторис, предыдущий элемент отмечается как просмотренный. После просмотра последней страницы сторис происходит переключение на следующий сторис
    - do: Тап на крестик
    - assert: Шторка отображается сразу, не переоткрывается и не мигает. Под кнопками дом/работа отображаются сторис
    - do: Свернуть штору
    - assert: Отображается главный экран с картой
    - do: Тап по табу "Поиск"
    - assert: |
        Отображается полная шторка
        Вверху шторки отображается поисковая строка со спичкитом и кнопкой закрытия
        Ниже отображаются поисковые категории
        Рекламные категории отображаются самыми последними
        (IOS) Ниже, под заголовком 'Актуальное', отображаются сторис и подборки
        (Android) Ниже, под заголовком 'Актуальное' отображаются сторис, а под заголовком 'Новые истории и подборки' - подборки
        Подборки и сторис обновляются в соответствии с городом
        У сторис присутствует - Картинка с текстом. - Обводка синего цвета (у каждого непросмотренного сторис). - Просмотренная сторис отображается без синей рамки в том же месте, где была до начала просмотра

    - platforms:
         - ios


  Просмотр stories в офлайне при подключении интернета:
    - info: |
        Приложение запущено
        Включен авиа-режим
    - do: Тап по табу "Поиск"
    - assert: |
        Отображается полная шторка
        Вверху шторки отображается поисковая строка со спичкитом и кнопкой закрытия
        Ниже отображаются поисковые категории
        Рекламные категории отображаются самыми последними
        (IOS) Ниже, под заголовком 'Истории и подборки мест', отображаются сторис и подборки
        (Android) Ниже, под заголовком 'Истории' отображаются сторис, а под заголовком 'Новые истории и подборки' - подборки
        Подборки и сторис обновляются в соответствии с городом
    - do: Тап на блок со сторис
    - assert: |
        Открывается сторис
        В центре экрана надпись Не удалось загрузить.
        Проверьте соединение с интернетом и попробуйте ещё раз
        Ниже кнопка Повторить.
        В правом верхнем углу кнопка закрытия.
        Вверху отображается статус элементов сторис (просмотренные и не просмотренные)
    - do: Тап на кнопку Повторить
    - assert: |
        На короткое время отображается индикатор загрузки.
        В центре экрана надпись Не удалось загрузить.
        Проверьте соединение с интернетом и попробуйте ещё раз
    - assert: Ниже кнопка Повторить. Статус элемента сторис на просмотрено не изменился
    - do: Отключить авиа-режим
    - assert: |
        В центре экрана надпись об отсутствии интернет-соединения.
        Ниже кнопка Повторить.
        Статус элемента сторис на просмотрено не изменился
    - do: Тап на кнопку Повторить
    - assert: |
        На короткое время отображается индикатор загрузки.
        После загрузки воспроизводится сторис.
        Статус элемента просматриваемого сторис изменяется.
        После окончания сторис открывается следующая страница сторис (если страница была последней, происходит переход к новому блоку со сторис)
    - do: Тап по правому краю экрана
    - assert: |
        На короткое время отображается индикатор загрузки.
        После загрузки воспроизводится сторис.
        Статус элемента просматриваемого сторис изменяется.
        После окончания сторис открывается следующая страница сторис (если страница была последней, происходит переход к новому блоку со сторис)
    - do: Свайп по экрану влево
    - assert: |
        На короткое время отображается индикатор загрузки
        Воспроизводится предыдущий блок со сторис
        После загрузки воспроизводится элемент следующей страницы сторис
        Статус элемента просматриваемой сторис изменяется* После окончания сторис открывается следующая страница сторис (если страница была последней, происходит переход к новому блоку со сторис)

    - testing:
       - acceptance_maps
       - lite_acceptance_maps
    - platforms:
       - ios
       - android
    - tags:
        - newbie


  Кеширование stories в памяти:
    - info: |
        Есть доступ в интернету
    - do: Тап на таб "Поиск"
    - assert: |
        Отображается полная шторка
        Вверху шторки отображается поисковая строка со спичкитом и кнопкой закрытия
        Ниже отображаются поисковые категории
        Рекламные категории отображаются самыми последними
        Ниже отображаются истории и подборки мест
        Подборки и сторис обновляются в соответствии с городом
    - do: Открыть любую многостраничную сторис
    - assert: Отображается спиннер загрузки. После загрузки отображается сторис в которой присутствует - Картинка с анимацией или видеоролик (может быть просто картика). Текст с описанием. Вверху индикатор проигрывания и кнопка закрытия. Внизу кнопка для перехода в подборку, в карточку организации или на сайт
    - do: Закрыть сторис не досмотрев до конца элемент сторис
    - assert: Шторка отображается полностью, не переоткрывается и не мигает
    - assert: У сторис присутствует - Картинка с текстом. - Обводка синего цвета (у каждого непросмотренного сторис). - В ночном режиме обводка непросмотренного сторис отображается светло-серого цвета
    - do: Отключить доступ в интернет
    - assert: Шторка отображается полностью, не переоткрывается и не мигает
    - assert: У сторис присутствует - Картинка с текстом. - Обводка синего цвета (у каждого непросмотренного сторис). - В ночном режиме обводка непросмотренного сторис отображается светло-серого цвета
    - do: Открыть сторис из ранее просмотренных
    - assert: Отображается следующий элемент сторис. Отображается спиннер загрузки. После загрузки отображается сторис в которой присутствует- Картинка с анимацией или видеоролик. Текст с описанием. Вверху индикатор проигрывания и кнопка закрытия - Внизу кнопка для перехода в подборку, в карточку организации или на сайт
    - do: Перейти к следующему элементу сторис тапом по правой части экрана
    - assert: В центре экрана надпись о проблемах с соединением. Ниже кнопка Повторить. В правом верхнем угла кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные)
    - do: Перейти к следующей сторис свайпом влево
    - assert: В центре экрана надпись о проблемах с соединением. Ниже кнопка Повторить. В правом верхнем угла кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные)

    - testing:
       - acceptance_maps
    - platforms:
       - ios
       - android


  Показ алерта с просьбой оценить приложение после закрытия подборки/stories:
    - do: Включены эксперименты для рейтинговалки [(по ссылке yandexmaps://add_exp?rate_user_lucky=on) и сторис (тычка в дебаг-панели))]. Прошло 3 дня с момента установки версии. Выполнены 9 действий из списка в инструкции (блок про рейтинговалку)
    - do: Свайп вверх по шторке
    - assert: Штора разворачивается на весь экран. В шторе присутствуют сторис и различные подборки
    - do: Тап по любой сторис/подборке
    - assert: Открывается сторис/подборка
    - do: Закрыть сторис/подборку тапом по крестику
    - assert: Сторис/подборка закрывается. Открывается штора. Появляется попап Оцените Яндекс.Карты со звёздами
    - do: Тап Не сейчас
    - assert: Попап закрывается. Открыта штора. Проскролл шторы сохранён

    - platforms:
        - android



  Просмотр статус-бара в stories:
    - do: Открыть таб "Поиск"
    - assert: В табе есть блок со сторис
    - do: Тап по любой сторис
    - assert: Открывается сторис. Статус бар в сторис в тёмном режиме, полупрозрачный. Статус бар не перекрывает элементы интерфейсa

    - platforms:
        - android

  Отображение кнопок в stories:
    - do: Авторизоваться
    - do: Тап по табу "Поиск"
    - assert: Отображается блок со сториз
    - do: Тап на сториз
    - assert: Отображается сториз. Внизу кнопка перехода на сайт (может не быть в некоторых сторис)
    - do: Тап на кнопку перехода на сайт
    - assert: Сайт открывается в CustomTub
    - do: Вернуться в сториз
    - assert: Отображается сториз. Внизу кнопка перехода на сайт
    - do: Изменить ориентацию на горизонтальную
    - assert: Ориентация не меняется. Сториз отображаются только в вертикальной ориентации

    - platforms:
       - ios
    - testing:
       - acceptance_maps
       - lite_acceptance_maps
    - tags:
        - newbie


  Отображение ошибки при просмотре stories в оффлайн режиме:
    - info: |
        Передача данных по сети интернет отключена
    - do: Тап по табу "Поиск"
    - assert: Раскрылась штора с отображаемым содержимым
    - do: Тап на блок со сторис
    - assert: Открывается сторис - В центре экрана уведомление об ошибке
    - assert: Ниже кнопка Повторить. В правом верхнем углу кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные)
    - do: Тап на кнопку Повторить
    - assert: В центре экрана уведомление об ошибке. Ниже кнопка Повторить. Статус элемента сторис на просмотрено не изменился
    - do: Закрыть сторис тапом по крестику или свайпом вниз
    - assert: Штора отображается на экране, не переоткрывается. Первая строка - Москва и температура. Вторая строка - Сторис (предзагружена картинка и описание, непросмотренные истории выделены обводкой). Третья строка - Подборка интересных мест
    - do: Открыть сторис вновь
    - assert: В центре экрана уведомление об ошибке. Ниже кнопка Повторить.
    - asset: В правом верхнем углу кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные). Статус элемента сторис на просмотрено не изменился
    - do: Свайп влево
    - assert: В центре экрана уведомление об ошибке. Ниже кнопка Повторить. В правом верхнем углу кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные). Произошел переход к новой сторис
    - do: Свайп вправо
    - assert: В центре экрана уведомление об ошибке. Ниже кнопка Повторить. В правом верхнем углу кнопка закрытия* Вверху отображается статус элементов сторис (просмотренные и не просмотренные). Произошел переход к предыдущей сторис
    - do: Тап в правой части экрана
    - assert: В центре экрана надпись уведомление об ошибке. Ниже кнопка Повторить. В правом верхнем углу кнопка закрытия- Вверху отображается статус элементов сторис (просмотренные и не просмотренные). Произошел переход к следующей странице сторис
    - do: Тап в левой части экрана
    - assert: В центре экрана уведомление об ошибке. Ниже кнопка Повторить. В правом верхнем углу кнопка закрытия. Вверху отображается статус элементов сторис (просмотренные и не просмотренные). Произошел переход к предыдущей странице сторис

    - platforms:
       - ios
       - android


  Закрытие stories свайпом:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Закрыть stories свайпом сверху-вниз
    - assert: |
        Stories закрыта
        Открыт экран поиска
        Присутствует карусель со stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Закрытие stories через системную кнопку Назад:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Закрыть stories через системную кнопку Назад
    - assert: |
        Stories закрыта
        Открыт экран поиска
        Присутствует карусель со stories

    - tags:
        - assessors
    - platforms:
        - android
    - testing:
        - acceptance_maps


  Закрытие stories через кнопку Закрыть:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Закрыть stories кнопкой Закрыть
    - assert: |
        Stories закрыта
        Открыт экран поиска
        Присутствует карусель со stories

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Просмотр stories со звуком:
    - info: |
        Открыт главный экран
    - do: Тап на таб 'Поиск'
    - assert: |
        Открыт экран поиска
        Присутствует карусель со stories
    - do: Тап на stories со звуком
    - assert: |
        Открыта stories
        Воспроизводится элемент stories
        Воспроизводится звук

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Просмотр stories без звука:
    - info: |
        Открыт главный экран
    - do: Тап на таб 'Поиск'
    - assert: |
        Открыт экран поиска
        Присутствует карусель со stories
    - do: Тап на stories без звука
    - assert: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Просмотреть любой элемент stories
    - assert: |
        Переключение элементов stories после просмотра происходит автоматически

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Переключение элементов stories:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Тап в правой части экрана
    - assert: |
        Происходит переключение к следующим элементам внутри stories
    - do: Тап в левой части экрана
    - assert: |
        Происходит переключение к предыдущим элементам внутри stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Переключение первых элементов stories:
    - info: |
        Открыта не первая в списке stories
        Воспроизводится первый элемент stories
    - do: Тап в левой части экрана
    - assert: |
        Происходит переход к предыдущей stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Переключение последних элементов stories:
    - info: |
        Открыта не последняя в списке stories
        Воспроизводится последний элемент stories
    - do: Тап в правой части экрана
    - assert: |
        Происходит переход к следующей stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Переключение stories свайпом:
    - info: |
        Открыта stories из середины списка
        Воспроизводится элемент stories
    - do: Свайп влево
    - assert: |
        Происходит переход к следующей stories
        Воспроизводится элемент stories
    - do: Свайп вправо
    - assert: |
        Происходит переход к предыдущей stories
        Воспроизводится элемент stories

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Пауза в stories:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Тап на экран с удержанием
    - assert: |
        Воспроизведение приостановлено
        Прогресс-бар элементов не отображается
        Кнопка Закрыть не отображается
        Action-кноки не отображаются

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Кеширование stories:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Включить авиа-режим
    - do: Перейти к следующему не закешированному элементу stories
    - assert: |
        Открыта stories
        Присутствует сообщение об ошибке интернет-соединения
    - do: Перейти к предыдущему элементу stories
    - assert: |
        Открыта stories
        Воспроизводится элемент stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Просмотр stories при восстановлени доступа к интернету:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Включить авиа-режим
    - do: Перейти к следующему не закешированному элементу stories
    - assert: |
        Открыта stories
        Присутствует сообщение об ошибке интернет-соединения
        Присутствует кнопка Повторить
    - do: Выключить авиа-режим
    - assert: |
        Есть доступ в сеть
    - do: Тап на Повторить
    - assert: |
        Открыта stories
        Воспроизводится элемент stories

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Проверка ориентации в stories:
    - info: |
        Открыта stories
        Воспроизводится элемент stories
        Девайс в вертикальной ориентации
    - do: Установить горизонтальную ориентацию девайса
    - assert: |
        Открыта stories
        Воспроизводится элемент stories
        Ориентация в stories всегда вертикальная

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Переход по action-кнопке в stories:
    - info: |
        Открыта stories с action-кнопкой
        Воспроизводится элемент stories
    - do: Тап на action-кнопку
    - assert: |
        Происходит переход по url кнопки
    - do: Вернуться назад
    - assert: |
        Открыта stories
        Воспроизводится элемент stories с которого был совершен переход

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение просмотренной stories:
    - info: |
        Открыт главный экран
        Первый запуск приложения
    - do: Тап на таб 'Поиск'
    - assert: |
        Открыт экран поиска
        Присутствует карусель со stories
    - do: Тап на одну из stories
    - assert: |
        Открыта stories
        Воспроизводится элемент stories
    - do: Просмотреть все элементы stories
    - assert: |
        Все элементы stories просмотрены
    - do: Закрыть stories
    - assert: |
        Stories закрыта
        Открыт экран поиска
        Присутствует карусель со stories
        Stories с просмотренными элементами не выделена рамкой

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
