testing:
  - regress
components: audiosession

specs:
  Голосовое управление — Запрет на доступ к микрофону:
    - info: |
        Отозвать разрешение на использование микрофона
        Developer settings -> Misc -> New Audio focus Api - Off
        Перезапустить приложение
    - do: Произнести на экране карты команду "Слушай, Яндекс/Алиса!" (первый запуск) или "Алиса/Яндекс" (второй и последующие).
    - assert: Приложение не реагирует на обозначенные команды.
    - do: Вызвать голосового помощника вручную (с экрана карт, экрана поиска).
    - assert: Отображается сообщение о необходимости дать доступ к микрофону

    - platforms:
        - ios
        - android


  Фоновое ведение - аудио ведение:
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить..
        - Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Запустить навигатор
        - Построить маршрут с учетом максимального количества маневров и ориетиров, в том числе и фраза прямо N км (фраза прямо не является последней фразой маршрута или хотя бы повторяется несколько раз)
    - assert: |
        - Навигатор запущен
        - Маршрут построен и запущено debug ведение по нему
    - do: Свернуть приложение (не системной кнопкой Назад в Android)
    - assert: |
        - Приложение свернуто
        - Идет фоновое ведение (кроме случая сворачивания приложения по Back для Android).
        - Слышны аннотации маршрута.
    - do: Развернуть приложение.
    - assert: Аннотации не прерываются.

    - platforms:
        - ios
        - android


  Проверка аннотаций и звуков других приложений (активная музыка):
    - description: |
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить..
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС. 
        - Запустить ведение по нему. 
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
    - do: Запустить на устройстве воспроизведение музыки.
    - assert: Музыка воспроизводится, смешиваясь с аннотациями (в зависимости от выбранной настройки **Меню - Настройки - При оповещениях** )
    - do: Поставить музыку на паузу
    - assert: |
        - Музыка на паузе. 
        - Аннотации по-прежнему воспроизводятся
    - do: Запустить музыку прямо во время произнесения аннотации Навигатора
    - assert: Музыка воспроизводится, смешиваясь с аннотациями.  (в зависимости от выбранной настройки **Меню - Настройки - При оповещениях** )
    - do: Поставить музыку на паузу в момент произнесения аннотации 
    - assert: Аннотации не прерываются и не зависят от музыки

    - platforms:
      - ios
      - android


  Проверка аннотаций и звуков других приложений:
    - description: |
        Кейс описывает в первую очередь поведение на iOS, но может быть проверен также на Android.
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Открыть экран карты.
        - Отправить на девайс смс или любое сообщение, которое должно прийти с аудио нотификацией.
    - assert: |
        - ios звук нотификации есть (но может не быть и это ок)
        - android звук нотификации есть
    - do: |
        Перейти в одно из меню:
        - Поиск
        - Мои места
        - Меню
    - assert: |
        Звук нотификации есть (его может не быть, если звук происходит одновременно с произносимой аннотацией)
        `При включенном поиске от МЯК при нахождении на экране поиска  звуковой нотификации НЕ будет`

    - platforms:
        - ios
        - android


  Озвучивание аннотаций при работе с гарнитурой (iOS):
    - info: Подключить БТ-гарнитуру к телефону
#   - *audiosession_settings_presets
    - do: Включить симуляция движения (Меню -> Настройки -> Дебаг-панель -> Routes -> Demo movement)
    - do: Включить воспроизведение аннотаций через БТ-гарнитуру (Меню -> Настройки -> Звуки и оповещения -> Bluetooth -> 'A2DP')
    - do: Вернуться на главный экран
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через БТ-гарнитуру
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Запустить музыку
    - do: Дождаться аннотации
    - assert: Музыка и аннотации звучат через гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors
        - not_suitable_for_farm
        - bt_headset
    - testing:
        - acceptance_maps


  Озвучивание аннотаций через динамик устройства при работе с гарнитурой (iOS):
    - info: Подключить БТ-гарнитуру к телефону
#   - *audiosession_settings_presets
    - do: Включить симуляция движения (Меню -> Настройки -> Дебаг-панель -> Routes -> Demo movement)
    - do: Выключить воспроизведение аннотаций через БТ-гарнитуру (Меню -> Настройки -> Звуки и оповещения -> Bluetooth -> 'По умолчанию')
    - do: Вернуться на главный экран
    - do: |
        Построить маршрут с большим количеством маневром и дорожных событий, например:
        [collapsed-image](https://jing.yandex-team.ru/files/polikashinaol/with_points.png){title=Маршрут}

    - do: Выбрать автомаршрут и тап 'Поехали'
    - assert: |
        Запускается ведение по маршруту
        Все аннотации озвучиваются через динамик устройства
    - do: Свернуть приложение
    - do: Дождаться аннотации
    - assert: Все аннотации озвучиваются через динамик устройства
    - do: Запустить музыку
    - do: Дождаться аннотации
    - assert: Музыка и аннотации смешиваются и звучат через БТ гарнитуру

    - platforms:
        - ios
    - tags:
        - assessors
        - not_suitable_for_farm
        - bt_headset


  Работа с нативным голосовым помощником:
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        Построить маршрут;
        Двигаться по маршруту, слушая голосовые аннотации.
        Вызвать нативный голосовой помощник (Siri или Google) по функциональной клавише.
    - assert: Открывается интерфейс голосового помощника. Навигатор прекращает аннотации.
    - do: Закрыть голосового помощника
    - assert: |
        Навигатор возобновляет аннотации.
        Алису можно вызвать голосом.


    - platforms:
        - ios
        - android
  

  Проверка работы Навигатора при входящих звонках:
    - description: |
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Совершить звонок на тестовый девайс
    - assert: |
        - **Для Android:** Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        - **Для iOS:** Аннотации отсутствуют
    - do: |
        - Завершить вызов.
        - Вызвать Алису голосом
    - assert: |
        - Аннотации возобновляются
        - Алиса вызывается голосом

    - platforms:
        - ios
        - android
       

  Проверка отключения аннотаций во время звонка:
    - description: |
        **на iOS** убрали настройку (Меню -> Настройки -> Звуки и оповещения -> Аннотации во время звонка.), позволяющая переключать воспроизводимость аннотаций во время разговора.
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Перейти в Меню -> Настройки -> Звуки и оповещения
    - assert: В меню должен отсутствовать пункт Аннотации во время звонка
    - do: |
        **Построить маршрут и начать ведение** по маршруту.
        _Удобно установить маршрут с частыми поворотами либо со сходами с маршрута._
    - assert: Маршрут построен, ведение начато, **аннотации озвучиваются.**
    - do: Совершить **входящий звонок** на устройство и принять, **начать разговор.**
    - assert: |
        Во время поступления звонка **аннотаций НЕТ.**
        Во время разговора **аннотаций НЕТ.**
    - do: Завершить звонок.
    - assert: По завершению звонка **Аннотации воспроизводятся с прежней(до совершения звонка) громкостью.**

    - platforms:
        - ios
    

  Голосовое управление — работа с гарнитурой:
    - description: |
        Я.Навигатор на андройде пока не поддерживает запись звука с bluetooth гарнитуры. Воспроизведение звука идет через гарнитуру.
        Я.Навигатор выводит звук через bluetooth гарнитуру только если на устройстве запущена музыка. Для проверки на iOS, перед выполнением тестов, нужно запустить музыку (Например через приложение Я. Музыка).
        Встроенная музыка в навигатор при подключении BT гарнитуры должна иметь тоже поведение, что и с другой
        музыкой
    - info: |
        - Подключить БТ-гарнитуру к телефону.
        - Проверить правильность подключения и работы БТ-гарнитуры. (Включить музыку через приложение Я.Музыка. Позвонить на устройство с подключенной гарнитурой)
        - **Для iOS**: Выставить в настройках "**Звуки и оповещения**" режим подключения **Headset**
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Построить маршрут и запустить ведение по нему.
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Свернуть приложение
    - assert: Все аннотации озвучиваются через БТ-гарнитуру.
    - do: Запустить музыку
    - assert: Музыка и аннотации звучат через гарнитуру.

    - platforms:
        - ios
        - android
    

  Проверка аннотаций и звуков других приложений (приложение свернуто):
    - description: |
        Кейс описывает в первую очередь поведение на iOS, но может быть проверен также на Android.
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
    - do: |
        Свернуть приложение.
        Отправить на девайс смс или любое сообщение, которое должно прийти с аудио нотификацией.
    - assert: Звук нотификации есть (его может не быть, если звук происходит одновременно с произносимой аннотацией)

    - platforms:
        - ios
        - android
    

  Проверка аннотаций и звуков других приложений (Алиса):
    - description: |
        Для iOS отключены звуки других приложений (смс, звуковые нотификации), пока мы находимся на экране карты
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
    - do: |
        - Запустить на девайсе воспроизведение музыки.
        - Вызвать Алису
    - assert: |
        - Алиса не слышит при воспроизведении музыки из стороннего приложения  (Спотифай, ЯМузыка, ютюб музыка). После вызова по кнопке Алисы сторонняя музыка не возобновляется
    - do: |
        - Вызвать Алису по кнопке
    - assert: |
        - Алиса вызывается и слышит команды


    - platforms:
        - ios
        - android
    

  Проверка аннотаций и звуков других приложений (Звонок):
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Запустить на девайсе воспроизведение музыки. (в стороннем приложении, например, Спотифай, ЯМузыка, ютюб музыка)
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Открыть приложение на экране карты
    - do: |
        - Позвонить и принять звонок
    - assert: |
        - Звук звонка слышен.
        - Звонок принимается
        - Воспроизведение аннотаций во время разговора происходит через динамик устройства на Android 4-7, на Android 8+ и iOS аннотации во время разговора не воспроизводятся.
    - do: |
        - Завершить разговор, спустя 1-2 мин
    - assert: |
        - Воспроизведение аннотаций возобновляется после завершения разговора.
        - Воспроизведение музыки из стороннего приложения возобновляется


    - platforms:
        - ios
        - android
   

  Проверка работы Навигатора при входящих звонках (навигатор в фоне):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо выключить developer settings -> Misc -> New Audio focus Api -> Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с включенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Свернуть навигатор во время ведения по маршруту
        - Совершить звонок на тестируемое устройство
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют

    - platforms:
        - ios
        - android


  Проверка работы Навигатора при входящих звонках (прерывание аннотации):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Совершить звонок на тестируемое устройство во время произнесения аннотации
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют

    - platforms:
        - ios
        - android
    

  Проверка работы Навигатора при входящих звонках (прерывание Алисы):
    - description: |
        На iOS Аннотации во время звонка **были удалены**
        Теперь по дефолту аннотаций во время звонка на iOS быть не должно. На Android пока подходит любое поведение аннотаций во время звонка. (актуально с 10.12.19)
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api -> On и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить симуляцию движения
        - Вызвать Алису.
        - Позвонить на тестовый девайс во время разговора с Алисой.
    - assert: |
        **Для Android:**
        - Аннотации могут произносится в динамик. Если аннотаций нет - пока багом это не считаем.
        **Для iOS:**
        - Аннотации отсутствуют
    - do: |
        - Завершить разговор
        - Вызвать Алису голосом
    - assert: По завершении разговора все аннотации возобновляются; Алису можно вызвать голосом.

    - platforms:
        - ios
        - android


  Работа аудио с reset media services:
    - description: проверка, что аннотации не умирают при ресете аудио в ios
    - info: Важно убедиться, что все настройки аудио стоит по умолчанию в приложении.
    - do: |
        - построить любой маршрут
        - запустить ведение по нему через дебаг панель
        - свернуть навигатор
    - assert: |
        - маршрут построился
        - началось ведение по нему
        - навигатор свернут и звучат аннотации
    - do: |
        - открыть системные ios настройки
        - перейти в Developer
        - тап "reset media services"
        - вернуться в навигатор и услышать, что аннотация работает
    - assert: |
        - развернув навигатор слышно все аннотации в приложении

    - platforms:
        - ios
    

  Фоновое ведение - аудио ведение с BT гарнитурой:
    - info: |
        - Developer settings -> Misc -> New Audio focus Api Off
        - Перезапустить приложение
        - Установлена _debug версия
    - do: |
        - Запустить навигатор
        - Построить маршрут с учетом максимального количества маневров и ДС
        - Свернуть навигатор
    - assert: |
        - Навигатор запущен
        - Маршрут построен
    - do: |
        - Подключить BT-гарнитуру к девайсу
        - Запустить воспроизведение музыки в навигаторе
    - assert: Музыка воспроизводит вместе с голосовыми аннотациями через гарнитуру
    - do: |
        - Получить звонок и принять его
        - Завершить звонок
    - assert: После ответа на звонок и завершения вызова воспроизведение музыки и голосовых аннотаций продолжается через BT-гарнитуру

    - platforms:
      - ios
      - android
    

  Сброс звонка при проигрывании встроенной музыки:
    - description: |
        **Известные баги iOS ( на 11.12.2019):**
        - Наша музыка должна восстанавливаться после звонков и сири, и не должна восстанавливаться после другой музыки. Этот пункт не всегда выполняется успешно. Его сильно легче сломать во время ведения.
        ---
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
        Он действует один раз на аккаунт и длиться один день, что должно быть достаточно для выполнения тест-кейсов.
        Если ты уже пользовался на своем аккаунте данным промокодом - можно создать новый и применить к нему данный промокод, использовать данный промокод нужно только для тестирования.
        ---
        На Samsung во время совершения звонка - музыка может продолжить играть, если выключен звук звонка!
        При включении звука звонка - музыка перестает играть при звонке на девайс. Считаем это особенностью девайсов.
        ---
        **Музыка раскатана только на регионы: РФ, Белоруссия, Казахстан**
        **Условия появления:** симка одной из стран (РФ, Белоруссия, Казахстан) / либо системный язык один из этих трех стран
        **Примечание:** Если симки нет, то в качестве "страны симки" будет использоваться язык приложения (или интерфейса системы).
    - info: |
        - Не первый запуск навигатора
        - Запустить музыку в приложении  (Тап на иконку Музыки в таббаре -> Выбрать любой плейлист -> Запустить его проигрывание)
        - Построить маршрут через ДС (желательно строить с разворотами, промежуточными точками - для большего количества аннотаций по пути)
        Запустить симуляцию движения
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: Осуществить звонок на устройство  и отклонить его
    - assert: |
        Во время звонка воспроизведение музыки останавливается
        При отклонении звонка музыка продолжает играть

    - platforms:
      - ios
      - android


  Совершение звонка при проигрывании встроенной музыки:
    - description: |
        **Известные баги iOS ( на 11.12.2019):**
        - Наша музыка должна восстанавливаться после звонков и сири, и не должна восстанавливаться после другой музыки. Этот пункт не всегда выполняется успешно. Его сильно легче сломать во время ведения.
        ---
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
        Он действует один раз на аккаунт и длиться один день, что должно быть достаточно для выполнения тест-кейсов.
        Если ты уже пользовался на своем аккаунте данным промокодом - можно создать новый и применить к нему данный промокод, использовать данный промокод нужно только для тестирования.
        ---
        На Samsung во время совершения звонка - музыка может продолжить играть, если выключен звук звонка!
        При включении звука звонка - музыка перестает играть при звонке на девайс. Считаем это особенностью девайсов.
        ---
        **Музыка раскатана только на регионы: РФ, Белоруссия, Казахстан**
        **Условия появления:** симка одной из стран (РФ, Белоруссия, Казахстан) / либо системный язык один из этих трех стран
        **Примечание:** Если симки нет, то в качестве "страны симки" будет использоваться язык приложения (или интерфейса системы).
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Запустить музыку в приложении  (Тап на иконку Музыки в таббаре -> Выбрать любой плейлист -> Запустить его проигрывание)
        - Построить маршрут через ДС (желательно строить с разворотами, промежуточными точками - для большего количества аннотаций по пути)
        Запустить симуляцию движения
    - do: |
        Осуществить звонок на устройство
        Принять его, начать разговор (разговаривать больше 5 минут)
    - assert: Во время звонка воспроизведение музыки останавливается
    - do: Завершить разговор
    - assert: Встроенная музыка восстанавливается

    - platforms:
      - ios
      - android
    

  Вызов Алисы при включенной встроенной музыке:
    - description: |
        **Известные баги iOS ( на 11.12.2019):**
        - Если наша музыка была включена хотя бы раз за сессию, а после этого включена другая музыка, то другая музыка не восстанавливается после Алисы (т.е. это не должно зааффектить пользователей, у которых еще не включена фича музыки в нави).
        - На iOS при включенной музыке алиса **пока не вызывается**
        ---
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
        Он действует один раз на аккаунт и длиться один день, что должно быть достаточно для выполнения тест-кейсов.
        Если ты уже пользовался на своем аккаунте данным промокодом - можно создать новый и применить к нему данный промокод, использовать данный промокод нужно только для тестирования.
        ---
        **Музыка раскатана только на регионы: РФ, Белоруссия, Казахстан**
        **Условия появления:** симка одной из стран (РФ, Белоруссия, Казахстан) / либо системный язык один из этих трех стран
        **Примечание:** Если симки нет, то в качестве "страны симки" будет использоваться язык приложения (или интерфейса системы).
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Запустить музыку в приложении (Тап на иконку Музыки в таббаре -> Выбрать любой плейлист -> Запустить его проигрывание)
        - Построить маршрут
        Запустить симуляцию движения
    - do: |
        **Android**: Вызвать Алису голосом
        **iOS**: Вызвать Алису тапом по кнопке
    - assert: Встроенная музыка перебивается Алисой.
    - do: Закрыть Алису
    - assert: После окончания взаимодействия с Алисой, музыка возобновляется

    - platforms:
      - ios
      - android
   

  Приглушение встроенной музыки при аннотациях:
    - description: |
        **Известные баги iOS ( на 11.12.2019):**
        - Наша музыка должна восстанавливаться после звонков и сири, и не должна восстанавливаться после другой музыки. Этот пункт не всегда выполняется успешно. Его сильно легче сломать во время ведения.
        - Если наша музыка была включена хотя бы раз за сессию, а после этого включена другая музыка, то другая музыка не восстанавливается после Алисы (т.е. это не должно зааффектить пользователей, у которых еще не включена фича музыки в нави).
        ---
        Если у тебя нет подписки музыки для выполнения этого тест-кейса, ты можешь воспользоваться промокодом - ASESSORSMOBILE2021.
        Он действует один раз на аккаунт и длиться один день, что должно быть достаточно для выполнения тест-кейсов.
        Если ты уже пользовался на своем аккаунте данным промокодом - можно создать новый и применить к нему данный промокод, использовать данный промокод нужно только для тестирования.
        ---
        **Музыка раскатана только на регионы: РФ, Белоруссия, Казахстан**
        **Условия появления:** симка одной из стран (РФ, Белоруссия, Казахстан) / либо системный язык один из этих трех стран
        **Примечание:** Если симки нет, то в качестве "страны симки" будет использоваться язык приложения (или интерфейса системы).
    - info: |
        Включить следующие настройки:
        -  Тап на иконку Меню в таббаре -> Настройки -> Звуки и оповещения -> Приглушать все звуки  (вкл)
        И Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        Запустить музыку в приложении  (Тап на иконку Музыки в таббаре -> Выбрать любой плейлист -> Запустить его проигрывание)
        Построить маршрут через ДС (желательно строить с разворотами, промежуточными точками - для большего количества аннотаций по пути)
        Запустить симуляцию движения
    - assert: При произношении аннотаций встроенная музыка приглушается

    - platforms:
      - ios
      - android


  Фоновое ведение прерываниее аннотации сворачиванием:
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить..
        - Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Запустить навигатор
        - Построить маршрут с учетом максимального количества маневров и ориетиров, в том числе и фраза прямо N км (фраза прямо не является последней фразой маршрута или хотя бы повторяется несколько раз)
    - assert: |
        - Навигатор запущен
        - Маршрут построен и запущено debug ведение по нему
    - do: Свернуть приложение в момент произнесения аннотации
    - assert: Аннотация не прерывается. (Аннотация может прерываться на iOS. Но последующие аннотации при этом должны корректно произноситься)

    - platforms:
        - ios
        - android


  Прооверка входящих звонков во время фонового ведения на iOS:
    - info: |
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение (пользователь не идет пешком)
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Отменить входящий вызов на тестовом девайсе
    - assert: |
        Навигатор продолжает ведение в фоне.
        Аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Ответить на звонок
    - assert: |
        Вверху экрана отображается плашка фонового ведения\работы GPS
        Аннотации не произносятся
    - do: Через некоторый промежуток времени, завершить звонок
    - assert: |
        Навигатор продолжает ведение в фоне.
        После завершения вызова аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS

    - platforms:
        - ios


  Прооверка входящих звонков во время фонового ведения на Android:
    - info: |
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение (пользователь не идет пешком)
        Аннотации произносятся/не произносятся(Особенность Android)

    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Отменить входящий вызов на тестовом девайсе
    - assert: |
        Навигатор продолжает ведение в фоне.
        Аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Позвонить на тестовый девайс
    - assert: |
        Переход к экрану звонка
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Ответить на звонок
    - assert: |
        Вверху экрана отображается плашка фонового ведения\работы GPS
    - do: Через некоторый промежуток времени, завершить звонок
    - assert: |
        Навигатор продолжает ведение в фоне.
        После завершения вызова аннотации произносятся
        Вверху экрана отображается плашка фонового ведения\работы GPS

    - platforms:
        - android


  Входящие звонки во время фонового ведения BT-гарнитруа на iOS:
    - info: |
        Подключить девайс к BT-гарнитуре
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение
    - do: |
        Позвонить на девайс.
    - assert: |
        До звонка аннотации озвучиваются через гарнитуру.
    - do: |
        Ответить на входящий
    - assert: |
        Разговор осуществляется через гарнитуру.
        Аннотации не произносятся.
    - do: |
        Завершить звонок
    - assert: |
        Аннотации начинают воспроизводится

    - platforms:
        - ios
    

  Входящие звонки во время фонового ведения BT-гарнитруа на Android:
    - info: |
        Подключить девайс к BT-гарнитуре
        Построен маршрут и запущено ведение по нему
        Приложение свернуто в фон
        Продолжается фоновое ведение
        Аннотации во время и до звонка произносятся/не произносятся(Особенность Android)
    - do: |
        Позвонить на девайс.
    - assert: |
        До звонка аннотации озвучиваются через гарнитуру.
    - do: |
        Ответить на входящий
    - assert: |
        Разговор осуществляется через гарнитуру.
    - do: |
        Завершить звонок
    - assert: |
        Аннотации начинают воспроизводится

    - platforms:
        - android
   

  Работа с нативным голосовым помощником при прерывании аннотации:
    - info: |
        Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        Если будет обнаружен баг, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
    - do: |
        - Построить маршрут и запустить введение
    - assert: |
        - Аннотации воспроизводятся
    - do: |
        - Вызвать нативный голосовой помощник (Siri или Google) по функциональной клавише в момент произнесения аннотации.
    - assert: |
        - По завершении работы голосового помощника аннотации возобновляются.
    - do: |
        - Вызвать алису голосом
    - assert: |
        - Алиса вызывается

    - platforms:
        - ios
        - android


  Проверка аннотаций и звуков других приложений при вызове Алисы(Звонок):
    - info: |
        - Надо включить developer settings -> Misc -> New Audio focus Api Off и перезапустить.
        **Если будет обнаружен баг**, то надо проверить, воспроизводится ли он с выключенным New Audio focus Api и написать об этом в заведенной баге
        - Построить длинный маршрут с большим числом маневров, промежуточных точек, ДС.
        - Запустить ведение по нему.
        - Запустить на девайсе воспроизведение музыки. (в стороннем приложении, например, Спотифай, ЯМузыка, ютюб музыка)
        - Двигаться по маршруту, слушая аннотации.
        - На устройстве включен звук
        - Открыть приложение на экране карты
    - do: |
        - Вызвать Алису и начать с ней говорить
    - assert: |
        - Алиса вызывается, воспринимает слова
    - do: |
        - Позвонить и принять звонок
    - assert: |
        - Звук звонка слышен.
        - Звонок принимается
        - Воспроизведение аннотаций во время разговора происходит через динамик устройства на Android 4-7, на Android 8+ и iOS аннотации во время разговора не воспроизводятся.
    - do: |
        - Завершить разговор, спустя 1-2 мин
    - assert: |
        - Воспроизведение аннотаций возобновляется после завершения разговора.
        - Воспроизведение музыки из стороннего приложения не возобновляется
    
    - platforms:
        - ios
        - android