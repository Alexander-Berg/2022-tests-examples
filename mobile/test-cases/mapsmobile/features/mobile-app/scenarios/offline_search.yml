testing:
  - regress
components: offline_search

specs:
  Офлайн поиск по категориям:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап таб "Поиск"
    - assert: |
        Открылся экран поиска
    - do: Произвести поиск по любой категории
    - assert: |
        На карте отмечены пины поисковой выдачи
        Отображается список организаций в соответсвии с выбранной категорией
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - newbie
        - refactor_ready
    - integration_run:
        - mapkit
    - testing:
        - acceptance_maps


  Офлайн переключение отображения результатов поиска между списком и пинами на карте:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: |
        Открылся экран поиска
    - do: Произвести поиск по любому запросу
    - assert: |
        На карте отмечены пины поисковой выдачи
        Отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации
    - do: Свернуть результаты поиска свайпом вниз
    - assert: |
        Список свернут
        На карте отбражаются поисковые пины
        Отображаются контролы:
        - слоев
        - зума
        - ММП
        Вверху экрана отображается поисковая строка
    - do: Развернуть результаты поиска свайпом вверх
    - assert: |
        На карте отмечены пины поисковой выдачи
        Отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit
    - testing:
        - acceptance_maps


  Офлайн поиск по запросу пользователя с экрана результатов поиска по другому запросу:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Произвести произвольный поисковый запрос
    - assert: |
        На карте отмечены пины поисковой выдачи
        В окне поиска отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации
    - do: Тап по строке поиска
    - assert: |
        Участок карты с поисковой выдачей не отображается
        (iPad) Участок карты с поисковой выдачей продолжает отображаться
        Отображаются саджесты по введенному ранее запросу
    - do: Тап по крестику в строке ввода
    - assert: |
        Список саджестов не отображается
        Отображаются поисковые категории
        Ниже отображается история поиска
    - do: Произвести поиск по другому запросу
    - assert: |
        На карте отмечены пины поисковой выдачи
        В окне поиска отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Отображение результатов поиска офлайн при изменении зума карты и сдвиге спана:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Произвести поиск по любому запросу
    - assert: |
        Отображаются результаты поиска
        На карте отображаются поисковые пины
    - do: Свернуть результаты поиска свайпом вниз
    - do: Сдвинуть немного карту в пределах скачанной области
    - assert: |
        Список свернут
        На карте отмечены пины поисковой выдачи
    - do: Уменьшить масштаб карты
    - assert: |
        Масштаб уменьшился
        Подгружаются организации, присутствующие на спане карты
    - do: Увеличить масштаб карты
    - assert: |
        Масштаб увеличился
        Подгружаются организации, присутствующие на спане карты

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Офлайн поиск по запросу, сохраненному в Истории:
    - info: |
        Ранее был произведен поиск по нескольким запросам с несколькими результатами поиска
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: |
        Открылся экран поиска
        Сохранены старые запросы пользователя
        Под поисковой строкой отображается карусель с закэшированными поисковыми категориями
    - do: Тап по сохраненному в истории запросу
    - assert: |
        Отображается карта с результатами поиска
        В поисковом поле отображен запрос из Истории, по которому был проведен поиск
    - do: Тап в поле ввода
    - do: Тап на крестик в поле ввода
    - assert: |
        Поле ввода очищено
        Отображается история поиска
        Запрос, по которому был произведен поиск, отображается в вверху списка

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Офлайн поиск в зоне, где не найден ни один результат:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открыт экран поиска
    - do: Произвести поиск по любому запросу
    - assert:  |
        На карте отмечены пины поисковой выдачи
        Отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации
    - do: Переместить спан карты в место, где результаты поиска отсутствуют
    - do: Развернуть результаты поиска свайпом вверх
    - assert: |
        В результатах поиска отображается, что ничего не найдено
        Предлагается изменить запрос
        Присутсвует кнопка Добавьте организацию

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Комбинированный поиск онлайн -> офлайн в разных регионах:
    - info: |
        Открыт главный экран приложения
        Девайс подключен к интернету
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Тап в строку поиска
    - do: Ввести в строке поиска "Минск"
    - do: Тап кэш Минска
    - do: Открыть главный экран приложения с картой Москвы
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Произвести поиск по любой категории
    - assert:
        На карте отмечены пины поисковой выдачи
        В окне поиска отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации
    - do: Закрыть результаты поиска
    - assert: |
        Открыт главный экран приложения
        Cпан карты - Москва
    - do: Открыть карту Минска
    - assert: |
        Открыт главный экран приложения
        Отображается спан Минска
    - do: Выключить интернет
    - do: Тап на поисковую строку
    - assert: Открылся экран поиска
    - do: Выполнить поиск по любому запросу
    - assert: |
        На карте отмечены пины поисковой выдачи
        В окне поиска отображается список организаций поисковой выдачи
        Отображается блок фильтров
        Если в поисковой выдаче будет только одна организация, то отобразится миникарточка этой организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - newbie
        - refactor_ready
    - integration_run:
        - mapkit


  Присутствие фильтров результатов офлайн поиска:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Произвести поиск организации с филиалами
    - assert: |
        Открыт экран результатов поиска
        Вверху находится поисковая строка
        Присутствует индикатор офлайн-поиска в строке
        На карте отображаются поисковые пины
        В нижней части экрана отображается
        Над карточкой блок с Фильтрами
    - do: Закрыть экран результатов поиска
    - assert: Отображается главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Выполнить поиск по топониму
    - assert: |
        Открыта миникарточка топонима
        На карте отображается активный пин искомого топонима
    - do: Закрыть карточку топонима
    - assert: Отображается главный экран приложения

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - refactor_ready


  Офлайн поиск по запросу без результатов поиска:
    - info: |
        Открыт главный экран приложения
        Устройство в вертикальной ориентации
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Ввести произвольный запрос без результатов поиска
    - do: Тап "Найти"
    - assert: |
        В результатах поиска отображается, что ничего не найдено
        Предлагается изменить запрос
        Присутствует кнопка Добавьте организацию
    - do: Сменить ориентацию устройства
    - assert: |
        В результатах поиска отображается, что ничего не найдено
        Предлагается изменить запрос
        Присутсвует кнопка Добавьте организацию

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - use_map
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Офлайн поиск топонима:
    - info: |
        Отображается главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert:  |
        Открылся экран поиска
        Отображается клавиатура
        Вверху экрана:
          Android: Кнопка вызова голосового ввода в виде микрофона
          iOS: Кнопка вызова Алисы
          Поле ввода с мигающим курсором
          Кнопка закрытия в виде крестика
          Дальше идет список поисковых категорий
    - do: Провести поиск топонима, например по запросу 'улица Ленина'
    - assert: |
        На карте отображены пины результатов поиска
        В нижней половине экрана - блок с миникарточками результатов поиска
        Если в данной области поиска ничего не найдено, отображено сообщение 'Ничего не найдено'
        Если результатом поиска является единственный топоним, то сразу показывается миникарточка топонима

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready
    - testing:
        - acceptance_maps


  Офлайн фильтрование результатов поиска (iOS):
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Выполнить поиск по категории
    - assert:  |
        На карте отображаются поисковые пины
        Отображается список результатов поиска
    - do: Тап по любому фильтру
    - assert: |
        Кнопка выбранного фильтра выделена
        Выдача изменилась согласно выбранному фильтру
    - do: Тап по кнопке фильтров
    - assert: |
        Отображается экран Фильтры
        Кнопка выбранного ранее фильтра выделена
        Ниже присутствуют другие блоки фильтров
    - do: Тап на Остальные в блоке фильтров
    - assert: |
        Открывается экран выбранного блока
        Слева сверху отображается кнопка возврата на предыдущий экран
    - do: Выделить несколько пунктов в выбранном блоке фильтров
    - assert: |
        Выбранные пункты отмечены галочкой
        Порядок отображения в списке не изменился
    - do: Тап на кнопку возврата
    - assert: |
        Отображается экран результатов поиска
        Выдача изменилась согласно выбранным ранее фильтрам
        В кнопке фильтров отображается значок активных фильтров
    - do: Тап на кнопку фильтров
    - assert: |
        Отображается экран Фильтры
        Выбранные ранее фильтры отображаются в порядке выбора
    - do: Тап Остальные в блоке, который открывался ранее
    - do: Выбрать другие фильтры
    - assert: Выбранный блок дополнился новыми пунктами
    - do: Тап на кнопку возврата на предыдущий экран
    - assert: Отображается экран Фильтры
    - do: Тап Сбросить всё
    - assert: Выбранный ранее фильтры сброшены

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - newbie
        - refactor_ready
    - integration_run:
        - mapkit
    - testing:
        - acceptance_maps


  Офлайн фильтрование результатов поиска (Android):
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Тап любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Открылся экран поиска
    - do: Выполнить поиск по категории
    - assert: |
        На карте отображаются поисковые пины
        Отображается список результатов поиска
    - do: Тап по любому фильтру
    - assert: |
        Кнопка выбранного фильтра выделена
        Выдача изменилась согласно выбранному фильтру
    - do: Тап по кнопке фильтров
    - assert: |
        Отображается экран Фильтры
        Кнопка выбранного ранее фильтра выделена
        Ниже присутствуют другие блоки фильтров
    - assert: |
        Отображается кнопка Сбросить всё
        Ниже присутствуют категории выбранного блока
    - do: Выделить несколько пунктов в выбранном блоке фильтров
    - assert: |
        Выбранные пункты отмечены галочкой
        Порядок отображения в списке не изменился
    - do: Тап на кнопку возврата
    - assert: |
        Отображается экран результатов поиска
        Выдача изменилась согласно выбранным ранее фильтрам
        В кнопке фильтров отображается значок активных фильтров
    - do: Тап на кнопку фильтров
    - assert: Отображается экран Фильтры
    - do: Тап Сбросить всё
    - assert: Выбранный ранее фильтры сброшены

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - newbie
        - refactor_ready
    - integration_run:
        - mapkit
    - testing:
        - acceptance_maps


  Поиск маршрутов в офлайн-режиме:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Тап в строку поиска
    - do: Ввести "Тула" в строку поиска
    - do: Тап кэш Тулы
    - do: Включить авиарежим
    - do: Открыть главный экран приложения на спане Тулы
    - do: Тап по поисковой строке
    - assert: |
        Отображается экран поиска
        Поле ввода в фокусе
        Отображается клавиатура
    - do: Произвести поиск по маршруту ОТ (напр., автобус 1)
    - assert:  |
        Отображаются сниппеты  с организациями
        Не отображаются сниппеты с ОТ
        Если ничего не нашлось, то стоит изменить спан карты/отдалить камеру
    - do: Включить интернет
    - do: Выполнить поиск по единственному маршруту ОТ (напр., трамвай 12)
    - assert: |
        Отображается миникарточка маршрута ОТ
        На карте отображается линия маршрута с остановками
        На карте отображаются живые метки маршрута
    - do: Выполнить поиск по маршруту ОТ с несколькими результатами (напр., автобус 7)
    - assert: |
        Отображается результаты поиска по маршруту
        Геометрия маршрутов на карте не отображается
        В списке результатов отображаются виды ОТ и номер
        Указана начальная и конечная остановки
    - do: Свернуть приложение
    - do: Развернуть приложение
    - assert: |
        Отображается результаты поиска по маршруту
        Геометрия маршрутов на карте не отображается
        В списке результатов отображаются виды ОТ и номер
        Указана начальная и конечная остановки

    - platforms:
        - ios
        - android
    - integration_run:
        - mapkit
    - tags:
        - assessors
        - mapkit_ready
        - refactor_ready


  Повтор поиска после удаления кэшей:
    - info: |
        Открыт главный экран приложения
        Включен интернет
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Открыть главный экран приложения
    - do: Тап по поисковой строке
    - assert: Отображается экран поиска
    - do: Выполнить поиск по одной организации
    - assert: |
        Открывается миникарточка организации
        На спане карты отображается активный пин
    - do: Выключить интернет
    - do: Закрыть миникарточку организации
    - assert: Отображается главный экран приложения
    - do: |
       Удалить загруженные карты:
       - (Android) Меню -> Загрузка карт -> Тап на кнопку настроек
       - (iOS) Меню -> Настройки -> Офлайн-карты
    - assert: |
        Все скачанные ранее кэши удалены
        (iOS) Кнопка Удалить загруженные карты не активна / (Android) Кнопка Удалить загруженные карты пропала
    - do: Вернуться на главный экран приложения
    - do: Тап на строку поиска
    - assert: |
        Отображается экран поиска
        Присутствует история поиска
        Первым отображается выполненный ранее запрос
    - do: Тап по последнему пользовательскому запросу
    - assert: |
        Открывается экран результатов поиска с текстом 'Искать без интернета можно только с загруженной картой'
        iOS:
        - Отображаются кнопки 'Загрузить карту, когда появится сеть' и 'Повторить поиск'
        - Над поиском присутствует строка 'Нет соединения с сетью'
        Android:
        - Отображаются кнопки 'Запланировать загрузку' и 'Повторить поиск'
        - Над поиском присутствует строка 'Нет соединения с интернетом'

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - mapkit_ready
        - refactor_ready
    - integration_run:
        - mapkit


  Невалидный оффлайн поиск:
    - info: |
        Открыт главный экран приложения
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап на поисковую строку
    - assert: Открыт экран поиска
    - do: Набрать случайные символы
    - do: Тап "Найти"
    - assert: Отображается сообщение об ошибке
    - do: Тап на крестик в поисковой строке
    - assert: |
        Отображается экран поиска
        Поисковая строка пуста

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Оффлайн поиск без скаченного кэша:
    - info: |
        Карта города не скачена
        Интернет соединение отключено
    - do: Тап на пин на карте
    - assert: |
        Открылась карточка Нет информации
        Присутсвует кнопка Обновить
    - do: Закрыть карточку
    - assert: Отображается спан карты
    - do: Тап на таб Поиск
    - assert: Открыт экран поиска
    - do: Тап на поисковую категорию
    - assert: |
        Отображается экран поисковой выдачи с ошибкой
        Присутсвует кнопка Повторить поиск

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
    - tags:
        - assessors
        - newbie
        - refactor_ready


  Состояние пинов в офлайн режиме:
    - info: |
        Пины имеют 4 состояния:
        - До взаимодействия (синий)
        - Активный пин (красный)
        - Пин после взаимодействия (голубой)
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Тап по строке поиска
    - assert: Отображается экран поиска
    - do: Произвести поиск по любой категории
    - assert: |
        Отображаются поисковые пины на карте
        Отображается список результатов поиска с блоком фильтров
        На карте отображаются поисковые пины в состоянии до взаимодействия
        Подложка отображается корректно
        Артефакты отсутствуют
    - do: Свернуть результаты поиска
    - assert: |
        Список свернут
        Над списком отображается блок с фильтрами
    - do: Тап по пину
    - assert: |
        Открывается миникарточка организации
        Пин имеет активное состояние
        Подложка отображается корректно
        Артефакты отсутствуют
    - do: Тап по другому пину
    - assert: |
        Открывается миникарточка новой организации
        Пин новой организации в активном состоянии
        Пин организации из предыдущего шага в состоянии после взаимодействия
        Подложка отображается корректно
        Артефакты отсутствуют

    - platforms:
        - android
    - integration_run:
        - mapkit
    - tags:
        - use_map
        - assessors
        - mapkit_ready
        - refactor_ready


  Офлайн-поиск по категории в ведении:
    - info: |
        Открыт главный экран приложения
    - do: Включена симуляция движения (Debug Panel -> Routes -> Demo movement)
    - do: Перезапустить приложение
    - do: Тап "Меню"
    - do: Тап "Загрузка карт"
    - do: Скачать любой кэш в блоке "Рядом с вами"
    - do: Включить авиарежим
    - do: Открыть главный экран приложения
    - do: Построить произвольный автомобильный маршрут любым способом
    - do: Тап "Поехали"
    - assert: Происходите офлайн ведение по автомобильному маршруту
    - do: Тап таб "Поиск" в таббаре
    - do: Совершить поиск по любой категории
    - assert: |
        Происходит ведение
        На карте отображаются пины результатов поисковой выдачи по категории

    - platforms:
        - ios
        - android
    - tags:
        - assessors
        - refactor_ready
    - testing:
        - acceptance_maps
