components: traffic_consumption
testing:
  - regress

specs:
  Замер потребления мобильного трафика в ведении:
    - info: |
        Устройство подключено к мобильному интернету
        Wi-Fi отключен
        Чистая установка МЯК
        МЯК не был запущен ранее
        Приготовить таймер на 20 минут на любом другом устройстве
        Посмотреть расход трафика и записать значение
        Посмотреть расход трафика можно следующим образом (в зависимости от версии ОС и модели устройства могут быть отличия):
          - iOS: Настройки -> Сотовая связь -> Найти название приложения в списке
          - Android: Настройки -> Сеть и Интернет -> Передача данных -> Мобильный трафик -> Найти название приложения в списке
    - do: Запустить МЯК
    - do: Авторизоваться стафф-аккаунтом
    - do: Включить симуляцию движения в настройках со скоростью 40 км/ч (Меню -> Настройки -> Дебаг-панель -> Routes -> Demo movement)
    - do: Перейти на главный экран
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу "Рублёвское шоссе, 15, Россия, Москва"
    - assert: |
        На карте отображается поднятый пин
        Открылась мини-карточка топонима
        В карточке присутствует кнопка построения маршрута
    - do: Тап на кнопку построения маршрута
    - assert: |
        Открыт экран построения маршрута
        Над табами типов маршрута (Все, Авто, ОТ и тд) отображается Блок с адресами начальной и конечной точки
    - do: Тап на Блок с адресами начальной и конечной точки
    - do: Тап на поле "Откуда"
    - do: Ввести "Красная площадь"
    - do: Тап на "Построить"
    - assert: Маршрут перестроился
    - do: Тап на "Поехали"
    - assert: Началось движение по маршруту
    - do: Запустить таймер на 20 минут
    - do: Завершить маршрут после 20 минут
    - assert: Открыт главный экран приложения
    - do: Посмотреть расход трафика в настройках устройства
    - do: Отнять текущее количество трафика от записанного ранее
    - do: Записать разницу в [таблицу](https://wiki.yandex-team.ru/maps/mobile/testing/traffic/)
    - assert: Данные внесены в таблицу
    - do: Сравнить текущий расход с предыдущим,
    - assert: |
        Расход трафика меньше предыдущей версии
        ИЛИ
        Расход трафика увеличился не более 20 процентов от предыдущей версии

    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
        - lite_acceptance_maps

