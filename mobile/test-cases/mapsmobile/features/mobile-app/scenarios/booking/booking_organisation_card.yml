testing:
  - regress
components: booking

# В этот ямл добавлять сценарии, которые затрагивают Бронирования в карточке организации

aliases:
  # Получение активной записи через Веб
  - &booking_active
    - info: |
        (Веб-карты можно использовать в браузере компьютера или мобильного устройства)
        Пользователь авторизован в один и тот же аккаунт в МЯК и Веб-Картах
        К аккаунту пользователя привязан номер телефона
        У пользователя нет активных записей
    - do: |
        Открыть Кофейню Кирилла в Веб-картах:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

        `https://yandex.ru/maps/-/CCUqzHb0cB`
    - do: Записаться к любому мастеру через CTA-кнопку "Записаться онлайн"
    - do: Запустить МЯК

  # Получение прошедшей записи через Веб
  - &booking_last
    - info: |
        (Веб-карты можно использовать в браузере компьютера или мобильного устройства)
        Пользователь авторизован в один и тот же аккаунт в МЯК и Веб-Картах
        К аккаунту пользователя привязан номер телефона
        У пользователя нет активных записей
    - do: |
        Открыть Кофейню Кирилла в Веб-картах:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

        `https://yandex.ru/maps/-/CCUqzHb0cB`
    - do: Записаться к любому мастеру через CTA-кнопку "Записаться онлайн"
    - do: Перевести время на устройстве так, чтобы оно было после времени записи
    - do: Запустить МЯК

  # Включение эксперимента bookings_personal и открытие Кофейни Кирилла
  - &booking_with_kirill
    - do: |
        iOS: Включить эксперимент `bookings_personal`
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/bookings_personal.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal`
    - do: |
        iOS: Перезапустить приложение
    - do: |
        Открыть Кофейню Кирилла:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

        `https://yandex.ru/maps/-/CCUqzHb0cB`

  # Предусловия для отображения кнопки "Записаться онлайн" в табах на iOS
  - &booking_in_tab_ios
      - do: |
          Включить эксперименты `bookings_personal` и `bookings_personal_in_photo_tab`
          [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/bookings_personal%26bookings_personal_in_photo_tab.png){title=QR-код}

          `yandexmaps://add_exp?bookings_personal&bookings_personal_in_photo_tab`
      - do: Перезапустить приложение
      - do: |
          Открыть Кофейню Кирилла:
          [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

          `https://yandex.ru/maps/-/CCUqzHb0cB`

  # Включение прозрачной кнопки "Записаться онлайн"
  - &booking_button_redesign
      - info: Устройство в вертикальной ориентации
      - do: |
          Включить эксперимент `transactional_button_redesign`
          [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/transactional_button_redesign.png){title=QR-код}

          `yandexmaps://add_exp?transactional_button_redesign`
      - do: Перезагрузить приложение
      - do: |
          Открыть Кофейню Кирилла:
          [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

          `https://yandex.ru/maps/-/CCUqzHb0cB`
      - assert: Отображается мини-карточка организации с прозрачной СТА-кнопкой "Записаться онлайн"
      - do: Раскрыть карточку свайпом вверх

  # Отображение оффера Плюса
  - &plus_in_bookings
      - do: |
           iOS: Включить эксперименты `bookings_personal` и `plus_in_bookings`
           [collapsed-image](https://jing.yandex-team.ru/files/vmnpopkova/YQR-2.jpeg){title=QR-код}

           `yandexmaps://add_exp?bookings_personal&plus_in_bookings`
      - do: |
          Android: Включить эксперимент `plus_in_bookings`
          [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/plus_in_bookings.png){title=QR-код}

          `yandexmaps://add_exp?plus_in_bookings`
      - do: Перезапустить приложение


specs:
  Открытие вебвью записи тапом на CTA-кнопку "Записаться онлайн":
    - *booking_with_kirill
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - assert: Открывается вебвью "Запись онлайн"
    - do: Тап на крестик
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - testing:
        - smoke


  Запись на услугу через CTA-кнопку Бронирований в карточке организации с авторизацией:
    - info: |
        Пользователь авторизован в аккаунт с привязанным номером телефона
        У пользователя нет активных записей
    - *booking_with_kirill
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - do: Пройти все этапы записи
    - do: Тап на "Подтвердить запись"
    - assert: Отображается экран "Вы записаны"
    - do: Закрыть экран тапом на "Отлично"
    - assert: Отображается карточка организации
    - do: Переоткрыть карточку Кофейни Кирилла
    - do: Развернуть карточку до полного состояния
    - assert: |
        Над CTA-кнопкой отображается сниппет "Вы записаны" с датой и временем записи
        Под табами отображается виджет Бронирования с кнопками "Перенести запись" и "Отменить запись"
        Время и дата соответсвует тому, что было выбрано при записи

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Запись на услугу через CTA-кнопку Бронирований в карточке организации с дальнейшей авторизацией в процессе записи на услугу:
    - info: Пользователь неавторизован
    - *booking_with_kirill
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - do: Пройти все этапы записи до экрана "Проверьте запись"
    - assert: |
        Отображается экран "Проверьте запись"
        На экране есть блок авторизации с кнопками "Войти в Яндекс.ID" и "Продолжить без авторизации"
    - do: Тап на "Войти в Яндекс.ID"
    - assert: Открывается экран авторизации
    - do: Авторизоваться в аккаунт с привязанным номером телефона
    - assert: Появился блок с именем и фамилией/псевдонимом и номером телефона пользователя
    - do: Тап на кнопку "Подтвердить запись"
    - do: Закрыть экран подтверждения записи
    - do: Закрыть карточку Кофейни Кирилла
    - do: Перейти в Меню
    - assert: Пользователь авторизован

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - integration_run:
        - am


  Тап на сниппет Бронирований в карточке организации при активной записи:
    - *booking_active
    - assert: Над action-баром отображается сниппет Бронирования с датой и временем записи
    - do: Раскрыть полную карточку организации
    - assert: Над CTA-кнопкой "Записаться онлайн" отображается сниппет Бронирования
    - do: Тап на сниппет Бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью
    - assert: Над CTA-кнопкой "Записаться онлайн" отображается сниппет Бронирования

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Тап на виджет Бронирования в карточке организации при активной записи:
    - *booking_active
    - do: Проскроллить карточку до виджета бронирования
    - assert: Под табами отображается виджет Бронироваиня с кнопками "Перенести запись" и "Отменить запись"
    - do: Тап на виджет Бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Перенос записи при тапе на кнопку "Перенести запись" в виджете Бронирования:
    - *booking_active
    - *booking_with_kirill
    - do: Пролистать карточку до виджета Бронирования
    - do: Тап на "Перенести запись"
    - assert: Открывается вебвью Бронирований с календарём для выбора даты записи
    - do: Выбрать произвольную дату и время
    - do: Тап на "Подтвердить запись"
    - do: Переоткрыть карточку Кофейни Кирилла
    - assert: |
        В плашке над CTA-кнопкой "Записаться онлайн" отображается время и дата новой записи
        В виджете Бронирования под табами отображается время и дата новой записи

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Отмена записи через кнопку "Отменить запись" в виджете Бронирования:
    - info: |
        Запись можно отменить только если до неё больше 48 часов
        (Если до записи меньше 48 часов, то можно поменять время на устройстве)
    - *booking_active
    - *booking_with_kirill
    - do: Проскроллить карточку до виджета бронирования
    - do: Тап на "Отменить запись"
    - assert: Открывается вебвью с поп-апом "Отменить запись"
    - do: Тап на "Отменить запись"
    - assert: Заголовок вебвью меняется на "Запись отменена"
    - do: Закрыть вебвью
    - do: Переоткрыть карточку Кофейни Кирилла
    - assert: Отображается виджет "Вы записывались" с кнопками "Записаться снова" и "Оценить место"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Тап на виджет Бронирования в карточке организации при прошедшей записи:
    - *booking_last
    - *booking_with_kirill
    - do: Проскроллить карточку до виджета Бронирования
    - assert: Отображается виджет Бронирования с кнопками "Записаться снова" и "Оценить место"
    - do: Тап на виджет Бронирования
    - assert: Открылось вебвью с информацией о записи
    - do: Закрыть вебвью
    - assert: Отображается карточка организации

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Повторная запись через кнопку "Записаться снова" в виджете Бронирования при прошедшей записи:
    - *booking_last
    - *booking_with_kirill
    - do: Проскроллить карточку до виджета Бронирования
    - do: Тап на "Записаться снова"
    - assert: Открывается вебвью Бронирований с календарём для выбора даты записи
    - do: Выбрать произвольную дату и время
    - assert: |
        Открыт экран "Проверьте запись"
        Дата и время соответствуют выбранным на предыдущем шаге
        Специалист не изменился
    - do: Тап на "Подтвердить запись"
    - do: Переоткрыть карточку Кофейни Кирилла
    - assert: |
        В сниппете над CTA-кнопкой "Записаться онлайн" отображается время и дата новой записи
        В виджете Бронирования под табами отображается время и дата новой записи

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Оценивание места через кнопку "Оценить место" в виджете Бронирования при прошедшей записи:
    - *booking_last
    - *booking_with_kirill
    - do: Проскроллить карточку до виджета Бронирования
    - do: Тап на "Оценить место"
    - assert: Открывается форма оставления отзыва
    - do: Поставить оценку и написать отзыв
    - do: Тап на "Отправить"
    - assert: Открыта карточка Кофейни Кирирлла на табе "Обзор"
    - do: Пролистать карточку до блока отзывов
    - assert: Отображается отзыв

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Открытие экрана бронирования через action-кнопку "Позвонить":
    - *booking_with_kirill
    - do: Тап на action-кнопку звонка в организацию
    - assert: |
        Открывается поп-ап, в котором присуствуют:
        Кнопка "Записаться онлайн"
        Номер телефона организации
    - do: Тап на "Записаться онлайн"
    - assert: Открывается вебвью с выбором услуг
    - do: Закрыть вебвью
    - do: Тап на action-кнопку звонка в организацию
    - do: Тап на любой номер телефона
    - assert: |
        (Android) Открывается системный экран звонков с введенным номером телефона
        (iOS) Отображается поп-ап с номером телефона, присутствует кнопки вызова и отмены

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Кнопка "Записаться онлайн" в табе "Меню/Товары и услуги":
    - *booking_with_kirill
    - do: Тап на таб "Меню"
    - assert: |
        Открыт таб "Меню"
        В таббаре есть кнопки "Категории" и "Записаться онлайн"
    - do: Сменить ориентацию на горизонтальную
    - assert: Кнопки "Категории" и "Записаться онлайн" отображаются
    - do: Тап на кнопку "Записаться онлайн"
    - assert: Открылось вебвью Бронирований
    - do: Закрыть вебвью
    - assert: Отображается таб "Меню"

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  (iOS) Кнопка "Записаться онлайн" в табе "Фото":
    - *booking_in_tab_ios
    - do: Тап на таб "Фото"
    - assert: |
        Открыт таб "Фото"
        В таббаре есть кнопки "Добавить фото" и "Записаться онлайн"
    - do: Тап на "Записаться онлайн"
    - assert: Открылось вебвью Бронирований
    - do: Закрыть вебвью
    - assert: Отображается таб "Фото"

    - platforms:
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  (iOS) Кнопка "Записаться онлайн" в табе "Отзывы":
    - *booking_in_tab_ios
    - do: Тап на таб "Отзывы"
    - assert: |
        Открыт таб "Отзывы"
        В таббаре есть кнопки "Написать отзыв" и "Записаться онлайн"
    - do: Тап на кнопку "Записаться онлайн"
    - assert: Открылось вебвью Бронирований
    - do: Закрыть вебвью
    - assert: Отображается таб "Отзывы"

    - platforms:
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  (Android) Кнопка "Записаться онлайн" в табе "Отзывы":
    - *booking_with_kirill
    - do: Тап на таб "Отзывы"
    - assert: |
        Открыт таб "Отзывы"
        В таббаре есть кнопки "Написать отзыв" и "Записаться онлайн"
    - do: Сменить ориентацию на горизонтальную
    - assert: Кнопки "Написать отзыв" и "Записаться онлайн" отображаются
    - do: Тап на кнопку "Записаться онлайн"
    - assert: Открылось вебвью Бронирований
    - do: Закрыть вебвью
    - assert: Отображается таб "Отзывы"

    - platforms:
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Прозрачная CTA-кнопка Бронирования:
    - *booking_button_redesign
    - assert: |
        Открылась полная карточка организации
        Отображается полупрозрачная СТА-кнопка "Записаться онлайн"
    - do: Изменить ориентацию устройства на горизонтальную
    - assert: Отображается прозрачная СТА-кнопка "Записаться онлайн"

    - tags:
        - assessors
    - platforms:
        - android


  Прозрачная кнопка Бронирования в табе "Меню":
    - *booking_button_redesign
    - do: Открыть таб "Меню"
    - assert: В экшн-баре отображается прозрачная кнопка "Записаться онлайн"
    - do: Изменить ориентацию устройства на горизонтальную
    - assert: Отображается прозрачная СТА-кнопка "Записаться онлайн"

    - tags:
        - assessors
    - platforms:
        - android


  Прозрачная кнопка Бронирования в табе "Отзывы":
    - *booking_button_redesign
    - do: Открыть таб "Отзывы"
    - assert: В экшн-баре отображается прозрачная кнопка "Записаться онлайн"
    - do: Изменить ориентацию устройства на горизонтальную
    - assert: Отображается прозрачная СТА-кнопка "Записаться онлайн"

    - tags:
        - assessors
    - platforms:
        - android


  Отображение оффера Плюса в списке результатов поиска при первом бронировании (пользователь без подписки Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя нет подписки Я.Плюс
        У пользователя не было записей
    - *plus_in_bookings
    - do: Тап на Меню
    - do: Тап "Записи и бронирования"
    - do: Тап "Найти салон красоты"
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение оффера Плюса в кнопке "Записаться онлайн" при первом бронировании (пользователь без подписки Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя нет подписки Я.Плюс
        У пользователя не было записей
    - *plus_in_bookings
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу "Красота"
    - assert: Отображается список результатов поиска
    - do: Тап на организацию с возможностью записи онлайн
    - assert: |
        Открыта карточка организации
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Свернуть карточку организации в среднее состояние
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Отображение оффера Плюса в списке результатов поиска при первом бронировании (пользователь c подпиской Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя есть подписка Я.Плюс
        У пользователя не было записей
    - *plus_in_bookings
    - do: Тап на Меню
    - do: Тап "Записи и бронирования"
    - do: Тап "Найти салон красоты"
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Отображается список результатов поиска
        У организаций с возможностью онлайн-записи отображается оффер "N баллов на Плюс"

    - tags:
        - assessors
    - platforms:
        - ios
        - android


  Отображение оффера Плюса в кнопке "Записаться онлайн" при первом бронировании (пользователь c подпиской Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя есть подписка Я.Плюс
        У пользователя не было записей
    - *plus_in_bookings
    - do: Тап на строку поиска
    - do: Произвести поиск по запросу "Красота"
    - assert: Отображается список результатов поиска
    - do: Тап на организацию с возможностью записи онлайн
    - assert: |
        Открыта карточка организации
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Свернуть карточку организации в среднее состояние
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов
    - do: Повернуть девайс в горизонтальную ориентацию
    - assert: |
        Присутствует кнопка "Записаться онлайн"
        На кнопке отображается оффер Плюса с количеством баллов

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение оффера Плюса в табе Товары и услуги, Фото, Отзывы (пользователь без подписки Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя нет подписки Я.Плюс
        У пользователя не было записей
    - do: Включить эксперимент bookings_personal_in_photo_tab(ios)
        [collapsed-image](https://jing.yandex-team.ru/files/nikita-asuad/qr-code%20%282%29.png){title=QR-код}

          `yandexmaps://add_exp?bookings_personal_in_photo_tab`
    - *plus_in_bookings
    - do: Тап на строку поиска
    - do: Выполнить поиск по запросу "Красота"
    - assert: Отображается список результатов поиска
    - do: |
        Тап на организацию с возможностью записи онлайн и оффером Плюса
        [ collapsed-image ](https://jing.yandex-team.ru/files/vmnpopkova/photo_2022-06-23%2013.58.41.jpeg){title=Пример организации с оффером Плюса}
    - assert: Открыта карточка организации
    - do: Тап на таб "Товары и услуги"
    - assert: |
        Открыт раздел Товаров и услуг
        На кнопке "Записаться онлайн" отображается оффер Плюса
    - do: Тап на таб "Фото"
    - assert: |
        Открыт раздел Фото
        На кнопке "Записаться онлайн" отображается оффер Плюса
    - do: Тап на таб "Отзывы"
    - assert: |
        Открыт раздел Отзывы
        На кнопке "Записаться онлайн" отображается оффер Плюса

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps


  Отображение оффера Плюса в табе Товары и услуги, Фото, Отзывы (пользователь c подпиской Я.Плюс):
    - info: |
        Пользователь авторизован
        У пользователя есть подписка Я.Плюс
        У пользователя не было записей
    - do: Включить эксперимент bookings_personal_in_photo_tab(ios)
        [collapsed-image](https://jing.yandex-team.ru/files/nikita-asuad/qr-code%20%282%29.png){title=QR-код}

          `yandexmaps://add_exp?bookings_personal_in_photo_tab`
    - *plus_in_bookings
    - do: Тап на таб Поиск
    - do: Тап на "Салоны красоты"
    - assert: Отображается список результатов поиска
    - do: |
        Тап на организацию с возможностью записи онлайн и оффером Плюса
        [ collapsed-image ](https://jing.yandex-team.ru/files/vmnpopkova/photo_2022-06-23%2013.58.41.jpeg){title=Пример организации с оффером Плюса}
    - assert: Открыта карточка организации
    - do: Тап на таб "Товары и услуги"
    - assert: |
        Открыт раздел Товаров и услуг
        На кнопке "Записаться онлайн" отображается оффер Плюса
    - do: Тап на таб "Фото"
    - assert: |
        Открыт раздел Фото
        На кнопке "Записаться онлайн" отображается оффер Плюса
    - do: Тап на таб "Отзывы"
    - assert: |
        Открыт раздел Отзывы
        На кнопке "Записаться онлайн" отображается оффер Плюса

    - tags:
        - assessors
    - platforms:
        - ios
        - android
    - testing:
        - acceptance_maps
