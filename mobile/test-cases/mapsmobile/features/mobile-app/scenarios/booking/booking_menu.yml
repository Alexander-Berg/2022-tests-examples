testing:
  - regress
components: booking

#В этот ямл добавлять все сценарии, которые затрагивают раздел "Записи и бронирования"

aliases:
  # Включение главного экспа Бронирований:
  - &booking_activation_st
    - do: |
        iOS: Включить эксперимент `bookings_personal`
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/bookings_personal.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal`
    - do: |
        iOS: Перезапустить приложение

  # Включение экспа и открытие "Записи и бронирования"
  - &booking_with_menu
    - do: |
        iOS: Включить эксперимент `bookings_personal`
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/bookings_personal.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal`
    - do: |
        iOS: Перезапустить приложение
    - do: Тап на кнопку "Записи и бронирования" в Меню

  # Предусловия для тикера
  - &booking_ticker
    - info: |
        Тикер -- это точка рядом с элементом
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/gojwgwjo.png){title=QR-код}

        iOS: Если в Меню не отображается пункт "Записи и бронирования", то нужно включить эксперимент `bookings_personal` и перезапустить МЯК
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/bookings_personal.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal`
        Первый запуск МЯК

    - do: Запустить МЯК
    - do: Открыть главный экран
    - asseert: Над иконкой Меню/Профиля отображается Тикер (синня точка)
    - do: Тап на Меню
    - assert: Рядом с разделом "Записи и бронирования" отображается Тикер

specs:
  Отображение раздела "Записи и бронирования" в Меню:
    - *booking_activation_st
    - do: Тап на Меню
    - assert: В Меню присутствует раздел "Записи и бронирования"
    - do: Тап на "Записи и бронирования"
    - assert: Открывается экран "Записи и бронирования"
    - do: Тап на крестик
    - assert: |
        Открывается Меню
        В Меню присуствует раздел "Записи и бронирования"

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Авторизация через раздел "Записи и бронирования":
    - info: |
        Экран авторизации может представлять из себя:
        * форму ввода логина или пароля
        * карусель аккаунтов, в которые совершался вход
        Для прохождения тест-кейса не имеет значения, какой из экранов авторизации отобразится
        Пользователь неавторизован
    - *booking_with_menu
    - assert: |
        Отображается экран "Записи и бронирования" с плейсхолдером об отсутствии записей
        На экране присутствует кнопка авторизации
    - do: Тап на кнопку авторизации
    - assert: Открывается экран авторизации
    - do: Авторизоваться аккаунтом `yndx-vikelvar-zqqa5o` с паролем `gen8897`
    - assert: |
        Открыто Меню
        Наверху отображается имя пользователя, логин и аватар
    - do: Тап на "Записи и бронирования"
    - assert: Отображается экран "Записи и бронирования" с историей записей

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps
    - integration_run:
        - am


  Поведение Тикера возле пункта "Записи и бронирования" в Меню при перезапуске:
    - *booking_ticker
    - do: Перезапустить приложение
    - assert: |
        Открыт главный экран приложения
        Над иконкой Меню/Профиля отображается Тикер
    - do: Тап на Меню
    - assert: Рядом с разделом "Записи и бронирования" отображается Тикер
    - do: Перезапустить приложение
    - assert: |
        Открыт главный экран приложения
        Над иконкой Меню/Профиля Тикер не отображается
    - do: Тап на Меню
    - assert: Рядом с разделом "Записи и бронирования" тикер отсутствует

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Поведение Тикера при тапе на пункт "Записи и бронирования" в Меню:
    - *booking_ticker
    - do: Тап на "Записи и бронирования"
    - assert: Отображается экран "Записи и бронирования"
    - do: Тап на крестик
    - assert: |
        Отображается экран Меню
        Рядом с разделом "Записи и бронирования" тикер не отображается
    - do: Выйти назад на Главный экран
    - assert: Рядом с иконкой Меню/Профиля тикер не отображается

    - platforms:
        - ios
        - android
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Поведение тикера возле пункта "Записи и бронирования" в Меню при авторизации:
    - *booking_ticker
    - do: Авторизоваться
    - assert: |
        Пользователь авторизован
        Рядом с разделом "Записи и бронирования" отображается Тикер
    - do: Вернуться на главный экран приложения
    - assert: Над иконкой Профиля отображается Тикер
    - do: Тап на троеточие возле информации об аккаунте
    - do: Выйти из аккаунта
    - assert: |
        Произошёл выход из аккаунта
        Отображается экран Меню
        Рядом с разделом "Записи и бронирования" отображается Тикер

    - platforms:
        - ios
        - android
    - tags:
        - assessors


  Балун при бронировании. Записаться:
    - estimatedTime: 10m
    - preconditions: |
        Первый запуск приложения
        Пользователь авторизован
        У пользователя отсутствуют записи
        Удалить запись можно через Меню -> Записи и бронирования -> Тап на запись -> Удалить запись
    - *booking_activation_st
    - do: |
        Открыть Кофейню Кирилла:
        [collapsed-image](https://jing.yandex-team.ru/files/vikelvar/qr-code-1.gif){title=Сканировать QR-код}

        `https://yandex.ru/maps/-/CCUqzHb0cB`
    - do: Тап на CTA-кнопку "Записаться онлайн"
    - do: Пройти все этапы записи, выбрав произвольные значения
    - assert: Отображается экран "Вы записаны"
    - do: Тап на "Отлично"
    - do: Закрыть приложение
    - do: Открыть приложение через 5 минут
    - assert: Под профилем отображается балун бронирования с надписью "Ваши записи в салоны красоты хранятся в профиле"

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Балун при бронировании. Скрытие и показ:
    - info : Если аккаунта с историей записей нет, можно авторизоваться в аккаунт `yndx-vikelvar-zqqa5o` с паролем `gen8897`
    - preconditions: |
        Первый запуск приложения
        Пользователь авторизован
        У пользователя есть записи, Меню -> Записи и бронирования
    - do: |
        iOS: Использовать интент:
        collapsed-image](https://jing.yandex-team.ru/files/dabrynskaya/Снимок%20экрана%202022-05-24%20в%2015.19.45.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal=enabled`
    - do: Перезагрузить приложение 2 раза
    - assert: Под профилем отображается балун бронирования с надписью "Ваши записи в салоны красоты хранятся в профиле"
    - do: Тап на "профиль"
    - assert: Балун бронирования скрывается
    - do: Перезагрузить приложение несколько раз
    - assert: Балун бронирования больше не показывается

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Балун при бронировании. Скрытие:
    - info : Если аккаунта с историей записей нет, можно авторизоваться в аккаунт `yndx-vikelvar-zqqa5o` с паролем `gen8897`
    - preconditions: |
        Первый запуск приложения
        Пользователь авторизован
        У пользователя есть записи, Меню -> Записи и бронирования
    - do: |
        iOS: Использовать интент:
        collapsed-image](https://jing.yandex-team.ru/files/dabrynskaya/Снимок%20экрана%202022-05-24%20в%2015.19.45.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal=enabled`
    - do: Перезагрузить приложение 2 раза
    - assert: Под профилем отображается балун бронирования с надписью "Ваши записи в салоны красоты хранятся в профиле"
    - do: Тап на карту
    - assert: Балун бронирования скрывается

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Балун при бронировании. Смена ориентации:
    - info : Если аккаунта с историей записей нет, можно авторизоваться в аккаунт `yndx-vikelvar-zqqa5o` с паролем `gen8897`
    - preconditions: |
        Первый запуск приложения
        Пользователь авторизован
        У пользователя есть записи, Меню -> Записи и бронирования
    - do: |
        iOS: Использовать интент:
        collapsed-image](https://jing.yandex-team.ru/files/dabrynskaya/Снимок%20экрана%202022-05-24%20в%2015.19.45.png){title=QR-код}

        `yandexmaps://add_exp?bookings_personal=enabled`
        Перезагрузить приложение 2 раза
    - do: Открыть приложение
    - assert: Под профилем отображается балун бронирования с надписью "Ваши записи в салоны красоты хранятся в профиле"
    - do: Изменить ориетацию экрана на горизонтальную
    - assert: Балун бронирования отображается в горизонтальной ориентации

    - platforms:
        - android
        - ios
    - tags:
        - assessors
