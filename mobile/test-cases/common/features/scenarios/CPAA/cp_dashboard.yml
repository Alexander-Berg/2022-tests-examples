components: cp_dashboard
testing:
  - regress

specs:
  CP. Отображение дашборда на ГУ. Подключение авторизованным пользователем с подпиской плюс:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
    - do: |
        МЯК: Выключить эксперимент cpaa_no_plus (Меню -> Настройки -> дебаг-панель -> Experiments)
        Нави: Выключить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%287%29.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_cpaa_no_plus=disabled`
    - do: (МЯК) Закрыть дебаг-панель
    - do: Выгрузить приложение на телефоне
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ
    - assert: На ГУ отображается главный экран CP с приложениями девайса
    - do: Тап на иконку дашборда в системном меню слева
    - assert: |
        Отображается дашборд, разделенный на блоки
        В левой части дашборда отображается блок с картой и курсором ММП
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Отображение дашборда на ГУ. Подключение авторизованным пользователем без подписки плюс:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом без подписки Яндекс Плюс
    - do: |
        МЯК: Выключить эксперимент cpaa_no_plus (Меню -> Настройки -> дебаг-панель -> Experiments)
        Нави: Выключить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%287%29.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_cpaa_no_plus=disabled`
    - do: (МЯК) Закрыть дебаг-панель
    - do: Выгрузить приложение на телефоне
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        В левом блоке отображается информация о доступности приложения по подписке на Яндекс Плюс
        В правом блоке сверху отображается заглушка "Оформить в телефоне"
    - do: Тап на "Оформить в телефоне"
    - assert: На телефоне открылся экран интро о подписке Яндекс Плюс

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение дашборда на ГУ. Подключение неавторизованным пользователем:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь неавторизован в приложении
        Приложение не запущено на телефоне
    - do: |
        МЯК: Выключить эксперимент cpaa_no_plus (Меню -> Настройки -> дебаг-панель -> Experiments)
        Нави: Выключить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%287%29.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_cpaa_no_plus=disabled`
    - do: (МЯК) Закрыть дебаг-панель
    - do: Перезагрузить приложение
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        В левом блоке отображается информация о доступности приложения по подписке на Яндекс Плюс
        В правом блоке сверху отображается заглушка "Оформить в телефоне"
    - do: Запустить приложение на телефоне
    - do: Тап на "Оформить в телефоне" на ГУ
    - assert: На телефоне открылся экран интро о подписке Яндекс Плюс

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Переходы между заглушками на дашборде ГУ и девайсе:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Приложение на телефоне свернуто в фон
        Девайс подключен к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: Отображается дашборд, разделенный на блоки
    - do: Развернуть приложение на телефоне
    - assert: |
        Приложение развернулось
        На телефоне отображается заглушка с кнопкой "Продолжить в телефоне"
    - do: Тап "Продолжить в телефоне"
    - assert: |
        На телефоне открывается главный экран приложения
        На ГУ в левом блоке отображается заглушка, информирующая использование приложения на телефоне
        В правом верхнем блоке отображается кнопка-заглушка "Продолжить в автомобиле"
    - do: Тап "Продолжить в автомобиле"
    - assert: |
        На телефоне отображается заглушка с кнопкой "Продолжить в телефоне"
        На ГУ отображается дашборд с запущенным приложением
        Заглушка отсутствует

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Эксперимент без подписки плюса. Подключение к дашборду ГУ неавторизованным пользователем:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь неавторизован в приложении
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: |
        МЯК: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%286%29.png){title=QR-код}

        `yandexmaps://add_exp?cpaa_no_plus`
        Нави: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%289%29.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`
    - do: Перезапустить приложение
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с картой и курсором ММП
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Эксперимент без подписки плюса. Подключение к дашборду ГУ авторизованным пользователем без подписки плюс:
    - info: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом без подписки Яндекс Плюс
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: |
        МЯК: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%286%29.png){title=QR-код}

        `yandexmaps://add_exp?cpaa_no_plus`
        Нави: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%289%29.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`
    - do: Перезапустить приложение
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с картой и курсором ММП
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Эксперимент без подписки плюса. Подключение к дашборду ГУ авторизованным пользователем с подпиской плюс:
    - info: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении с подпиской Яндекс Плюс
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: |
        МЯК: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%286%29.png){title=QR-код}

        `yandexmaps://add_exp?cpaa_no_plus`
        Нави: Включить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%289%29.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`
    - do: Перезапустить приложение
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с картой и курсором ММП
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение дома и работы на дашборде ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлены адреса "Дом" и "Работа"
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с домом и работой

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Отображение дома и работы на дашборде ГУ. Exp-Off:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлены адреса "Дом" и "Работа"
    - do: |
        МЯК: Выключить эксперимент cpaa_no_plus (Меню -> Настройки -> дебаг-панель -> Experiments)
        Нави: Выключить эксперимент с помощью интента [collapsed-image](https://jing.yandex-team.ru/files/aamikhailin/YQR%20%287%29.png){title=QR-код}

            `yandexnavi://add_exp?navi_feature_cpaa_no_plus=disabled`
    - do: (МЯК) Закрыть дебаг-панель
    - do: Перезагрузить приложение
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с домом и работой

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение дома на дашборд ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлен адрес "Дом" и отсутствует адрес "Работа"
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с домом

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение работы на дашборде ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлен адрес "Работа"  и отсутствует адрес "Дом"
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с работой

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отсутствие дома и работы на дашборде ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте отсутствуют адреса "Дом" и "Работа"
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Блок с домом и работой отсутствует

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Построение маршрута до дома через дашборд на ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлены адреса Дом и Работа
        Девайс подключен к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с картой и курсором ММП
        Присутствует блок с плашкой дома
    - do: Тап по плашке дома
    - assert: |
        В блоке с картой отображается построенный маршрут до дома
        Внизу блока отображается плашка ЕТА с временем приезда до финиша и общим временем пути

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Построение маршрута до работы через дашборд на ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        На аккаунте добавлен адрес Работа и отсутствует адрес Дом
        Девайс подключен к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд
        Присутствует блок с картой и курсором ММП
        Присутствует блок с плашкой работы
    - do: Тап по палашке работы
    - assert: |
        В блоке с картой отображается построенный маршрут до работы
        Внизу блока отображается плашка ЕТА с временем приезда до финиша и общим временем пути

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Переход в приложение через системное меню, если открыт экран дашборда:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Девайс подключен к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Слева от дашборда отображается системное меню
        В системном меню отображается иконка приложения МЯК, которое открыто на дашборде
    - do: Тап по иконке приложения МЯК
    - assert: Открывается приложение МЯК в полноразмерном режиме

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение блока с маневрами на дашборде в режиме ведения по маршруту в МЯК:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Включена симуляция движения: Debug Panel -> Routes -> Demo movement
    - do: Построить любой автомаршрут на телефоне
    - do: Тап Поехали
    - assert: Отображается ведение по автомаршруту
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с картой
        Присутствует блок с маневрами о подсказках по маршруту
        В блоке с маневрами отображается:
          - правильная теущая информация о следующем маневре
          - расстояние до маневра
          - указатель маневра
          - адрес следующего маневра
          - полосность под маневром (при наличии по маршруту)
          - по мере движения данные в блоке изменяются

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  CP. Отображение блока с маневрами на дашборде в режиме ведения по маршруту в Навигаторе:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
    - do: Построить любой автомаршрут на телефоне
    - do: Тап Поехали
    - do: Запустить симуляцию ведения
    - assert: Происходит ведение по автомаршруту
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с картой
        Присутствует блок с маневрами о подсказках по маршруту
        В блоке с маневрами отображается:
          - правильная теущая информация о следующем маневре
          - расстояние до маневра
          - указатель маневра
          - адрес следующего маневра
          - полосность под маневром (при наличии по маршруту)
          - по мере движения данные в блоке изменяются

    - platforms:
        - carplay
    - testing:
        - acceptance_navi
    - tags:
        - assessors


  CP. Отображание заглушки на дашборде, если запрещен доступ к ММП:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Приложению запрещен доступ на определение ММП
        На аккаунте добавлены в закладки адреса Дом и Работа
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Отображается заглушка с информацией о настройке геопозиции в блоке с картой
        Карта не отображается
    - do: В настройках телефона дать разрешение на доступ к ММП приложению
    - assert: |
        В блоке с картой подгрузился курсор с ММП и карта
        Заглушка не отображается
        В блоке с закладками подгрузились дом и работа

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Определение ММП в блоке с картой на дашборде ГУ. Приложение на девайсе не запущены:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Приложению выдано разрешение на определение ММП
        Приложение на девайсе не запущено
        Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд с открытым приложением
        В блоке с картой отображается курсор с ММП
    - do: Запустить приложение на девайсе
    - assert: |
        Отображается заглушка "Продолжить в телефоне"
        На ГУ отображается дашборд с запущенным приложением

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  CP. Сохранение состояния открытия дашборда при повторном подключении к ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Приложению выдано разрешение на определение ММП
    - do: Построить маршрут и подтвердить его
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: Отображается дашборд с открытым приложением
    - do: Отключить девайс от ГУ
    - assert: |
        На ГУ СР с дашбордом не отображается
        Отображается стандартный экран ГУ
    - do: Подключить девайс к ГУ
    - assert: На ГУ открылся дашборд с открытым приложением

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Сохранение состояния открытия приложения при повторном подключении к ГУ:
    - info: ТК для iOS > 13.4
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении аккаунтом с подпиской Яндекс Плюс
        Приложению выдано разрешение на определение ММП
    - do: Построить маршрут и подтвердить его
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд с открытым приложением
        В блоке с картой отображается курсор с ММП
    - do: Тап по иконке приложения МЯК в системном меню слева от дашборда
    - assert: |
        Дашборд закрылся
        Открылосось приложение МЯК в полноразмерном режиме
    - do: Отключить девайс от ГУ
    - assert: |
        СР не отображается на ГУ
        Отображается стандартный экран ГУ
    - do: Подключить девайс к ГУ
    - assert: |
        На ГУ открылся СР с приложением в полноразмерном режиме
        Дашборд не отображается

    - platforms:
        - carplay
    - tags:
        - assessors


  CP. Отображение блока с картой на дашборде в режиме ведения по маршруту:
    - preconditions: |
        - ТК для iOS > 13.4
        - Пользователь прошел все интроскрины приложения
        - Авторизоваться аккаунтом с подпиской Я.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
        - Включена симуляция движения: Debug Panel -> Routes -> Demo movement
    - do: |
        - Построить автомаршрут на телефоне
        - Тап Поехали
    - assert: Отображается ведение по автомаршруту
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить СР на ГУ с дашбордом
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с маневрами о подсказках по маршруту
        Присутствует блок с картой
        В блоке с картой:
          - отображается экран в режиме ведения по маршруту
          - на карте отображаются ДС и линия маршрута окрашена
          - сверху блока отображается спидлимит и текущая скорость
          - внизу отображается плашка ЕТА
          - плашка ETA отображает текущую информацию по маршруту: время ожидаемого приезда и время движения в пути
          - время ожидаемого приезда и время в пути совпадают
          - плашка ЕТА не перекрывает курсор

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  CP. Запуск дашборда после открытия приложения:
    - preconditions: |
        - ТК для iOS > 13.4
        - Пользователь прошел все интроскрины приложения
        - Авторизоваться аккаунтом с подпиской Я.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
    - do: Подключить телефон к ГУ (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить тестируемое приложение
    - do: |
        Выйти в меню СР
        Тап на иконку дашборда в системном меню слева
    - assert: |
        Отображается дашборд, разделенный на блоки
        Присутствует блок с иконками дом/работа (при наличии)
        Присутствует блок с картой

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
    - tags:
        - assessors