components: cpaa_access
testing:
  - regress

specs:
  CP/AA. Ограничение на другие страны:
    - info: |
        - Пользователь прошел все интроскрины
    - do: |
        - Авторизоваться аккаунтом с подпиской Я.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
        - Девайс подключить к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ )
        - Пользователь находится В России
    - do: Запустить приложение на ГУ/Симуляторе
    - assert: Приложение успешно запускается
    - do: |
        - Отсоединить телефон от ГУ/Симуляторе
        - Закрыть приложение
        - Поменить местоположение на Турцию
        - Подключить телефон к ГУ/Симуляторе
        - Запустить приложение
    - assert: Приложение на ГУ/Симуляторе запускается, отображается карта
    - do: |
        - Отсоединить телефон от ГУ/Симуляторе
        - Закрыть приложение
        - Поменить местоположение на Россию
        - Подключить телефон к ГУ/Симуляторе
        - Запустить приложение
    - assert: Приложение на ГУ/Симуляторе запускается, отображается карта

    - platforms:
        - carplay
        - android_auto
    - tags:
        - assessors
    - testing:
        - acceptance_maps
        - acceptance_navi


  CP/AA. Лок-скрин при подключении к ГУ с выгруженным приложением. Пользователь не авторизован:
    - info: |
        - Пользователь не авторизован в приложении
    - do: Выгрузить приложение
    - do: Подключить девайс к ГУ/Симулятору
    - assert: На ГУ/Симуляторе отображается лок-скрин уведомляющий о том, что необходимо оформить подписку Плюс.
    - do: Тап "Продолжить в телефоне"
    - assert: |
        На ГУ/Симуляторе продолжает отображаться лок-скрин уведомляющий о том, что необходимо оформить подписку Плюс.
        На телефоне открывается вебвью плюса

    - platforms:
        - carplay
        - android_auto
    - tags:
        - assessors
    - testing:
        - acceptance_maps
        - acceptance_navi


  CP/AA. Лок-скрин при подключении к ГУ с выгруженным приложением. Пользователь авторизован аккаунтом без подписки на плюс:
    - do: |
        - Пользователь авторизован в приложении аккаунтом без подписки Плюс
        - Выгрузить приложение
    - do: Подключить девайс к ГУ/Симулятору
    - assert: На ГУ/Симуляторе отображается лок-скрин уведомляющий о том, что необходимо оформить подписку Плюс.
    - do: Тап "Продолжить в телефоне"
    - assert: |
        На ГУ/Симуляторе продолжает отображаться лок-скрин уведомляющий о том, что необходимо оформить подписку Плюс.
        На телефоне открывается вебвью плюса

    - platforms:
        - carplay
        - android_auto
    - tags:
        - assessors
    - testing:
        - acceptance_maps
        - acceptance_navi


  CP/AA. Подключение к ГУ при отсутствии интернета. Пользователь авторизован аккаунтом без подписки на плюс:
    - do: |
        Авторизоваться в приложении аккаунтом без подписки Плюс
        Отключить интернет или включить авиа-режим
    - do: Подключить девайс к ГУ/Симулятору
    - assert: На ГУ/Симуляторе отображается лок-скрин уведомляющий о том, что необходимо оформить подписку Плюс
    - do: Тап "Продолжить в телефоне"
    - assert: |
        На ГУ/Симуляторе открывается главный экран
        На телефоне открывается интро СР/AA

    - platforms:
        - carplay
        - android_auto
    - tags:
        - assessors
    - testing:
        - acceptance_maps
        - acceptance_navi


  CP/AA. Эксперимент без подписки плюса. Подключение неавторизованным пользователем:
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь неавторизован в приложении
    - do: |
        Включить эксперименты:
        МЯК:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.487c004.png){title=Скриншот}

        `yandexmaps://add_exp?cpaa_no_plus=enabled`
        Навигатор:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.2218821.png){title=Скриншот}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`

        Перезапустить приложение
    - do: |
        Подключить телефон к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
        Запустить приложение на ГУ/Симуляторе
    - assert: |
        На ГУ/Симуляторе открылся главный экран приложения
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует
    - do: Запустить приложение на девайсе
    - do: Тап "Продолжить в телефоне" на девайсе
    - assert: |
        На девайсе отображается главный экран приложения
        (СР) На ГУ отображается заглушка с кнопкой "Продолжить в автомобиле"
        (АА) На ГУ/Симуляторе приложение сворачивается в фон
    - do: |
        (CP) Тап на "Продолжить в автомобиле" на ГУ
        (AA) Открыть приложение на ГУ/Симуляторе
    - assert: |
        На девайсе отображается заглушка с кнопкой "Продолжить в телефоне"
        На ГУ/Симуляторе отображается главный экран приложения

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  CP/AA. Эксперимент без подписки плюса. Подключение авторизованным пользователем без подписки плюс:
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении без подписки Яндекс Плюс
    - do: |
        Включить эксперименты:
        МЯК:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.487c004.png){title=Скриншот}

        `yandexmaps://add_exp?cpaa_no_plus=enabled`
        Навигатор:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.2218821.png){title=Скриншот}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`

        Перезапустить приложение
    - do: Подключить телефон к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить приложение на ГУ/Симуляторе
    - assert: |
        На ГУ/Симуляторе открылся главный экран приложения
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует
    - do: Запустить приложение на девайсе
    - do: Тап "Продолжить в телефоне" на девайсе
    - assert: |
        На девайсе отображается главный экран приложения
        (СР) На ГУ отображается заглушка с кнопкой "Продолжить в автомобиле"
        (АА) На ГУ/Симуляторе приложение сворачивается в фон
    - do: |
        (CP) Тап "Продолжить в автомобиле" на ГУ/Симуляторе
        (AA) Открыть приложение на ГУ/Симуляторе
    - assert: |
        На девайсе отображается заглушка с кнопкой "Продолжить в телефоне"
        На ГУ/Симуляторе отображается главный экран приложения

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  CP/AA. Эксперимент без подписки плюса. Подключение авторизованным пользователем с подпиской плюс:
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении с подпиской Яндекс Плюс
    - do: |
        Включить эксперименты:
        МЯК:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.487c004.png){title=Скриншот}

        `yandexmaps://add_exp?cpaa_no_plus=enabled`
        Навигатор:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.2218821.png){title=Скриншот}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`

        Перезапустить приложение
    - do: Подключить телефон к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - do: Запустить приложение на ГУ/Симуляторе
    - assert: На ГУ/Симуляторе открылся главный экран приложения
    - do: Запустить приложение на девайсе
    - do: Тап на "Продолжить в телефоне" на девайсе
    - assert: |
        На девайсе отображается главный экран приложения
        (СР) На ГУ отображается заглушка с кнопкой "Продолжить в автомобиле"
        (АА) На ГУ/Симуляторе приложение сворачивается в фон
    - do: |
        (CP) Тап на "Продолжить в автомобиле" на ГУ/Симуляторе
        (AA) Открыть приложение на ГУ/Симуляторе
    - assert: |
        На девайсе отображается заглушка с кнопкой "Продолжить в телефоне"
        На ГУ/Симуляторе отображается главный экран приложения

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  CP/AA. Эксперимент без подписки плюса. Подключение без подписки плюс в режиме ведения по маршруту:
    - preconditions: |
        Пользователь прошел все интроскрины приложения
        Пользователь авторизован в приложении без подписки Яндекс Плюс
    - do: |
        Включить эксперименты:
        МЯК:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.487c004.png){title=Скриншот}

        `yandexmaps://add_exp?cpaa_no_plus=enabled`
        Навигатор:
        [collapsed-image](https://jing.yandex-team.ru/files/fedonina71/download.2218821.png){title=Скриншот}

        `yandexnavi://add_exp?navi_feature_cpaa_no_plus=enabled`

        Перезапустить приложение
    - do: |
        Построить маршрут на телефоне
        Тап "Поехали"
    - do: Подключить телефон к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ)
    - assert: |
        На ГУ/Симуляторе открылось приложение с построенным маршрутом
        Фуллскрин экран, информирующий об отсутствии подписки на плюс, отсутствует
        На девайсе в приложении отображается заглушка "Продолжить в телефоне"

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
    - tags:
        - assessors


  AndroidAuto. Запрет пермишена на получение геолокации:
    - info: |
        - На устройстве запущено приложение
        - В приложении выполнена авторизация аккаунтом с подпиской Яндекс.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
        - В настройках устройства для приложения отключен доступ к геолокации
        - Девайс подключен к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ )
        - На ГУ/Симуляторе открыт главный экран АА
    - do: На ГУ/Симуляторе запустить приложение
    - assert: Показана фуллскрин ошибка геолокации
    - do: Тап по кнопке в фулскрин ошибке
    - assert: |
        - На ГУ/Симуляторе ошибка не скрылась
        - На телефоне открылся поп-ап с выбором разрешения пермишина геолокации
    - do: В появившемся окне на телефоне выбрать запрет на получение геолокации
    - assert: |
        - На ГУ/Симуляторе фуллскрин ошибка не закрылась
        - На девайсе поп-ап с запросом пермишинов скрылся
    - do: На ГУ тап по кнопке в фулскрин ошибке
    - assert: |
        - На ГУ/Симуляторе ошибка не скрылась
        - На телефоне, если не был выбран вариант "Запретить и больше не показывать", появится поп-ап с выбором резрешений пермишина геолокации
    - do: Разрешить доступ к геолокации тапнув "Разрешить". Если был выбран вариант "Запретить и больше не показывать" - разрешить доступ к геолокации через настройки телефона
    - assert: |
        - На ГУ/Симуляторе ошибка скрылась

    - platforms:
        - android_auto
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors


  Carplay. Запрет пермишена на получение геолокации:
    - info: |
        - На устройстве запущено приложение
        - В приложении выполнена авторизация аккаунтом с подпиской Яндекс.Плюс. Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus)
        - В настройках устройства для приложения отключен доступ к геолокации
        - Девайс подключен к ГУ/Симулятору (Bluetooth + USB) (включить Bluetooth -> соединить телефон по bluetooth с ГУ )
        - На ГУ/Симуляторе открыт главный экран приложения
    - do: На ГУ/Симуляторе запустить приложение
    - assert: Показана фуллскрин ошибка геолокации
    - do: Тап по кнопке в фулскрин ошибке
    - assert: |
        - На ГУ/Симуляторе ошибка не скрылась
        - На телефоне открылся поп-ап с выбором разрешения пермишина геолокации
    - do: В появившемся окне на телефоне выбрать запрет на получение геолокации
    - assert: |
        - На ГУ/Симуляторе фуллскрин ошибка не закрылась
        - Поп-ап на телефоне скрывается
    - do: На ГУ тап по кнопке в фулскрин ошибке
    - assert: |
        - На ГУ/Симуляторе ошибка не скрылась
        - На телефоне открылся поп-ап с выбором разрешения
    - do: |
        - Разрешить доступ к геолокации тапнув "Настройки"
        - Разрешить доступ к геолокации через настройки телефона
    - assert: |
        - На ГУ/Симуляторе ошибка скрылась

    - platforms:
        - carplay
    - testing:
        - acceptance_maps
        - acceptance_navi
    - tags:
        - assessors