components: cpaa_foreground
testing:
  - regress

specs:
  CP/AA. Нотификации о маневрах в фоне на ГУ:
    - info: |
        - Условие показа нотификации iOS 14+ (на iOS ниже нотификации не показываются)
        - Устройство подключено к ГУ по Bluetooth (не для симулятора)
        - На устройстве запущено приложение
        - В приложении выполнить авторизацию аккаунтом с подпиской Яндекс.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
    - do: |
        - На устройстве включить симуляцию движения
        - Построить маршрут
        - Тап Поехали
    - do: |
        - Подключить устройство к ГУ с помощью USB-кабеля (не для симулятора)
        - Подключить устройство к Симулятору
    - assert: Открыт экран ведения по маршруту
    - do: Перейти в главное меню ГУ/Симуляторе
    - assert: |
        Приложение свернулось
        Открыта стартовая страница ГУ/Симулятора
        На ГУ/Симуляторе появляются нотификации о маневрах
    - do: На телефоне свернуть приложение
    - assert: На ГУ/Симуляторе появляются нотификации о маневрах

    - platforms:
        - carplay
        - android_auto
    - tags:
        - assessors
    - integration_run:
        - mapkit


  CP/AA. Аннотации приложения в фоне при сворачиивании на телефоне:
    - do: |
        - Устройство подключено к ГУ по Bluetooth
        - На устройстве запущено приложение
        - В приложении выполнена авторизация аккаунтом с подпиской Яндекс.Плюс (Если аккаунта нет - читай в [ПРИВЕТСТВЕННОЙ СТРАНИЦЕ](https://wiki.yandex-team.ru/eva/testing/projects/navigator/#kakproxodittest-kejjsytrebujushhienalichiepodpiskijandeks.pljus) выше)
    - do: |
        - Построить маршрут
        - Тап Поехали
        - На устройстве включить симуляцию движения
    - do: Подключить устройство к ГУ с помощью USB-кабеля
    - assert: |
        На ГУ открыт экран ведения по маршруту
        На ГУ воспроизводятся голосовые аннотации о маневрах и ДС
    - do: На телефоне свернуть приложение
    - assert: На ГУ воспроизводятся голосовые аннотации о маневрах и ДС

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
        - acceptance_navi
    - integration_run:
        - mapkit


  CP/AA. Ведение при выключенной настройке "Фоновое ведение" и сворачивании приложения на устройстве:
    - preconditions: |
        На устройстве запущено приложение
        Пользователь авторизован аккаунтом с подпиской Я.Плюс
        iOS: На устройстве включена симуляция движения
        Android: На устройстве включена симуляция движения через Mock Locations
    - do: |
        Фоновое ведение в приложении отключено: Настройки -> Маршруты -> Фоновое ведение -> Выкл
    - do: |
        На телефоне построить маршрут
        Тап Поехали
    - do: Подключить девайс к ГУ с помощью USB-кабеля или Bluetooth
    - assert: |
        Приложение запустилось на ГУ
        В приложении происходит ведение по маршруту
        На устройстве отображается заглушка с кнопкой "Продолжить в телефоне"
    - do: На устройстве свернуть приложение
    - assert: |
        На ГУ открыт экран ведения по маршруту
        Ведение продолжается
    - do: На устройстве запустить другое приложение
    - assert: |
        На ГУ открыт экран ведения по маршруту
        Ведение продолжается
    - do: Заблокровать экран устройства
    - assert: |
        На ГУ открыт экран ведения по маршруту
        Ведение продолжается
    - do: Разблокровать экран устройства
    - do: Развернуть тестируемое приложение
    - assert: |
        На устройстве отображается заглушка с кнопкой "Продолжить в телефоне"
        На ГУ открыт экран ведения по маршруту
        Ведение продолжается

    - platforms:
        - carplay
        - android_auto
    - testing:
        - acceptance_maps
    - integration_run:
        - mapkit