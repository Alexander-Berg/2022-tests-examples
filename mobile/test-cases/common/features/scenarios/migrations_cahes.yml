components: migrations
testing:
  - regress

aliases:
  - &enable_exp_in_navi
    - info: |
        На девайсе установлены навигатор и карты
        Приложения выгружены из памяти
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/navi.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_migration_offline_caches=enabled`
    - do: Перезапустить приложение
    - do: Скачать одни офлайн-карты не текущего региона(Меню -> Загрузка карт)
    - do: Перезапустить приложение

  - &enable_exp_and_reset_intro_in_navi
    - do: Запустить карты
    - do: Удалить скаченные кеши(Меню -> Настройки -> Офлайн карты -> Удалить загруженные карты)
    - do: В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - assert: Отображается интро-штора "Тот самый Навигатор теперь в Картах"


specs:
  Отображение предложения скачать один кеш из навигатора:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш
        Предлагается скачать кеш города/региона, который был скачен в Навигаторе
        Отображается 2 кнопки: "Не сейчас" и "Загрузить"
    - do: Сменить ориентацию девайса на противоположную
    - assert: |
        Предложение скачать кеш отображается в противоположной ориентации
        Предлагается скачать кеш города/региона, который был скачен в Навигаторе
        Отображается 2 кнопки: "Не сейчас" и "Загрузить"

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Один кеш. Взаимодействие с кнопкой "Загрузить" в интро:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать один кеш из Навигатора
    - do: Тап "Загрузить"
    - assert: Предложение скачать кеш закрылось
    - do: Тап Меню -> Загрузка карт
    - assert: |
        Открыт экран офлайн карт
        Кеш из Навигатора отображается в секции "Загруженные"
        Кеш скачан или в процессе скачивания

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_navi
        - acceptance_maps


  Один кеш. Взаимодействие с кнопкой "Не сейчас" в интро:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать один кеш из Навигатора
    - do: Тап "Загрузить"
    - assert: Предложение скачать кеш закрылось
    - do: Тап Меню -> Загрузка карт
    - assert: |
        Открыт экран офлайн карт
        Кеш из Навигатора отображается в секции "Добавлено в Навигаторе"

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Отображение предложения скачать два и более кешей из навигатора:
    - info: |
        На девайсе установлены навигатор и карты
        Приложения выгружены из памяти
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/navi.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_migration_offline_caches=enabled`
    - do: Перезапустить приложение
    - do: Скачать две офлайн-карты не текущего региона(Меню -> Загрузка карт)
    - do: Перезапустить приложение
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеши
        Предлагается скачать кеши, которые были скачены в Навигаторе
        Отображается 2 кнопки: "К списку карт" и "Не сейчас"
    - do: Сменить ориентацию девайса на противоположную
    - assert: |
        Предложение скачать кеши отображается в противоположной ориентации
        Предлагается скачать кеши, которые были скачены в Навигаторе
        Отображается 2 кнопки: "К списку карт" и "Не сейчас"

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Два и более кешей. Взаимодействие с кнопкой "К списку карт" в интро:
    - info: |
        На девайсе установлены навигатор и карты
        Приложения выгружены из памяти
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/navi.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_migration_offline_caches=enabled`
    - do: Перезапустить приложение
    - do: Скачать две офлайн-карты не текущего региона(Меню -> Загрузка карт)
    - do: Перезапустить приложение
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеши из Навигатора
    - do: Тап "К списку карт"
    - assert: |
        Предложение скачать кеш закрылось
        Открывается экран офлайн карт
        Кеши из Навигатора отображается в секции "Добавлено в Навигаторе"

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_navi
        - acceptance_maps


  Два и более кешей. Взаимодействие с кнопкой "Не сейчас" в интро:
    - info: |
        На девайсе установлены навигатор и карты
        Приложения выгружены из памяти
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/navi.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_migration_offline_caches=enabled`
    - do: Перезапустить приложение
    - do: Скачать две офлайн-карты не текущего региона(Меню -> Загрузка карт)
    - do: Перезапустить приложение
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеши из Навигатора
    - do: Тап "Не сейчас"
    - assert: |
        Предложение скачать кеш закрылось
        Отображается главный экран карты

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Приоритет интро миграции кешей над интро текущего региона:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш из Навигатора
    - do: Перезапустить приложение
    - assert: |
        Не отображается предложение скачать кеш из Навигатора

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_maps


  Отображение интро миграции кешей один раз на установку:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш из Навигатора
    - do: Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: Перезапустить приложение 4 раза
    - assert: |
        На четвертый перезапуск показывается предложение скачать кеш, центр которого ближе всего к местоположению

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Показ интро миграции при обновлении, если интро текущего региона было просмотрено:
    - *enable_exp_in_navi
    - do: Запустить карты
    - do: Удалить скаченные кеши(Меню -> Настройки -> Офлайн карты -> Удалить загруженные карты)
    - do: В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
    - do: Выключить эксперимент `migration_offline_caches` (Меню -> Настройки -> Debug-Panel - Experiments)
    - do: Перезапустить приложение
    - assert: Отображается интро-штора "Тот самый Навигатор теперь в Картах"
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш, центр которого ближе всего к местоположению
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - assert: |
        Не отображается предложение скачать кеш из Навигатора
    - do: Debug Panel-> Startup Screens and Hints - Intro thinks application is updating
    - do: Перезапустить приложение 4 раза
    - assert: |
        На четвертый перезапуск показывается предложение скачать кеш из Навигатора

    - platforms:
        - android
        - ios
    - tags:
        - assessors
    - testing:
        - acceptance_navi
        - acceptance_maps


  Отсутствие интро миграции. Мобильный интернет:
    - *enable_exp_in_navi
    - *enable_exp_and_reset_intro_in_navi
    - do: На девайсе отключить Wi-Fi и включить мобильный интернет
    - do: Перезапустить приложение
    - assert: |
        Не отображается предложение скачать кеш из Навигатора
    - do: На девайсе включить Wi-Fi
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш из Навигатора

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Отсутствие интро миграции, если кеш был скачан в картах:
    - *enable_exp_in_navi
    - do: Запустить карты
    - do: Скачать такой же кеш(Меню -> Настройки -> Офлайн карты)
    - do: В дебаг панели в Startup Screens and Hints тап на Clear shown intro screens
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - assert: Отображается интро-штора "Тот самый Навигатор теперь в Картах"
    - do: Перезапустить приложение
    - assert: |
        Отображается предложение скачать кеш, центр которого ближе всего к местоположению

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Обновление секции "Добавлено в навигаторе", если в Навигаторе скачали еще кеши:
    - *enable_exp_in_navi
    - do: Запустить карты
    - do: Удалить скаченные кеши(Меню -> Настройки -> Офлайн карты -> Удалить загруженные карты)
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        Открывается экран офлайн карт
        Отображается один кеш в секции "Добавлено в Навигаторе"
    - do: Открыть Навигатор
    - do: Скачать еще один кеш (Меню -> Загрузка карт)
    - do: Перезапустить приложение
    - do: Открыть Карты
    - do: Перезапустить приложение
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        Открывается экран офлайн карт
        Отображается два кеша в секции "Добавлено в Навигаторе"

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Обновление секции "Добавлено в навигаторе", если в Навигаторе удалили все кеши:
    - *enable_exp_in_navi
    - do: Запустить карты
    - do: Удалить скаченные кеши(Меню -> Настройки -> Офлайн карты -> Удалить загруженные карты)
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        Открывается экран офлайн карт
        Отображается один кеш в секции "Добавлено в Навигаторе"
    - do: Открыть Навигатор
    - do: Удалить кеши( Меню -> Настройки -> Сохраненные данные -> Стереть карты)
    - do: Перезапустить приложение
    - do: Открыть Карты
    - do: Перезапустить приложение
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        Открывается экран офлайн карт
        Секция "Добавлено в Навигаторе" отсутствует

    - platforms:
        - android
        - ios
    - tags:
        - assessors


  Пересечение секций "Добавлено в навигаторе" и "Близжайший регион":
    - info: |
        На девайсе установлены навигатор и карты
        Приложения выгружены из памяти
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/navi.png){title=QR-код}

        `yandexnavi://add_exp?navi_feature_migration_offline_caches=enabled`
    - do: Перезапустить приложение
    - do: Скачать одни офлайн-карты текущего региона(Меню -> Загрузка карт)
    - do: Перезапустить приложение
    - do: Запустить карты
    - do: Удалить скаченные кеши(Меню -> Настройки -> Офлайн карты -> Удалить загруженные карты)
    - do: |
        Использовать интент [collapsed-image](https://jing.yandex-team.ru/files/kuznetsova22/maps.png){title=QR-код}

        `yandexmaps://add_exp?migration_offline_caches`
    - do: Перезапустить приложение
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        Открывается экран офлайн карт
        Секция "Добавлено в Навигаторе" отсутствует
    - do: |
        Подменить местоположение на город
        Android:с помощью приложения Mock Locations
        iOS: через дебаг панель Routes > Enter your route
    - do: Открыть экран Офлайн карт (Меню -> Настройки -> Офлайн карты)
    - assert: |
        В секции "Рядом с вами" отображается другой город
        В секции "Добавлено в Навигаторе" отображается кеш скаченный в Навигаторе

    - platforms:
        - android
        - ios
    - tags:
        - assessors
