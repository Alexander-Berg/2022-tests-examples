// <<< AUTOGENERATED BY YANDEX.SCRIPT FROM mail/actions/messages-list/group-mode-actions.ts >>>

package com.yandex.xplat.testopithecus

import com.yandex.xplat.common.*
import com.yandex.xplat.eventus.common.*
import com.yandex.xplat.eventus.*
import com.yandex.xplat.mapi.*
import com.yandex.xplat.testopithecus.common.*

public abstract class BaseGroupModeAction(private var type: MBTActionType): MBTAction {
    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures) && ContainerGetterFeature.`get`.included(modelFeatures))
    }

    open override fun canBePerformed(model: App): Boolean {
        val groupModeModel = GroupModeFeature.`get`.forceCast(model)
        val messageListModel = MessageListDisplayFeature.`get`.forceCast(model)
        val containersModel = ContainerGetterFeature.`get`.forceCast(model)
        val messages = messageListModel.getMessageList(10)
        val selectedMessageOrders = groupModeModel.getSelectedMessages()
        if (selectedMessageOrders == null) {
            return false
        }
        val selectedMessages: YSArray<MessageView> = mutableListOf()
        for (order in selectedMessageOrders.values()) {
            selectedMessages.add(messages[order])
        }
        val currentContainer = containersModel.getCurrentContainer()
        if (currentContainer.type != MessageContainerType.folder) {
            return false
        }
        return this.canBePerformedImpl(selectedMessages, selectedMessageOrders, requireNonNull(currentContainer.name, "Мы не находимся в папке"))
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        this.performImpl(GroupModeFeature.`get`.forceCast(model))
        this.performImpl(GroupModeFeature.`get`.forceCast(application))
        return MaillistComponent()
    }

    open override fun getActionType(): MBTActionType {
        return this.type
    }

    abstract fun canBePerformedImpl(messages: YSArray<MessageView>, selectedOrders: YSSet<Int>, currentFolder: FolderName): Boolean
    abstract fun performImpl(modelOrApplication: GroupMode): Unit
    abstract override fun events(): YSArray<EventusEvent>
    abstract override fun tostring(): String
}

public abstract class BaseMarkSelectedMessages(private var type: MBTActionType): MBTAction {
    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun canBePerformed(model: App): Boolean {
        val messageListModel = MessageListDisplayFeature.`get`.forceCast(model)
        val groupModeModel = GroupModeFeature.`get`.forceCast(model)
        val selectedMessageOrders = groupModeModel.getSelectedMessages()
        if (selectedMessageOrders == null) {
            return false
        }
        val messages = messageListModel.getMessageList(10)
        val unreadCount = filterByOrders(messages, selectedMessageOrders).filter( {
            message ->
            !message.read
        }).size
        return this.canBePerformedImpl(unreadCount)
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        this.performImpl(GroupModeFeature.`get`.forceCast(model))
        this.performImpl(GroupModeFeature.`get`.forceCast(application))
        return MaillistComponent()
    }

    open override fun tostring(): String {
        return this.getActionType()
    }

    open override fun getActionType(): MBTActionType {
        return this.type
    }

    abstract override fun events(): YSArray<EventusEvent>
    abstract fun canBePerformedImpl(selectedUnreadCount: Int): Boolean
    abstract fun performImpl(modelOrApplication: GroupMode): Unit
}

public open class GroupModeInitialSelectAction(private var order: Int): BaseSimpleAction<GroupMode, MaillistComponent>(GroupModeSelectAction.type) {
    open override fun requiredFeature(): Feature<GroupMode> {
        return GroupModeFeature.`get`
    }

    open override fun canBePerformedImpl(model: GroupMode): Boolean {
        val isInGroupMode = model.isInGroupMode()
        return !isInGroupMode
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.selectMessage(this.order, int64(-1)))
    }

    open override fun performImpl(modelOrApplication: GroupMode, _currentComponent: MaillistComponent): MBTComponent {
        modelOrApplication.initialMessageSelect(this.order)
        return GroupOperationsComponent()
    }

    open override fun tostring(): String {
        return "${GroupModeInitialSelectAction.type}(${this.order})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeInitialSelectAction"
    }
}

public open class GroupModeSelectAction(private var order: Int): BaseSimpleAction<GroupMode, GroupOperationsComponent>(GroupModeSelectAction.type) {
    open override fun requiredFeature(): Feature<GroupMode> {
        return GroupModeFeature.`get`
    }

    open override fun canBePerformedImpl(model: GroupMode): Boolean {
        return model.isInGroupMode()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.selectMessage(this.order, int64(-1)))
    }

    open override fun performImpl(modelOrApplication: GroupMode, _currentComponent: GroupOperationsComponent): MBTComponent {
        modelOrApplication.selectMessage(this.order)
        return GroupOperationsComponent()
    }

    open override fun tostring(): String {
        return "${GroupModeSelectAction.type}(${this.order})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeSelectAction"
    }
}

public open class GroupModeSelectAllAction(): BaseSimpleAction<GroupMode, GroupOperationsComponent>(GroupModeSelectAllAction.type) {
    open override fun requiredFeature(): Feature<GroupMode> {
        return GroupModeFeature.`get`
    }

    open override fun canBePerformedImpl(model: GroupMode): Boolean {
        return model.isInGroupMode()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun performImpl(modelOrApplication: GroupMode, _currentComponent: GroupOperationsComponent): MBTComponent {
        modelOrApplication.selectAllMessages()
        return GroupOperationsComponent()
    }

    open override fun tostring(): String {
        return "${GroupModeSelectAllAction.type}"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeSelectAllAction"
    }
}

public open class GroupModeMarkAsReadAction(): BaseMarkSelectedMessages(GroupModeMarkAsReadAction.type) {
    open override fun canBePerformedImpl(selectedUnreadCount: Int): Boolean {
        return selectedUnreadCount > 0
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsRead()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.markAsReadSelectedMessages())
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkAsUnreadAction"
    }
}

public open class GroupModeMarkAsUnreadAction(): BaseMarkSelectedMessages(GroupModeMarkAsUnreadAction.type) {
    open override fun canBePerformedImpl(selectedUnreadCount: Int): Boolean {
        return selectedUnreadCount == 0
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsUnread()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.markAsUnreadSelectedMessages())
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkAsUnreadAction"
    }
}

public open class GroupModeDeleteAction: MBTAction {
    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun canBePerformed(_model: App): Boolean {
        return true
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        GroupModeFeature.`get`.forceCast(model).delete()
        GroupModeFeature.`get`.forceCast(application).delete()
        return MaillistComponent()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.deleteSelectedMessages())
    }

    open override fun tostring(): String {
        return this.getActionType()
    }

    open override fun getActionType(): MBTActionType {
        return GroupModeDeleteAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeDeleteAction"
    }
}

public open class GroupModeArchiveAction: MBTAction {
    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun canBePerformed(model: App): Boolean {
        return ContainerGetterFeature.`get`.castIfSupported(model)!!.getCurrentContainer().name != DefaultFolderName.archive
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        GroupModeFeature.`get`.forceCast(model).archive()
        GroupModeFeature.`get`.forceCast(application).archive()
        return MaillistComponent()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun tostring(): String {
        return this.getActionType()
    }

    open override fun getActionType(): MBTActionType {
        return GroupModeArchiveAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeArchiveAction"
    }
}

public open class GroupModeMarkImportantAction(): BaseGroupModeAction(GroupModeMarkImportantAction.type) {
    open override fun canBePerformedImpl(messages: YSArray<MessageView>, _selectedOrders: YSSet<Int>, _currentFolder: FolderName): Boolean {
        return messages.map( {
            m ->
            !m.important
        }).contains(true)
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsImportant()
    }

    open override fun tostring(): String {
        return GroupModeMarkImportantAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkImportantAction"
    }
}

public open class GroupModeMarkUnimportantAction(): BaseGroupModeAction(GroupModeMarkUnimportantAction.type) {
    open override fun canBePerformedImpl(messages: YSArray<MessageView>, _selectedOrders: YSSet<Int>, _currentFolder: FolderName): Boolean {
        return messages.map( {
            m ->
            !m.important
        }).contains(false)
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsUnimportant()
    }

    open override fun tostring(): String {
        return GroupModeMarkUnimportantAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkUnimportantAction"
    }
}

public open class GroupModeMarkSpamAction(): BaseGroupModeAction(GroupModeMarkSpamAction.type) {
    open override fun canBePerformedImpl(messages: YSArray<MessageView>, selectedOrders: YSSet<Int>, currentFolder: FolderName): Boolean {
        return currentFolder != DefaultFolderName.spam
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsSpam()
    }

    open override fun tostring(): String {
        return GroupModeMarkSpamAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkSpamAction"
    }
}

public open class GroupModeMarkNotSpamAction(): BaseGroupModeAction(GroupModeMarkNotSpamAction.type) {
    open override fun canBePerformedImpl(messages: YSArray<MessageView>, selectedOrders: YSSet<Int>, currentFolder: FolderName): Boolean {
        return currentFolder == DefaultFolderName.spam
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.markAsNotSpam()
    }

    open override fun tostring(): String {
        return GroupModeMarkNotSpamAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMarkNotSpamAction"
    }
}

public open class GroupModeMoveToFolderAction(private var folderName: FolderName): MBTAction {
    open override fun canBePerformed(model: App): Boolean {
        val currentContainer = ContainerGetterFeature.`get`.castIfSupported(model)!!.getCurrentContainer()
        return currentContainer.type == MessageContainerType.folder && currentContainer.name != this.folderName
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun getActionType(): String {
        return GroupModeMoveToFolderAction.type
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        GroupModeFeature.`get`.forceCast(model).openMoveToFolderScreen()
        GroupModeFeature.`get`.forceCast(application).openMoveToFolderScreen()
        MoveToFolderFeature.`get`.forceCast(model).tapOnFolder(this.folderName)
        MoveToFolderFeature.`get`.forceCast(application).tapOnFolder(this.folderName)
        return MaillistComponent()
    }

    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun tostring(): String {
        return "${GroupModeMoveToFolderAction.type}(${this.folderName})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeMoveToFolderAction"
    }
}

public open class GroupModeApplyLabelsAction(private var labelNames: YSArray<LabelName>): MBTAction {
    open override fun canBePerformed(model: App): Boolean {
        return !mutableListOf(DefaultFolderName.spam, DefaultFolderName.trash).contains(ContainerGetterFeature.`get`.castIfSupported(model)!!.getCurrentContainer().name)
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun getActionType(): String {
        return GroupModeApplyLabelsAction.type
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        GroupModeFeature.`get`.forceCast(model).openApplyLabelsScreen()
        GroupModeFeature.`get`.forceCast(application).openApplyLabelsScreen()
        val modelApplyLabel = ApplyLabelFeature.`get`.forceCast(model)
        val appApplyLabel = ApplyLabelFeature.`get`.forceCast(application)
        modelApplyLabel.selectLabelsToAdd(this.labelNames)
        appApplyLabel.selectLabelsToAdd(this.labelNames)
        modelApplyLabel.tapOnDoneButton()
        appApplyLabel.tapOnDoneButton()
        return MaillistComponent()
    }

    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures) && ApplyLabelFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun tostring(): String {
        return "${GroupModeApplyLabelsAction.type}(${this.labelNames})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeApplyLabelsAction"
    }
}

public open class GroupModeRemoveLabelsAction(private var labelNames: YSArray<LabelName>): MBTAction {
    open override fun canBePerformed(model: App): Boolean {
        return !mutableListOf(DefaultFolderName.spam, DefaultFolderName.trash).contains(ContainerGetterFeature.`get`.forceCast(model).getCurrentContainer().name)
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun getActionType(): String {
        return GroupModeRemoveLabelsAction.type
    }

    open override fun perform(model: App, application: App, _history: MBTHistory): MBTComponent {
        GroupModeFeature.`get`.forceCast(model).openApplyLabelsScreen()
        GroupModeFeature.`get`.forceCast(application).openApplyLabelsScreen()
        val modelApplyLabel = ApplyLabelFeature.`get`.forceCast(model)
        val appApplyLabel = ApplyLabelFeature.`get`.forceCast(application)
        modelApplyLabel.deselectLabelsToRemove(this.labelNames)
        appApplyLabel.deselectLabelsToRemove(this.labelNames)
        modelApplyLabel.tapOnDoneButton()
        appApplyLabel.tapOnDoneButton()
        return MaillistComponent()
    }

    open override fun supported(modelFeatures: YSArray<FeatureID>, applicationFeatures: YSArray<FeatureID>): Boolean {
        return (MessageListDisplayFeature.`get`.included(modelFeatures) && GroupModeFeature.`get`.includedAll(modelFeatures, applicationFeatures))
    }

    open override fun tostring(): String {
        return "${GroupModeRemoveLabelsAction.type}(${this.labelNames})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeRemoveLabelsAction"
    }
}

public open class GroupModeUnselectMessageAction(private var order: Int): BaseGroupModeAction(GroupModeUnselectMessageAction.type) {
    open override fun canBePerformedImpl(messages: YSArray<MessageView>, selectedOrders: YSSet<Int>, _currentFolder: FolderName): Boolean {
        return selectedOrders.has(this.order)
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf(Eventus.groupActionsEvents.deselectMessage(this.order, fakeMid()))
    }

    open override fun perform(model: App, application: App, history: MBTHistory): MBTComponent {
        this.performImpl(GroupModeFeature.`get`.forceCast(model))
        this.performImpl(GroupModeFeature.`get`.forceCast(application))
        if (GroupModeFeature.`get`.forceCast(model).isInGroupMode()) {
            return history.currentComponent
        } else {
            return MaillistComponent()
        }
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.unselectMessage(this.order)
    }

    open override fun tostring(): String {
        return "${GroupModeUnselectMessageAction.type}(${this.order})"
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeUnselectMessageAction"
    }
}

public open class GroupModeUnselectAllAction(): BaseGroupModeAction(GroupModeUnselectAllAction.type) {
    open fun requiredFeature(): Feature<GroupMode> {
        return GroupModeFeature.`get`
    }

    open override fun canBePerformedImpl(messages: YSArray<MessageView>, selectedOrders: YSSet<Int>, _currentFolder: FolderName): Boolean {
        return selectedOrders.size >= 1
    }

    open override fun performImpl(modelOrApplication: GroupMode): Unit {
        modelOrApplication.unselectAllMessages()
    }

    open override fun events(): YSArray<EventusEvent> {
        return mutableListOf()
    }

    open override fun tostring(): String {
        return GroupModeUnselectAllAction.type
    }

    companion object {
        @JvmStatic val type: MBTActionType = "GroupModeUnselectAllAction"
    }
}

