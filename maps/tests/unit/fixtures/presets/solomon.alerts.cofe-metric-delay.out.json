{
    "solomon": {
        "project_id": "maps-analytics",
        "alerts": [
            {
                "id": "tools-duty-failure",
                "projectId": "maps-analytics",
                "name": "Cofe metric appearance delay for /test/test",
                "channels": [
                    {
                        "id": "MapsAnalyticsMonitorings",
                        "config": {
                            "notifyAboutStatuses": [
                                "ALARM",
                                "ERROR",
                                "NO_DATA",
                                "OK",
                                "WARN"
                            ],
                            "repeatDelaySecs": 0
                        }
                    }
                ],
                "type": {
                    "expression": {
                        "program": "// every reaction publishes one or more artifacts\n// so we get the one of them (max, for example)\nlet source = {project=\"cofe\", cluster=\"production\", service=\"tech_daily\", app=\"/test\", metric=\"ready.collect\", task_name=\"test\"};\n\nlet time_offset = 3 * 3600; // UTC + 3 hours = MSK time\nlet now = time_interval_end() + time_offset; // in UTC epoch seconds \nlet today = now - 86400 * fract(now / 86400); // start of the day second\nlet now_hours = (now - today) / 3600;\n\nlet last_point_timestamp = last(get_timestamps(source));\nlet completed_hours = last(drop_nan(source));\nlet completed_hours_str = to_fixed(completed_hours, 1);\n\nlet ALERT_HOURS = 1;\nlet is_published_too_late = now_hours > ALERT_HOURS && completed_hours > ALERT_HOURS; // completed after deadline\nlet is_not_published = now_hours > ALERT_HOURS && completed_hours != completed_hours; // NaN in completed_hours means there are no point today\n\nalarm_if(is_not_published);",
                        "checkExpression": ""
                    }
                },
                "annotations": {
                    "solomon_graph_id": "reactor-reactions-failures",
                    "description": "{{#expression.is_not_published}}Expected test to publish before {{expression.ALERT_HOURS}}{{/expression.is_not_published}}",
                    "juggler_host": "maps-analytics",
                    "juggler_service": "cofe_/test_test_delay"
                },
                "windowSecs": 172800,
                "delaySecs": 0,
                "resolvedEmptyPolicy": "RESOLVED_EMPTY_DEFAULT",
                "noPointsPolicy": "NO_POINTS_DEFAULT"
            }
        ]
    }
}