<!DOCTYPE html>
<!--
Title:
Список объектов

Description:
Список объектов на карте
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
smoke

Estimated time:
270000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней.

  Expectation:
  Карта отобразилась корректно.
  На карте спан Киева.
  На карте имеются контролы: масштабирования - "+/-", местоположения, кнопки "Найти", "Пробки", "Слои", кнопка разворачивания экрана, кнопка линейки.
  На карте метки коллекций четырех цветов(красные, синие, оранжевые, зеленые).
  Под блоком с картой имеется список ссылок на объекты.

Step:
  Action:
  Клик в списке в "Монумент "Родина - Мать!".

  Expectation:
  Над одной из меток красного цвета появляется балун с текстом Монумент "Родина - Мать!". У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Памятник "Богдану Хмельницкому".

  Expectation:
  Балун предыдущей метки пропадает и на другой метке красного цвета появляется балун с текстом Памятник "Богдану Хмельницкому". У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Арка Дружбы народов.

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток красного цвета появляется балун с текстом Арка Дружбы народов.
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Известные памятники.

  Expectation:
  Балун предыдущей метки пропадает.
  Подпункты "Известные памятники" схлопываются в списке под картой.
  С карты пропадают метки коллекции красного цвета.

Step:
  Action:
  Клик в списке в Ресторан "Калинка-Малинка".

  Expectation:
  Спан карты немного смещается, над одной из меток зеленого цвета появляется балун с текстом Монумент "Ресторан "Калинка-Малинка".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Бар "Сало-бар".

  Expectation:
  Спан карты немного смещается, балун предыдущей метки пропадает и над одной из меток зеленого цвета появляется балун с текстом Бар "Сало-бар".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Абсент-бар "Палата №6".

  Expectation:
  Спан карты немного смещается, балун предыдущей метки пропадает и над одной из меток зеленого цвета появляется балун с текстом Абсент-бар "Палата №6".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Ресторан "Спотыкач".

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток зеленого цвета появляется балун с текстом Ресторан "Спотыкач".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Покушайки.

  Expectation:
  Балун предыдущей метки пропадает.
  Подпункты "Покушайки" схлопываются в списке под картой.
  С карты пропадают метки коллекции зеленого цвета.

Step:
  Action:
  Клик в списке в Музей грамзаписи и старинных музыкальных инструментов.

  Expectation:
  Над одной из меток оранжевого цвета появляется балун с текстом "Музей грамзаписи и старинных музыкальных инструментов".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Музей истории медицины или Анатомический театр.

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток оранжевого цвета появляется балун с текстом "Музей истории медицины или Анатомический театр".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Музей воды. Водно-информационный центр.

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток оранжевого цвета появляется балун с текстом "Музей воды. Водно-информационный центр".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Оригинальные музейчики.

  Expectation:
  Балун предыдущей метки пропадает.
  Подпункты "Оригинальные музейчики" схлопываются в списке под картой.
  С карты пропадают метки коллекции оранжевого цвета.

Step:
  Action:
  Клик в списке в Замок Ричарда-Львиное сердце.

  Expectation:
  Над одной из меток синего цвета появляется балун с текстом "Замок Ричарда-Львиное сердце".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в "Дом с химерами".

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток синего цвета появляется балун с текстом "Дом с химерами".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Дом Рыцаря.

  Expectation:
  Балун предыдущей метки пропадает и над одной из меток синего цвета появляется балун с текстом "Дом Рыцаря".
  У балуна есть кнопка закрытия - крестик.

Step:
  Action:
  Клик в списке в Красивости.

  Expectation:
  Балун предыдущей метки пропадает.
  Подпункты "Красивости" схлопываются в списке под картой.
  С карты пропадают метки коллекции синего цвета.
-->
<html lang="en">
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="../../../helper.js"></script>
    <script src="https://yandex.st/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <script src="https://sandbox.api.maps.yandex.net/examples/ru/2.1/object_list/groups.js"
            type="text/javascript"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {

            // Создание экземпляра карты.
            var myMap = new ymaps.Map('map', {
                        center: [50.443705, 30.530946],
                        zoom: 14
                    }, {
                        searchControlProvider: 'yandex#search', backgroundVisible: false
                    }),
            // Контейнер для меню.
                    menu = $('<ul class="menu"></ul>');

            for (var i = 0, l = groups.length; i < l; i++) {
                createMenuGroup(groups[i]);
            }

            function createMenuGroup (group) {
                // Пункт меню.
                var menuItem = $('<li><a href="#" id="'+ group.name.replace(/\s/g, '') +'">' + group.name + '</a></li>'),
                // Коллекция для геообъектов группы.
                        collection = new ymaps.GeoObjectCollection(null, { preset: group.style }),
                // Контейнер для подменю.
                        submenu = $('<ul class="submenu"></ul>');

                // Добавляем коллекцию на карту.
                myMap.geoObjects.add(collection);

                // Добавляем подменю.
                menuItem
                        .append(submenu)
                    // Добавляем пункт в меню.
                        .appendTo(menu)
                    // По клику удаляем/добавляем коллекцию на карту и скрываем/отображаем подменю.
                        .find('a')
                        .toggle(function () {
                            myMap.geoObjects.remove(collection);
                            submenu.hide();
                        }, function () {
                            myMap.geoObjects.add(collection);
                            submenu.show();
                        });
                for (var j = 0, m = group.items.length; j < m; j++) {
                    createSubMenu(group.items[j], collection, submenu);
                }
            }

            function createSubMenu (item, collection, submenu) {
                // Пункт подменю.
                var submenuItem = $('<li><a href="#" id="'+ item.name.replace(/\s/g, '') +'">' + item.name + '</a></li>'),
                // Создаем метку.
                        placemark = new ymaps.Placemark(item.center, { balloonContent: item.name });

                // Добавляем метку в коллекцию.
                collection.add(placemark);
                // Добавляем пункт в подменю.
                submenuItem
                        .appendTo(submenu)
                    // При клике по пункту подменю открываем/закрываем баллун у метки.
                        .find('a')
                        .toggle(function () {
                            placemark.balloon.open();
                        }, function () {
                            placemark.balloon.close();
                        });
            }

            // Добавляем меню в тэг BODY.
            menu.appendTo($('body'));
            // Выставляем масштаб карты чтобы были видны все группы.
            myMap.setBounds(myMap.geoObjects.getBounds());

            addGrid(myMap);
            var log = new Log();
            log.info('Test script: тыкать в список, смотреть метки');
        }
    </script>
</head>
<body>
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>