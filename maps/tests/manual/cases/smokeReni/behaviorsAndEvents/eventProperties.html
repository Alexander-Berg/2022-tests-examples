<!DOCTYPE HTML>
<!--
Title:
Свойства события. Координаты щелчка.

Description:
Открытие балуна и хинта по клику в любое место карты.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
smoke

Estimated time: 
270000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 

  Expectation:
  Карта отобразилась корректно.
  На карте спан Углича. 
  На карте имеются контролы: масштабирования - "+/-", местоположения, кнопки "Найти", "Пробки", "Слои", кнопка разворачивания экрана. 

Step:
  Action:
  Клик ПКМ в любое место на карте.  
  
  Expectation:
  На карте появляется прямоугольный хинт с текстом: "Кто-то щелкнул правой кнопкой".

Step:
  Action:
  Клик ЛКМ в любое место на карте.  
  
  Expectation:
  Появляется балун с заголовком: "Событие!"; телом: "Кто-то щелкнул по карте.Координаты щелчка: 57.5402, 38.2711"(цифры могут не совпадать); футером: "Щелкните еще раз".
  Хинт при открытии балуна пропадает.
  Если клик происходит у края контейнера с картой, то при открытии балуна происходит смещение спана.
  Под блоком с картой появляются полные координаты точки в которую произошел клик вида: "57.540233947568154,38.27108107910155".
  Координаты в балуне аналогичны координатам под картой, только сокращены до 6 цифр значения с округлением в большую сторону.

Step:
  Action:
  Кликнуть ЛКМ в любое место на карте (не в балун).
  
  Expectation:
  Балун закрывается.

Step:
  Action:
  Выполнить клик правой клавишей на тачпаде.
  
  Expectation:
  На карте появляется прямоугольный хинт с текстом: "Кто-то щелкнул правой кнопкой".

Step:
  Action:
  Выполнить клик левой клавишей/тапнуть на тачпаде.
  
  Expectation:
  Появляется балун с заголовком: "Событие!"; телом: "Кто-то щелкнул по карте.Координаты щелчка: 57.5402, 38.2711"(цифры могут не совпадать); футером: "Щелкните еще раз".
  Хинт при открытии балуна пропадает.
  Если клик происходит у края контейнера с картой, то при открытии балуна происходит смещение спана.
  Под блоком с картой появляются полные координаты точки в которую произошел клик/тап вида: "57.540233947568154,38.27108107910155".
  Координаты в балуне аналогичны координатам под картой, только сокращены до 6 цифр значения с округлением в большую сторону.
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            var myMap = new ymaps.Map("map", {
                center: [57.5262, 38.3061], // Углич
                zoom: 11
            }, {
                balloonMaxWidth: 200,
                backgroundVisible: false
            });

            // Обработка события, возникающего при щелчке
            // левой кнопкой мыши в любой точке карты.
            // При возникновении такого события откроем балун.
            myMap.events.add('click', function (e) {
                if (!myMap.balloon.isOpen()) {
                    var coords = e.get('coords');
                    __log__(coords);
                    myMap.balloon.open(coords, {
                        contentHeader: 'Событие!',
                        contentBody: '<p>Кто-то щелкнул по карте.</p>' +
                                '<p>Координаты щелчка: ' + [
                            coords[0].toPrecision(6),
                            coords[1].toPrecision(6)
                        ].join(', ') + '</p>',
                        contentFooter: '<sup>Щелкните еще раз</sup>'
                    });
                }
                else {
                    myMap.balloon.close();
                }
            });

            // Обработка события, возникающего при щелчке
            // правой кнопки мыши в любой точке карты.
            // При возникновении такого события покажем всплывающую подсказку
            // в точке щелчка.
            myMap.events.add('contextmenu', function (e) {
                myMap.hint.open(e.get('coords'), 'Кто-то щелкнул правой кнопкой');
            });

            // Скрываем хинт при открытии балуна.
            myMap.events.add('balloonopen', function (e) {
                myMap.hint.close();
            });
            addGrid(myMap);
            var log = new Log();
            log.info("Test case: Балун открывается по клику. Хинт по 'contextmenu'");

        }
    </script>
</head>
<body>
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>