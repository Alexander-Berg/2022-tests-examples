<!DOCTYPE html>
<!--
Title:
Дистрибуция такси: все зоны вызова такси

Description:
Проверка отображения кнопки такси во всех зонах вызова.
Памятка по терминам: https://wiki.yandex-team.ru/eva/search/assessors-testing/maps-api/

Components:
smoke

Estimated time:
180000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней.
  
  Expectation:
  Карта отобразилась корректно со спаном Москвы и меткой, сверху в контейнере 10 кнопок. Фон карты окрашен полупрозрачным фоном синего цвета.
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".
  
Step:
  Action:
  Выполнить клик в кнопку "[Москва]".
  
  Expectation:
  Происходит смещение спана карты, в блоке дистрибуции меняется отображение кнопок, кнопка "На такси" пропадает.
  Остаются кнопки: "Открыть в Яндекс.Картах", "API Карт", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Москва]".
  
  Expectation:
  Происходит возврат на первоначальный спан карты, в блоке дистрибуции меняется отображение кнопок, кнопка "На такси" появляется.
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Псковс...".
  
  Expectation:
  Спан карты меняется на спан Великих Лук(часть спана окрашена фоном синего цвета), в центре метка. 
  В блоке дистрибуции: кнопка "Как добраться", кнопка "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Псковс...".  

  Expectation:
  Происходит смещение спана на спан Невеля, в блоке дистрибуции меняется отображение кнопок, кнопка "На такси" пропадает.
  Внизу карты блок дистрибуции из кнопок "Как добраться", "Создать свою карту", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Воронеж]".
  
  Expectation:
  Спан карты меняется на спан Воронежа(спана окрашен фоном синего цвета), на карте две голубые метки. 
  В блоке дистрибуции: кнопка "Открыть в Яндекс.Картах", "API Карт", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Воронеж]".  

  Expectation:
  Происходит смещение спана к правой метке в Рождественской Хаве, в блоке дистрибуции меняется отображение кнопок, появляется кнопка "На такси".
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Юг]".
  
  Expectation:
  Спан карты меняется на спан Сочи(на спане видны полигоны окрашенные синим), на карте одна метка. 
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Юг]".  

  Expectation:
  Происходит смещение спана вправо(слева видно предыдущую метку, в центре карты также есть метка), в блоке дистрибуции меняется отображение кнопок, кнопка "На такси" пропадает.
  Внизу карты блок дистрибуции из кнопок "Как добраться", "Создать свою карту", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Волгогр...".
  
  Expectation:
  Спан карты меняется на спан Волгограда(спан окрашен фоном синего цвета), в центре метка. 
  В блоке дистрибуции: кнопка "Как добраться", кнопка "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Оренбу...".
  
  Expectation:
  Спан карты меняется на спан Оренбурга(спан окрашен фоном синего цвета), в центре метка. 
  В блоке дистрибуции: кнопка "Как добраться", кнопка "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Тюмень...".
  
  Expectation:
  Спан карты меняется на спан Тюмени(спан окрашен фоном синего цвета), в центре метка. 
  В блоке дистрибуции: кнопка "Как добраться", кнопка "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Тюмень...".  

  Expectation:
  Происходит смещение спана на спан Тобольска(синего фона нет), в центре карты есть метка, в блоке дистрибуции меняется отображение кнопок, кнопка "На такси" пропадает.
  Внизу карты блок дистрибуции из кнопок "Как добраться", "Создать свою карту", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Иркутск]".
  
  Expectation:
  Спан карты меняется на спан Иркутска(город находится внутри полигона окрашенного синим), в центре метка. 
  В блоке дистрибуции: кнопка "Как добраться", кнопка "На такси", кнопка-ссылка "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Хабаро...".  

  Expectation:
  Происходит смещение спана на спан Хабаровска(город находится внутри полигона окрашенного синим), на карте 2 метки.
  Внизу карты блок дистрибуции из кнопок "Открыть в Яндекс.Картах", "API карт", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Хабаро...".  

  Expectation:
  Происходит смещение спана вниз и немного вправо, в блоке дистрибуции меняется отображение кнопок, появляется кнопка "На такси".
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", "API", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Владив...".  

  Expectation:
  Происходит смещение спана на спан Владивостока и пос.Поповка(город находится внутри полигона окрашенного синим), на карте 2 метки(одна в Поповке, вторая во Владивостоке).
  Внизу карты блок дистрибуции из кнопок "Открыть в Яндекс.Картах", "API карт", коопирайт, ссылка на "Условия использования".

Step:
  Action:
  Выполнить клик в кнопку "[Владив...".  

  Expectation:
  Происходит смещение спана вверх и немного вправо, в блоке дистрибуции меняется отображение кнопок, появляется кнопка "На такси".
  Внизу карты блок дистрибуции из кнопок "Как добраться", "На такси", "API", коопирайт, ссылка на "Условия использования".
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="./taxi_bbox.json" type="text/javascript"></script>
    <script src="../../../helper.js"></script> 
    <!-- <script src="https://api-maps.tst.c.maps.yandex.com/2.1.79/?mode=debug&lang=ru_RU&apikey=291aaf26-9346-4dbd-a59c-0718d6568ba1&coordorder=longlat" type="text/javascript"></script> -->
    <script type=text/javascript>

        Api('init', '', '', 'longlat', '', 'ymaps');
        
        function init(ymaps) {

            var myMap = new ymaps.Map("map", {
                center: [37.738521, 55.684758],
                zoom: 10,
                controls: [],
            }, {
                suppressMapOpenBlock: false,
            });

            const bboxes = [];
            const polygons = [];
            
            function getBBoxes() {
                geojson.features.map((feature) => {
                    if (feature.geometry.type === 'Point') return;

                    let min_lat = 180;
                    let min_lon = 180;
                    let max_lat = -180;
                    let max_lon = -180;

                    feature.geometry.coordinates[0].map((coordinate) => {
                        min_lat = Math.min(min_lat, coordinate[1]);
                        min_lon = Math.min(min_lon, coordinate[0]);
                        max_lat = Math.max(max_lat, coordinate[1]);
                        max_lon = Math.max(max_lon, coordinate[0]);
                    })

                    bboxes.push([[min_lon, min_lat], [max_lon, max_lat]]);
                    polygons.push([[[min_lon, min_lat], [min_lon, max_lat], [max_lon, max_lat], [max_lon, min_lat], [min_lon, min_lat]]])
                });
            }
            getBBoxes();
            console.log(bboxes);
            console.log(polygons);

            bboxes.map((bbox, i) => myMap.geoObjects.add(new ymaps.Rectangle(bbox, {hintContent: i})));

            
            myMap.geoObjects
                .add(new ymaps.Placemark([37.738521, 55.684758], {
                    balloonContent: 'Москва'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#0095b6'
                }))
                .add(new ymaps.Placemark([30.523397, 56.342650], {
                    balloonContent: 'Великие Луки'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#0095b6'
                }))
                .add(new ymaps.Placemark([29.933310, 56.014867], {
                    balloonContent: 'Невель'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([39.101098, 51.664660], {
                    balloonContent: 'Воронеж'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([39.705695, 51.657406], {
                    balloonContent: 'Рождественская Хава'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([39.948637, 43.614112], {
                    balloonContent: 'Возле Калинового озера'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([40.310974, 43.624557], {
                    balloonContent: 'Высота Роза'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([44.568560, 48.707434], {
                    balloonContent: 'Волгоград'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([55.192684, 51.794660], {
                    balloonContent: 'Оренбург'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([65.545916, 57.137410], {
                    balloonContent: 'Тюмень'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([68.258187, 58.204774], {
                    balloonContent: 'Тобольск'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([104.265865, 52.315638], {
                    balloonContent: 'Иркутск'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([135.051244, 48.496073], {
                    balloonContent: 'Хабаровск'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([135.129471, 48.348407], {
                    balloonContent: 'Хабаровск Ореховая'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([131.736225, 42.958714], {
                    balloonContent: 'Поповка'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))
                .add(new ymaps.Placemark([131.949738, 43.142887], {
                    balloonContent: 'Владивосток'
                }, {
                    preset: 'islands#icon',
                    iconColor: '#82CDFF'
                }))

            var mskButton = new ymaps.control.Button({data: {content: '[Москва]'}, options: {selectOnClick: true}});
            mskButton.events
                    .add('select', function () {
                        myMap.panTo([37, 55], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([37.738521, 55.684758], {flying: false, safe: false})
                    });
            var pskButton = new ymaps.control.Button({data: {content: '[Псковская область]'}, options: {selectOnClick: true}});
            pskButton.events
                    .add('select', function () {
                        myMap.panTo([30.523397, 56.342650], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([29.933310, 56.014867], {flying: false, safe: false})
                    });
            var vorButton = new ymaps.control.Button({data: {content: '[Воронеж]'}, options: {selectOnClick: true}});
            vorButton.events
                    .add('select', function () {
                        myMap.panTo([39.389689, 51.667947], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([39.705695, 51.657406], {flying: false, safe: false})
                    });
            var southButton = new ymaps.control.Button({data: {content: '[Юг]'}, options: {selectOnClick: true}});
            southButton.events
                    .add('select', function () {
                        myMap.panTo([39.948637, 43.614112], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([40.310974, 43.624557], {flying: false, safe: false})
                    });
            var vgrButton = new ymaps.control.Button({data: {content: '[Волгоград]'}, options: {selectOnClick: true}});
            vgrButton.events
                    .add('select', function () {
                        myMap.panTo([44.568560, 48.707434], {flying: false, safe: true, duration: 1500})
                    });
            var oreButton = new ymaps.control.Button({data: {content: '[Оренбург]'}, options: {selectOnClick: true}});
            oreButton.events
                    .add('select', function () {
                        myMap.panTo([55.192684, 51.794660], {flying: false, safe: true, duration: 1500})
                    });
            var tumButton = new ymaps.control.Button({data: {content: '[Тюмень/Тобольск]'}, options: {selectOnClick: true}});
            tumButton.events
                    .add('select', function () {
                        myMap.panTo([65.545916, 57.137410], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([68.258187, 58.204774], {flying: false, safe: false})
                    });
            var irkButton = new ymaps.control.Button({data: {content: '[Иркутск]'}, options: {selectOnClick: true}});
            irkButton.events
                    .add('select', function () {
                        myMap.panTo([104.265865, 52.315638], {flying: false, safe: true, duration: 1500})
                    });
            var hubButton = new ymaps.control.Button({data: {content: '[Хабаровск]'}, options: {selectOnClick: true}});
            hubButton.events
                    .add('select', function () {
                        myMap.panTo([135.051244, 48.496073], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([135.211371, 48.226522], {flying: false, safe: false})
                    });
            var vladButton = new ymaps.control.Button({data: {content: '[Владивосток]'}, options: {selectOnClick: true}});
            vladButton.events
                    .add('select', function () {
                        myMap.panTo([131.736225, 42.958714], {flying: false, safe: true, duration: 1500})
                    })
                    .add('deselect', function () {
                        myMap.panTo([132.097086, 43.204731], {flying: false, safe: false})
                    });
            myMap.controls
                    .add(mskButton)
                    .add(pskButton)
                    .add(vorButton)
                    .add(southButton)
                    .add(vgrButton)
                    .add(oreButton)
                    .add(tumButton)
                    .add(irkButton)
                    .add(hubButton)
                    .add(vladButton);
        }
    </script>
   </head>
   <body>
    <div id="map" style="height: 512px; width: 512px;">
</body>

</html>