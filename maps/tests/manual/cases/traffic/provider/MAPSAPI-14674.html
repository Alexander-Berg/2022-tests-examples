<!DOCTYPE HTML>
<!--
Title:
Пробки: провайдер архивных пробок при зуме

Description:
Проверка провайдера архивных пробок на призуме.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components:
traffic

Estimated time:
120000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть страницу и элементы на ней. 

  Expectation:
  Карта отобразилась корректно со спаном Москвы, дефолтным набором контролов.
  
Step:
  Action:
  Открыть инструменты разработчика командами Windows: Ctrl + Shift + I если у вас MacOS: ⌥ + ⌘ + I, вкладку Console.
  Выполнить клик в контрол "Пробки". 

  Expectation:
  По клику на карте появляются разноцветные линии пробок, в контроле отображается балл пробок и время.

Step:
  Action:
  Выполнить клик в контролпризума "+".

  Expectation:
  Происходит корректный призум спана карты, пробочные линиию отображаются корректно.
  По клику под контейнером с картой появляется отладочная информация, по клику в контрол призума в консоли не появляются ошибки.

Step:
  Action:
  Скролом мыши выполнить отзум/призум спана карты.

  Expectation:
  Происходит корректный призум/отзум спана карты, карта не замирает, пробочные лини не пропадают.
  При призуме/отзуме в консоли не появляются ошибки.

Step:
  Action:
  Выполнить драг карты, драгом сместить карту за пределы МКАД.

  Expectation:
  Происходит корректный драг спана карты, карта не замирает, пробочные лини не пропадают.
  При драге за пределы МКАД может обновляться отладочная информация под контейнером с картой, в консоли при этом не появляются ошибки.  
  При выводе за пределы МКАД из контрола пробок пропадает пробочный балл и время.

Step:
  Action:
  Выполнить клик в шестеренку настроек на контроле пробок, выбрать "Статистика", переместить ползунок времени вперед.

  Expectation:
  По клику в статистику пробочные линии обновляются, также при перемещении ползунка времени пробочные линии на спане обновляются.
  В контроле пробок появляется день недели и время прогноза пробок.
  При действиях шага в консоли не появляются ошибки.

Step:
  Action:
  Скролом мыши выполнить отзум/призум спана карты.

  Expectation:
  Происходит корректный призум/отзум спана карты, карта не замирает, пробочные лини не пропадают.
  Пробочные линии обновляются после остановки после призума/отзума.
  При призуме/отзуме в консоли не появляются ошибки.

Step:
  Action:
  Выполнить клик в контрол "Пробки". 

  Expectation:
  По клику пробочные линии на карте пропадают, карта отображается корректно.
  По клику в контрол в консоли не появляются ошибки.
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script type="text/javascript">
        Api('init');

        function init(ymaps) {
            // Создание карты.
            var myMap = new ymaps.Map("map", {
                // Координаты центра карты.
                // Порядок по умолчанию: «широта, долгота».
                // Чтобы не определять координаты центра карты вручную,
                // воспользуйтесь инструментом Определение координат.
                center: [55.76, 37.64],
                // Уровень масштабирования. Допустимые значения:
                // от 0 (весь мир) до 19.
                zoom: 10
            });

            addGrid(myMap);
            var log = new Log();
      
            var timestamp = 24 * 60 * 60 + // дважды по 24 часа — это время за понедельник и вторник.
              15 * 60 * 60// + // 17 часов прошло с 00:00 среды.
              //45 * 60, // поскольку время должно быть кратно 15 минутам, берем не 47 минут, а 45.
            archiveProvider = new ymaps.traffic.provider.Archive({
                // Запретим при первом открытии выставлять время, близкое к текущему.
                showCurrentTimeFirst: false
            }, {
                // Зададим начальное время самостоятельно.
                timestamp: timestamp
            });
            archiveProvider.setMap(myMap);
      
            
      
            // Запретим показ всплывающих подсказок для слоя пробок.
            myMap.layers.options.set({
                // Название опции сформировано из опции слоя активных областей
              // 'openHintOnHover' путем добавления префикса 'trafficJam'.
                trafficJamOpenHintOnHover: false
            });
      
            var  stateMonitor = new ymaps.Monitor(archiveProvider.state)
            stateMonitor.add('level', function (newValue) {
              log.info('level', newValue);
              log.info('getTime', archiveProvider.getTime());
            })
        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>