<!DOCTYPE HTML>
<!--
Title:
Карта: включение опций событий и прослушивание событий картой

Description:
Проверка включения опций событий и прослушивания событий картой.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
map

Estimated time:
240000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 
  
  Expectation:
  Карта отобразилась корректно. 
  В контейнере карта со спаном Москвы, сверху ряд кнопок с опциями. 
  Справа в нижнем углу контрол слоев, контрол фулскрин, кнопки опций.
  (кнопка "clear log" удаляет лог текста событий под контейнером с картой, после каждого шага выполнять клик в кнопку "clear log")

Step:
  Action:
  Выполнить клик в кнопку "balloon". 
  
  Expectation:
  В центре карты открывается балун с рандомным числом от 0 до 1, а также хинт с текстом "loading".

Step:
  Action:
  Выполнить клик в кнопку "balloon". 
  
  Expectation:
  Балун и хинт пропадают со спана карты.

Step:
  Action:
  Выполнить клик в кнопку "action", затем зажав на спане ЛКМ выполнить драг карты. 
  
  Expectation:
  По клику в "action", под картой появляется строка: "Waiting for action* events...".
  При начале драг под картой появляется строка: "map: actionbegin", по окончанию драга: "map: actionend".

Step:
  Action:
  Выполнить клик в кнопку "action", затем зажав на спане ЛКМ выполнить драг карты. 
  
  Expectation:
  По клику в "action", под картой появляется строка: "action* events will be ignored".
  При драге под картой не повляется строк с событиями карты.

Step:
  Action:
  Выполнить клик в кнопку "DOM", затем навести курсор на спан карты, увести курсор за пределы спана карты, выполнить клик в спан карты ЛКМ, затем клик ПКМ, даблклик, скрол. 
  
  Expectation:
  По клику в "DOM", под картой появляется строка: "Waiting for DOM events....".
  При наведении курсора на карту: "map: mouseenter", при уводе курсора: "map: mouseleave", при клике: "map: mousedown; map: mouseup; map: click", при клике ПКМ дублируются события mousedown и mouseup, а также появляется "map: contextmenu".  
  При даблклике дублируются mousedown, mouseup, click и добавляется строка "map: dblclick", а также происходит призум, при скроле: "map: wheel" и призум/отзум.

Step:
  Action:
  Выполнить клик в кнопку "DOM", затем навести курсор на спан карты, увести курсор за пределы спана карты, выполнить клик в спан карты ЛКМ, затем клик ПКМ, даблклик, скрол. 
  
  Expectation:
  По клику в "DOM", под картой появляется строка: "DOM events will be ignored".
  При выполнении действий строк событий под картой не появляется.

Step:
  Action:
  Выполнить клик в кнопку "move", затем поводить курсором по спану карты. 
  
  Expectation:
  По клику в "move", под картой появляется строка: "Waiting for move events...".
  При проведении курсором по спану карты под контейнером появялются множетсво строк: "map: mousemove".

Step:
  Action:
  Выполнить клик в кнопку "move", затем поводить курсором по спану карты. 
  
  Expectation:
  По клику в "move", под картой появляется строка: "Move events will be ignored".
  При выполнении действий строк событий под картой не появляется.

Step:
  Action:
  Выполнить клик в кнопку "option", затем выполнить зум спана карты скролом мыши до максимума. 
  
  Expectation:
  Происходит корректный призум, карта не пропадает не мигает цветами, нет странных визуальных эффектов.

Step:
  Action:
  Выполнить клик в кнопку "option", затем выполнить отзум спана выполнив 10 даблкликов ПКМ в спан карты. 
  
  Expectation:
  Происходит корректный отзум, карта не пропадает не мигает цветами, нет странных визуальных эффектов.

Step:
  Action:
  Выполнить клик в кнопку "listen", затем клик в "bounds". 
  
  Expectation:
  По клику в "listen", под картой появляется строка: "Waiting for events...".
  По клику в "bounds" происходит смена спана карты на спан Реутова, под контейнером с картой появляется строка: "map: boundschange".

Step:
  Action:
  Зажав ЛКМ на спане карты выполнить драг спана карты.
  
  Expectation:
  Под контейнером с картой появляется строка: "map: boundschange".

Step:
  Action:
  Выполнить клик в кнопку "listen", затем клик в "bounds". 
  
  Expectation:
  По клику в "listen", под картой появляется строка: "Events will be ignored".
  По клику в "bounds" происходит смена спана карты на спан Реутова.

Step:
  Action:
  Выполнить клик в кнопку "tick", затем клик даблклик ЛКМ в спан карты, затем драг спана карты. 
  
  Expectation:
  По клику в "tick", под картой появляется строка: "Waiting for actiontick events...".
  При даблклике происходит корректный призум спан карты, под контейнером появляются строки: "map: actiontick; map: actiontickcomplete".
  При драге под контейнером с картой появляются строки: "map: actiontick; map: actiontickcomplete".

Step:
  Action:
  Выполнить клик в кнопку "tick", затем клик даблклик ЛКМ в спан карты, затем драг спана карты. 
  
  Expectation:
  По клику в "tick", под картой появляется строка: "actiontick events will be ignored".
  При даблклике происходит корректный призум спан карты, события под картой не появляются.
  При драге под контейнером с картой строк событий не появляется.

Step:
  Action:
  Выполнить клик в кнопку "freeze", затем клик даблклик ЛКМ в спан карты, затем драг спана карты. 
  
  Expectation:
  По клику в "freeze", спан карты без изменений.
  При даблклике происходит корректный призум спан карты, события под картой не появляются.
  При драге под контейнером с картой строк событий не появляется.

Step:
  Action:
  Выполнить клик в кнопку "freeze", затем клик даблклик ЛКМ в спан карты, затем драг спана карты. 
  
  Expectation:
  По клику в "freeze", спан карты без изменений.
  При даблклике происходит корректный призум спан карты, события под картой не появляются.
  При драге под контейнером с картой строк событий не появляется.

Step:
  Action:
  Выполнить клик в кнопку "destroy". 
  
  Expectation:
  По клику карта пропадает из контейнера.
-->
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../helper.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            ymaps = ym; // hack

            var map = myMap = new ym.Map('map', {
                center: [55.73259667357658, 37.70153663432529],
                zoom: 9,
                behaviors: ['default', 'scrollZoom'],
                controls: []
            });

            addGrid(myMap);
            var log = new Log();
            log.info('Balloon button - open balloon and hint(timeout=1000)');
            log.info('Action button - not ignored/ignored actionevents');
            log.info('Dom button - not ignored/ignored domevents');
            log.info('Move button - not ignored/ignored moveevents');
            log.info('Option button - set/unset avoidFractionalZoom = false');
            log.info('Bounds button - myMap.setBounds "Салтыковский лесопарк"');
            log.info('Listen button - not ignored/ignored events');
            log.info('Tick button - not ignored/ignored actiontickevents');
            log.info('Destroy button - Map.destroy()');
            log.info('Freeze button - freeze/unfreeze myMap');

            var events = ['balloonclose', 'balloonopen', 'boundschange', 'destroy', 'hintclose', 'hintopen', 'sizechange', 'optionschange', 'typechange'];

            var domevents = ['click', 'contextmenu', 'dblclick', 'mousedown', 'mouseenter', 'mouseleave', 'mouseup', 'multitouchend',
                'multitouchstart', 'wheel'];

            var moveevents = ['mousemove', 'multitouchmove'];

            var actionevents = ['actionbegin', 'actionbreak', 'actionend'];

            var actiontickevents = ['actiontick', 'actiontickcomplete'];

            var callback = function (e) {
                log.info('map: ' + e.get('type'));
            };

            var destroyButton = new ymaps.control.Button({data: {content: 'destroy'}, options: {selectOnClick: false}});
            var listenerButton = new ymaps.control.Button({data: {content: 'listen'}, options: {selectOnClick: true}});
            var optionButton = new ymaps.control.Button({data: {content: 'option'}, options: {selectOnClick: true}});
            var freezeButton = new ymaps.control.Button({data: {content: 'freeze'}, options: {selectOnClick: true}});
            var boundsButton = new ymaps.control.Button({data: {content: 'bounds'}, options: {selectOnClick: false}});
            var moveButton = new ymaps.control.Button({data: {content: 'move'}, options: {selectOnClick: true}});
            var domButton = new ymaps.control.Button({data: {content: 'DOM'}, options: {selectOnClick: true}});
            var actionButton = new ymaps.control.Button({data: {content: 'action'}, options: {selectOnClick: true}});
            var balloonhintButton = new ymaps.control.Button({data: {content: 'balloon'}, options: {selectOnClick: true}});
            var clearButton = new ymaps.control.Button({data: {content: 'clear log'}, options: {selectOnClick: false}});
            var tickButton = new ymaps.control.Button({data: {content: 'tick'}, options: {selectOnClick: true}});

            destroyButton.events
                    .add('click', function () {
                        myMap.destroy();
                    });

            listenerButton.events
                    .add('deselect', function () {
                        log.info('Events will be ignored.');
                        myMap.events.remove(events, callback);
                    })
                    .add('select', function () {
                        log.info('Waiting for events...');
                        myMap.events.add(events, callback);
                    });

            optionButton.events
                    .add('select', function () {
                        myMap.options.set('avoidFractionalZoom', false);
                    })
                    .add('deselect', function () {
                        myMap.options.unset('avoidFractionalZoom');
                    });

            freezeButton.events
                    .add('select', function () {
                        myMap.options.freeze();
                    })
                    .add('deselect', function () {
                        myMap.options.unfreeze();
                    });

            boundsButton.events
                    .add('click', function () {
                        myMap.setBounds([
                            [55.785448262083506, 37.816636657710355],
                            [55.68782209653647, 37.945726013178486]
                        ]);
                    });

            moveButton.events
                    .add('select', function () {
                        log.info('Waiting for move events...');
                        myMap.events.add(moveevents, callback);
                    })
                    .add('deselect', function () {
                        log.info('Move events will be ignored.');
                        myMap.events.remove(moveevents, callback);
                    });

            domButton.events
                    .add('select', function () {
                        log.info('Waiting for DOM events...');
                        myMap.events.add(domevents, callback);
                    })
                    .add('deselect', function () {
                        log.info('DOM events will be ignored.');
                        myMap.events.remove(domevents, callback);
                    });

            actionButton.events
                    .add('select', function () {
                        log.info('Waiting for action* events...');
                        myMap.events.add(actionevents, callback);
                    })
                    .add('deselect', function () {
                        log.info('action* events will be ignored.');
                        myMap.events.remove(actionevents, callback);
                    });
            tickButton.events
                    .add('select', function () {
                        log.info('Waiting for actiontick events...');
                        myMap.events.add(actiontickevents, callback);
                    })
                    .add('deselect', function () {
                        log.info('actiontick events will be ignored.');
                        myMap.events.remove(actiontickevents, callback);
                    });

            balloonhintButton.events
                    .add('select', function () {
                        myMap.balloon.open(myMap.getCenter(), Math.random());
                        myMap.hint.open(myMap.getCenter(), { content: 'loading' }, { openTimeout: 1000 });
                    })
                    .add('deselect', function () {
                        myMap.balloon.close();
                        myMap.hint.close();
                    });

            clearButton.events.add('click', function () {
                log.clear();
            });

            map.controls
                    .add(listenerButton, {float: 'left'})
                    .add(boundsButton, {float: 'left'})
                    .add(optionButton, {float: 'left'})
                    .add(freezeButton, {float: 'none', position: {bottom: 55, right: 10}})
                    .add(clearButton, {float: 'none', position: {bottom: 25, right: 10}})
                    .add(destroyButton, {float: 'none', position: {bottom: 85, right: 10}})
                    .add(tickButton, {float: 'none', position: {bottom: 115, right: 10}})
                    .add(new ymaps.control.FullscreenControl(), {float: 'none', position: {bottom: 165, right: 10}})
                    .add(new ymaps.control.TypeSelector(), {float: 'none', position: {bottom: 195, right: 10}})
                    .add(moveButton, {float: 'left'})
                    .add(domButton, {float: 'left'})
                    .add(actionButton, {float: 'left'})
                    .add(balloonhintButton, {float: 'left'});
        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>