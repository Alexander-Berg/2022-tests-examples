<!DOCTYPE HTML>
<!--
Title:
Кластерная метка: опции

Description:
Проверка работы опций кластерной метки.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components:
clusterer

Estimated time:
360000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней.

  Expectation:
  Карта отобразилась корректно.
  На карте спан Москвы.
  На спане кластерная метка со значением 50.
  Сверху в контейнере имеются кнопки управления опциями.

Step:
  Action:
  Выполнить клик в кнопку "openHin...".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке перекрестье, хинта при наведении нет.

Step:
  Action:
  Выполнить клик в кнопку "openHin...".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке перекрестье, хинт при наведении - маленькое пустое прямоугольное окно.

Step:
  Action:
  Выполнить клик в кнопку "openEm...".
  Выполнить даблклик ЛКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный призум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке перекрестье, хинта при наведении нет.

Step:
  Action:
  Выполнить клик в кнопку "openEm...".
  Выполнить даблклик ЛКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный призум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке перекрестье, хинт при наведении - маленькое пустое прямоугольное окно.

Step:
  Action:
  Выполнить клик в кнопку "openBall...".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Кластерная метка не реагирует на клик, балун метки не открывается.

Step:
  Action:
  Выполнить клик в кнопку "openBall...".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна.В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.
  
Step:
  Action:
  Выполнить клик в кнопку "iconCon...".
  Выполнить даблклик ЛКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный призум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна.В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.
  
Step:
  Action:
  Выполнить клик в кнопку "iconCon...".
  Выполнить даблклик ЛКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный призум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна.В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.

Step:
  Action:
  Выполнить клик в кнопку "hideIcon".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна, который открывается прямо на метке(метка не пропадает со спана карты).В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.
  
Step:
  Action:
  Выполнить клик в кнопку "hideIcon".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна(метка кластера пропадает со спана карты).В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.

Step:
  Action:
  Выполнить клик в кнопку "disableC...".
  Выполнить даблклик ЛКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный призум карты. Кластерная метка не пропадает со спана карты.
  После клика происходит смена спана с призумом, на максимальное значение зума, на спане кластерная метка, балун метки не открылся.

Step:
  Action:
  Выполнить клик в кнопку "disableC...".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Выполнить клик в кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Спан карты смещается для открытия балуна(метка кластера пропадает со спана карты).В балуне две колонки(правая колонка гораздо шире левой, балун шире контейнера с картой).
  В левой колонке список меток вида "Заголовок метки №0". В правой отображается содержимое метки 0. У каждой колонки имеется скрол полоса, имеется кнопка закрытия балуна.
  В правой колонке заголовок "Заголовок метки №0", тело балуна (стих), футер "Футер метки № 0". Заголовок выделен жирным шрифтом, остальное содержимое балуна обычным.

Step:
  Action:
  Выполнить клик в кнопку "cursor".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке стрелка со знаком вопроса(?), имеется хинт в виде пустого прямоугольника.

Step:
  Action:
  Выполнить клик в кнопку "cursor".
  Выполнить даблклик ПКМ в спан карты, вне кластерной метки.
  Навести курсор на кластерную метку.

  Expectation:
  После даблклика происходит корректный отзум карты. Кластерная метка не пропадает со спана карты.
  Курсор на кластерной метке перекрестье, имеется хинт в виде пустого прямоугольника.
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            ymaps = ym;

            var map = myMap = new ym.Map('map', {
                center: [55.72725771214265, 37.640390506634006],
                zoom: 10,
                behaviors: ['default', 'scrollZoom'],
                controls: []
            });

            addGrid(myMap);
            var log = new Log();
            __log__('Test case: option is changing after re-create cluster.');

            var fullscreen = new ymaps.control.FullscreenControl();
            map.controls.add(fullscreen, {float: 'none', position: {bottom: 35, right: 5}});
            var MyIconContentLayout = ymaps.templateLayoutFactory.createClass(
                    '<div style="color: #000000; font-weight: bold;">$[properties.geoObjects.length]</div>');
            var cursor = 'crosshair';
            var disableClickZoom = true;
            var hideIconOnBalloonOpen = true;
            var iconContentLayout = MyIconContentLayout;
            var openBalloonOnClick = true;
            var openEmptyHint = true;
            var openHintOnHover = true;

            var clusterer = new ymaps.Clusterer({hasHint: true});
            map.geoObjects.add(clusterer);
            clusterer.createCluster = function (center, geoObjects) {
                var clusterPlacemark = ymaps.Clusterer.prototype.createCluster.call(this, center, geoObjects);
                clusterPlacemark.options.set('cursor', cursor);
                clusterPlacemark.options.set('disableClickZoom', disableClickZoom);
                clusterPlacemark.options.set('hideIconOnBalloonOpen', hideIconOnBalloonOpen);
                clusterPlacemark.options.set('iconContentLayout', iconContentLayout);
                clusterPlacemark.options.set('openBalloonOnClick', openBalloonOnClick);
                clusterPlacemark.options.set('openEmptyHint', openEmptyHint);
                clusterPlacemark.options.set('openHintOnHover', openHintOnHover);
                return clusterPlacemark;
            };
            var geoObjects = [];

            var cursorButton = new ymaps.control.Button('cursor');
            var disableClickZoomButton = new ymaps.control.Button('disableClickZoom');
            var hideIconOnBalloonOpenButton = new ymaps.control.Button('hideIcon');
            var iconContentLayoutButton = new ymaps.control.Button('iconContent');
            var openBalloonOnClickButton = new ymaps.control.Button('openBalloonOnClick');
            var openEmptyHintButton = new ymaps.control.Button('openEmptyHint');
            var openHintOnHoverButton = new ymaps.control.Button('openHintOnHover');
            cursorButton.events
                    .add('select', function () {
                        cursor = 'help';
                    })
                    .add('deselect', function () {
                        cursor = 'crosshair';
                    });
            disableClickZoomButton.events
                    .add('click', function () {
                        disableClickZoom = !disableClickZoom;
                    });
            hideIconOnBalloonOpenButton.events
                    .add('click', function () {
                        hideIconOnBalloonOpen = !hideIconOnBalloonOpen;
                    });
            iconContentLayoutButton.events
                    .add('select', function () {
                        iconContentLayout = 'cluster#iconContent';
                    })
                    .add('deselect', function () {
                        iconContentLayout = MyIconContentLayout;
                    });
            openBalloonOnClickButton.events
                    .add('click', function () {
                        openBalloonOnClick = !openBalloonOnClick;
                    });
            openEmptyHintButton.events
                    .add('click', function () {
                        openEmptyHint = !openEmptyHint;
                    });
            openHintOnHoverButton.events
                    .add('click', function () {
                        openHintOnHover = !openHintOnHover;
                    });

            map.controls
                    .add(cursorButton)
                    .add(disableClickZoomButton)
                    .add(hideIconOnBalloonOpenButton)
                    .add(iconContentLayoutButton)
                    .add(openBalloonOnClickButton)
                    .add(openEmptyHintButton)
                    .add(openHintOnHoverButton);

            var content = [
                '',
                'Этот город завёрнут, как в саван, в туман, ',
                'И царит в нём безумье, порок и обман. ',
                'Город мрачных трущоб, весь изглоданный злом, ',
                'По ночам его мгла накрывает крылом.. . ',
                '',
                'И в глазницы домов смотрит ночь, словно ворон, ',
                'Этот город безукоризненно чёрен. ',
                'Только толпы теней, только Темзы свинец — ',
                'Этот город страшней, чем оживший мертвец. ',
                '',
                'И в роскошных дворцах вечный холод и тлен, ',
                'И часы мертвецам отбивает Биг-Бен. ',
                'Вы не бывали в Лондоне, сэр? ',
                'Этот город безукоризненно сер...'
            ].join('<br/>');

            for (var i = 0, l = 50; i < l; i++) {
                var placemark = new ymaps.GeoObject({
                    geometry: {
                        type: "Point",
                        coordinates: map.getCenter()
                    },
                    properties: {
                        balloonContentHeader: 'Заголовок метки №' + i,
                        balloonContentBody: 'Тело метки №' + i + content,
                        balloonContentFooter: 'Футер метки №' + i
                    }
                });
                geoObjects.push(placemark);
            }

            clusterer.add(geoObjects);
        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>