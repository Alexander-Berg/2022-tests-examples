<!DOCTYPE HTML>
<!--
Title:
Кластер: метод получения информации о текущем состоянии объекта

Description:
Проверка метода получения информации о текущем состоянии объекта, добавленного в менеджер.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
clusterer

Estimated time:
240000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней.

  Expectation:
  Карта отобразилась корректно.
  На спане карты кластерная метка со значением "3" и метка коллекций.
  Сверху имеются кнопки "5", "4", "3", "2", "1", "0".
  
Step:
  Action:
  Скролом мыши выполнить призум на одно значение.

  Expectation:
  Происходит корректный призум спана карты, при этом кластерная метка распадается на 2 метки коллекций. 
  На спане 3 метки коллекций.

Step:
  Action:
  Скролом мыши выполнить отзум на одно значение.

  Expectation:
  Происходит корректный отзум спана карты, при этом метки коллекций кластеризовались в кластерную метку со значением "3"(имеются невидимые метки). 
  На спане кластерная метка со значением "3" и метка коллекций.

Step:
  Action:
  Выполнить клик в кнопку "0".

  Expectation:
  Спан карты смещается для открытия балуна кластера.
  Кластерная метка пропадает, на ее месте открывается балун с двумя колонками.
  В балуне две колонки(правая колонка шире левой), в правой колонке окно с содержимым: заголовок крупным шрифтом черного цвета "Геообъект №1"; тело: "Содержимое балуна геообъекта №1".
  В левой колонке список из трех меток: Геообъект №1, Геообъект №2, Геооббъект №4, серым фоном выделена отображаемая в окне справа метка(Геообъект №1).
  Под контейнером с картой появляется блок с текстом: isShown: true, isClustered: true, cluster: [object Object].

Step:
  Action:
  Выполнить клик в кнопку закрытия панели балуна кластера - крестик.
  (если кнопка закрытия находится за пределами контейнера с картой, выполнить драг карты для отображения кнопки)

  Expectation:
  Балун закрывается, на спане карты кластерная метка со значением "3" и метка коллекций.

Step:
  Action:
  Выполнить клик в кнопку "1".

  Expectation:
  Спан карты смещается для открытия балуна кластера.
  Кластерная метка пропадает, на ее месте открывается балун с двумя колонками.
  В балуне две колонки(правая колонка шире левой), в правой колонке окно с содержимым: заголовок крупным шрифтом черного цвета "Геообъект №2"; тело: "Содержимое балуна геообъекта №2".
  В левой колонке список из трех меток: Геообъект №1, Геообъект №2, Геооббъект №4, серым фоном выделена отображаемая в окне справа метка(Геообъект №2).
  Под контейнером с картой появляется блок с текстом: isShown: true, isClustered: true, cluster: [object Object].

Step:
  Action:
  Выполнить клик в кнопку закрытия панели балуна кластера - крестик.
  (если кнопка закрытия находится за пределами контейнера с картой, выполнить драг карты для отображения кнопки)

  Expectation:
  Балун закрывается, на спане карты кластерная метка со значением "3" и метка коллекций.

Step:
  Action:
  Выполнить клик в кнопку "2".

  Expectation:
  Спан карты может сместиться для открытия балуна метки.
  Метка коллекции пропадает, на ее месте открывается балун, метка кластера на месте и не пропадает.
  В балуне метки содержимое: "Содержимое балуна геообъекта №3". 
  Под контейнером с картой появляется блок с текстом: isShown: true, isClustered: false, cluster: null.

Step:
  Action:
  Выполнить клик в кнопку закрытия панели балуна кластера - крестик.
  (если кнопка закрытия находится за пределами контейнера с картой, выполнить драг карты для отображения кнопки)

  Expectation:
  Балун закрывается, на спане карты кластерная метка со значением "3" и метка коллекций.

Step:
  Action:
  Выполнить клик в кнопку "3".

  Expectation:
  Спан карты смещается для открытия балуна кластера.
  Кластерная метка пропадает, на ее месте открывается балун с двумя колонками.
  В балуне две колонки(правая колонка шире левой), в правой колонке окно с содержимым: заголовок крупным шрифтом черного цвета "Геообъект №4"; тело: "Содержимое балуна геообъекта №4".
  В левой колонке список из трех меток: Геообъект №1, Геообъект №2, Геооббъект №4, серым фоном выделена отображаемая в окне справа метка(Геообъект №4).
  Под контейнером с картой появляется блок с текстом: isShown: true, isClustered: true, cluster: [object Object].

Step:
  Action:
  Выполнить клик в кнопку закрытия панели балуна кластера - крестик.
  (если кнопка закрытия находится за пределами контейнера с картой, выполнить драг карты для отображения кнопки)

  Expectation:
  Балун закрывается, на спане карты кластерная метка со значением "3" и метка коллекций.

Step:
  Action:
  Выполнить клик в кнопку "4".

  Expectation:
  Спан карты может сместиться для открытия балуна метки.
  На спане между кластерной меткой и меткой коллекции открывается балун.
  В балуне метки содержимое: "Содержимое балуна геообъекта №5". 
  Под контейнером с картой появляется блок с текстом: isShown: true, isClustered: false, cluster: null.

Step:
  Action:
  Выполнить клик в кнопку закрытия панели балуна кластера - крестик.
  (если кнопка закрытия находится за пределами контейнера с картой, выполнить драг карты для отображения кнопки)

  Expectation:
  Балун закрывается, на спане карты кластерная метка со значением "3" и метка коллекций.  

Step:
  Action:
  Выполнить клик в кнопку "5".

  Expectation:
  Метки на спане карты не пропадают.
  Под контейнером с картой появляется блок с текстом: isShown: false, isClustered: false, cluster: null. 
-->
<html>
<head>
<title>2.1</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<script src="../../helper.js"></script>
<script type=text/javascript>

    Api('init');

    function init(ymaps) {
        ymaps = ym;

        var map = myMap = new ym.Map('map', {
            center: [56.034, 36.992],
            zoom: 12,
            behaviors: ['default', 'scrollZoom'],
            controls: ['fullscreenControl']
        });

        addGrid(myMap);
        var log = new Log();

        log.info('Description:');
        log.info('0 - shown and clustered');
        log.info('1 - shown and clustered');
        log.info('2 - shown and not clustered');
        log.info('3 - shown and clustered (invisible)');
        log.info('4 - shown and not clustered (invisible)');
        log.info('5 - not on the map');
        log.info('');

        var myGeoObjects = [];
        myGeoObjects[0] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [56.025, 36.992] },
            properties: {
                clusterCaption: 'Геообъект №1',
                balloonContentBody: 'Содержимое балуна геообъекта №1.'
            }
        });
        myGeoObjects[1] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [56.021, 36.983] },
            properties: {
                clusterCaption: 'Геообъект №2',
                balloonContentBody: 'Содержимое балуна геообъекта №2.'
            }
        });
        myGeoObjects[2] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [56.045, 36.983] },
            properties: {
                clusterCaption: 'Геообъект №3',
                balloonContentBody: 'Содержимое балуна геообъекта №3.'
            }
        });
        myGeoObjects[3] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [56.021, 36.998] },
            properties: {
                clusterCaption: 'Геообъект №4',
                balloonContentBody: 'Содержимое балуна геообъекта №4.'
            }
        }, {
            visible: false
        });
        myGeoObjects[4] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [56.034, 36.976] },
            properties: {
                clusterCaption: 'Геообъект №5',
                balloonContentBody: 'Содержимое балуна геообъекта №5.'
            }
        }, {
            visible: false
        });
        myGeoObjects[5] = new ymaps.GeoObject({
            geometry: { type: "Point", coordinates: [61, 31] },
            properties: {
                clusterCaption: 'Геообъект №6',
                balloonContentBody: 'Содержимое балуна геообъекта №6.'
            }
        });

        var clusterer = new ymaps.Clusterer({ clusterDisableClickZoom: true });

        clusterer.add(myGeoObjects);
        map.geoObjects.add(clusterer);

        var state0Button = new ymaps.control.Button({data: {content: '0'}, options: {selectOnClick: false}});
        var state1Button = new ymaps.control.Button({data: {content: '1'}, options: {selectOnClick: false}});
        var state2Button = new ymaps.control.Button({data: {content: '2'}, options: {selectOnClick: false}});
        var state3Button = new ymaps.control.Button({data: {content: '3'}, options: {selectOnClick: false}});
        var state4Button = new ymaps.control.Button({data: {content: '4'}, options: {selectOnClick: false}});
        var state5Button = new ymaps.control.Button({data: {content: '5'}, options: {selectOnClick: false}});

        state0Button.events.add('click', function () {
            var object0State = clusterer.getObjectState(myGeoObjects[0]);
            console.log(object0State);
            log.info('isShown: ' + object0State.isShown);
            log.info('isClustered: ' + object0State.isClustered);
            if (object0State.isShown) {
                log.info('cluster: ' + object0State.cluster);
                if (object0State.isClustered) {
                    object0State.cluster.state.set('activeObject', myGeoObjects[0]);
                    clusterer.balloon.open(object0State.cluster);
                } else {
                    myGeoObjects[0].balloon.open();
                }
            } else {
                log.info('cluster: ' + object0State.cluster)
            }
            log.info('');
        });

        state1Button.events.add('click', function () {
            var object1State = clusterer.getObjectState(myGeoObjects[1]);
            console.log(object1State);
            log.info('isShown: ' + object1State.isShown);
            log.info('isClustered: ' + object1State.isClustered);
            if (object1State.isShown) {
                log.info('cluster: ' + object1State.cluster);
                if (object1State.isClustered) {
                    object1State.cluster.state.set('activeObject', myGeoObjects[1]);
                    clusterer.balloon.open(object1State.cluster);
                } else {
                    myGeoObjects[1].balloon.open();
                }
            } else {
                log.info('cluster: ' + object1State.cluster)
            }
            log.info('');
        });

        state2Button.events.add('click', function () {
            var object2State = clusterer.getObjectState(myGeoObjects[2]);
            console.log(object2State);
            log.info('isShown: ' + object2State.isShown);
            log.info('isClustered: ' + object2State.isClustered);
            if (object2State.isShown) {
                log.info('cluster: ' + object2State.cluster);
                if (object2State.isClustered) {
                    object2State.cluster.state.set('activeObject', myGeoObjects[2]);
                    clusterer.balloon.open(object2State.cluster);
                } else {
                    myGeoObjects[2].balloon.open();
                }
            } else {
                log.info('cluster: ' + object2State.cluster)
            }
            log.info('');
        });

        state3Button.events.add('click', function () {
            var object3State = clusterer.getObjectState(myGeoObjects[3]);
            console.log(object3State);
            log.info('isShown: ' + object3State.isShown);
            log.info('isClustered: ' + object3State.isClustered);
            if (object3State.isShown) {
                log.info('cluster: ' + object3State.cluster);
                if (object3State.isClustered) {
                    object3State.cluster.state.set('activeObject', myGeoObjects[3]);
                    clusterer.balloon.open(object3State.cluster);
                } else {
                    myGeoObjects[3].balloon.open();
                }
            } else {
                log.info('cluster: ' + object3State.cluster)
            }
            log.info('');
        });

        state4Button.events.add('click', function () {
            var object4State = clusterer.getObjectState(myGeoObjects[4]);
            console.log(object4State);
            log.info('isShown: ' + object4State.isShown);
            log.info('isClustered: ' + object4State.isClustered);
            if (object4State.isShown) {
                log.info('cluster: ' + object4State.cluster);
                if (object4State.isClustered) {
                    object4State.cluster.state.set('activeObject', myGeoObjects[4]);
                    clusterer.balloon.open(object4State.cluster);
                } else {
                    myGeoObjects[4].balloon.open();
                }
            } else {
                log.info('cluster: ' + object4State.cluster)
            }
            log.info('');
        });

        state5Button.events.add('click', function () {
            var object5State = clusterer.getObjectState(myGeoObjects[5]);
            console.log(object5State);
            log.info('isShown: ' + object5State.isShown);
            log.info('isClustered: ' + object5State.isClustered);
            if (object5State.isShown) {
                log.info('cluster: ' + object5State.cluster);
                if (object5State.isClustered) {
                    object5State.cluster.state.set('activeObject', myGeoObjects[5]);
                    clusterer.balloon.open(object5State.cluster);
                } else {
                    myGeoObjects[5].balloon.open();
                }
            } else {
                log.info('cluster: ' + object5State.cluster)
            }
            log.info('');
        });

        map.controls
                .add(state0Button)
                .add(state1Button)
                .add(state2Button)
                .add(state3Button)
                .add(state4Button)
                .add(state5Button)

    }
</script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>