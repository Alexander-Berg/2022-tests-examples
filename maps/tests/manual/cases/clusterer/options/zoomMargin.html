<!doctype html>
<!--
Title:
Кластер: отступы от границ карты, при клике на кластере

Description:
Проверка опции отступов от границ видимой области карты, которые соблюдаются при приближении карты после клика на кластере.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
clusterer

Estimated time:
90000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней.

  Expectation:
  Карта отобразилась корректно.
  На карте спан с кластерной меткой со значением кластеризации "30".
  Сверху имеется кнопки опции "[350, 35...", "[250, 10...", "[350,0]/...", "100/0", "clear".

Step:
  Action:
  Выполнить клик в кластерную метку.

  Expectation:
  Происходит призум и распад кластерной метки, на спане карты метки коллекций и кластерные метки с меньшим значением кластеризации.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[350, 35...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в нижнем левом углу контейнера с картой.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[350, 35...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в верхнем правом углу контейнера с картой.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[250, 10...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены снизу контейнера в центре(без отступа снизу).
  Между метками по вертикали имеются отсупы, также имеются неравные отступы в рядах.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[250, 10...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в правой части контейнера.
  Отступы между метками соотвествуют предыдущему шагу.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[350, 0]/...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в центре контейнера.
  Метки располагаются плотно, почти без отступов по горизонтали, вертикальные отступы между рядами имеются.

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[350, 0]/...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в центре контейнера.
  Метки имеют отступы по горизонтали и по вертикали(первый вертикальный ряд располагается почти без отступа ко второму).

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[100, 0]/...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Кластерная метка распадается, при этом на спане девять меток кластеров с меньшим значением кластеризации которые расположены в центре контейнера.
  Метки имеют отступы по горизонтали и по вертикали(первый вертикальный ряд располагается почти без отступа ко второму).

Step:
  Action:
  Выполнить клик в кнопку "clear".
  Выполнить клик в кнопку "[100, 0]/...".
  Выполнить клик в кластерную метку.

  Expectation:
  После нажатия кнопки "clear" происходит возврат спана к первоначальному виду с меткой кластера со значением "30".
  Происходит призум и распад кластерной метки, на спане карты метки коллекций и кластерные метки с меньшим значением кластеризации.
-->
<html>
<head>
    <title>API 2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script type="text/javascript">
        Api('init');
        function init(ym) {
            var map = myMap = new ym.Map('map', {
                center: [59.936708, 30.046006],
                zoom: 12,
                controls: ['fullscreenControl']
            });
            var bounds = map.getBounds();

            addGrid(map);
            var log = new Log();

            log.info('Clear the state after every zoomMargin change');

            var x = map.getCenter()[0], y = map.getCenter()[1], i = 0;
            var cluster = new ym.Clusterer();
            cluster.options.set({
                gridSize: 64
            });

            for (i = 0; i < 10; i++) {
                cluster.add(new ym.Placemark([x + 0.0037, y + (i - 5) / 1000]));
                cluster.add(new ym.Placemark([x + 0.0013, y + (i - 5) / 1000]));
                cluster.add(new ym.Placemark([x - 0.0014, y + (i - 5) / 1000]));
            }
            map.geoObjects.add(cluster);

            var button = new ym.control.Button("clear");
            button.events.add("click", function (e) {
                map.setBounds(bounds);
            });
            map.controls.add(button);

            button = new ym.control.Button("100 / 0");
            button.events.add("select", function (e) {
                cluster.options.set("zoomMargin", 100)
            }).add("deselect", function (e) {
                cluster.options.set("zoomMargin", 0)
            });
            map.controls.add(button);

            button = new ym.control.Button("[350, 0] / [0, 150]");
            button.events.add("select", function (e) {
                cluster.options.set("zoomMargin", [150, 0])
            }).add("deselect", function (e) {
                cluster.options.set("zoomMargin", [0, 150])
            });
            map.controls.add(button);

            button = new ym.control.Button("[250, 100, 0, 100] / [100, 0, 100, 250]");
            button.events.add("select", function (e) {
                cluster.options.set("zoomMargin", [250, 100, 0, 100])
            }).add("deselect", function (e) {
                cluster.options.set("zoomMargin", [100, 0, 100, 250])
            });
            map.controls.add(button);

            button = new ym.control.Button("[350, 350, 0, 0] / [0, 0, 350, 350]");
            button.events.add("select", function (e) {
                cluster.options.set("zoomMargin", [350, 350, 0, 0])
            }).add("deselect", function (e) {
                cluster.options.set("zoomMargin", [0, 0, 350, 350])
            });
            map.controls.add(button);
        }

    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;">
</div>
</body>
</html>
