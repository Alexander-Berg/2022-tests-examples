<!DOCTYPE HTML>
<!--(skip)(description)

-->
<!--(version)

-->
<!--(commands)

-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../../helper.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            ymaps = ym;

            var coords = [],
                    center = [55.744522, 37.616378],
                    features = [],
                    sourceObjectsQuery;

            var map = myMap = new ymaps.Map('map', {
                center: center,
                zoom: 3,
                type: 'yandex#map',
                controls: ['fullscreenControl', 'typeSelector']
            });
            __log__("Server: remoteServerFilter.js");
            var remoteObjectManager = new ymaps.RemoteObjectManager('https://alexa.maps.dev.yandex.ru:4782/?bbox=%b', {
                splitRequests: true,
                paddingTemplate: 'managerResponse_bbox_%b',
                clusterDisableClickZoom: true,
                geoObjectBalloonContentLayout: ymaps.templateLayoutFactory.createClass('{{properties.balloonContent}}')
            });

            map.geoObjects.add(remoteObjectManager);


            addGrid(myMap);
            var log = new Log();
            var state_1Button = new ymaps.control.Button({data: {content: '-1'}, options: {selectOnClick: false}});
            var state0Button = new ymaps.control.Button({data: {content: '0'}, options: {selectOnClick: false}});
            var state1Button = new ymaps.control.Button({data: {content: '1'}, options: {selectOnClick: false}});
            var state2Button = new ymaps.control.Button({data: {content: '2'}, options: {selectOnClick: false}});
            var state3Button = new ymaps.control.Button({data: {content: '3'}, options: {selectOnClick: false}});
            var state4Button = new ymaps.control.Button({data: {content: '4'}, options: {selectOnClick: false}});
            var state5Button = new ymaps.control.Button({data: {content: '5'}, options: {selectOnClick: false}});
            var state6Button = new ymaps.control.Button({data: {content: '6'}, options: {selectOnClick: false}});

            //не показан на карте
            state_1Button.events.add('click', function () {
                map.setZoom(13);
                setTimeout(function () {
                    var object_1State = remoteObjectManager.getObjectState(148);
                    console.log(object_1State);
                    log.info('isFound: ' + object_1State.found);
                    log.info('isShown: ' + object_1State.isShown);
                    log.info('isFilteredOut: ' + object_1State.isFilteredOut);
                    log.info('isClustered:' + object_1State.isClustered);
                    log.info('cluster:' + object_1State.cluster);
                    validateValue(object_1State.found, false);
                    validateValue(object_1State.isShown, undefined);
                    validateValue(object_1State.isFilteredOut, undefined);
                    validateValue(object_1State.isClustered, undefined);
                    validateValue(object_1State.cluster, undefined);
                    log.info('');
                }, 1000)
            });
            //не показан на карте
            state0Button.events.add('click', function () {
                var object0State = remoteObjectManager.getObjectState(0);
                console.log(object0State);
                log.info('isFound: ' + object0State.found);
                log.info('isShown: ' + object0State.isShown);
                log.info('isFilteredOut: ' + object0State.isFilteredOut);
                log.info('isClustered:' + object0State.isClustered);
                log.info('cluster:' + object0State.cluster);
                validateValue(object0State.found, false);
                validateValue(object0State.isShown, undefined);
                validateValue(object0State.isFilteredOut, undefined);
                validateValue(object0State.isClustered, undefined);
                validateValue(object0State.cluster, undefined);
                log.info('');

            });
            //показан на карте
            state1Button.events.add('click', function () {
                var object1State = remoteObjectManager.getObjectState(148);
                console.log(object1State);
                log.info('isFound: ' + object1State.found);
                log.info('isShown: ' + object1State.isShown);
                log.info('isFilteredOut: ' + object1State.isFilteredOut);
                log.info('isClustered:' + object1State.isClustered);
                log.info('cluster:' + object1State.cluster);
                validateValue(object1State.found, true);
                validateValue(object1State.isShown, true);
                validateValue(object1State.isFilteredOut, false);
                validateValue(object1State.isClustered, false);
                validateValue(object1State.cluster, undefined);
                log.info('');
            });
            //в кластере
            state2Button.events.add('click', function () {
                var object2State = remoteObjectManager.getObjectState(36);
                console.log(object2State);
                log.info('isFound: ' + object2State.found);
                log.info('isShown: ' + object2State.isShown);
                log.info('isFilteredOut: ' + object2State.isFilteredOut);
                log.info('isClustered:' + object2State.isClustered);
                log.info('cluster:' + object2State.cluster);
                validateValue(object2State.found, false);
                validateValue(object2State.isShown, undefined);
                validateValue(object2State.isFilteredOut, undefined);
                validateValue(object2State.isClustered, undefined);
                validateValue(object2State.cluster, undefined);
                log.info('');
            });
            //неточечная геометрия
            state3Button.events.add('click', function () {
                var object3State = remoteObjectManager.getObjectState(559);
                console.log(object3State);
                log.info('isFound: ' + object3State.found);
                log.info('isShown: ' + object3State.isShown);
                log.info('isFilteredOut: ' + object3State.isFilteredOut);
                log.info('isClustered:' + object3State.isClustered);
                log.info('cluster:' + object3State.cluster);
                validateValue(object3State.found, true);
                validateValue(object3State.isShown, true);
                validateValue(object3State.isFilteredOut, false);
                validateValue(object3State.isClustered, false);
                validateValue(object3State.cluster, undefined);
                log.info('');
            });
            //неточечная не показанная
            state4Button.events.add('click', function () {
                var object4State = remoteObjectManager.getObjectState(547);
                console.log(object4State);
                log.info('isFound: ' + object4State.found);
                log.info('isShown: ' + object4State.isShown);
                log.info('isFilteredOut: ' + object4State.isFilteredOut);
                log.info('isClustered:' + object4State.isClustered);
                log.info('cluster:' + object4State.cluster);
                validateValue(object4State.found, false);
                validateValue(object4State.isShown, undefined);
                validateValue(object4State.isFilteredOut, undefined);
                validateValue(object4State.isClustered, undefined);
                validateValue(object4State.cluster, undefined);
                log.info('');
            });
            //прошёл фильтрацию
            state5Button.events.add('click', function () {
                remoteObjectManager.setFilter('geometry.type == "Circle"');
                setTimeout(function () {
                    var object5State = remoteObjectManager.getObjectState(559);
                    console.log(object5State);
                    log.info('isFound: ' + object5State.found);
                    log.info('isShown: ' + object5State.isShown);
                    log.info('isFilteredOut: ' + object5State.isFilteredOut);
                    log.info('isClustered:' + object5State.isClustered);
                    log.info('cluster:' + object5State.cluster);
                    validateValue(object5State.found, true);
                    validateValue(object5State.isShown, true);
                    validateValue(object5State.isFilteredOut, false);
                    validateValue(object5State.isClustered, false);
                    validateValue(object5State.cluster, undefined);
                    remoteObjectManager.setFilter('');
                    log.info('');
                }, 1000);
            });
            //не прошёл фильтрацию
            state6Button.events.add('click', function () {
                remoteObjectManager.setFilter('geometry.type == "Circle"');
                setTimeout(function () {
                    var object6State = remoteObjectManager.getObjectState(477);
                    console.log(object6State);
                    log.info('isFound: ' + object6State.found);
                    log.info('isShown: ' + object6State.isShown);
                    log.info('isFilteredOut: ' + object6State.isFilteredOut);
                    log.info('isClustered:' + object6State.isClustered);
                    log.info('cluster:' + object6State.cluster);
                    validateValue(object6State.found, true);
                    validateValue(object6State.isShown, undefined);
                    validateValue(object6State.isFilteredOut, true);
                    validateValue(object6State.isClustered, undefined);
                    validateValue(object6State.cluster, undefined);
                    remoteObjectManager.setFilter('');
                    log.info('');
                }, 1000)
            });

            map.controls
                    .add(state_1Button)
                    .add(state0Button)
                    .add(state1Button)
                    .add(state2Button)
                    .add(state3Button)
                    .add(state4Button)
                    .add(state5Button)
                    .add(state6Button);
        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>