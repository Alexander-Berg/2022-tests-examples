<!DOCTYPE HTML>
<!--(skip)(description)
Clusterer: getObjectState()
-->
<!--(version)
-->
<!--(commands)
-->
<html>
<head>
<title>2.1</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<script src="../../../helper.js"></script>
<script src="../../../js/objectSource.js"></script>
<script type=text/javascript>

Api('init');

function init(ymaps) {

    ymaps = ym;

    var map = myMap = new ym.Map('map', {
        center: [55.70402572970743, 37.29611465251371],
        zoom: 15,
        behaviors: ['default', 'scrollZoom'],
        controls: ['fullscreenControl']
    });
    objectManagerSource(ym, myMap, this);
    addGrid(myMap);
    var log = new Log();

    var objectManager = new ymaps.ObjectManager({
        clusterize: false,
        clusterDisableClickZoom: true
    });

    objectManager.add(objectPlacemark1);
    objectManager.add(objectPlacemark2);
    objectManager.add(objectPlacemark3);
    objectManager.add(objectPlacemark4);
    objectManager.add(objectPlacemark5);
    objectManager.add(objectPlacemark6);
    objectManager.add(objectPlacemark7);
    objectManager.add(objectPlacemark8);
    objectManager.add(objectPlacemark9);
    objectManager.add(objectPlacemark10);
    objectManager.add(objectPlacemark11);
    objectManager.add(objectPlacemark12);
    objectManager.add(objectPlacemark13);
    objectManager.add(objectPlacemark14);
    objectManager.add(objectPlacemark15);
    objectManager.add(objectPlacemark16);
    objectManager.add(objectPlacemark17);
    objectManager.add(objectManagerArray);
    objectManager.add(objectManagerCollection);
    objectManager.add(objectManagerArrayNonPointObjects);
    objectManager.add(objectManagerCollectionNonPointObjects);
    objectManager.add(objectManagerPolygon);
    objectManager.add(objectManagerPolyline);
    objectManager.add(objectManagerCircle);
    objectManager.add(objectManagerRectangle);
    map.geoObjects.add(objectManager);

    var state_2Button = new ymaps.control.Button({data: {content: '-2'}, options: {selectOnClick: false}});
    var state_1Button = new ymaps.control.Button({data: {content: '-1'}, options: {selectOnClick: false}});
    var state0Button = new ymaps.control.Button({data: {content: '0'}, options: {selectOnClick: false}});
    var state1Button = new ymaps.control.Button({data: {content: '1'}, options: {selectOnClick: false}});
    var state2Button = new ymaps.control.Button({data: {content: '2'}, options: {selectOnClick: false}});
    var state3Button = new ymaps.control.Button({data: {content: '3'}, options: {selectOnClick: false}});
    var state4Button = new ymaps.control.Button({data: {content: '4'}, options: {selectOnClick: false}});
    var state5Button = new ymaps.control.Button({data: {content: '5'}, options: {selectOnClick: false}});
    var state6Button = new ymaps.control.Button({data: {content: '6'}, options: {selectOnClick: false}});

    //не существует
    state_2Button.events.add('click', function () {
        var object_2State = objectManager.getObjectState(-1);
        console.log(object_2State);
        log.info('found: ' + object_2State.found);
        log.info('isShown: ' + object_2State.isShown);
        log.info('isClustered: ' + object_2State.isClustered);
        log.info('cluster: ' + object_2State.cluster);
        log.info('isFilteredOut: ' + object_2State.isFilteredOut);
        validateValue(object_2State.found, false);
        validateValue(object_2State.isShown, undefined);
        validateValue(object_2State.isClustered, undefined);
        validateValue(object_2State.cluster, undefined);
        validateValue(object_2State.isFilteredOut, undefined);
        log.info('')

    });
    //показан, а потом не показан
    state_1Button.events.add('click', function () {
        map.setCenter([45.70402572970743, 37.29611465251371]);
        setTimeout(function () {
            var object_1State = objectManager.getObjectState(1);
            console.log(object_1State);
            log.info('found: ' + object_1State.found);
            log.info('isShown: ' + object_1State.isShown);
            log.info('isClustered: ' + object_1State.isClustered);
            log.info('cluster: ' + object_1State.cluster);
            log.info('isFilteredOut: ' + object_1State.isFilteredOut);
            validateValue(object_1State.found, true);
            validateValue(object_1State.isShown, false);
            validateValue(object_1State.isClustered, false);
            validateValue(object_1State.cluster, undefined);
            validateValue(object_1State.isFilteredOut, false);
            log.info('')
        }, 1000)
    });
    //не показан
    state0Button.events.add('click', function () {
        var object0State = objectManager.getObjectState(45);
        console.log(object0State);
        log.info('found: ' + object0State.found);
        log.info('isShown: ' + object0State.isShown);
        log.info('isClustered: ' + object0State.isClustered);
        log.info('cluster: ' + object0State.cluster);
        log.info('isFilteredOut: ' + object0State.isFilteredOut);
        validateValue(object0State.found, true);
        validateValue(object0State.isShown, false);
        validateValue(object0State.isClustered, false);
        validateValue(object0State.cluster, undefined);
        validateValue(object0State.isFilteredOut, false);
        log.info('')

    });

    //показан в кластере
    state1Button.events.add('click', function () {
        objectManager.options.set("clusterize", true);
        var object1State = objectManager.getObjectState(1);
        console.log(object1State);
        log.info('found: ' + object1State.found);
        log.info('isShown: ' + object1State.isShown);
        log.info('isClustered: ' + object1State.isClustered);
        log.info('cluster: ' + object1State.cluster);
        log.info('isFilteredOut: ' + object1State.isFilteredOut);
        validateValue(object1State.found, true);
        validateValue(object1State.isShown, true);
        validateValue(object1State.isClustered, true);
        validateValue(object1State.cluster, '[object Object]');
        validateValue(object1State.isFilteredOut, false);
        objectManager.options.set("clusterize", false);
        log.info('')
    });
    //показан без кластера
    state2Button.events.add('click', function () {
        var object2State = objectManager.getObjectState(34);
        console.log(object2State);
        log.info('found: ' + object2State.found);
        log.info('isShown: ' + object2State.isShown);
        log.info('isClustered: ' + object2State.isClustered);
        log.info('cluster: ' + object2State.cluster);
        log.info('isFilteredOut: ' + object2State.isFilteredOut);
        validateValue(object2State.found, true);
        validateValue(object2State.isShown, true);
        validateValue(object2State.isClustered, false);
        validateValue(object2State.cluster, undefined);
        validateValue(object2State.isFilteredOut, false);
        log.info('')
    });
    //показан неточечная
    state3Button.events.add('click', function () {
        var object3State = objectManager.getObjectState(59);
        console.log(object3State);
        log.info('found: ' + object3State.found);
        log.info('isShown: ' + object3State.isShown);
        log.info('isClustered: ' + object3State.isClustered);
        log.info('cluster: ' + object3State.cluster);
        log.info('isFilteredOut: ' + object3State.isFilteredOut);
        validateValue(object3State.found, true);
        validateValue(object3State.isShown, true);
        validateValue(object3State.isClustered, false);
        validateValue(object3State.cluster, undefined);
        validateValue(object3State.isFilteredOut, false);
        log.info('')
    });
    //не показан неточечная
    state4Button.events.add('click', function () {
        var object4State = objectManager.getObjectState(61);
        console.log(object4State);
        log.info('found: ' + object4State.found);
        log.info('isShown: ' + object4State.isShown);
        log.info('isClustered: ' + object4State.isClustered);
        log.info('cluster: ' + object4State.cluster);
        log.info('isFilteredOut: ' + object4State.isFilteredOut);
        validateValue(object4State.found, true);
        validateValue(object4State.isShown, false);
        validateValue(object4State.isClustered, false);
        validateValue(object4State.cluster, undefined);
        validateValue(object4State.isFilteredOut, false);
        log.info('')
    });
    //показан прошёл фильтрацию
    state5Button.events.add('click', function () {
        objectManager.setFilter('geometry.type == "Polygon"');
        setTimeout(function () {
            var object5State = objectManager.getObjectState(55);
            console.log(object5State);
            log.info('found: ' + object5State.found);
            log.info('isShown: ' + object5State.isShown);
            log.info('isClustered: ' + object5State.isClustered);
            log.info('cluster: ' + object5State.cluster);
            log.info('isFilteredOut: ' + object5State.isFilteredOut);
            validateValue(object5State.found, true);
            validateValue(object5State.isShown, true);
            validateValue(object5State.isClustered, false);
            validateValue(object5State.cluster, undefined);
            validateValue(object5State.isFilteredOut, false);
            objectManager.setFilter('');
            log.info('')
        }, 1000);
    });
    //показан не прошёл фильтрацию
    state6Button.events.add('click', function () {
        objectManager.setFilter('geometry.type == "Circle"');
        setTimeout(function () {
            var object6State = objectManager.getObjectState(60);
            console.log(object6State);
            log.info('found: ' + object6State.found);
            log.info('isShown: ' + object6State.isShown);
            log.info('isClustered: ' + object6State.isClustered);
            log.info('cluster: ' + object6State.cluster);
            log.info('isFilteredOut: ' + object6State.isFilteredOut);
            validateValue(object6State.found, true);
            validateValue(object6State.isShown, undefined);
            validateValue(object6State.isClustered, undefined);
            validateValue(object6State.cluster, undefined);
            validateValue(object6State.isFilteredOut, true);
            objectManager.setFilter('');
            log.info('')
        }, 1000);
    });

    map.controls
            .add(state_2Button)
            .add(state_1Button)
            .add(state0Button)
            .add(state1Button)
            .add(state2Button)
            .add(state3Button)
            .add(state4Button)
            .add(state5Button)
            .add(state6Button);

}
</script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>