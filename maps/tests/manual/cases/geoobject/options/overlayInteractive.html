<!DOCTYPE HTML>
<!--
Title:
Геообъект: интерактивные опции объектов

Description:
Проверка интерактивных опций объектов.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
geoobject

Estimated time:
300000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 
  
  Expectation:
  Карта отобразилась корректно.
  На карте спан Московской области, на спане два ряда объектов: метка, линия, многоугольник, прямоугольник, круг(верхний ряд синего цвета, нижний - зеленого).
  Сверху имеются кнопки "silent", "transpar...", "layer", "geoobject", "opaque", "draggable", справа снизу кнопки "value", "clear".
  (кнопка "clear" очищает содержимое под контейнером с картой, после выполнения каждого шага выполнять клик в кнопку)   

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего ряда выпадают события соотвествующих объектов: placemark, polyline, polygon, rectangle, circle.
  При наведении на объекты нижнего ряда выпадают события соотвествующих геообъектов: geoObjectPlacemark, geoObjectPolyline, geoObjectPolygon, geoObjectRectangle, geoObjectCircle.

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк [object Object].

Step:
  Action:
  Выполнить клик в кнопку "silent".
  
  Expectation:
  Под контейнером с картой появляется строка: "interactivity: silent".

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк "default#silent".

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего и нижнего рядов события объектов не выпадают, при этом при наведении на объект выпадает событие "map:mouseleave".

Step:
  Action:
  Выполнить клик в кнопку "draggable".
  
  Expectation:
  Спан карты без изменений.

Step:
  Action:
  Навести курсор на синий круг, зажав ЛКМ на объекте переместить курсор на спане карты.
  
  Expectation:
  При попытке переноса фигура происходит драг карты, объект не переносится на спане карты.
  Под контейнером с картой выпадают события наведения/покидания курсором карты, при зажатии ЛКМ и драге выпадает событие: "map: mousedown".

Step:
  Action:
  Выполнить клик в кнопку "transpar...".
  
  Expectation:
  Под контейнером с картой появляется строка: "interactivity: transparent".

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк "default#transparent".

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего ряда выпадают события соотвествующих объектов: placemark, polyline, polygon, rectangle, circle.
  При наведении на объекты нижнего ряда выпадают события соотвествующих геообъектов: geoObjectPlacemark, geoObjectPolyline, geoObjectPolygon, geoObjectRectangle, geoObjectCircle.

Step:
  Action:
  Выполнить клик в кнопку "layer".
  
  Expectation:
  Под контейнером с картой появляется строка: "interactivity: layer".

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк "default#layer".

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего ряда выпадают события соотвествующих объектов: placemark, polyline, polygon, rectangle, circle.
  При наведении на объекты нижнего ряда выпадают события соотвествующих геообъектов: geoObjectPlacemark, geoObjectPolyline, geoObjectPolygon, geoObjectRectangle, geoObjectCircle.

Step:
  Action:
  Выполнить клик в кнопку "geoobject".
  
  Expectation:
  Под контейнером с картой появляется строка: "interactivity: geoObject".

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк "default#geoObject".

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего ряда выпадают события соотвествующих объектов: placemark, polyline, polygon, rectangle, circle.
  При наведении на объекты нижнего ряда выпадают события соотвествующих геообъектов: geoObjectPlacemark, geoObjectPolyline, geoObjectPolygon, geoObjectRectangle, geoObjectCircle.

Step:
  Action:
  Выполнить клик в кнопку "opaque".
  
  Expectation:
  Под контейнером с картой появляется строка: "interactivity: opaque".

Step:
  Action:
  Выполнить клик в кнопку "value".
  
  Expectation:
  Под контейнером с картой появляется блок из 10 строк "default#opaque".

Step:
  Action:
  Последовательно навести курсор на все объекты в верхнем ряду и нижнем ряду.

  Expectation:
  При наведении курсора на карту и объекты под контейнером появляются события наведения/покидания карты(map): mouseenter, mouseleave.
  При наведении на объекты верхнего ряда выпадают события соотвествующих объектов: placemark, polyline, polygon, rectangle, circle.
  При наведении на объекты нижнего ряда выпадают события соотвествующих геообъектов: geoObjectPlacemark, geoObjectPolyline, geoObjectPolygon, geoObjectRectangle, geoObjectCircle.

Step:
  Action:
  Навести курсор на синий круг, зажав ЛКМ на объекте переместить курсор на спане карты.
  
  Expectation:
  Захват и перенос круга корректный.
  Под контейнером с картой выпадают события наведения/покидания курсором карты, при зажатии ЛКМ и переносе фигуре выпадает событие: "circle: mousedown".

Step:
  Action:
  Навести курсор на зеленый прямоугольник, зажав ЛКМ на объекте переместить курсор на спане карты.
  
  Expectation:
  Захват и перенос прямоугольника корректный.
  Под контейнером с картой выпадают события наведения/покидания курсором карты, при зажатии ЛКМ и переносе фигуре выпадает событие: "geoObjectRectangle: mousedown".
-->
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<script src="../../../helper.js"></script>
<script src="../geoCS.js"></script>
<script type=text/javascript>

Api('init');

function init(ymaps) {
    ymaps = ym; // hack

    var map = myMap = new ym.Map('map', {
                center: [55.73259667357658, 37.70153663432529],
                zoom: 9,
                behaviors: ['default', 'scrollZoom'],
                controls: []
            }), log = new Log(),
            collection = new ymaps.GeoObjectCollection(),
            events = ['click', 'contextmenu', 'dblclick', 'mousedown', 'mouseenter', 'mouseleave', 'mouseup',
                'multitouchend', 'multitouchstart', 'wheel'],
            callback1 = function (e) {
                log.info(e.get('target').options.get('id') + ': ' + e.get('type'));
                console.log(e.get('target').options.get('id') + ': ' + e.get('type'))
            },
            callback2 = function (e) {
                log.info(e.get('type'));
                console.log(e.get('type'))
            };

    geoCSSource(ym, map, this);
    addGrid(map);

    collection
            .add(geoObjectPlacemark)
            .add(geoObjectPolyline)
            .add(geoObjectPolygon)
            .add(geoObjectRectangle)
            .add(geoObjectCircle)
            .add(placemark)
            .add(polyline)
            .add(polygon)
            .add(rectangle)
            .add(circle);
    map.geoObjects.add(collection);

    collection.each(function (object) {
        addProperties(object);
        listenEventsOnObject(object);
    });

    //map.container.events.add(events, callback2);

    var opaqueButton = new ymaps.control.Button({data: {content: 'opaque'}, options: {selectOnClick: true}});
    var geoobjectButton = new ymaps.control.Button({data: {content: 'geoobject'}, options: {selectOnClick: true}});
    var layerButton = new ymaps.control.Button({data: {content: 'layer'}, options: {selectOnClick: true}});
    var transparentButton = new ymaps.control.Button({data: {content: 'transparent'}, options: {selectOnClick: true}});
    var silentButton = new ymaps.control.Button({data: {content: 'silent'}, options: {selectOnClick: true}});
    var valueButton = new ymaps.control.Button({data: {content: 'value'}, options: {selectOnClick: false}});
    var draggableButton = new ymaps.control.Button({data: {content: 'draggable'}, options: {selectOnClick: true}});
    var clearButton = new ymaps.control.Button({data: {content: 'clear'}, options: {selectOnClick: false}});

    // Объект получает все DOM-события и не прокидывает их на карту.
    // Поведения карты не будут работать при наведении или клике на объекты с данной моделью интерактивности
    opaqueButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#opaque');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', true)
                    })
                });
                log.info('interactivity: opaque');
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#opaque');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', false)
                    })
                });
                log.info('interactivity: opaque');
            });

    // Объект получает все DOM-события. На карту прокидываются события 'wheel' и 'mousedown'.
    // У события 'mousedown' выставляется флаг 'preventDefault'=true. Если на карте включены поведения 'scrollZoom' или 'magnifier',
    // они будут работать через объекты с данной моделью интерактивности, в отличие от объектов с моделью 'default#opaque'.
    geoobjectButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#geoObject');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', true)
                    });
                });

                log.info('interactivity: geoObject');
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#geoObject');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', false)
                    });
                });

                log.info('interactivity: geoObject');
            });

    // Объект получает все DOM-события. На карту прокидываются события 'wheel' и 'mousedown'.
    // Если на карте включены поведения 'scrollZoom', 'drag' или 'magnifier',
    // они будут работать через объекты с данной моделью интерактивности
    layerButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#layer');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', true)
                    });
                });
                log.info('interactivity: layer');
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#layer');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', false)
                    });
                });
                log.info('interactivity: layer');
            });

    // Объект получает все DOM-события, а затем прокидывает их на карту.
    transparentButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#transparent');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', true)
                    });
                });
                log.info('interactivity: transparent');
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#transparent');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', false)
                    });
                });
                log.info('interactivity: transparent');
            });

    // Объект перестает кидать события интерактивности, но пропускает их на карту.
    silentButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#silent');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', true)
                    });
                });
                log.info('interactivity: silent');
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'interactivityModel', 'default#silent');
                    object.getOverlay().then(function (res) {
                        res.options.set('interactive', false)
                    });
                });
                log.info('interactivity: silent');
            });

    draggableButton.events
            .add('select', function () {
                collection.each(function (object) {
                    setOption(object, 'draggable', true);
                });
            })
            .add('deselect', function () {
                collection.each(function (object) {
                    setOption(object, 'draggable', false);
                });
            });

    valueButton.events.add('click', function () {
        collection.each(function (object) {
            defaultValue(object);
        });
    });

    clearButton.events.add('click', function () {
        log.clear();
    });

    myMap.events.add(events, function (e) {
        log.info('map: ' + e.get('type'))
        console.log('map: ' + e.get('type'))
    });

    myMap.controls
            .add(opaqueButton, {float: 'left'})
            .add(geoobjectButton, {float: 'left'})
            .add(layerButton, {float: 'left'})
            .add(valueButton, {float: 'none', position: {bottom: 65, right: 5}})
            .add(transparentButton, {float: 'left'})
            .add(silentButton, {float: 'left'})
            .add(draggableButton, {float: 'right'})
            .add(clearButton, {float: 'none', position: {bottom: 35, right: 5}});

    function addProperties(obj) {
        obj.properties.set('balloonContent', 'balloon');
        obj.properties.set('hintContent', 'hint')
    }

    function listenEventsOnObject(obj) {
        obj.events.add(events, callback1);
    }

    function defaultValue(obj) {
        log.info(obj.options.get('interactivityModel'));
    }

    function setOption(obj, option, value) {
        obj.options.set(option, value);
    }
}
</script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>