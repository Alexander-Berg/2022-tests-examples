<!DOCTYPE HTML>
<!--
Title:
Геообъект: поворот и драг полигона со внутренним контуром

Description:
Проверка поворот и драг полигона со внутренним контуром.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
geoobject

Estimated time:
180000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 

  Expectation:
  В контейнере с картой отображается рамка с метками редактора внутри которой множетсво многоугольников. Сверху рамки поворотная кнопка со стрелкой.
  Сверху имеются кнопки "draggable", "framing".

Step:
  Action:
  Навести курсор на область внутри рамки, зажать ЛКМ и выполнить драг области.

  Expectation:
  Захват и драг корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой появляется блок: "Закончено редактирование" и 6 строк "OK".

Step:
  Action:
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку.

  Expectation:
  Захват и поворот рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой появляется блок: "Закончено редактирование" и 6 строк "OK".

Step:
  Action:
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и 6 строк "OK".

Step:
  Action:
  Выполнить клик в кнопку "framing".
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и 6 строк "OK".

Step:
  Action:
  Выполнить клик в кнопку "draggable".
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и 6 строк "OK".

Step:
  Action:
  Выполнить клик в кнопку "draggable".
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и 6 строк "OK".  

Step:
  Action:
  Выполнить клик в кнопку "framing".
  Навести курсор на область внутри рамки, зажать ЛКМ и выполнить драг.

  Expectation:
  Вокруг многоугольников пропадает рамка с метками редактирования и поворотной кнопкой.
  Захват и драг корректный: со спана ничего не пропадает, многоугольники не мигают цветами.
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script src="../../../js/geoCS.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            ymaps = ym; // hack

            var map = myMap = new ym.Map('map', {
                center: [55.72999394574634, 37.75001056119799],
                zoom: 23,
                behaviors: ['default', 'scrollZoom'],
                controls: ['fullscreenControl']
            });

            geoCSSource(ym, map, this);
            addGrid(map);
            var log = new Log();

            __log__('');

            var collection = new ymaps.GeoObjectCollection();
            collection
                //.add(geoObjectPolyline)
                //.add(geoObjectPolygon)
                //.add(polyline)
                    .add(polygon);
            map.geoObjects.add(collection);
            polygon.geometry.setCoordinates([
                [
                    [55.73000274332428, 37.749991115182624],
                    [55.72999735126062, 37.749991450458765],
                    [55.730001608153046, 37.74999463558196],
                    [55.72999763505346, 37.7499963119626],
                    [55.73000066217699, 37.74998776242136],
                    [55.729997729651075, 37.749986588954904],
                    [55.729996405284446, 37.749991618096814],
                    [55.729996405284446, 37.74999530613422],
                    [55.730000094591354, 37.74999966472386],
                    [55.73000387849549, 37.75000419095158],
                    [55.730003783897885, 37.74998189508915],
                    [55.72999517551541, 37.749998826533556],
                    [55.729998770224825, 37.7500031851232],
                    [55.730006527228156, 37.74999564141032],
                    [55.729998013443904, 37.74998139217496],
                    [55.73000671642335, 37.74998725950717],
                    [55.73000122976262, 37.7500077113509],
                    [55.72999479712493, 37.750004358589635],
                    [55.730006054240185, 37.74999966472386],
                    [55.73000785159443, 37.749991115182624],
                    [55.73000170275065, 37.749998323619366],
                    [55.72999394574634, 37.75000217929482],
                    [55.730006811020935, 37.7499834038317],
                    [55.73000094596981, 37.749978207051754],
                    [55.73000208114107, 37.75001508742569],
                    [55.729997540455855, 37.75001139938829],
                    [55.73001040572925, 37.749987091869095],
                    [55.73000851377755, 37.74998055398463],
                    [55.72999195919619, 37.74999782070517],
                    [55.73000387849549, 37.75001206994057],
                    [55.73000804078961, 37.75000201165676],
                    [55.729992053793836, 37.7499926239252],
                    [55.73001097331475, 37.74999312683939],
                    [55.73000491906906, 37.749975692480795],
                    [55.729995648503504, 37.7499857507646],
                    [55.73000927055825, 37.74999865889547],
                    [55.73000425688587, 37.75001508742569],
                    [55.73000841917997, 37.75001039355991],
                    [55.729995932296376, 37.75000905245542],
                    [55.73000274332428, 37.749991115182624]
                ],
                [
                    [55.72999981079853, 37.75001793727278],
                    [55.72999668907731, 37.75001793727278],
                    [55.72999829723676, 37.750019613653414],
                    [55.729996310686836, 37.75002045184372],
                    [55.72999668907731, 37.75001223757862],
                    [55.72999971620092, 37.75002162531018],
                    [55.72999763505346, 37.750022966414676],
                    [55.729995648503504, 37.750023469328866],
                    [55.72999451333206, 37.75002196058629],
                    [55.72999422953921, 37.75002028420566],
                    [55.729993567355834, 37.75001894310117],
                    [55.72999252678196, 37.7500145845115],
                    [55.729993378160586, 37.75001240521667],
                    [55.72999394574634, 37.75001056119799],
                    [55.73000066217699, 37.75001676380632],
                    [55.73000170275065, 37.750023972243056],
                    [55.730000283786566, 37.75002665445207],
                    [55.72999886482241, 37.75002766028045],
                    [55.72999744585824, 37.75002732500432],
                    [55.72999612149161, 37.75002665445207],
                    [55.72999460792969, 37.75002631917593],
                    [55.72999299977009, 37.7500246427953],
                    [55.729992053793836, 37.75002279877662],
                    [55.729991391610426, 37.75002129003404],
                    [55.72999072942702, 37.7500169314444],
                    [55.72999016184122, 37.750013243407004],
                    [55.729991486208064, 37.75000989064572],
                    [55.72998921586489, 37.750016596168265],
                    [55.72999016184122, 37.75002581626174],
                    [55.73000472987387, 37.75002028420566],
                    [55.73000255412908, 37.75003101304171],
                    [55.7299926213796, 37.75002078711985],
                    [55.72999886482241, 37.75001307576892],
                    [55.72999981079853, 37.75001793727278]
                ]
            ]);
            __log__("____Начальные условия____");
            __log__("Покрути и подрагай, всё должно быть ок");
            var coord = polygon.geometry.getCoordinates();
            validateValue(coord[0][0][0], coord[0][coord[0].length - 1][0]);
            validateValue(coord[0][0][1], coord[0][coord[0].length - 1][1]);
            validateValue(coord[1][0][0], coord[1][coord[1].length - 1][0]);
            validateValue(coord[1][0][1], coord[1][coord[1].length - 1][1]);
            validateValue(coord[0].length, 40);
            validateValue(coord[1].length, 34);
            collection.each(function (obj) {
                obj.editor.startFraming();
                obj.editor.events.add(['framingend'], function () {
                    __log__("____Закончено редактирование____");
                    var coord = polygon.geometry.getCoordinates();
                    validateValue(coord[0][0][0], coord[0][coord[0].length - 1][0]);
                    validateValue(coord[0][0][1], coord[0][coord[0].length - 1][1]);
                    validateValue(coord[1][0][0], coord[1][coord[1].length - 1][0]);
                    validateValue(coord[1][0][1], coord[1][coord[1].length - 1][1]);
                    validateValue(coord[0].length, 40);
                    validateValue(coord[1].length, 34);
                });
            });
            var editorButton = new ymaps.control.Button({data: {content: 'framing'}, options: {selectOnClick: true}});

            editorButton.events
                    .add('select', function () {
                        collection.each(function (obj) {
                            obj.editor.startFraming();
                        });
                    })
                    .add('deselect', function () {
                        collection.each(function (obj) {
                            obj.editor.stopFraming();
                        });
                    });
            map.controls.add(editorButton);
            var draggableButton = new ymaps.control.Button({data: {content: 'draggable'}, options: {selectOnClick: true}});

            draggableButton.events
                    .add('select', function () {
                        polygon.options.set("draggable", true)

                    })
                    .add('deselect', function () {
                        polygon.options.set("draggable", false)

                    });
            map.controls.add(draggableButton);
        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>