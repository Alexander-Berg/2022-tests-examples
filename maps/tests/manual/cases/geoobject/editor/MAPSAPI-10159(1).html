<!DOCTYPE HTML>
<!--
Title:
Геообъект: поворот и драг объекта линии

Description:
Проверка поворот и драг объекта линии.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components: 
geoobject

Estimated time:
120000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 

  Expectation:
  В контейнере с картой отображается рамка с метками редактора внутри которой линия. Сверху рамки поворотная кнопка со стрелкой.
  Сверху имеется кнопка "framing".

Step:
  Action:
  Навести курсор на область внутри рамки, зажать ЛКМ и выполнить драг области.

  Expectation:
  Захват и драг корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой появляется блок: "Закончено редактирование" и строка "OK".

Step:
  Action:
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку.

  Expectation:
  Захват и поворот рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой появляется блок: "Закончено редактирование" и строка "OK".

Step:
  Action:
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и строка "OK".

Step:
  Action:
  Выполнить клик в кнопку "framing".
  Навести курсор на кнопку поворота рамки, зажать ЛКМ и повернуть рамку, затем выполнить драг рамки.

  Expectation:
  Поворот и драг рамки корректный: со спана ничего не пропадает, область с рамкой не мигает цветами.
  Под контейнером с картой после поворота и драга появляются 2 блока: "Закончено редактирование" и строка "OK".

Step:
  Action:
  Выполнить клик в кнопку "framing".
  Навести курсор на область линии, зажать ЛКМ и выполнить драг.

  Expectation:
  Вокруг линии пропадает рамка с метками редактирования и поворотной кнопкой.
  Захват и драг корректный: со спана ничего не пропадает, линия не мигает цветами.
-->
<html>
<head>
    <title>2.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="../../../helper.js"></script>
    <script src="../../../js/geoCS.js"></script>
    <script type=text/javascript>

        Api('init');

        function init(ymaps) {
            ymaps = ym; // hack

            var map = myMap = new ym.Map('map', {
                center: [55.72999394574634, 37.75001056119799],
                zoom: 23,
                behaviors: ['default', 'scrollZoom'],
                controls: ['fullscreenControl']
            });

            geoCSSource(ym, map, this);
            addGrid(map);
            var log = new Log();

            __log__('');

            var collection = new ymaps.GeoObjectCollection();
            collection
                //.add(geoObjectPolyline)
                //.add(geoObjectPolygon)
                    .add(polyline);
            //.add(polygon);
            map.geoObjects.add(collection);
            polyline.geometry.setCoordinates([
                [55.73000690561853, 37.7499926239252],
                [55.730005108264244, 37.74999295920131],
                [55.730004162288274, 37.749993462115505],
                [55.73000312171469, 37.74999480322002],
                [55.730002459531484, 37.7499971501529],
                [55.73000208114107, 37.749999832361915],
                [55.7300008513722, 37.75000100582837],
                [55.729999999993744, 37.749998323619366],
                [55.72999971620092, 37.74999480322002],
                [55.73000018918895, 37.74999295920131],
                [55.7300008513722, 37.74999044463038],
                [55.73000141895784, 37.749988600611665],
                [55.72999971620092, 37.74998793005942],
                [55.72999820263915, 37.74998994171619],
                [55.729997729651075, 37.749991618096814],
                [55.72999763505346, 37.749993462115505],
                [55.729997256663, 37.74999597668646],
                [55.729998108041535, 37.75000067055224],
                [55.72999895942004, 37.7500031851232],
                [55.73000018918895, 37.75000368803739],
                [55.73000122976262, 37.75000368803739],
                [55.730002648726675, 37.750002849847064],
                [55.73000350010508, 37.74999966472386],
                [55.73000397309308, 37.74999681487679],
                [55.73000520286184, 37.74999480322002],
                [55.73000700021611, 37.74999413266777],
                [55.7300081353872, 37.74999312683939],
                [55.73000775699684, 37.74999094754457],
                [55.73000624343538, 37.74999044463038],
                [55.73000472987387, 37.74999094754457],
                [55.73000350010508, 37.74999212101101],
                [55.73000208114107, 37.749993965029695],
                [55.73000122976262, 37.74999614432451],
                [55.73000113516502, 37.749998323619366],
                [55.73000208114107, 37.75000150874257],
                [55.73000122976262, 37.75000217929482],
                [55.730000094591354, 37.75000201165676],
                [55.729999243212866, 37.75000067055224],
                [55.729998770224825, 37.749998491257415],
                [55.729998770224825, 37.749996479600654],
                [55.729998770224825, 37.749993462115505],
                [55.72999886482241, 37.74999077990649],
                [55.729999905396134, 37.74998994171619],
                [55.73000255412908, 37.74999044463038],
                [55.73000340550748, 37.74998826533556],
                [55.73000482447146, 37.74998793005942],
                [55.730005959642604, 37.74998793005942],
                [55.73000700021611, 37.74998876824975],
                [55.73000832458237, 37.749989103525856],
                [55.73000927055825, 37.74999178573487],
                [55.73000794619201, 37.74999597668646],
                [55.73000785159443, 37.74999815598128],
                [55.730006054240185, 37.74999597668646],
                [55.73000690561853, 37.75000050291418],
                [55.73000548665463, 37.74999815598128],
                [55.73000539205703, 37.750000838190296],
                [55.73000520286184, 37.75001240521667],
                [55.729999243212866, 37.75000653788446],
                [55.72999394574634, 37.75002078711985],
                [55.73001163549781, 37.74998793005942],
                [55.73001078411959, 37.7500077113509],
                [55.73000520286184, 37.75003017485141],
                [55.7300071894113, 37.7500100582838],
                [55.73000520286184, 37.74998373910783],
                [55.73000350010508, 37.75001559033988],
                [55.730002459531484, 37.74998541548846],
                [55.72999602689399, 37.74999245628712],
                [55.729995648503504, 37.75000301748511],
                [55.73000047298178, 37.750013243407004],
                [55.730008702972725, 37.750004861503825],
                [55.73001239227845, 37.750000838190296],
                [55.73000908136307, 37.749986588954904],
                [55.729995932296376, 37.749986588954904],
                [55.72999385114871, 37.75000536441802],
                [55.729995553905894, 37.75000821426509],
                [55.729998581029584, 37.75000502914188],
                [55.730008702972725, 37.75000201165676],
                [55.73000851377755, 37.750009723007665],
                [55.730005959642604, 37.75000569969413],
                [55.73000482447146, 37.75000569969413],
                [55.73000359470269, 37.75000586733221],
                [55.73000208114107, 37.75000804662703],
                [55.73000113516502, 37.75001039355991],
                [55.7300007567746, 37.75000553205607],
                [55.729999337810476, 37.750009723007665],
                [55.729998486431974, 37.7500063702464],
                [55.72999735126062, 37.75000368803739],
                [55.72999687827254, 37.74999932944772]
            ]);
            __log__("____Начальные условия____");
            __log__("Покрути и подрагай, всё должно быть ок");
            var coord = polyline.geometry.getCoordinates();
            validateValue(coord.length, 88);

            collection.each(function (obj) {
                obj.editor.startFraming();
                obj.editor.events.add(['framingend'], function () {
                    __log__("____Закончено редактирование____");
                    var coord = polyline.geometry.getCoordinates();

                    validateValue(coord.length, 88);
                });
            });

            var editorButton = new ymaps.control.Button({data: {content: 'framing'}, options: {selectOnClick: true}});

            editorButton.events
                    .add('select', function () {
                        collection.each(function (obj) {
                            obj.editor.startFraming();
                        });
                    })
                    .add('deselect', function () {
                        collection.each(function (obj) {
                            obj.editor.stopFraming();
                        });
                    });
            map.controls.add(editorButton);

        }
    </script>
</head>
<body style="position: relative; padding: 0; margin: 0;">
<div id="map" style="height: 512px; width: 512px;"></div>
</body>
</html>