<!DOCTYPE html>
<!--
Title:
Контрол: создание пользовательского контрола

Description:
Проверка создания пользовательского контрола.
Памятка по терминам: https://wiki.yandex-team.ru/eva/testing/Projects/maps-api/

Components:
regress_v1.1

Estimated time:
180000

Precondition:
Открыть ссылку ${currentPagePath}

Step:
  Action:
  Осмотреть карту и элементы на ней. 

  Expectation:
  Карта загрузилась корректно со спаном Москвы, на карте две синих метки.
  Справа сверху список из ссылок-кнопок.

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Одесса". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Одессы.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Одесса; Одесса, пр. Шевченко, дом 4-Д, офис 61".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Екатеринбург". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Екатеринбурга.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Екатеринбург; Екатеринбург, ул. Гагарина, 8, офис 602".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Санкт-Петербург". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Санкт-Петербурга.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Санкт-Петербург; Санкт-Петербург, Cвердловская набережная, дом 44, бизнес-центр «Бенуа» (4-6 эт.)".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Москва(Самокатная)". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Москвы.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Москва (Самокатная); Москва, ул. Самокатная, дом 1, строение 21".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Киев". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Киева.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Киев; Киев, ул. Луначарского, 4".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Симферополь". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Симферополя.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Симферополь; Симферополь, ул. Героев Аджимушкая, 6/13, второй этаж".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Burlingame". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Burlingame в США.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Burlingame; 3d floor, Suite 306, 330 Primrose Road Burlingame, CA 94010".

Step:
  Action:
  Выполнить клик в ссылку-кнопку "Москва(Парк Культуры)". 

  Expectation:
  По клику карта выполняет перемещение спана на спан Москвы.
  Карта при перемещении не мигает цветами, нет странных визуальных эффектов.
  В центре спана балун "Москва (Парк культуры); Москва, ул. Тимура Фрунзе, 11 и ул. Льва Толстого, 16".
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Примеры. Создание пользовательского элемента управления.</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="/1.1/index.xml?counters=all" type="text/javascript"></script>
    <script type="text/javascript">
        // Создание обработчика для события window.onLoad
        YMaps.jQuery(function () {
            // Создание экземпляра карты и его привязка к созданному контейнеру
            var map = new YMaps.Map(YMaps.jQuery("#YMapsID")[0]);

            // Установка для карты ее центра и масштаба
            map.setCenter(new YMaps.GeoPoint(37.64, 55.76), 10);

            // Создание группы объектов и добавление ее на карту
            var group = new YMaps.GeoObjectCollection();
            group.add(createPlacemark(new YMaps.GeoPoint(37.678514, 55.758255), 'Москва (Самокатная)', 'Москва, ул. Самокатная, дом 1, строение 21'));
            group.add(createPlacemark(new YMaps.GeoPoint(37.587398, 55.734172), 'Москва (Парк культуры)', 'Москва, ул. Тимура Фрунзе, 11 и ул. Льва Толстого, 16'));
            group.add(createPlacemark(new YMaps.GeoPoint(60.644555, 56.845209), 'Екатеринбург', 'Екатеринбург, ул. Гагарина, 8, офис 602'));
            group.add(createPlacemark(new YMaps.GeoPoint(30.406127143, 59.9590655815), 'Санкт-Петербург', 'Санкт-Петербург, Cвердловская набережная, дом 44, бизнес-центр «Бенуа» (4-6 эт.)'));
            group.add(createPlacemark(new YMaps.GeoPoint(30.749512, 46.459542), 'Одесса', 'Одесса, пр. Шевченко, дом 4-Д, офис 61'));
            group.add(createPlacemark(new YMaps.GeoPoint(30.598379, 50.45332), 'Киев', 'Киев, ул. Луначарского, 4'));
            group.add(createPlacemark(new YMaps.GeoPoint(34.095482, 44.949507), 'Симферополь', 'Симферополь, ул. Героев Аджимушкая, 6/13, второй этаж'));
            group.add(createPlacemark(new YMaps.GeoPoint(-122.348557, 37.578894), 'Burlingame', '3d floor, Suite 306, 330 Primrose Road Burlingame, CA 94010'));
            map.addOverlay(group);

            // Создание управляющего элемента "Путеводитель по офисам"
            map.addControl(new OfficeNavigator(group));
        });

        // Функия создания метки
        function createPlacemark (geoPoint, name, description) {
            var placemark = new YMaps.Placemark(geoPoint);
            placemark.name = name;
            placemark.description = description;

            return placemark;
        }

        // Управляющий элемент "Путеводитель по офисам", реализиует интерфейс YMaps.IControl
        function OfficeNavigator (offices) {

            // Добавление на карту
            this.onAddToMap = function (map, position) {
                    this.container = YMaps.jQuery("<ul></ul>")
                    this.map = map;
                    this.position = position || new YMaps.ControlPosition(YMaps.ControlPosition.TOP_RIGHT, new YMaps.Size(10, 10));

                    // Выставление необходимых CSS-свойств
                    this.container.css({
                        position: "absolute",
                        zIndex: YMaps.ZIndex.CONTROL,
                        background: '#fff',
                        listStyle: 'none',
                        padding: '10px',
                        margin: 0
                    });
                    
                    // Формирование списка офисов
                    this._generateList();
                    
                    // Применение позиции к управляющему элементу
                    this.position.apply(this.container);
                    
                    // Добавление на карту
                    this.container.appendTo(this.map.getContainer());
            }

            // Удаление с карты
            this.onRemoveFromMap = function () {
                this.container.remove();
                this.container = this.map = null;
            };

            // Пока "летим" игнорируем клики по ссылкам
            this.isFlying = 0;

            // Формирование списка офисов
            this._generateList = function () {
                var _this = this;
                
                // Для каждого объекта вызываем функцию-обработчик
                offices.forEach(function (obj) {
                    // Создание ссылки на объект
                    var li = YMaps.jQuery("<li><a href=\"#\">" + obj.name + "</a></li>"),
                        a = li.find("a"); 
                    
                    // Создание обработчика щелчка по ссылке
                    li.bind("click", function () {
                        if (!_this.isFlying) {
                            _this.isFlying = 1;
                            _this.map.panTo(obj.getGeoPoint(), {
                                flying: 1,
                                callback: function () {
                                    obj.openBalloon();
                                    _this.isFlying = 0;
                                }
                            });
                        }
                        return false;
                    });
                    
                    // Слушатели событий на открытие и закрытие балуна у объекта
                    YMaps.Events.observe(obj, obj.Events.BalloonOpen, function () {
                        a.css("text-decoration", "none");
                    });
                    
                    YMaps.Events.observe(obj, obj.Events.BalloonClose, function () {
                        a.css("text-decoration", "");
                    });
                    
                    // Добавление ссылки на объект в общий список
                    li.appendTo(_this.container);
                });
            };
        }
    </script>
</head>

<body>
    <div id="YMapsID" style="width:600px;height:400px"></div>
</body>
</html>
