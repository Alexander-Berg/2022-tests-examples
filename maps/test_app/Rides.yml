Components:
  - mobile_app_test
Feature:
  - Rides

specs:
  Свободный заезд. Старт/Стоп сессии:
    - description: Съёмка маршрута в режиме свободного заезда
    - info: |
        Подменить местоположение, построить маршрут и начать движение по маршруту в приложении Mock Location: https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid
        Залогиниться в приложении.
    - do: |
        Зайти в раздел "Свободный заезд".
        При необходимости дать приложению доступ к камере и геолокации.
    - assert: |
        - Открылся режим съёмки дороги
        - Камера сфокусирована в бесконечность
    - do: |
        Убедиться, что чекбокс "Снимать только цели" не выставлен.
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Кнопка "СТАРТ" превратилась в кнопку "СТОП"
        - Счетчик "Количество фотографий" увеличивается
        - Счетчик "Длительность поездки" увеличивается. (Длительность округляется до минут, поэтому первое изменение произойдет только через 30 секунд).
        - Счетчик "Длина трека" увеличивается.
    - do: Тапнуть по кнопке "СТОП".
    - assert: |
        - Съемка остановилась
        - Кнопка "СТОП" превратилась в кнопку "СТАРТ"
        - Счетчики "Количество фотографий", "Длительность поездки", "Длина трека" не увеличивается.

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Свободный заезд. Симуляция проезда:
    - description: Симуляция свободного заезда с подменой координат
    - info: |
        Запустить на компьютере видео: https://photos.google.com/share/AF1QipMkFhFNjZuC2nmFzkmmX4uzu_eiGMuvgnspTLIAMsYST7SWEhRoQecVz_dC9MompA/photo/AF1QipPxhPzdDVZy0WiZZwC5tRPyWh8DKTwIrIHSgfyr?key=elRCR2R6dHNrQm5Vc00wQld0ZlljSXlUNE5yX0x3
        
        В приложении [Mock Location](https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid) подменить местоположение, построить маршрут вдоль дорог, выбрать скорость маршрута 40 км/ч +/- 5 км/ч и начать движение по маршруту.
        
        Телефон подключен к WiFi.
        
        Залогиниться в приложении.
    - do: |
        Зайти в раздел "Свободный заезд".
        При необходимости дать приложению доступ к камере и геолокации.
    - assert: |
        - Открылся режим съёмки дороги
        - Камера сфокусирована в бесконечность
    - do:
        Навести камеру телефона на видео из предусловия.
        Убедиться, что чекбокс "Снимать только цели" не выставлен.
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Кнопка "СТАРТ" превратилась в кнопку "СТОП"
        - Счетчик "Количество фотографий" увеличивается
        - Счетчик "Длительность поездки" увеличивается. (Длительность округляется до минут, поэтому первое изменение произойдет только через 30 секунд).
        - Счетчик "Длина трека" увеличивается.
    - do: |
        Тапнуть по кнопке "СТОП".
        Тапнуть кнопку "Назад" на смартфоне.
    - assert: |
        - Съемка остановилась
        - Произошел возврат в главное меню приложения
    - do: Зайти в раздел "Выгрузка данных".
    - assert: |
        - Число фотографий с заездов совпадает с числом фотографий в счетчике на экране заезда
        - Есть надпись "Выгрузка остановлена" и кнопка "НАЧАТЬ ВЫГРУЗКУ"
    - do: Тапнуть по кнопке "НАЧАТЬ ВЫГРУЗКУ".
    - assert: |
        - Во время выгрузки число фотографий с заездов уменьшается до 0
        - Есть надпись "Выгрузка запущена"
    - do: Дождаться окончания выгрузки.
    - assert: По завершении выгрузки на экране надпись "Выгрузка остановлена"
    - do: |
        Дождаться публикации фотографий.
        Оценить расстояние между парами соседних фотографий в mrc-planner или НЯК.
    - assert: Расстояние между парами соседних фотографий составляет не более 5 м

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Свободный заезд. Симуляция проезда с учетом целей:
    - description: Симуляция свободного заезда с подменой координат с учетом целей съемки
    - info: |
        Запустить на компьютере видео: https://photos.google.com/share/AF1QipMkFhFNjZuC2nmFzkmmX4uzu_eiGMuvgnspTLIAMsYST7SWEhRoQecVz_dC9MompA/photo/AF1QipPxhPzdDVZy0WiZZwC5tRPyWh8DKTwIrIHSgfyr?key=elRCR2R6dHNrQm5Vc00wQld0ZlljSXlUNE5yX0x3
        
        В приложении [Mock Location](https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid) подменить местоположение, **построить маршрут через местность вдали от любых дорог** и начать движение по маршруту.
        
        Телефон подключен к WiFi.
        
        Залогиниться в приложении.
    - do: |
        Зайти в раздел "Свободный заезд".
        При необходимости дать приложению доступ к камере и геолокации.
    - assert: |
        - Открылся режим съёмки дороги
        - Камера сфокусирована в бесконечность
    - do:
        Навести камеру телефона на видео из предусловия.
        Убедиться, что чекбокс "Снимать только цели" не выставлен.
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Кнопка "СТАРТ" превратилась в кнопку "СТОП"
        - Счетчик "Количество фотографий" увеличивается
    - do: |
        Тапнуть по кнопке "СТОП".
        Включить чекбокс "Снимать только цели".
    - assert: |
        - Счетчики "Количество фотографий", "Длительность поездки", "Длина трека" обнулились.
    - do: |
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Мини-карта отображает движение по маршруту
        - Съемка не выполняется
        - Счетчик "Количество фотографий" не увеличивается
        - Счетчик "Длительность поездки" увеличивается. (Длительность округляется до минут, поэтому первое изменение произойдет только через 30 секунд).
        - Счетчик "Длина трека" увеличивается.
    - do: |
        Тапнуть по кнопке "СТОП".
        Снова отключить чекбокс "Снимать только цели".
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Счетчик "Количество фотографий" увеличивается
        - Счетчик "Длительность поездки" увеличивается. (Длительность округляется до минут, поэтому первое изменение произойдет только через 30 секунд).
        - Счетчик "Длина трека" увеличивается.
    - do: |
        В приложении Mock Location построить новый маршрут, проходящий через автомобильные дороги, вдоль которых нет свежих фотографий.
        Начать движение по маршруту.
    - assert: Движение по маршруту в MockLocations запустилось
    - do: |
        В приложении MrcTestApp вернуться на экран свободного заезда.
        Включить чекбокс "Снимать только цели".
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Счетчик "Количество фотографий" увеличивается
    - do: Тапнуть по кнопке "СТОП".
    - assert: |
        - Съемка остановилась
        - Кнопка "СТОП" превратилась в кнопку "СТАРТ"
        - Счетчик "Количество фотографий" не увеличивается

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Свободный заезд. Длительная съемка:
    - description: Длительная съёмка маршрута
    - info: |
        Запустить на компьютере видео (если компьютера нет, пропустить этот шаг): https://photos.google.com/share/AF1QipMkFhFNjZuC2nmFzkmmX4uzu_eiGMuvgnspTLIAMsYST7SWEhRoQecVz_dC9MompA/photo/AF1QipPxhPzdDVZy0WiZZwC5tRPyWh8DKTwIrIHSgfyr?key=elRCR2R6dHNrQm5Vc00wQld0ZlljSXlUNE5yX0x3
        
        Подменить местоположение, построить маршрут и начать движение по маршруту в приложении Mock Location: https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid
        Залогиниться в приложении.
    - do: |
        Зайти в раздел "Свободный заезд".
        При необходимости дать приложению доступ к камере и геолокации.
    - assert: |
        - Открылся режим съёмки дороги
        - Камера сфокусирована в бесконечность
    - do: |
        Убедиться, что чекбокс "Снимать только цели" не выставлен.
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Мини-карта отображает движение по маршруту
        - Кнопка "СТАРТ" превратилась в кнопку "СТОП"
        - Счетчик "Количество фотографий" увеличивается
        - Счетчик "Длительность поездки" увеличивается. (Длительность округляется до минут, поэтому первое изменение произойдет только через 30 секунд).
        - Счетчик "Длина трека" увеличивается.
    - do: |
        Вести съемку разных объектов (в помещении, на улице, окно, видео из предусловия) в течение 10 минут, в т.ч.:
        - в условиях контрастной освещенности (например, яркое небо сверху)
        - со сменой ориентации экрана
        _**ВАЖНО!** В приложении MrcTestApp нет поддержки фонового режима съемки._
    - assert: |
        - Съемка ведется непрерывно
        - Камера сфокусирована в бесконечность
        - Снимки имеют адекватную освещенность
    - do: |
        Спустя 10 минут тапнуть по кнопке "СТОП".
    - assert: Запись остановилась
    - do: |
        Запомнить количество снятых кадров.
        Вернуться на главный экран кнопкой смартфона "Назад".
    - assert: Вернулись на главный экран приложения
    - do: Зайти в раздел "Выгрузка данных".
    - assert: |
        - Открылся экран выгрузки с надписью "Выгрузка остановлена" и кнопкой "Начать выгрузку"
        - Число фотографий с заездов совпадает с числом фотографий в счетчике на экране заезда, а число пешеходных фотографий неточностей совпадает с числом сделанных пешеходных фотографий
    - do: Тапнуть по кнопке "Начать выгрузку".
    - assert: |
        - Есть надпись "Выгрузка запущена"
        - Во время выгрузки число фотографий с заездов и пешеходных фотографий уменьшается до 0
    - do: Дождаться окончания выгрузки.
    - assert: По завершении выгрузки на экране надпись "Выгрузка остановлена"

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Свободный заезд. Исчерпание свободного места:
    - description: Исчерпание свободного места для хранения фотографий во время свободного заезда
    - info: |
        Сохранение фотографий настроено во внутреннюю память устройтва.
        
        Заполнить внутреннюю память так, чтобы осталось менее 200 Мб свободного места.
        
        В приложении Mock Location (https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid) подменить местоположение и начать движение по маршруту.
        
        Залогиниться в приложении.
    - do: |
        Зайти в раздел "Свободный заезд".
        При необходимости дать приложению доступ к камере и геолокации.
    - assert: |
        - Открылся режим съёмки дороги
        - Камера сфокусирована в бесконечность
    - do: |
        Убедиться, что чекбокс "Снимать только цели" не выставлен.
        Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Счетчик "Количество фотографий" увеличивается
        - На экране периодически появляется сообщение "Свободное место скоро закончится" с указанием размера оставшегося места
        _**ВАЖНО!** Размер отображаемого свободного места меньше фактического свободного места на диске, разница составляет примерно 128 Мб._
    - do: |
        Дождаться, когда размер свободного места уменьшится до нуля.
        Чтобы ускорить процесс, можно заполнить свободное место в памяти телефона, скопировав на него еще больше файлов.
    - assert: |
        - Съемка остановилась
        - Кнопка "СТАРТ/СТОП" исчезла с экрана
        - Счетчик "Количество фотографий" не увеличивается
        - На экране периодически появляется сообщение "Свободное место закончилось"
    - do: |
        Через файловый менеджер, или подключив телефон к компьютеру, освободить как минимум 300 Мб.
        Вернуться на экран свободного заезда в приложении.
    - assert: |
        - На экране есть кнопка "СТАРТ"
    - do: Тапнуть по кнопке "СТАРТ".
    - assert: |
        - Началась съемка
        - Счетчик "Количество фотографий" увеличивается
        - Сообщение о недостаточном свободном месте не появляется

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Выгрузка данных. Wi-Fi и мобильный интернет:
    - description: Выгрузка снимков на карту
    - info: |
        Залогиниться в приложении.
        Сделать более 200 снимков в режиме "Свободный заезд".
        Сохранить один или более снимков в режиме "Фотографирование неточностей".
        В приложении в разделе "Настройки" выключить тумблер "Разрешить выгрузку через сотовую сеть".
        Отключить на телефоне мобильный интернет.
        Подключиться к Wi-Fi.
    - do: Зайти в раздел "Выгрузка данных".
    - assert: |
        - Открылся экран выгрузки с надписью "Выгрузка остановлена" и кнопкой "Начать выгрузку"
        - Число фотографий с заездов совпадает с числом фотографий в счетчике на экране заезда, а число пешеходных фотографий неточностей совпадает с числом сделанных пешеходных фотографий
    - do: Тапнуть по кнопке "Начать выгрузку".
    - assert: |
        - Есть надпись "Выгрузка запущена"
        - Во время выгрузки число фотографий с заездов и пешеходных фотографий уменьшается до 0
    - do: Не дожидаясь выгрузки всех данных, остановить выгрузку.
    - assert: |
        - Выгрузка остановилась
        - Счетчики фотографий не уменьшаются
    - do: |
        Отключить на телефоне Wi-Fi.
        Тапнуть по кнопке "Начать выгрузку"
    - assert: |
        - На экране надпись "Ждем подключения"
        - Выгрузка не идет
    - do: |
        Остановить выгрузку.
        Включить на телефоне мобильный интернет.
        Тапнуть по кнопке "Начать выгрузку".
    - assert: |
        - На экране надпись "Ждем подключения"
        - Выгрузка не идет
    - do: |
        Кнопкой "Назад" вернуться на главный экран приложения.
        Зайти в раздел "Настройки".
        Включить тумблер "Разрешить выгрузку через сотовую сеть".
        Вернуться в раздел "Выгрузка данных" и тапнуть по кнопке "Начать выгрузку".
    - assert: |
        - Есть надпись "Выгрузка запущена"
        - Во время выгрузки число фотографий с заездов и пешеходных фотографий уменьшается
    - do: Подключиться к Wi-Fi.
    - assert: Выгрузка данных продолжилась.
    - do: Остановить выгрузку.
    - assert: Выгрузка остановилась, счетчик фотографий перестал уменьшаться.

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Настройки. Место хранения фотографий:
    - description: Проверка работы приложения с SD-картой
    - info: |
        Установить SD-карту в девайс.
        Удалить приложение "MrcTestApp", если оно было ранее установлено.
        Установить приложение заново. 
        Подменить местоположение, построить маршрут и начать движение по маршруту в приложении Mock Location: https://wiki.yandex-team.ru/eva/testing/projects/mirrors/#podmenamestopolozhenijanaandroid
        Залогиниться в приложении "MrcTestApp".
    - do: |
        Тапнуть по иконке "Настройки".
        В настройках выбрать место хранения фотографий - "Карта памяти".
    - assert: Хранение файлов успешно переключилось на SD-карту
    - do: |
        Вернуться на главный экран приложения.
        Зайти в раздел "Свободный заезд".
        Начать съемку, тапнув "СТАРТ".
    - assert: |
        - Счетчик "Количество фотографий" растет.
    - do: |
        Остановить съемку, тапнув "СТОП".
        В файловом менеджере зайти в папку <SdCard>/Android/data/com.yandex.maps.mrctestapp.testing/files/mrc/results.
    - assert: |
        - В указанной папке есть данные заездов.
    - do: |
        Вернуться на главный экран приложения.
        Зайти в раздел "Выгрузка данных".
        Запомнить количество фотографий, готовых к выгрузке.
        Вернуться на главный экран приложения.
        Зайти в раздел "Настройки".
        В настройках выбрать место хранения фотографий - "Внутренняя память".
    - assert: |
        - Началось перемещение данных на внутреннюю память устройства
        - По окончании перемещения появился тост "Перемещение данных завершено"
    - do: |
        Остановить приложение, выгрузив его из памяти.
        Снова открыть приложение.
        Зайти в раздел "Выгрузка данных".
    - assert: |
        - Количество фотографий, готовых к выгрузке, не изменилось.
    - do: |
        - В файловом менеджере зайти в папку <SdCard>/Android/data/com.yandex.maps.mrctestapp.testing/files/mrc/results.
    - assert: |
        - В указанной папке нет данных заездов - подпапки не содержат sqlite-файлов.
    - do: |
        - В файловом менеджере зайти в папку <InternalMemory/Android/data/com.yandex.maps.mrctestapp.testing/files/mrc/results.
    - assert: |
        - В указанной папке есть данные заездов.
    - do: |
        Вернуться на главный экран приложения.
        Зайти в раздел "Свободный заезд".
        Начать съемку, тапнув "СТАРТ".
    - assert: Счетчик "Количество фотографий" растет.
    - do: Остановить съемку.
    - assert: Съемка остановилась.

    - Test_type:
      - Acceptance
    - OS:
      - Android
    - SD_card:
      - Yes
