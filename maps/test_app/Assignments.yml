Components:
  - mobile_app_test
Feature:
  - Assignments

specs:
  Работа с заданиями. Новое задание:
    - description: Взятие нового задания
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Приложению выданы доступы к камере и геолокации.
    - do: |
        [collapsed-image](https://jing.yandex-team.ru/files/confeta/_20200518_194249.jpg){title=В табе "Доступные" тапнуть по синей области задания на карте.}
    - assert: |
        * Появилось диалоговое окно с названием задания и протяженностью маршрута
        * Есть кнопки "Отмена" и "Взять задание"
    - do: Тапнуть по кнопке "Взять задание".
    - assert: |
        * Диалоговое окно закрылось
        * Область выбранного задания стала белой
    - do: Зайти в таб "Мои задания".
    - assert: |
        * Новое задание появилось в списке заданий
        * У задания активна кнопка "Поехали"

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Список заданий:
    - description: Просмотр списка моих заданий
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Приложению выданы доступы к камере и геолокации.
    - do: |
        Зайти в таб "Мои задания".
        Если в списке отсутствует хотя бы одно задание в статусе В РАБОТЕ, перейти на таб "Доступные" и взять в работу любое задание, вернуться в таб "Мои задания".
    - assert: |
        * Открылся список моих заданий
        * Задания могут быть в трех статусах: В РАБОТЕ, ЗАВЕРШЕНО, ОСТАВЛЕНО
        * Для заданий В РАБОТЕ отображается:
          -- время до истечения срока выполнения задания
          -- расстояние, которое осталось проехать по маршруту задания в метрах или км
          -- прогресс-бар с оставшимся (голубой), пройденным (бледно-зеленый) и выгруженным (ярко-зеленый) маршрутом
        * По мере прохождения по маршруту значение в поле "Осталось проехать" уменьшается, а прогресс в прогресс-баре увеличивается

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Режим симуляции:
    - description: Выполнение задания в режиме симуляции
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Приложению выданы доступы к камере и геолокации.
    - do: |
        Зайти в таб "Мои задания".
        Если в списке отсутствует хотя бы одно задание в статусе В РАБОТЕ, перейти на таб "Доступные" и взять в работу любое задание.
        Зайти в таб "Доступные".
    - assert: На карте есть хотя бы одно с областью белого цвета - задание взято в работу.
    - do: |
        [collapsed-image](https://jing.yandex-team.ru/files/trurlik/%D1%81%D0%BA%D1%89%D0%B7.7b66793.png){title=В табе "Доступные" тапнуть по белой области взятого задания на карте.}
        Тапнуть по кнопке "Поехали".
    - assert: Открылся экран "Закрепите телефон"
    - do: Тапнуть по кнопке "Симуляция".
    - assert: |
        * Открылся экран выполнения задания
        * Изначально все улицы, по которым нужно проехать для выполнения задания, выделены синим цветом
    - do: |
        Построить маршрут.
        Начать движение по маршруту в режиме симуляции.
    - assert: |
        * Синее выделение пропадает с карты после проезда по выбранным улицам
        * На панели слева по ходу выполнения задания информация обновляется:
          – время, затраченное на пройденный маршрут, увеличивается
          – протяженность целей, которые осталось пройти, уменьшается
          – прогресс-бар пройденной части маршрута и километраж увеличиваются
    - do: Дождаться выполнения >90% задания.
    - assert: Вся информация в блоке продолжает меняться и обновляться

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Построение маршрута:
    - description: Построение и движение по маршруту в режиме симуляции
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Приложению выданы доступы к камере и геолокации.
    - do: |
        Зайти в таб "Доступные".
        Взять любое задание в работу.
    - assert: Задание успешно взято в работу, область задания пометилась белым цветом.
    - do: |
        В табе "Доступные" тапнуть по белой области взятого задания на карте.
        Тапнуть по кнопке "Поехали".
        На экране "Закрепите телефон" тапнуть по кнопке "Симуляция".
    - do: |
        Лонгтапом по карте выбрать начальную точку движения (А).
        Нажать на кнопку построения маршрута (изогнутая стрелка).
    - assert: Появилось диалоговое окно "Маршрут готов" с протяженностью маршрута в км и кнопками "Отмена" и "Поехали"
    - do: Тапнуть по кнопке "Поехали".
    - assert: |
        - Диалоговое окно закрылось
        - Карта отцентрировалась на метке местоположения
        - Началась симуляция движения по маршруту
        - Серой линией на карте указан маршрут движения

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Невозможно взять задание двумя пользователями:
    - description: После получения задания другим пользователем область выбранного задания пропадает с карты
    - info: |
        Залогиниться с двух мобильных устройств разными аккаунтами.
        На одном из устройств взять любое задание в работу.
    - do: |
        Запомнить расположение взятого задания.
        На другом устройстве найти расположение взятого ранее в работу задания.
    - assert: На карте нет синей области задания для взятия его в работу

    - Test_type:
      - Acceptance
    - OS:
      - Android
    - Specific:
      - ">=2 devices"


  Работа с заданиями. Отказаться от задания:
    - description: Отказ от взятого в работу задания
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Взять любое задание в работу.
        Зайти в таб "Мои задания".
    - do: В табе "Мои задания" у задания в работе тапнуть по иконке меню ⋮
    - assert: |
        Появилось меню с двумя пунктами: "Завершить" и "Отказаться"
    - do: |
        Тапнуть по пункту "Отказаться".
        Тапнуть по кнопке "ОК".
    - assert: |
        * У выбранного задания статус сменился на ОСТАВЛЕНО
        * Вместо кнопки "Поехали" - серая некликабельная галка
        * Значений "Истекает", "Осталось проехать" и прогресс-бара нет
        * В плашке выгрузки внизу экрана из размера фотографий, готовых к выгрузке, вычелся размер фотографий, сделанных во время проезда по отмененному заданию
    - do: |
        Зайти в таб "Доступные".
        Найти на карте отмененное задание.
    - assert: На карте область задания синего цвета
    - do: |
        Залогиниться любым другим пользователем.
        Зайти в таб "Доступные".
        Найти на карте отмененное первым пользователем задание.
    - assert: |
        * На карте область задания синего цвета
        * Задание можно взять в работу

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Выгрузка через Wi-Fi:
    - description: Фотографии выгружаются через Wi-Fi
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Взять любое короткое (до 5 км) задание в работу.
        Выполнить задание минимум на 1%.
        Зайти в таб "Мои задания".
        Отключить мобильный интернет.
        Подключиться к Wi-Fi.
    - do: |
        В табе "Мои задания" тапнуть по зеленой кнопке выгрузки: ↑
    - assert: |
        * Началась выгрузка фотографий
        * Кнопка выгрузки сменилась на кнопку паузы: ![image](https://jing.yandex-team.ru/files/magicman/1.jpg)
    - do: Дождаться окончания выгрузки фотографий.
    - assert: Выгрузка фотографий успешно завершилась

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Выгрузка через сотовую сеть:
    - description: Фотографии выгружаются через сотовую сеть
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Взять любое короткое (до 5 км) задание в работу.
        Выполнить задание минимум на 1%.
        Зайти в таб "Доступные".
    - do: |
        На девайсе отключить Wi-Fi.
        Тапнуть по иконке "Настройки": ![image](https://jing.yandex-team.ru/files/magicman/3.jpg)
        В настройках включить чекбокс "Разрешить выгрузку через сотовую сеть".
        Вернуться в раздел "Работа с заданиями".
        Зайти в таб "Мои задания" и тапнуть по зеленой кнопке выгрузки: ↑
    - assert: |
        * Началась выгрузка фотографий
        * Кнопка выгрузки сменилась на кнопку паузы: ![image](https://jing.yandex-team.ru/files/magicman/1.jpg)
    - do: Дождаться окончания выгрузки фотографий.
    - assert: Выгрузка фотографий успешно завершилась

    - Test_type:
      - Acceptance
    - OS:
      - Android


  Работа с заданиями. Выгрузка. Пауза:
    - description: Тапом по кнопке "Пауза" выгрузка фотографий прекращается
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Взять любое задание в работу.
        Выполнить задание минимум на 1%.
        Зайти в таб "Мои задания".
    - do: |
        В табе "Мои задания" тапнуть по зеленой кнопке выгрузки: ↑
    - assert: |
        * Началась выгрузка фотографий
        * Кнопка выгрузки сменилась на кнопку паузы: ![image](https://jing.yandex-team.ru/files/magicman/1.jpg)
    - do: Тапнуть по кнопке паузы.
    - assert: |
        * Процесс выгрузки фотографий остановился
        * Кнопка паузы сменилась на кнопку выгрузки
    - do: Снова тапнуть по кнопке выгрузки.
    - assert: |
        * Продолжился процесс выгрузки фотографий
        * Кнопка выгрузки сменилась на кнопку паузы
    - do: Дождаться окончания выгрузки фотографий.
    - assert: Выгрузка фотографий успешно завершилась

    - Test_type:
      - Regression
    - OS:
      - Android


  Работа с заданиями. Завершить задание:
    - description: Завершение выполненного задания
    - info: |
        Залогиниться в приложении.
        Зайти в раздел "Работа с заданиями".
        Взять любое короткое (до 5 км) задание в работу.
        Проехать не менее 10% задания.
        Выгрузить снимки.
        Зайти в таб "Мои задания".
    - do: В табе "Мои задания" у задания в работе тапнуть по иконке меню ⋮
    - assert: |
        Появилось меню с двумя пунктами: "Завершить" и "Отказаться"
    - do: |
        Тапнуть по пункту "Завершить".
        Тапнуть по кнопке "ОК".
    - assert: |
        * [collapsed-image](https://jing.yandex-team.ru/files/magicman/photo_2020-05-28_18-52-09.jpg){title=У выбранного задания статус сменился на "Завершено"}
        * Вместо кнопки "Поехали" - зеленая некликабельная галка
        * Значений "Истекает", "Осталось проехать" и прогресс-бара нет

    - Test_type:
      - Acceptance
    - OS:
      - Android

