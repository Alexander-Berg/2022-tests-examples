{
    "HeavyWorkerThreads": 4,
    "HttpServer": {
        "Port": {{port}}
    },

    "Logs": {
        "Rules": [
            {
                "FilePath": "{{global_log}}",
                "IncludeCategories": [
                    "Main",
                    "BigRT",
                    "Http"
                ],
                "MinLevel": "Debug"
            },
            {
                "ExcludeCategories": [
                    "AUTO"
                ],
                "FilePath": "{{yt_log}}",
                "MinLevel": "Error"
            }
        ]
    },

    "IdentificationConfig": {
    	"HedgingClientConfig": {
		    "BanDuration": 50,
		    "BanPenalty": 3,
		    "Clients": [
		        {
		            "ClientConfig": {
		                "ChannelPoolSize": 9,
		                "ClusterName": "{{yt_cluster}}",
		                "EnableRetries": true
		            },
		            "InitialPenalty": 0
		        }
		    ]
    	}
    },

    "Destinations": [
        {
            "DestinationName": "default",
            "Writer": {
                "MaxDelayBetweenQueueChangeMs": 1000,
                "Queues": [
                    {
                        "Cluster": "{{yt_cluster}}",
                        "Path": "{{output_queue}}"
                    }
                ]
            },
            "ReshardingHashFunction": "BigbHash",
            "ShardsCount": 3072,
            "ReshardingMode": "RM_MODULE",
            "SampleShardsMax": 10
        }
    ],

    "ResourcesReloaderConfig": {
        "ReloadPeriodS": 300,
        "SelectTypeFile": "./bsyeti-configs/select_type.json",
        "AbExperimentsLongConfig": "./just_default_and_predefault.json"
    },

    "SharedTransactionPeriod": 50,

    "Sources": [
        {
            "RowsProcessor": {
                "Splitter": { "LogfellerSplitter": "\n" },
                "MessageType": "PROFILE_SERVICE",
                "MaxOutputChunksCount": 1,
                "Parser": {
                    "FromJson": {"TimeStamp": "TimeStamp", "ProfileID": "ProfileID", "StandVersion":  "StandVersion"}
                }
            },
            "ResharderInstance": {
                "ConsumingSystem": {
                    "MainPath": "{{main_path}}",
                    "MaxShards": {{max_shards}},
                    "MaxShardsToCheck": 4,
                    "Shards": {
                        "AutoResolve": {}
                    },
                    "ThreadLabelPrefix": "test_log",
                    "WorkerMinorName": "{{worker_minor_name}}",
                    "StartDelayMinMs": 0,
                    "StartDelayRandomPartMs": 1,
                    "DesiredTimeForTakingAllLocksMs": 100,
                    "DelayOnErrorMs": 10,
                    "DelayOnCreationBalancerErrorMs": 100,
                    "DelayOnUnequalShardOffsetsMs": 100,
                    "BalancerTimeoutMs": 5000,
                    "DelayOnMediatorRestartMs": 100,
                    "LaunchShardProcessorInFiber": true,
                    "MaxMessagesInProxyQueue": 2
                },
                "MaxMemoryUsage": 80000000,
                "SrcDcLabel": "dc_test",
                "StatelessShardProcessorConfig": {},
                "Suppliers": [
                    {
                        "Alias": "resharded_yt_log",
                        "YtSupplier": {
                            "QueueConsumer": "{{consumer}}",
                            "QueuePath": "{{input_queue}}",
                            "Cluster": "{{yt_cluster}}",
                            "MaxOutChunkSize": 1 {# test specific. NEVER use it with real YT clusters #}
                        }
                    }
                ]
            }
        }
    ],

    "YtCluster": "{{yt_cluster}}"
}
