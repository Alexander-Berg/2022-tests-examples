{
    "model_yt_dir": "//home/factordev/padese/search/0528_4v100_i6_different/model_different/bsl",
    "system": {
        "scheduler_max_workers": 24,
        "max_workers_per_gpu": 4,
        "num_downloaders": 100
    },
    "ttl_filter": {
        "frequency": 30
    },
    "snapshotter": {
        "frequency": 7200
    },
    "model": {
        "document": {
            "normalizers": {
                "Slice_rapid_clicks": {
                    "dim": 327,
                    "type": "logarithmic_scaled"
                },
                "Slice_rapid_pers_clicks": {
                    "dim": 76,
                    "type": "logarithmic_scaled"
                },
                "Slice_begemot_query_factors": {
                    "dim": 233,
                    "type": "logarithmic_scaled"
                }
            },
            "features": [
                "DocumentID",
                "DomainID",
                "OmniTitleBertNormedHash",
                "RalibUrlV1BertNormedHash",
                "Slice_rapid_clicks",
                "Slice_rapid_pers_clicks",
                "Slice_begemot_query_factors"
            ],
            "network_impl": {
                "factory_type": "orthogonal_linear_relu",
                "out_features": 16,
                "network_type": "weightnorm_embedding",
                "width": 10,
                "depth": 2,
                "split_depth": 1
            },
            "network_type": "generic_feed_forward",
            "external_feature_dims": {
                "Slice_rapid_clicks": 327,
                "Slice_rapid_pers_clicks": 76,
                "Slice_begemot_query_factors": 233
            }
        },
        "features": {
            "embeddings": {
                "default_algo_params": {
                    "expiration_ttl": 336,
                    "lr": 0.0001
                },
                "features": [
                    {
                        "dim": 2,
                        "name": "UserRegionID"
                    },
                    {
                        "dim": 2,
                        "name": "UserBestInterests"
                    },
                    {
                        "dim": 2,
                        "name": "UserLast10CatalogiaCategories"
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaAgeSegment"
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaGender"
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaIncome"
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaYandexLoyalty"
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaCommonSegments"
                    },
                    {
                        "dim": 2,
                        "name": "AffinitiveSites",
                        "features": [
                            "KryptaTopDomain",
                            "UserCryptaAffinitiveSitesIDs"
                        ]
                    },
                    {
                        "dim": 2,
                        "name": "UserCryptaInterests",
                        "features": [
                            "UserCryptaLongInterests",
                            "UserCryptaShortInterestsAll"
                        ]
                    },
                    {
                        "dim": 2,
                        "name": "UserTopCategories",
                        "features": [
                            "UserTop3BmCategoriesByInterestsFixed",
                            "UserTop1BmCategoriesByInterestsFixed",
                            "UserTop3BmCategoriesByUpdateTimeFixed",
                            "UserTop1BmCategoriesByUpdateTimeFixed",
                            "UserTop3BmCategoriesByEventTimeFixed",
                            "UserTop1BmCategoriesByEventTimeFixed"
                        ]
                    },
                    {
                        "dim": 2,
                        "name": "SearchQueryPositionalEmbedding"
                    },
                    {
                        "dim": 2,
                        "name": "BigBQuerySelectTypes"
                    },
                    {
                        "dim": 2,
                        "add_prob": 0.3,
                        "name": "SearchQueryTexts",
                        "features": [
                            "SearchQueryTextTokenLemma",
                            "BigBQueryTexts",
                            "QueryHistoryTexts"
                        ]
                    },
                    {
                        "dim": 2,
                        "name": "SearchQueryRegion",
                        "features": [
                            "SearchQueryRegion",
                            "QueryHistoryRegions"
                        ]
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys35"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys37"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys89"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys93"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys144"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys146"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys250"
                    },
                    {
                        "dim": 2,
                        "name": "CounterKeys671"
                    },
                    {
                        "dim": 2,
                        "name": "DocumentID",
                        "add_prob": 0.1
                    },
                    {
                        "dim": 2,
                        "name": "DomainID"
                    },
                    {
                        "dim": 2,
                        "name": "OmniTitleBertNormedHash",
                        "add_prob": 0.3
                    },
                    {
                        "dim": 2,
                        "name": "RalibUrlV1BertNormedHash",
                        "add_prob": 0.3
                    }
                ],
                "default_algo": "rmsprop_norm"
            },
            "external": [
                "CountersAggregatedValues",
                "VisitStatesFeatures",
                "BigBQueryFactors",
                "QueryHistoryFactors",
                "Slice_rapid_clicks",
                "Slice_rapid_pers_clicks",
                "Slice_begemot_query_factors"
            ]
        },
        "nn": {
            "warmup_steps": 1000,
            "learning_rate": 0.0001
        },
        "user": {
            "normalizers": {
                "VisitStatesFeatures": {
                    "dim": 7,
                    "type": "logarithmic_scaled"
                },
                "CountersAggregatedValues": {
                    "dim": 3828,
                    "type": "logarithmic_scaled"
                }
            },
            "features": [
                "KryptaTopDomain",
                "UserRegionID",
                "UserBestInterests",
                "UserLast10CatalogiaCategories",
                "UserCryptaAgeSegment",
                "UserCryptaGender",
                "UserCryptaIncome",
                "UserCryptaYandexLoyalty",
                "UserCryptaAffinitiveSitesIDs",
                "UserCryptaLongInterests",
                "UserCryptaShortInterestsAll",
                "UserCryptaCommonSegments",
                "UserTop3BmCategoriesByInterestsFixed",
                "UserTop1BmCategoriesByInterestsFixed",
                "UserTop3BmCategoriesByUpdateTimeFixed",
                "UserTop1BmCategoriesByUpdateTimeFixed",
                "UserTop3BmCategoriesByEventTimeFixed",
                "UserTop1BmCategoriesByEventTimeFixed",
                "CountersAggregatedValues",
                "VisitStatesFeatures",
                "SearchQueryRegion",
                "SearchQueryTextTokenLemma",
                "CounterKeys35",
                "CounterKeys37",
                "CounterKeys89",
                "CounterKeys93",
                "CounterKeys144",
                "CounterKeys146",
                "CounterKeys250",
                "CounterKeys671"
            ],
            "sub_networks": {
                "QueryHistoryTransformer": {
                    "attention": "linear",
                    "init_type": "t-fixup",
                    "linear_type": "orthogonal",
                    "d_model": 10,
                    "sub_networks": {
                        "QueryHistoryTransformerSeq": {
                            "max_seq_len": 80,
                            "combine_type": "plain_sum",
                            "embeddings": [
                                "QueryHistoryTexts",
                                "QueryHistoryRegions"
                            ],
                            "network_type": "multisequence_tranformer_input_sequence_builder"
                        }
                    },
                    "num_layers": 1,
                    "transformer_type": "ads_pytorch",
                    "network_type": "multisequence_transformer_encoder2"
                },
                "BigBQueryTransformer": {
                    "attention": "linear",
                    "init_type": "t-fixup",
                    "linear_type": "orthogonal",
                    "d_model": 10,
                    "sub_networks": {
                        "BigBQueryTransformerSeq": {
                            "max_seq_len": 20,
                            "combine_type": "plain_sum",
                            "embeddings": [
                                "BigBQueryTexts",
                                "BigBQuerySelectTypes"
                            ],
                            "network_type": "multisequence_tranformer_input_sequence_builder"
                        }
                    },
                    "num_layers": 1,
                    "transformer_type": "ads_pytorch",
                    "network_type": "multisequence_transformer_encoder2"
                },
                "SearchQueryTransformer": {
                    "attention": "linear",
                    "init_type": "t-fixup",
                    "linear_type": "orthogonal",
                    "d_model": 5,
                    "sub_networks": {
                        "SearchQueryTransformerSeq": {
                            "combine_type": "plain_sum",
                            "embeddings": [
                                "SearchQueryPositionalEmbedding",
                                "SearchQueryTextTokenLemma",
                                "SearchQueryRegion"
                            ],
                            "network_type": "multisequence_tranformer_input_sequence_builder"
                        }
                    },
                    "num_layers": 1,
                    "transformer_type": "ads_pytorch",
                    "network_type": "multisequence_transformer_encoder2"
                }
            },
            "network_impl": {
                "factory_type": "orthogonal_linear_relu",
                "out_features": 16,
                "network_type": "weightnorm_embedding",
                "width": 10,
                "depth": 2,
                "split_depth": 1
            },
            "network_type": "generic_feed_forward",
            "external_feature_dims": {
                "VisitStatesFeatures": 7,
                "CountersAggregatedValues": 3828
            }
        }
    },
    "evaluation": {
        "eval_confs": [
            {
                "datetime_format": "%Y%m%d%H%M",
                "name": "train",
                "end_date": "202103212100",
                "keys": [
                    "RequestIDHash",
                    "DocumentID"
                ],
                "shifts": [
                    10
                ],
                "table": "//home/factordev/padese/search/pools/time_split_point_2021-03-08/train_pool_torch",
                "start_date": "202103072100"
            },
            {
                "datetime_format": "%Y%m%d%H%M",
                "name": "test",
                "end_date": "202103212100",
                "keys": [
                    "RequestIDHash",
                    "DocumentID"
                ],
                "shifts": [
                    10
                ],
                "table": "//home/factordev/padese/search/pools/time_split_point_2021-03-08/eval_pool_torch",
                "start_date": "202103072100"
            }
        ]
    },
    "train_data": {
        "datetime_format": "%Y%m%d%H%M",
        "table": "//home/factordev/padese/search/pools/time_split_point_2021-03-08/train_pool_torch",
        "start_date": "202102082100",
        "end_date": "202103212100",
        "targets": [
            "PersTarget",
            "OddTarget",
            "LogDtTarget",
            "TrTarget",
            "RequestIDHash"
        ]
    }
}
